<!DOCTYPE html><html lang="zh-hans" dir="ltr"><head><meta charSet="utf-8"/><link rel="preconnect" href="https://1FCF9AYYAT-dsn.algolia.net"/><link rel="preload" as="style" href="/_next/static/css/69c3dd7f95e90f41.css"/><script async="" src="https://www.googletagmanager.com/gtag/js?id=G-B1E83PJ3RT"></script><link rel="preload" as="script" href="/_next/static/chunks/webpack-7aa5606533a0da22.js"/><link rel="preload" as="script" href="/_next/static/chunks/framework-60dbcc17f2b10a40.js"/><link rel="preload" as="script" href="/_next/static/chunks/main-691602c61f9ae952.js"/><link rel="preload" as="script" href="/_next/static/chunks/pages/_app-91cab47494e285be.js"/><link rel="preload" as="script" href="/_next/static/chunks/181-0c884f228c508338.js"/><link rel="preload" as="script" href="/_next/static/chunks/962-d27b3139d5233d22.js"/><link rel="preload" as="script" href="/_next/static/chunks/pages/%5B%5B...markdownPath%5D%5D-3fa615249ba59b83.js"/><link rel="preload" as="script" href="/_next/static/o3sV9gi4zL8eH-vfCdLA_/_buildManifest.js"/><link rel="preload" as="script" href="/_next/static/o3sV9gi4zL8eH-vfCdLA_/_ssgManifest.js"/><link rel="preload" href="/fonts/Source-Code-Pro-Regular.woff2" as="font" type="font/woff2" crossorigin="anonymous"/><link rel="preload" href="https://react.dev/fonts/Optimistic_Display_W_Md.woff2" as="font" type="font/woff2" crossorigin="anonymous"/><link rel="preload" href="https://react.dev/fonts/Optimistic_Display_W_SBd.woff2" as="font" type="font/woff2" crossorigin="anonymous"/><link rel="preload" href="https://react.dev/fonts/Optimistic_Display_W_Bd.woff2" as="font" type="font/woff2" crossorigin="anonymous"/><link rel="preload" href="https://react.dev/fonts/Optimistic_Text_W_Md.woff2" as="font" type="font/woff2" crossorigin="anonymous"/><link rel="preload" href="https://react.dev/fonts/Optimistic_Text_W_Bd.woff2" as="font" type="font/woff2" crossorigin="anonymous"/><link rel="preload" href="https://react.dev/fonts/Optimistic_Text_W_Rg.woff2" as="font" type="font/woff2" crossorigin="anonymous"/><link rel="preload" href="https://react.dev/fonts/Optimistic_Text_W_It.woff2" as="font" type="font/woff2" crossorigin="anonymous"/><link rel="preload" href="/_next/static/css/69c3dd7f95e90f41.css" as="style"/><meta name="viewport" content="width=device-width, initial-scale=1"/><title>React 19 RC – React 中文文档</title><link rel="canonical" href="https://zh-hans.react.dev/blog/2024/04/25/react-19"/><link rel="alternate" href="https://react.dev/blog/2024/04/25/react-19" hrefLang="x-default"/><link rel="alternate" hrefLang="en" href="https://react.dev/blog/2024/04/25/react-19"/><link rel="alternate" hrefLang="zh-hans" href="https://zh-hans.react.dev/blog/2024/04/25/react-19"/><link rel="alternate" hrefLang="es" href="https://es.react.dev/blog/2024/04/25/react-19"/><link rel="alternate" hrefLang="fr" href="https://fr.react.dev/blog/2024/04/25/react-19"/><link rel="alternate" hrefLang="ja" href="https://ja.react.dev/blog/2024/04/25/react-19"/><link rel="alternate" hrefLang="tr" href="https://tr.react.dev/blog/2024/04/25/react-19"/><link rel="alternate" hrefLang="ko" href="https://ko.react.dev/blog/2024/04/25/react-19"/><meta property="fb:app_id" content="623268441017527"/><meta property="og:type" content="website"/><meta property="og:url" content="https://zh-hans.react.dev/blog/2024/04/25/react-19"/><meta property="og:title" content="React 19 RC – React 中文文档"/><meta property="og:description" content="The library for web and native user interfaces"/><meta property="og:image" content="https://zh-hans.react.dev/images/og-blog.png"/><meta name="twitter:card" content="summary_large_image"/><meta name="twitter:site" content="@reactjs"/><meta name="twitter:creator" content="@reactjs"/><meta name="twitter:title" content="React 19 RC – React 中文文档"/><meta name="twitter:description" content="The library for web and native user interfaces"/><meta name="twitter:image" content="https://zh-hans.react.dev/images/og-blog.png"/><meta name="google-site-verification" content="sIlAGs48RulR4DdP95YSWNKZIEtCqQmRjzn-Zq-CcD0"/><meta name="algolia-search-order" content="5"/><meta name="next-head-count" content="36"/><link rel="apple-touch-icon" sizes="180x180" href="/apple-touch-icon.png"/><link rel="icon" type="image/png" sizes="32x32" href="/favicon-32x32.png"/><link rel="icon" type="image/png" sizes="16x16" href="/favicon-16x16.png"/><link rel="manifest" href="/site.webmanifest"/><link rel="mask-icon" href="/safari-pinned-tab.svg" color="#404756"/><meta name="msapplication-TileColor" content="#2b5797"/><meta name="theme-color" content="#23272f"/><link rel="preload" as="image" imageSrcSet="/_next/image?url=%2Fimages%2Fuwu.png&amp;w=64&amp;q=75 1x, /_next/image?url=%2Fimages%2Fuwu.png&amp;w=128&amp;q=75 2x" fetchPriority="high"/><link rel="stylesheet" href="/_next/static/css/69c3dd7f95e90f41.css" data-n-g=""/><noscript data-n-css=""></noscript><script defer="" noModule="" src="/_next/static/chunks/polyfills-c67a75d1b6f99dc8.js"></script><script src="/_next/static/chunks/webpack-7aa5606533a0da22.js" defer=""></script><script src="/_next/static/chunks/framework-60dbcc17f2b10a40.js" defer=""></script><script src="/_next/static/chunks/main-691602c61f9ae952.js" defer=""></script><script src="/_next/static/chunks/pages/_app-91cab47494e285be.js" defer=""></script><script src="/_next/static/chunks/181-0c884f228c508338.js" defer=""></script><script src="/_next/static/chunks/962-d27b3139d5233d22.js" defer=""></script><script src="/_next/static/chunks/pages/%5B%5B...markdownPath%5D%5D-3fa615249ba59b83.js" defer=""></script><script src="/_next/static/o3sV9gi4zL8eH-vfCdLA_/_buildManifest.js" defer=""></script><script src="/_next/static/o3sV9gi4zL8eH-vfCdLA_/_ssgManifest.js" defer=""></script></head><script>window.dataLayer = window.dataLayer || [];function gtag(){dataLayer.push(arguments);}gtag('js', new Date());gtag('config', 'G-B1E83PJ3RT');</script><body class="font-text font-medium antialiased text-lg bg-wash dark:bg-wash-dark text-secondary dark:text-secondary-dark leading-base"><script>
              (function () {
                try {
                  let logShown = false;
                  function setUwu(isUwu) {
                    try {
                      if (isUwu) {
                        localStorage.setItem('uwu', true);
                        document.documentElement.classList.add('uwu');
                        if (!logShown) {
                          console.log('uwu mode! turn off with ?uwu=0');
                          console.log('logo credit to @sawaratsuki1004 via https://github.com/SAWARATSUKI/ServiceLogos');
                          logShown = true;
                        }
                      } else {
                        localStorage.removeItem('uwu');
                        document.documentElement.classList.remove('uwu');
                        console.log('uwu mode off. turn on with ?uwu');
                      }
                    } catch (err) { }
                  }
                  window.__setUwu = setUwu;
                  function checkQueryParam() {
                    const params = new URLSearchParams(window.location.search);
                    const value = params.get('uwu');
                    switch(value) {
                      case '':
                      case 'true':
                      case '1':
                        return true;
                      case 'false':
                      case '0':
                        return false;
                      default:
                        return null;
                    }
                  }
                  function checkLocalStorage() {
                    try {
                      return localStorage.getItem('uwu') === 'true';
                    } catch (err) {
                      return false;
                    }
                  }
                  const uwuQueryParam = checkQueryParam();
                  if (uwuQueryParam != null) {
                    setUwu(uwuQueryParam);
                  } else if (checkLocalStorage()) {
                    document.documentElement.classList.add('uwu');
                  }
                } catch (err) { }
              })();
            </script><script>
                (function () {
                  function setTheme(newTheme) {
                    window.__theme = newTheme;
                    if (newTheme === 'dark') {
                      document.documentElement.classList.add('dark');
                    } else if (newTheme === 'light') {
                      document.documentElement.classList.remove('dark');
                    }
                  }

                  var preferredTheme;
                  try {
                    preferredTheme = localStorage.getItem('theme');
                  } catch (err) { }

                  window.__setPreferredTheme = function(newTheme) {
                    preferredTheme = newTheme;
                    setTheme(newTheme);
                    try {
                      localStorage.setItem('theme', newTheme);
                    } catch (err) { }
                  };

                  var initialTheme = preferredTheme;
                  var darkQuery = window.matchMedia('(prefers-color-scheme: dark)');

                  if (!initialTheme) {
                    initialTheme = darkQuery.matches ? 'dark' : 'light';
                  }
                  setTheme(initialTheme);

                  darkQuery.addEventListener('change', function (e) {
                    if (!preferredTheme) {
                      setTheme(e.matches ? 'dark' : 'light');
                    }
                  });

                  // Detect whether the browser is Mac to display platform specific content
                  // An example of such content can be the keyboard shortcut displayed in the search bar
                  document.documentElement.classList.add(
                      window.navigator.platform.includes('Mac')
                      ? "platform-mac" 
                      : "platform-win"
                  );
                })();
              </script><div id="__next"><div></div><div class="z-40 sticky top-0"><nav class="duration-300 backdrop-filter backdrop-blur-lg backdrop-saturate-200 transition-shadow bg-opacity-90 items-center w-full flex justify-between bg-wash dark:bg-wash-dark dark:bg-opacity-95 px-1.5 lg:pe-5 lg:ps-4 z-40"><div class="flex items-center justify-between w-full h-16 gap-0 sm:gap-3"><div class="flex flex-row 3xl:flex-1 items-centers"><button type="button" aria-label="Menu" class="active:scale-95 transition-transform flex lg:hidden w-12 h-12 rounded-full items-center justify-center hover:bg-primary/5 hover:dark:bg-primary-dark/5 outline-link"><svg width="1.33em" height="1.33em" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><line x1="3" y1="12" x2="21" y2="12"></line><line x1="3" y1="6" x2="21" y2="6"></line><line x1="3" y1="18" x2="21" y2="18"></line></svg></button><span data-state="closed" class="flex items-center" style="-webkit-touch-callout:none"><div class="flex items-center"><div class="uwu-visible flex items-center justify-center h-full"><a href="/"><img alt="logo by @sawaratsuki1004" title="logo by @sawaratsuki1004" fetchPriority="high" width="63" height="32" decoding="async" data-nimg="1" class="h-8" style="color:transparent" srcSet="/_next/image?url=%2Fimages%2Fuwu.png&amp;w=64&amp;q=75 1x, /_next/image?url=%2Fimages%2Fuwu.png&amp;w=128&amp;q=75 2x" src="/_next/image?url=%2Fimages%2Fuwu.png&amp;w=128&amp;q=75"/></a></div><div class="uwu-hidden"><a class="active:scale-95 overflow-hidden transition-transform relative items-center text-primary dark:text-primary-dark p-1 whitespace-nowrap outline-link rounded-full 3xl:rounded-xl inline-flex text-lg font-normal gap-2" href="/"><svg width="100%" height="100%" viewBox="-10.5 -9.45 21 18.9" fill="none" xmlns="http://www.w3.org/2000/svg" class="text-sm me-0 w-10 h-10 text-brand dark:text-brand-dark flex origin-center transition-all ease-in-out"><circle cx="0" cy="0" r="2" fill="currentColor"></circle><g stroke="currentColor" stroke-width="1" fill="none"><ellipse rx="10" ry="4.5"></ellipse><ellipse rx="10" ry="4.5" transform="rotate(60)"></ellipse><ellipse rx="10" ry="4.5" transform="rotate(120)"></ellipse></g></svg><span class="sr-only 3xl:not-sr-only">React</span></a></div></div></span><div class="flex flex-column justify-center items-center"><a class=" flex py-2 flex-column justify-center items-center text-gray-50 dark:text-gray-30 hover:text-link hover:dark:text-link-dark hover:underline text-sm ms-1 cursor-pointer" href="/versions">v<!-- -->18.3.1</a></div></div><div class="items-center justify-center flex-1 hidden w-full md:flex 3xl:w-auto 3xl:shrink-0 3xl:justify-center"><button type="button" class="flex 3xl:w-[56rem] 3xl:mx-0 relative ps-4 pe-1 py-1 h-10 bg-gray-30/20 dark:bg-gray-40/20 outline-none focus:outline-link betterhover:hover:bg-opacity-80 pointer items-center text-start w-full text-gray-30 rounded-full align-middle text-base"><svg width="1em" height="1em" viewBox="0 0 20 20" class="align-middle me-3 text-gray-30 shrink-0 group-betterhover:hover:text-gray-70"><path d="M14.386 14.386l4.0877 4.0877-4.0877-4.0877c-2.9418 2.9419-7.7115 2.9419-10.6533 0-2.9419-2.9418-2.9419-7.7115 0-10.6533 2.9418-2.9419 7.7115-2.9419 10.6533 0 2.9419 2.9418 2.9419 7.7115 0 10.6533z" stroke="currentColor" fill="none" stroke-width="2" fill-rule="evenodd" stroke-linecap="round" stroke-linejoin="round"></path></svg>搜索<span class="hidden ms-auto sm:flex item-center me-1"><kbd class="w-5 h-5 border border-transparent me-1 bg-wash dark:bg-wash-dark text-gray-30 align-middle p-0 inline-flex justify-center items-center text-xs text-center rounded-md" data-platform="mac">⌘</kbd><kbd class="w-10 h-5 border border-transparent me-1 bg-wash dark:bg-wash-dark text-gray-30 align-middle p-0 inline-flex justify-center items-center text-xs text-center rounded-md" data-platform="win">Ctrl</kbd><kbd class="w-5 h-5 border border-transparent me-1 bg-wash dark:bg-wash-dark text-gray-30 align-middle p-0 inline-flex justify-center items-center text-xs text-center rounded-md">K</kbd></span></button></div><div class="text-base justify-center items-center gap-1.5 flex 3xl:flex-1 flex-row 3xl:justify-end"><div class="mx-2.5 gap-1.5 hidden lg:flex"></div><div class="flex w-full md:hidden"></div><div class="flex items-center -space-x-2.5 xs:space-x-0 "><div class="flex md:hidden"><button aria-label="Search" type="button" class="flex items-center justify-center w-12 h-12 transition-transform rounded-full active:scale-95 md:hidden hover:bg-secondary-button hover:dark:bg-secondary-button-dark outline-link"><svg width="1em" height="1em" viewBox="0 0 20 20" class="w-5 h-5 align-middle"><path d="M14.386 14.386l4.0877 4.0877-4.0877-4.0877c-2.9418 2.9419-7.7115 2.9419-10.6533 0-2.9419-2.9418-2.9419-7.7115 0-10.6533 2.9418-2.9419 7.7115-2.9419 10.6533 0 2.9419 2.9418 2.9419 7.7115 0 10.6533z" stroke="currentColor" fill="none" stroke-width="2" fill-rule="evenodd" stroke-linecap="round" stroke-linejoin="round"></path></svg></button></div><div class="flex dark:hidden"><button type="button" aria-label="Use Dark Mode" class="flex items-center justify-center w-12 h-12 transition-transform rounded-full active:scale-95 hover:bg-primary/5 hover:dark:bg-primary-dark/5 outline-link"><svg xmlns="http://www.w3.org/2000/svg" width="28" height="28" viewBox="0 0 32 32"><g fill="none" fill-rule="evenodd" transform="translate(-440 -200)"><path fill="currentColor" fill-rule="nonzero" stroke="currentColor" stroke-width="0.5" d="M102,21 C102,18.1017141 103.307179,15.4198295 105.51735,13.6246624 C106.001939,13.2310647 105.821611,12.4522936 105.21334,12.3117518 C104.322006,12.1058078 103.414758,12 102.5,12 C95.8722864,12 90.5,17.3722864 90.5,24 C90.5,30.6277136 95.8722864,36 102.5,36 C106.090868,36 109.423902,34.4109093 111.690274,31.7128995 C112.091837,31.2348572 111.767653,30.5041211 111.143759,30.4810139 C106.047479,30.2922628 102,26.1097349 102,21 Z M102.5,34.5 C96.7007136,34.5 92,29.7992864 92,24 C92,18.2007136 96.7007136,13.5 102.5,13.5 C102.807386,13.5 103.113925,13.5136793 103.419249,13.5407785 C101.566047,15.5446378 100.5,18.185162 100.5,21 C100.5,26.3198526 104.287549,30.7714322 109.339814,31.7756638 L109.516565,31.8092927 C107.615276,33.5209452 105.138081,34.5 102.5,34.5 Z" transform="translate(354.5 192)"></path><polygon points="444 228 468 228 468 204 444 204"></polygon></g></svg></button></div><div class="hidden dark:flex"><button type="button" aria-label="Use Light Mode" class="flex items-center justify-center w-12 h-12 transition-transform rounded-full active:scale-95 hover:bg-primary/5 hover:dark:bg-primary-dark/5 outline-link"><svg xmlns="http://www.w3.org/2000/svg" width="32" height="32" viewBox="0 0 32 32"><g fill="none" fill-rule="evenodd" transform="translate(-442 -200)"><g fill="currentColor" transform="translate(356 144)"><path fill-rule="nonzero" d="M108.5 24C108.5 27.5902136 105.590214 30.5 102 30.5 98.4097864 30.5 95.5 27.5902136 95.5 24 95.5 20.4097864 98.4097864 17.5 102 17.5 105.590214 17.5 108.5 20.4097864 108.5 24zM107 24C107 21.2382136 104.761786 19 102 19 99.2382136 19 97 21.2382136 97 24 97 26.7617864 99.2382136 29 102 29 104.761786 29 107 26.7617864 107 24zM101 12.75L101 14.75C101 15.1642136 101.335786 15.5 101.75 15.5 102.164214 15.5 102.5 15.1642136 102.5 14.75L102.5 12.75C102.5 12.3357864 102.164214 12 101.75 12 101.335786 12 101 12.3357864 101 12.75zM95.7255165 14.6323616L96.7485165 16.4038616C96.9556573 16.7625614 97.4143618 16.8854243 97.7730616 16.6782835 98.1317614 16.4711427 98.2546243 16.0124382 98.0474835 15.6537384L97.0244835 13.8822384C96.8173427 13.5235386 96.3586382 13.4006757 95.9999384 13.6078165 95.6412386 13.8149573 95.5183757 14.2736618 95.7255165 14.6323616zM91.8822384 19.0244835L93.6537384 20.0474835C94.0124382 20.2546243 94.4711427 20.1317614 94.6782835 19.7730616 94.8854243 19.4143618 94.7625614 18.9556573 94.4038616 18.7485165L92.6323616 17.7255165C92.2736618 17.5183757 91.8149573 17.6412386 91.6078165 17.9999384 91.4006757 18.3586382 91.5235386 18.8173427 91.8822384 19.0244835zM90.75 25L92.75 25C93.1642136 25 93.5 24.6642136 93.5 24.25 93.5 23.8357864 93.1642136 23.5 92.75 23.5L90.75 23.5C90.3357864 23.5 90 23.8357864 90 24.25 90 24.6642136 90.3357864 25 90.75 25zM92.6323616 30.2744835L94.4038616 29.2514835C94.7625614 29.0443427 94.8854243 28.5856382 94.6782835 28.2269384 94.4711427 27.8682386 94.0124382 27.7453757 93.6537384 27.9525165L91.8822384 28.9755165C91.5235386 29.1826573 91.4006757 29.6413618 91.6078165 30.0000616 91.8149573 30.3587614 92.2736618 30.4816243 92.6323616 30.2744835zM97.0244835 34.1177616L98.0474835 32.3462616C98.2546243 31.9875618 98.1317614 31.5288573 97.7730616 31.3217165 97.4143618 31.1145757 96.9556573 31.2374386 96.7485165 31.5961384L95.7255165 33.3676384C95.5183757 33.7263382 95.6412386 34.1850427 95.9999384 34.3921835 96.3586382 34.5993243 96.8173427 34.4764614 97.0244835 34.1177616zM103 35.25L103 33.25C103 32.8357864 102.664214 32.5 102.25 32.5 101.835786 32.5 101.5 32.8357864 101.5 33.25L101.5 35.25C101.5 35.6642136 101.835786 36 102.25 36 102.664214 36 103 35.6642136 103 35.25zM108.274483 33.3676384L107.251483 31.5961384C107.044343 31.2374386 106.585638 31.1145757 106.226938 31.3217165 105.868239 31.5288573 105.745376 31.9875618 105.952517 32.3462616L106.975517 34.1177616C107.182657 34.4764614 107.641362 34.5993243 108.000062 34.3921835 108.358761 34.1850427 108.481624 33.7263382 108.274483 33.3676384zM112.117762 28.9755165L110.346262 27.9525165C109.987562 27.7453757 109.528857 27.8682386 109.321717 28.2269384 109.114576 28.5856382 109.237439 29.0443427 109.596138 29.2514835L111.367638 30.2744835C111.726338 30.4816243 112.185043 30.3587614 112.392183 30.0000616 112.599324 29.6413618 112.476461 29.1826573 112.117762 28.9755165zM113.25 23L111.25 23C110.835786 23 110.5 23.3357864 110.5 23.75 110.5 24.1642136 110.835786 24.5 111.25 24.5L113.25 24.5C113.664214 24.5 114 24.1642136 114 23.75 114 23.3357864 113.664214 23 113.25 23zM111.367638 17.7255165L109.596138 18.7485165C109.237439 18.9556573 109.114576 19.4143618 109.321717 19.7730616 109.528857 20.1317614 109.987562 20.2546243 110.346262 20.0474835L112.117762 19.0244835C112.476461 18.8173427 112.599324 18.3586382 112.392183 17.9999384 112.185043 17.6412386 111.726338 17.5183757 111.367638 17.7255165zM106.975517 13.8822384L105.952517 15.6537384C105.745376 16.0124382 105.868239 16.4711427 106.226938 16.6782835 106.585638 16.8854243 107.044343 16.7625614 107.251483 16.4038616L108.274483 14.6323616C108.481624 14.2736618 108.358761 13.8149573 108.000062 13.6078165 107.641362 13.4006757 107.182657 13.5235386 106.975517 13.8822384z" transform="translate(0 48)" stroke="currentColor" stroke-width="0.25"></path><path d="M98.6123,60.1372 C98.6123,59.3552 98.8753,58.6427 99.3368,58.0942 C99.5293,57.8657 99.3933,57.5092 99.0943,57.5017 C99.0793,57.5012 99.0633,57.5007 99.0483,57.5007 C97.1578,57.4747 95.5418,59.0312 95.5008,60.9217 C95.4578,62.8907 97.0408,64.5002 98.9998,64.5002 C99.7793,64.5002 100.4983,64.2452 101.0798,63.8142 C101.3183,63.6372 101.2358,63.2627 100.9478,63.1897 C99.5923,62.8457 98.6123,61.6072 98.6123,60.1372" transform="translate(3 11)"></path></g><polygon points="444 228 468 228 468 204 444 204"></polygon></g></svg></button></div><div class="flex"><a class="active:scale-95 transition-transform flex w-12 h-12 rounded-full items-center justify-center hover:bg-primary/5 hover:dark:bg-primary-dark/5 outline-link" aria-label="Translations" href="/community/translations"><svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24"><path fill="currentColor" d=" M12.87 15.07l-2.54-2.51.03-.03c1.74-1.94 2.98-4.17 3.71-6.53H17V4h-7V2H8v2H1v1.99h11.17C11.5 7.92 10.44 9.75 9 11.35 8.07 10.32 7.3 9.19 6.69 8h-2c.73 1.63 1.73 3.17 2.98 4.56l-5.09 5.02L4 19l5-5 3.11 3.11.76-2.04zM18.5 10h-2L12 22h2l1.12-3h4.75L21 22h2l-4.5-12zm-2.62 7l1.62-4.33L19.12 17h-3.24z "></path></svg></a></div><div class="flex"></div></div></div></div></nav></div><div class=""><!--$--><main class="min-w-0 isolate"><article class="font-normal break-words text-primary dark:text-primary-dark"><div class="ps-0"><div class="mx-auto px-0 lg:px-4 max-w-5xl"><div class="px-5 sm:px-12 pt-3.5"><div class="max-w-4xl ms-0 2xl:mx-auto"><div class="flex flex-wrap"><div class="flex mb-3 mt-0.5 items-center"><a class="text-link dark:text-link-dark text-sm tracking-wide font-bold uppercase me-1 hover:underline" href="/blog">博客</a><span class="inline-block me-1 text-link dark:text-link-dark text-lg rtl:rotate-180"><svg width="20" height="20" viewBox="0 0 20 20" fill="none" xmlns="http://www.w3.org/2000/svg"><path d="M6.86612 13.6161C6.37796 14.1043 6.37796 14.8957 6.86612 15.3839C7.35427 15.872 8.14572 15.872 8.63388 15.3839L13.1339 10.8839C13.622 10.3957 13.622 9.60428 13.1339 9.11612L8.63388 4.61612C8.14572 4.12797 7.35427 4.12797 6.86612 4.61612C6.37796 5.10428 6.37796 5.89573 6.86612 6.38388L10.4822 10L6.86612 13.6161Z" fill="currentColor"></path></svg></span></div></div><h1 class="mdx-heading mt-0 text-primary dark:text-primary-dark -mx-.5 break-words text-5xl font-display font-bold leading-tight">React 19 RC<a href="#undefined" aria-label="Link for this heading" title="Link for this heading" class="mdx-header-anchor hidden"><svg width="1em" height="1em" viewBox="0 0 13 13" xmlns="http://www.w3.org/2000/svg" class="text-gray-70 ms-2 h-5 w-5"><g fill="currentColor" fill-rule="evenodd"><path d="M7.778 7.975a2.5 2.5 0 0 0 .347-3.837L6.017 2.03a2.498 2.498 0 0 0-3.542-.007 2.5 2.5 0 0 0 .006 3.543l1.153 1.15c.07-.29.154-.563.25-.773.036-.077.084-.16.14-.25L3.18 4.85a1.496 1.496 0 0 1 .002-2.12 1.496 1.496 0 0 1 2.12 0l2.124 2.123a1.496 1.496 0 0 1-.333 2.37c.16.246.42.504.685.752z"></path><path d="M5.657 4.557a2.5 2.5 0 0 0-.347 3.837l2.108 2.108a2.498 2.498 0 0 0 3.542.007 2.5 2.5 0 0 0-.006-3.543L9.802 5.815c-.07.29-.154.565-.25.774-.036.076-.084.16-.14.25l.842.84c.585.587.59 1.532 0 2.122-.587.585-1.532.59-2.12 0L6.008 7.68a1.496 1.496 0 0 1 .332-2.372c-.16-.245-.42-.503-.685-.75z"></path></g></svg></a></h1></div></div></div><div class="px-5 sm:px-12"><div class="max-w-7xl mx-auto lg:flex lg:flex-col lg:items-center"><div class="max-w-4xl ms-0 2xl:mx-auto"><p class="whitespace-pre-wrap my-4">2024 年 4 月 25 日 <a class="inline text-link dark:text-link-dark border-b border-link border-opacity-0 hover:border-opacity-100 duration-100 ease-in transition leading-normal" href="/community/team">The React Team</a></p>
<hr class="my-6 block border-b border-t-0 border-border dark:border-border-dark"/>
<div class="font-display text-xl text-primary dark:text-primary-dark leading-relaxed"><p class="whitespace-pre-wrap my-4">React 19 RC 版本现在可以在 npm 上使用了!</p></div>
<p class="whitespace-pre-wrap my-4">在我们的 <a class="inline text-link dark:text-link-dark border-b border-link border-opacity-0 hover:border-opacity-100 duration-100 ease-in transition leading-normal" href="/blog/2024/04/25/react-19-upgrade-guide">React 19 RC 升级指南</a> 中, 我们分享了将应用程序升级到 React 19 的分步说明。在这篇文章中，我们将概述 React 19 的新特性，以及如何使用它们。</p>
<ul class="ms-6 my-3 list-disc">
<li class="leading-relaxed mb-1"><a class="inline text-link dark:text-link-dark border-b border-link border-opacity-0 hover:border-opacity-100 duration-100 ease-in transition leading-normal" href="#whats-new-in-react-19">React 19 中的新功能</a></li>
<li class="leading-relaxed mb-1"><a class="inline text-link dark:text-link-dark border-b border-link border-opacity-0 hover:border-opacity-100 duration-100 ease-in transition leading-normal" href="#improvements-in-react-19">React 19 中的改进</a></li>
<li class="leading-relaxed mb-1"><a class="inline text-link dark:text-link-dark border-b border-link border-opacity-0 hover:border-opacity-100 duration-100 ease-in transition leading-normal" href="#how-to-upgrade">如何升级</a></li>
</ul>
<p class="whitespace-pre-wrap my-4">有关破坏性更改的列表，请参阅 <a class="inline text-link dark:text-link-dark border-b border-link border-opacity-0 hover:border-opacity-100 duration-100 ease-in transition leading-normal" href="/blog/2024/04/25/react-19-upgrade-guide">升级指南</a>。</p>
<hr class="my-6 block border-b border-t-0 border-border dark:border-border-dark"/>
<h2 id="whats-new-in-react-19" class="mdx-heading text-3xl font-display leading-10 text-primary dark:text-primary-dark font-bold my-6">React 19 中的新功能 <a href="#whats-new-in-react-19" aria-label="Link for React 19 中的新功能 " title="Link for React 19 中的新功能 " class="mdx-header-anchor inline-block"><svg width="1em" height="1em" viewBox="0 0 13 13" xmlns="http://www.w3.org/2000/svg" class="text-gray-70 ms-2 h-5 w-5"><g fill="currentColor" fill-rule="evenodd"><path d="M7.778 7.975a2.5 2.5 0 0 0 .347-3.837L6.017 2.03a2.498 2.498 0 0 0-3.542-.007 2.5 2.5 0 0 0 .006 3.543l1.153 1.15c.07-.29.154-.563.25-.773.036-.077.084-.16.14-.25L3.18 4.85a1.496 1.496 0 0 1 .002-2.12 1.496 1.496 0 0 1 2.12 0l2.124 2.123a1.496 1.496 0 0 1-.333 2.37c.16.246.42.504.685.752z"></path><path d="M5.657 4.557a2.5 2.5 0 0 0-.347 3.837l2.108 2.108a2.498 2.498 0 0 0 3.542.007 2.5 2.5 0 0 0-.006-3.543L9.802 5.815c-.07.29-.154.565-.25.774-.036.076-.084.16-.14.25l.842.84c.585.587.59 1.532 0 2.122-.587.585-1.532.59-2.12 0L6.008 7.68a1.496 1.496 0 0 1 .332-2.372c-.16-.245-.42-.503-.685-.75z"></path></g></svg></a></h2>
<h3 id="actions" class="mdx-heading text-2xl font-display leading-9 text-primary dark:text-primary-dark font-bold my-6">Actions <a href="#actions" aria-label="Link for Actions " title="Link for Actions " class="mdx-header-anchor inline-block"><svg width="1em" height="1em" viewBox="0 0 13 13" xmlns="http://www.w3.org/2000/svg" class="text-gray-70 ms-2 h-5 w-5"><g fill="currentColor" fill-rule="evenodd"><path d="M7.778 7.975a2.5 2.5 0 0 0 .347-3.837L6.017 2.03a2.498 2.498 0 0 0-3.542-.007 2.5 2.5 0 0 0 .006 3.543l1.153 1.15c.07-.29.154-.563.25-.773.036-.077.084-.16.14-.25L3.18 4.85a1.496 1.496 0 0 1 .002-2.12 1.496 1.496 0 0 1 2.12 0l2.124 2.123a1.496 1.496 0 0 1-.333 2.37c.16.246.42.504.685.752z"></path><path d="M5.657 4.557a2.5 2.5 0 0 0-.347 3.837l2.108 2.108a2.498 2.498 0 0 0 3.542.007 2.5 2.5 0 0 0-.006-3.543L9.802 5.815c-.07.29-.154.565-.25.774-.036.076-.084.16-.14.25l.842.84c.585.587.59 1.532 0 2.122-.587.585-1.532.59-2.12 0L6.008 7.68a1.496 1.496 0 0 1 .332-2.372c-.16-.245-.42-.503-.685-.75z"></path></g></svg></a></h3>
<p class="whitespace-pre-wrap my-4">在 React 应用中，一个常见的用例是执行数据变更，然后响应更新状态。例如，当用户提交一个表单来更改他们的名字，你会发起一个 API 请求，然后处理响应。在过去，你需要手动处理待定状态、错误、乐观更新和顺序请求。</p>
<p class="whitespace-pre-wrap my-4">例如，你可以在 <code dir="ltr" class="inline text-code text-secondary dark:text-secondary-dark px-1 rounded-md no-underline bg-gray-30 bg-opacity-10 py-px">useState</code> 中处理待定和错误状态：</p>
<!--$--><div dir="ltr" class="sandpack sandpack--codeblock rounded-2xl h-full w-full overflow-x-auto flex items-center bg-wash dark:bg-gray-95 shadow-lg my-8" style="contain:content"><div class="sp-wrapper"><div class="sp-stack"><div class="sp-code-editor"><pre class="sp-cm sp-pristine sp-javascript flex align-start"><code class="sp-pre-placeholder grow-[2]"><div class="cm-line "><span class="sp-syntax-comment">// 没有 Actions 之前</span><br/></div><div class="cm-line "><span class="sp-syntax-keyword">function</span> <span class="sp-syntax-definition">UpdateName</span><span class="sp-syntax-punctuation">(</span><span class="sp-syntax-punctuation">{</span><span class="sp-syntax-punctuation">}</span><span class="sp-syntax-punctuation">)</span> <span class="sp-syntax-punctuation">{</span><br/></div><div class="cm-line ">  <span class="sp-syntax-keyword">const</span> <span class="sp-syntax-punctuation">[</span><span class="sp-syntax-plain">name</span><span class="sp-syntax-punctuation">,</span> <span class="sp-syntax-plain">setName</span><span class="sp-syntax-punctuation">]</span> = <span class="sp-syntax-definition">useState</span><span class="sp-syntax-punctuation">(</span><span class="sp-syntax-string">&quot;&quot;</span><span class="sp-syntax-punctuation">)</span><span class="sp-syntax-punctuation">;</span><br/></div><div class="cm-line ">  <span class="sp-syntax-keyword">const</span> <span class="sp-syntax-punctuation">[</span><span class="sp-syntax-plain">error</span><span class="sp-syntax-punctuation">,</span> <span class="sp-syntax-plain">setError</span><span class="sp-syntax-punctuation">]</span> = <span class="sp-syntax-definition">useState</span><span class="sp-syntax-punctuation">(</span><span class="sp-syntax-keyword">null</span><span class="sp-syntax-punctuation">)</span><span class="sp-syntax-punctuation">;</span><br/></div><div class="cm-line ">  <span class="sp-syntax-keyword">const</span> <span class="sp-syntax-punctuation">[</span><span class="sp-syntax-plain">isPending</span><span class="sp-syntax-punctuation">,</span> <span class="sp-syntax-plain">setIsPending</span><span class="sp-syntax-punctuation">]</span> = <span class="sp-syntax-definition">useState</span><span class="sp-syntax-punctuation">(</span><span class="sp-syntax-static">false</span><span class="sp-syntax-punctuation">)</span><span class="sp-syntax-punctuation">;</span><br/></div><div class="cm-line "><br/></div><div class="cm-line ">  <span class="sp-syntax-keyword">const</span> <span class="sp-syntax-plain">handleSubmit</span> = <span class="sp-syntax-keyword">async</span> <span class="sp-syntax-punctuation">(</span><span class="sp-syntax-punctuation">)</span> <span class="sp-syntax-punctuation">=&gt;</span> <span class="sp-syntax-punctuation">{</span><br/></div><div class="cm-line ">    <span class="sp-syntax-definition">setIsPending</span><span class="sp-syntax-punctuation">(</span><span class="sp-syntax-static">true</span><span class="sp-syntax-punctuation">)</span><span class="sp-syntax-punctuation">;</span><br/></div><div class="cm-line ">    <span class="sp-syntax-keyword">const</span> <span class="sp-syntax-plain">error</span> = <span class="sp-syntax-keyword">await</span> <span class="sp-syntax-definition">updateName</span><span class="sp-syntax-punctuation">(</span><span class="sp-syntax-plain">name</span><span class="sp-syntax-punctuation">)</span><span class="sp-syntax-punctuation">;</span><br/></div><div class="cm-line ">    <span class="sp-syntax-definition">setIsPending</span><span class="sp-syntax-punctuation">(</span><span class="sp-syntax-static">false</span><span class="sp-syntax-punctuation">)</span><span class="sp-syntax-punctuation">;</span><br/></div><div class="cm-line ">    <span class="sp-syntax-keyword">if</span> <span class="sp-syntax-punctuation">(</span><span class="sp-syntax-plain">error</span><span class="sp-syntax-punctuation">)</span> <span class="sp-syntax-punctuation">{</span><br/></div><div class="cm-line ">      <span class="sp-syntax-definition">setError</span><span class="sp-syntax-punctuation">(</span><span class="sp-syntax-plain">error</span><span class="sp-syntax-punctuation">)</span><span class="sp-syntax-punctuation">;</span><br/></div><div class="cm-line ">      <span class="sp-syntax-keyword">return</span><span class="sp-syntax-punctuation">;</span><br/></div><div class="cm-line ">    <span class="sp-syntax-punctuation">}</span> <br/></div><div class="cm-line ">    <span class="sp-syntax-definition">redirect</span><span class="sp-syntax-punctuation">(</span><span class="sp-syntax-string">&quot;/path&quot;</span><span class="sp-syntax-punctuation">)</span><span class="sp-syntax-punctuation">;</span><br/></div><div class="cm-line ">  <span class="sp-syntax-punctuation">}</span><span class="sp-syntax-punctuation">;</span><br/></div><div class="cm-line "><br/></div><div class="cm-line ">  <span class="sp-syntax-keyword">return</span> <span class="sp-syntax-punctuation">(</span><br/></div><div class="cm-line ">    <span class="sp-syntax-punctuation">&lt;</span><span class="sp-syntax-tag">div</span><span class="sp-syntax-punctuation">&gt;</span><br/></div><div class="cm-line ">      <span class="sp-syntax-punctuation">&lt;</span><span class="sp-syntax-tag">input</span> <span class="sp-syntax-property">value</span>=<span class="sp-syntax-punctuation">{</span><span class="sp-syntax-plain">name</span><span class="sp-syntax-punctuation">}</span> <span class="sp-syntax-property">onChange</span>=<span class="sp-syntax-punctuation">{</span><span class="sp-syntax-punctuation">(</span><span class="sp-syntax-plain">event</span><span class="sp-syntax-punctuation">)</span> <span class="sp-syntax-punctuation">=&gt;</span> <span class="sp-syntax-definition">setName</span><span class="sp-syntax-punctuation">(</span><span class="sp-syntax-plain">event</span>.<span class="sp-syntax-property">target</span>.<span class="sp-syntax-property">value</span><span class="sp-syntax-punctuation">)</span><span class="sp-syntax-punctuation">}</span> <span class="sp-syntax-punctuation">/&gt;</span><br/></div><div class="cm-line ">      <span class="sp-syntax-punctuation">&lt;</span><span class="sp-syntax-tag">button</span> <span class="sp-syntax-property">onClick</span>=<span class="sp-syntax-punctuation">{</span><span class="sp-syntax-plain">handleSubmit</span><span class="sp-syntax-punctuation">}</span> <span class="sp-syntax-property">disabled</span>=<span class="sp-syntax-punctuation">{</span><span class="sp-syntax-plain">isPending</span><span class="sp-syntax-punctuation">}</span><span class="sp-syntax-punctuation">&gt;</span><br/></div><div class="cm-line ">        Update<br/></div><div class="cm-line ">      <span class="sp-syntax-punctuation">&lt;/</span><span class="sp-syntax-tag">button</span><span class="sp-syntax-punctuation">&gt;</span><br/></div><div class="cm-line ">      <span class="sp-syntax-punctuation">{</span><span class="sp-syntax-plain">error</span> &amp;&amp; <span class="sp-syntax-punctuation">&lt;</span><span class="sp-syntax-tag">p</span><span class="sp-syntax-punctuation">&gt;</span><span class="sp-syntax-punctuation">{</span><span class="sp-syntax-plain">error</span><span class="sp-syntax-punctuation">}</span><span class="sp-syntax-punctuation">&lt;/</span><span class="sp-syntax-tag">p</span><span class="sp-syntax-punctuation">&gt;</span><span class="sp-syntax-punctuation">}</span><br/></div><div class="cm-line ">    <span class="sp-syntax-punctuation">&lt;/</span><span class="sp-syntax-tag">div</span><span class="sp-syntax-punctuation">&gt;</span><br/></div><div class="cm-line ">  <span class="sp-syntax-punctuation">)</span><span class="sp-syntax-punctuation">;</span><br/></div><div class="cm-line "><span class="sp-syntax-punctuation">}</span></div></code></pre></div></div></div></div><!--/$-->
<p class="whitespace-pre-wrap my-4">在 React 19 中，我们正在添加在过渡中使用异步函数的支持，以自动处理待定状态、错误、表单和乐观更新。</p>
<p class="whitespace-pre-wrap my-4">例如，你可以使用 <code dir="ltr" class="inline text-code text-secondary dark:text-secondary-dark px-1 rounded-md no-underline bg-gray-30 bg-opacity-10 py-px">useTransition</code> 来为你处理待定状态：</p>
<!--$--><div dir="ltr" class="sandpack sandpack--codeblock rounded-2xl h-full w-full overflow-x-auto flex items-center bg-wash dark:bg-gray-95 shadow-lg my-8" style="contain:content"><div class="sp-wrapper"><div class="sp-stack"><div class="sp-code-editor"><pre class="sp-cm sp-pristine sp-javascript flex align-start"><code class="sp-pre-placeholder grow-[2]"><div class="cm-line "><span class="sp-syntax-comment">// 使用 Actions 中的待定状态</span><br/></div><div class="cm-line "><span class="sp-syntax-keyword">function</span> <span class="sp-syntax-definition">UpdateName</span><span class="sp-syntax-punctuation">(</span><span class="sp-syntax-punctuation">{</span><span class="sp-syntax-punctuation">}</span><span class="sp-syntax-punctuation">)</span> <span class="sp-syntax-punctuation">{</span><br/></div><div class="cm-line ">  <span class="sp-syntax-keyword">const</span> <span class="sp-syntax-punctuation">[</span><span class="sp-syntax-plain">name</span><span class="sp-syntax-punctuation">,</span> <span class="sp-syntax-plain">setName</span><span class="sp-syntax-punctuation">]</span> = <span class="sp-syntax-definition">useState</span><span class="sp-syntax-punctuation">(</span><span class="sp-syntax-string">&quot;&quot;</span><span class="sp-syntax-punctuation">)</span><span class="sp-syntax-punctuation">;</span><br/></div><div class="cm-line ">  <span class="sp-syntax-keyword">const</span> <span class="sp-syntax-punctuation">[</span><span class="sp-syntax-plain">error</span><span class="sp-syntax-punctuation">,</span> <span class="sp-syntax-plain">setError</span><span class="sp-syntax-punctuation">]</span> = <span class="sp-syntax-definition">useState</span><span class="sp-syntax-punctuation">(</span><span class="sp-syntax-keyword">null</span><span class="sp-syntax-punctuation">)</span><span class="sp-syntax-punctuation">;</span><br/></div><div class="cm-line ">  <span class="sp-syntax-keyword">const</span> <span class="sp-syntax-punctuation">[</span><span class="sp-syntax-plain">isPending</span><span class="sp-syntax-punctuation">,</span> <span class="sp-syntax-plain">startTransition</span><span class="sp-syntax-punctuation">]</span> = <span class="sp-syntax-definition">useTransition</span><span class="sp-syntax-punctuation">(</span><span class="sp-syntax-punctuation">)</span><span class="sp-syntax-punctuation">;</span><br/></div><div class="cm-line "><br/></div><div class="cm-line ">  <span class="sp-syntax-keyword">const</span> <span class="sp-syntax-plain">handleSubmit</span> = <span class="sp-syntax-punctuation">(</span><span class="sp-syntax-punctuation">)</span> <span class="sp-syntax-punctuation">=&gt;</span> <span class="sp-syntax-punctuation">{</span><br/></div><div class="cm-line ">    <span class="sp-syntax-definition">startTransition</span><span class="sp-syntax-punctuation">(</span><span class="sp-syntax-keyword">async</span> <span class="sp-syntax-punctuation">(</span><span class="sp-syntax-punctuation">)</span> <span class="sp-syntax-punctuation">=&gt;</span> <span class="sp-syntax-punctuation">{</span><br/></div><div class="cm-line ">      <span class="sp-syntax-keyword">const</span> <span class="sp-syntax-plain">error</span> = <span class="sp-syntax-keyword">await</span> <span class="sp-syntax-definition">updateName</span><span class="sp-syntax-punctuation">(</span><span class="sp-syntax-plain">name</span><span class="sp-syntax-punctuation">)</span><span class="sp-syntax-punctuation">;</span><br/></div><div class="cm-line ">      <span class="sp-syntax-keyword">if</span> <span class="sp-syntax-punctuation">(</span><span class="sp-syntax-plain">error</span><span class="sp-syntax-punctuation">)</span> <span class="sp-syntax-punctuation">{</span><br/></div><div class="cm-line ">        <span class="sp-syntax-definition">setError</span><span class="sp-syntax-punctuation">(</span><span class="sp-syntax-plain">error</span><span class="sp-syntax-punctuation">)</span><span class="sp-syntax-punctuation">;</span><br/></div><div class="cm-line ">        <span class="sp-syntax-keyword">return</span><span class="sp-syntax-punctuation">;</span><br/></div><div class="cm-line ">      <span class="sp-syntax-punctuation">}</span> <br/></div><div class="cm-line ">      <span class="sp-syntax-definition">redirect</span><span class="sp-syntax-punctuation">(</span><span class="sp-syntax-string">&quot;/path&quot;</span><span class="sp-syntax-punctuation">)</span><span class="sp-syntax-punctuation">;</span><br/></div><div class="cm-line ">    <span class="sp-syntax-punctuation">}</span><span class="sp-syntax-punctuation">)</span><br/></div><div class="cm-line ">  <span class="sp-syntax-punctuation">}</span><span class="sp-syntax-punctuation">;</span><br/></div><div class="cm-line "><br/></div><div class="cm-line ">  <span class="sp-syntax-keyword">return</span> <span class="sp-syntax-punctuation">(</span><br/></div><div class="cm-line ">    <span class="sp-syntax-punctuation">&lt;</span><span class="sp-syntax-tag">div</span><span class="sp-syntax-punctuation">&gt;</span><br/></div><div class="cm-line ">      <span class="sp-syntax-punctuation">&lt;</span><span class="sp-syntax-tag">input</span> <span class="sp-syntax-property">value</span>=<span class="sp-syntax-punctuation">{</span><span class="sp-syntax-plain">name</span><span class="sp-syntax-punctuation">}</span> <span class="sp-syntax-property">onChange</span>=<span class="sp-syntax-punctuation">{</span><span class="sp-syntax-punctuation">(</span><span class="sp-syntax-plain">event</span><span class="sp-syntax-punctuation">)</span> <span class="sp-syntax-punctuation">=&gt;</span> <span class="sp-syntax-definition">setName</span><span class="sp-syntax-punctuation">(</span><span class="sp-syntax-plain">event</span>.<span class="sp-syntax-property">target</span>.<span class="sp-syntax-property">value</span><span class="sp-syntax-punctuation">)</span><span class="sp-syntax-punctuation">}</span> <span class="sp-syntax-punctuation">/&gt;</span><br/></div><div class="cm-line ">      <span class="sp-syntax-punctuation">&lt;</span><span class="sp-syntax-tag">button</span> <span class="sp-syntax-property">onClick</span>=<span class="sp-syntax-punctuation">{</span><span class="sp-syntax-plain">handleSubmit</span><span class="sp-syntax-punctuation">}</span> <span class="sp-syntax-property">disabled</span>=<span class="sp-syntax-punctuation">{</span><span class="sp-syntax-plain">isPending</span><span class="sp-syntax-punctuation">}</span><span class="sp-syntax-punctuation">&gt;</span><br/></div><div class="cm-line ">        Update<br/></div><div class="cm-line ">      <span class="sp-syntax-punctuation">&lt;/</span><span class="sp-syntax-tag">button</span><span class="sp-syntax-punctuation">&gt;</span><br/></div><div class="cm-line ">      <span class="sp-syntax-punctuation">{</span><span class="sp-syntax-plain">error</span> &amp;&amp; <span class="sp-syntax-punctuation">&lt;</span><span class="sp-syntax-tag">p</span><span class="sp-syntax-punctuation">&gt;</span><span class="sp-syntax-punctuation">{</span><span class="sp-syntax-plain">error</span><span class="sp-syntax-punctuation">}</span><span class="sp-syntax-punctuation">&lt;/</span><span class="sp-syntax-tag">p</span><span class="sp-syntax-punctuation">&gt;</span><span class="sp-syntax-punctuation">}</span><br/></div><div class="cm-line ">    <span class="sp-syntax-punctuation">&lt;/</span><span class="sp-syntax-tag">div</span><span class="sp-syntax-punctuation">&gt;</span><br/></div><div class="cm-line ">  <span class="sp-syntax-punctuation">)</span><span class="sp-syntax-punctuation">;</span><br/></div><div class="cm-line "><span class="sp-syntax-punctuation">}</span></div></code></pre></div></div></div></div><!--/$-->
<p class="whitespace-pre-wrap my-4">异步过渡会立即将 <code dir="ltr" class="inline text-code text-secondary dark:text-secondary-dark px-1 rounded-md no-underline bg-gray-30 bg-opacity-10 py-px">isPending</code> 状态设置为 true，发出异步请求，然后在任何过渡后将 <code dir="ltr" class="inline text-code text-secondary dark:text-secondary-dark px-1 rounded-md no-underline bg-gray-30 bg-opacity-10 py-px">isPending</code> 切换为 <code dir="ltr" class="inline text-code text-secondary dark:text-secondary-dark px-1 rounded-md no-underline bg-gray-30 bg-opacity-10 py-px">false</code>。这使你能够在数据变化时保持当前 UI 的响应性和交互性。</p>
<div class="expandable-callout pt-8 pb-4 px-5 sm:px-8 my-8 relative rounded-none shadow-inner-border -mx-5 sm:mx-auto sm:rounded-2xl bg-green-5 dark:bg-green-60 dark:bg-opacity-20 text-primary dark:text-primary-dark text-lg"><h3 class="text-2xl font-display font-bold text-green-60 dark:text-green-40"><svg class="inline me-3 mb-1 text-lg text-green-60 dark:text-green-40" width="2em" height="2em" viewBox="0 0 72 72" fill="none" xmlns="http://www.w3.org/2000/svg"><g clip-path="url(#clip0_40_48064)"><path d="M24 27C24 25.3431 25.3431 24 27 24H45C46.6569 24 48 25.3431 48 27C48 28.6569 46.6569 30 45 30H27C25.3431 30 24 28.6569 24 27Z" fill="currentColor"></path><path d="M24 39C24 37.3431 25.3431 36 27 36H39C40.6569 36 42 37.3431 42 39C42 40.6569 40.6569 42 39 42H27C25.3431 42 24 40.6569 24 39Z" fill="currentColor"></path><path fill-rule="evenodd" clip-rule="evenodd" d="M12 18C12 13.0294 16.0294 9 21 9H51C55.9706 9 60 13.0294 60 18V54C60 58.9706 55.9706 63 51 63H21C16.0294 63 12 58.9706 12 54V18ZM21 15H51C52.6569 15 54 16.3431 54 18V54C54 55.6569 52.6569 57 51 57H21C19.3431 57 18 55.6569 18 54V18C18 16.3431 19.3431 15 21 15Z" fill="currentColor"></path></g><defs><clipPath id="clip0_40_48064"><rect width="72" height="72" fill="white"></rect></clipPath></defs></svg>注意</h3><div class="relative"><div class="py-2"><h4 id="by-convention-functions-that-use-async-transitions-are-called-actions" class="mdx-heading text-xl font-display font-bold leading-9 my-4">按照惯例，使用异步过渡的函数被称为 “Actions”。 <a href="#by-convention-functions-that-use-async-transitions-are-called-actions" aria-label="Link for 按照惯例，使用异步过渡的函数被称为 “Actions”。 " title="Link for 按照惯例，使用异步过渡的函数被称为 “Actions”。 " class="mdx-header-anchor inline-block"><svg width="1em" height="1em" viewBox="0 0 13 13" xmlns="http://www.w3.org/2000/svg" class="text-gray-70 ms-2 h-5 w-5"><g fill="currentColor" fill-rule="evenodd"><path d="M7.778 7.975a2.5 2.5 0 0 0 .347-3.837L6.017 2.03a2.498 2.498 0 0 0-3.542-.007 2.5 2.5 0 0 0 .006 3.543l1.153 1.15c.07-.29.154-.563.25-.773.036-.077.084-.16.14-.25L3.18 4.85a1.496 1.496 0 0 1 .002-2.12 1.496 1.496 0 0 1 2.12 0l2.124 2.123a1.496 1.496 0 0 1-.333 2.37c.16.246.42.504.685.752z"></path><path d="M5.657 4.557a2.5 2.5 0 0 0-.347 3.837l2.108 2.108a2.498 2.498 0 0 0 3.542.007 2.5 2.5 0 0 0-.006-3.543L9.802 5.815c-.07.29-.154.565-.25.774-.036.076-.084.16-.14.25l.842.84c.585.587.59 1.532 0 2.122-.587.585-1.532.59-2.12 0L6.008 7.68a1.496 1.496 0 0 1 .332-2.372c-.16-.245-.42-.503-.685-.75z"></path></g></svg></a></h4><p class="whitespace-pre-wrap my-4">Actions 自动为你管理数据提交：</p><ul class="ms-6 my-3 list-disc">
<li class="leading-relaxed mb-1"><strong class="font-bold">待定状态</strong>: Actions 提供一个待定状态，该状态在请求开始时启动，并在最终状态更新提交时自动重置。</li>
<li class="leading-relaxed mb-1"><strong class="font-bold">乐观更新</strong>: Actions 支持新的 <a class="inline text-link dark:text-link-dark border-b border-link border-opacity-0 hover:border-opacity-100 duration-100 ease-in transition leading-normal" href="#new-hook-optimistic-updates"><code dir="ltr" class="inline text-code text-secondary dark:text-secondary-dark px-1 rounded-md no-underline bg-gray-30 bg-opacity-10 py-px">useOptimistic</code></a>  Hook，因此你可以在请求提交时向用户显示即时反馈。</li>
<li class="leading-relaxed mb-1"><strong class="font-bold">错误处理</strong>: Actions 提供错误处理，因此当请求失败时，你可以显示错误边界，并自动将乐观更新恢复到其原始值。</li>
<li class="leading-relaxed mb-1"><strong class="font-bold">表单</strong>: <code dir="ltr" class="inline text-code text-secondary dark:text-secondary-dark px-1 rounded-md no-underline bg-gray-30 bg-opacity-10 py-px">&lt;form&gt;</code> 元素现在支持将函数传递给 <code dir="ltr" class="inline text-code text-secondary dark:text-secondary-dark px-1 rounded-md no-underline bg-gray-30 bg-opacity-10 py-px">action</code> 和 <code dir="ltr" class="inline text-code text-secondary dark:text-secondary-dark px-1 rounded-md no-underline bg-gray-30 bg-opacity-10 py-px">formAction</code> 属性。将函数传递给 <code dir="ltr" class="inline text-code text-secondary dark:text-secondary-dark px-1 rounded-md no-underline bg-gray-30 bg-opacity-10 py-px">action</code> 属性默认使用 Actions，并在提交后自动重置表单。</li>
</ul></div></div></div>
<p class="whitespace-pre-wrap my-4">在 Actions 的基础上，React 19 引入了 <a class="inline text-link dark:text-link-dark border-b border-link border-opacity-0 hover:border-opacity-100 duration-100 ease-in transition leading-normal" href="#new-hook-optimistic-updates"><code dir="ltr" class="inline text-code text-secondary dark:text-secondary-dark px-1 rounded-md no-underline bg-gray-30 bg-opacity-10 py-px">useOptimistic</code></a> 来管理乐观更新，以及一个新的 Hook <a class="inline text-link dark:text-link-dark border-b border-link border-opacity-0 hover:border-opacity-100 duration-100 ease-in transition leading-normal" href="#new-hook-useactionstate"><code dir="ltr" class="inline text-code text-secondary dark:text-secondary-dark px-1 rounded-md no-underline bg-gray-30 bg-opacity-10 py-px">React.useActionState</code></a> 来处理 Actions 的常见情况。在 <code dir="ltr" class="inline text-code text-secondary dark:text-secondary-dark px-1 rounded-md no-underline bg-gray-30 bg-opacity-10 py-px">react-dom</code> 中我们添加了 <a class="inline text-link dark:text-link-dark border-b border-link border-opacity-0 hover:border-opacity-100 duration-100 ease-in transition leading-normal" href="#form-actions"><code dir="ltr" class="inline text-code text-secondary dark:text-secondary-dark px-1 rounded-md no-underline bg-gray-30 bg-opacity-10 py-px">&lt;form&gt;</code> Actions</a> 来自动管理表单和 <code dir="ltr" class="inline text-code text-secondary dark:text-secondary-dark px-1 rounded-md no-underline bg-gray-30 bg-opacity-10 py-px">useFormStatus</code> 来支持表单中 Actions 的常见情况。</p>
<p class="whitespace-pre-wrap my-4">在 React 19 中，上述示例可以简化为：</p>
<!--$--><div dir="ltr" class="sandpack sandpack--codeblock rounded-2xl h-full w-full overflow-x-auto flex items-center bg-wash dark:bg-gray-95 shadow-lg my-8" style="contain:content"><div class="sp-wrapper"><div class="sp-stack"><div class="sp-code-editor"><pre class="sp-cm sp-pristine sp-javascript flex align-start"><code class="sp-pre-placeholder grow-[2]"><div class="cm-line "><span class="sp-syntax-comment">// 使用表单的 Actions 和 useActionState</span><br/></div><div class="cm-line "><span class="sp-syntax-keyword">function</span> <span class="sp-syntax-definition">ChangeName</span><span class="sp-syntax-punctuation">(</span><span class="sp-syntax-punctuation">{</span> <span class="sp-syntax-property">name</span><span class="sp-syntax-punctuation">,</span> <span class="sp-syntax-property">setName</span> <span class="sp-syntax-punctuation">}</span><span class="sp-syntax-punctuation">)</span> <span class="sp-syntax-punctuation">{</span><br/></div><div class="cm-line ">  <span class="sp-syntax-keyword">const</span> <span class="sp-syntax-punctuation">[</span><span class="sp-syntax-plain">error</span><span class="sp-syntax-punctuation">,</span> <span class="sp-syntax-plain">submitAction</span><span class="sp-syntax-punctuation">,</span> <span class="sp-syntax-plain">isPending</span><span class="sp-syntax-punctuation">]</span> = <span class="sp-syntax-definition">useActionState</span><span class="sp-syntax-punctuation">(</span><br/></div><div class="cm-line ">    <span class="sp-syntax-keyword">async</span> <span class="sp-syntax-punctuation">(</span><span class="sp-syntax-plain">previousState</span><span class="sp-syntax-punctuation">,</span> <span class="sp-syntax-plain">formData</span><span class="sp-syntax-punctuation">)</span> <span class="sp-syntax-punctuation">=&gt;</span> <span class="sp-syntax-punctuation">{</span><br/></div><div class="cm-line ">      <span class="sp-syntax-keyword">const</span> <span class="sp-syntax-plain">error</span> = <span class="sp-syntax-keyword">await</span> <span class="sp-syntax-definition">updateName</span><span class="sp-syntax-punctuation">(</span><span class="sp-syntax-plain">formData</span>.<span class="sp-syntax-property">get</span><span class="sp-syntax-punctuation">(</span><span class="sp-syntax-string">&quot;name&quot;</span><span class="sp-syntax-punctuation">)</span><span class="sp-syntax-punctuation">)</span><span class="sp-syntax-punctuation">;</span><br/></div><div class="cm-line ">      <span class="sp-syntax-keyword">if</span> <span class="sp-syntax-punctuation">(</span><span class="sp-syntax-plain">error</span><span class="sp-syntax-punctuation">)</span> <span class="sp-syntax-punctuation">{</span><br/></div><div class="cm-line ">        <span class="sp-syntax-keyword">return</span> <span class="sp-syntax-plain">error</span><span class="sp-syntax-punctuation">;</span><br/></div><div class="cm-line ">      <span class="sp-syntax-punctuation">}</span><br/></div><div class="cm-line ">      <span class="sp-syntax-definition">redirect</span><span class="sp-syntax-punctuation">(</span><span class="sp-syntax-string">&quot;/path&quot;</span><span class="sp-syntax-punctuation">)</span><span class="sp-syntax-punctuation">;</span><br/></div><div class="cm-line ">      <span class="sp-syntax-keyword">return</span> <span class="sp-syntax-keyword">null</span><span class="sp-syntax-punctuation">;</span><br/></div><div class="cm-line ">    <span class="sp-syntax-punctuation">}</span><span class="sp-syntax-punctuation">,</span><br/></div><div class="cm-line ">    <span class="sp-syntax-keyword">null</span><span class="sp-syntax-punctuation">,</span><br/></div><div class="cm-line ">  <span class="sp-syntax-punctuation">)</span><span class="sp-syntax-punctuation">;</span><br/></div><div class="cm-line "><br/></div><div class="cm-line ">  <span class="sp-syntax-keyword">return</span> <span class="sp-syntax-punctuation">(</span><br/></div><div class="cm-line ">    <span class="sp-syntax-punctuation">&lt;</span><span class="sp-syntax-tag">form</span> <span class="sp-syntax-property">action</span>=<span class="sp-syntax-punctuation">{</span><span class="sp-syntax-plain">submitAction</span><span class="sp-syntax-punctuation">}</span><span class="sp-syntax-punctuation">&gt;</span><br/></div><div class="cm-line ">      <span class="sp-syntax-punctuation">&lt;</span><span class="sp-syntax-tag">input</span> <span class="sp-syntax-property">type</span>=<span class="sp-syntax-string">&quot;text&quot;</span> <span class="sp-syntax-property">name</span>=<span class="sp-syntax-string">&quot;name&quot;</span> <span class="sp-syntax-punctuation">/&gt;</span><br/></div><div class="cm-line ">      <span class="sp-syntax-punctuation">&lt;</span><span class="sp-syntax-tag">button</span> <span class="sp-syntax-property">type</span>=<span class="sp-syntax-string">&quot;submit&quot;</span> <span class="sp-syntax-property">disabled</span>=<span class="sp-syntax-punctuation">{</span><span class="sp-syntax-plain">isPending</span><span class="sp-syntax-punctuation">}</span><span class="sp-syntax-punctuation">&gt;</span>Update<span class="sp-syntax-punctuation">&lt;/</span><span class="sp-syntax-tag">button</span><span class="sp-syntax-punctuation">&gt;</span><br/></div><div class="cm-line ">      <span class="sp-syntax-punctuation">{</span><span class="sp-syntax-plain">error</span> &amp;&amp; <span class="sp-syntax-punctuation">&lt;</span><span class="sp-syntax-tag">p</span><span class="sp-syntax-punctuation">&gt;</span><span class="sp-syntax-punctuation">{</span><span class="sp-syntax-plain">error</span><span class="sp-syntax-punctuation">}</span><span class="sp-syntax-punctuation">&lt;/</span><span class="sp-syntax-tag">p</span><span class="sp-syntax-punctuation">&gt;</span><span class="sp-syntax-punctuation">}</span><br/></div><div class="cm-line ">    <span class="sp-syntax-punctuation">&lt;/</span><span class="sp-syntax-tag">form</span><span class="sp-syntax-punctuation">&gt;</span><br/></div><div class="cm-line ">  <span class="sp-syntax-punctuation">)</span><span class="sp-syntax-punctuation">;</span><br/></div><div class="cm-line "><span class="sp-syntax-punctuation">}</span></div></code></pre></div></div></div></div><!--/$-->
<p class="whitespace-pre-wrap my-4">在下一节中，我们将详细介绍 React 19 中的每一个新的 Action 功能。</p>
<h3 id="new-hook-useactionstate" class="mdx-heading text-2xl font-display leading-9 text-primary dark:text-primary-dark font-bold my-6">新的 Hook: <code dir="ltr" class="inline text-code text-secondary dark:text-secondary-dark px-1 rounded-md no-underline bg-gray-30 bg-opacity-10 py-px">useActionState</code> <a href="#new-hook-useactionstate" aria-label="Link for this heading" title="Link for this heading" class="mdx-header-anchor inline-block"><svg width="1em" height="1em" viewBox="0 0 13 13" xmlns="http://www.w3.org/2000/svg" class="text-gray-70 ms-2 h-5 w-5"><g fill="currentColor" fill-rule="evenodd"><path d="M7.778 7.975a2.5 2.5 0 0 0 .347-3.837L6.017 2.03a2.498 2.498 0 0 0-3.542-.007 2.5 2.5 0 0 0 .006 3.543l1.153 1.15c.07-.29.154-.563.25-.773.036-.077.084-.16.14-.25L3.18 4.85a1.496 1.496 0 0 1 .002-2.12 1.496 1.496 0 0 1 2.12 0l2.124 2.123a1.496 1.496 0 0 1-.333 2.37c.16.246.42.504.685.752z"></path><path d="M5.657 4.557a2.5 2.5 0 0 0-.347 3.837l2.108 2.108a2.498 2.498 0 0 0 3.542.007 2.5 2.5 0 0 0-.006-3.543L9.802 5.815c-.07.29-.154.565-.25.774-.036.076-.084.16-.14.25l.842.84c.585.587.59 1.532 0 2.122-.587.585-1.532.59-2.12 0L6.008 7.68a1.496 1.496 0 0 1 .332-2.372c-.16-.245-.42-.503-.685-.75z"></path></g></svg></a></h3>
<p class="whitespace-pre-wrap my-4">为了使 Actions 的常见情况更加简单，我们添加了一个名为 <code dir="ltr" class="inline text-code text-secondary dark:text-secondary-dark px-1 rounded-md no-underline bg-gray-30 bg-opacity-10 py-px">useActionState</code> 的新 Hook：</p>
<!--$--><div dir="ltr" class="sandpack sandpack--codeblock rounded-2xl h-full w-full overflow-x-auto flex items-center bg-wash dark:bg-gray-95 shadow-lg my-8" style="contain:content"><div class="sp-wrapper"><div class="sp-stack"><div class="sp-code-editor"><pre class="sp-cm sp-pristine sp-javascript flex align-start"><code class="sp-pre-placeholder grow-[2]"><div class="cm-line "><span class="sp-syntax-keyword">const</span> <span class="sp-syntax-punctuation">[</span><span class="sp-syntax-plain">error</span><span class="sp-syntax-punctuation">,</span> <span class="sp-syntax-plain">submitAction</span><span class="sp-syntax-punctuation">,</span> <span class="sp-syntax-plain">isPending</span><span class="sp-syntax-punctuation">]</span> = <span class="sp-syntax-definition">useActionState</span><span class="sp-syntax-punctuation">(</span><br/></div><div class="cm-line ">  <span class="sp-syntax-keyword">async</span> <span class="sp-syntax-punctuation">(</span><span class="sp-syntax-plain">previousState</span><span class="sp-syntax-punctuation">,</span> <span class="sp-syntax-plain">newName</span><span class="sp-syntax-punctuation">)</span> <span class="sp-syntax-punctuation">=&gt;</span> <span class="sp-syntax-punctuation">{</span><br/></div><div class="cm-line ">    <span class="sp-syntax-keyword">const</span> <span class="sp-syntax-plain">error</span> = <span class="sp-syntax-keyword">await</span> <span class="sp-syntax-definition">updateName</span><span class="sp-syntax-punctuation">(</span><span class="sp-syntax-plain">newName</span><span class="sp-syntax-punctuation">)</span><span class="sp-syntax-punctuation">;</span><br/></div><div class="cm-line ">    <span class="sp-syntax-keyword">if</span> <span class="sp-syntax-punctuation">(</span><span class="sp-syntax-plain">error</span><span class="sp-syntax-punctuation">)</span> <span class="sp-syntax-punctuation">{</span><br/></div><div class="cm-line ">      <span class="sp-syntax-comment">// 您可以返回操作的任何结果。</span><br/></div><div class="cm-line ">      <span class="sp-syntax-comment">// 这里，我们只返回错误。</span><br/></div><div class="cm-line ">      <span class="sp-syntax-keyword">return</span> <span class="sp-syntax-plain">error</span><span class="sp-syntax-punctuation">;</span><br/></div><div class="cm-line ">    <span class="sp-syntax-punctuation">}</span><br/></div><div class="cm-line "><br/></div><div class="cm-line ">    <span class="sp-syntax-comment">// 处理成功的情况。</span><br/></div><div class="cm-line ">    <span class="sp-syntax-keyword">return</span> <span class="sp-syntax-keyword">null</span><span class="sp-syntax-punctuation">;</span><br/></div><div class="cm-line ">  <span class="sp-syntax-punctuation">}</span><span class="sp-syntax-punctuation">,</span><br/></div><div class="cm-line ">  <span class="sp-syntax-keyword">null</span><span class="sp-syntax-punctuation">,</span><br/></div><div class="cm-line "><span class="sp-syntax-punctuation">)</span><span class="sp-syntax-punctuation">;</span></div></code></pre></div></div></div></div><!--/$-->
<p class="whitespace-pre-wrap my-4"><code dir="ltr" class="inline text-code text-secondary dark:text-secondary-dark px-1 rounded-md no-underline bg-gray-30 bg-opacity-10 py-px">useActionState</code> 接受一个函数（“Action”），并返回一个被包装的用于调用的 Action。这是因为 Actions 是可以组合的。当调用被包装的 Action 时，<code dir="ltr" class="inline text-code text-secondary dark:text-secondary-dark px-1 rounded-md no-underline bg-gray-30 bg-opacity-10 py-px">useActionState</code> 将返回 Action 的最后结果作为 <code dir="ltr" class="inline text-code text-secondary dark:text-secondary-dark px-1 rounded-md no-underline bg-gray-30 bg-opacity-10 py-px">data</code>，以及 Action 的待定状态作为 <code dir="ltr" class="inline text-code text-secondary dark:text-secondary-dark px-1 rounded-md no-underline bg-gray-30 bg-opacity-10 py-px">pending</code>。</p>
<div class="expandable-callout pt-8 pb-4 px-5 sm:px-8 my-8 relative rounded-none shadow-inner-border -mx-5 sm:mx-auto sm:rounded-2xl bg-green-5 dark:bg-green-60 dark:bg-opacity-20 text-primary dark:text-primary-dark text-lg"><h3 class="text-2xl font-display font-bold text-green-60 dark:text-green-40"><svg class="inline me-3 mb-1 text-lg text-green-60 dark:text-green-40" width="2em" height="2em" viewBox="0 0 72 72" fill="none" xmlns="http://www.w3.org/2000/svg"><g clip-path="url(#clip0_40_48064)"><path d="M24 27C24 25.3431 25.3431 24 27 24H45C46.6569 24 48 25.3431 48 27C48 28.6569 46.6569 30 45 30H27C25.3431 30 24 28.6569 24 27Z" fill="currentColor"></path><path d="M24 39C24 37.3431 25.3431 36 27 36H39C40.6569 36 42 37.3431 42 39C42 40.6569 40.6569 42 39 42H27C25.3431 42 24 40.6569 24 39Z" fill="currentColor"></path><path fill-rule="evenodd" clip-rule="evenodd" d="M12 18C12 13.0294 16.0294 9 21 9H51C55.9706 9 60 13.0294 60 18V54C60 58.9706 55.9706 63 51 63H21C16.0294 63 12 58.9706 12 54V18ZM21 15H51C52.6569 15 54 16.3431 54 18V54C54 55.6569 52.6569 57 51 57H21C19.3431 57 18 55.6569 18 54V18C18 16.3431 19.3431 15 21 15Z" fill="currentColor"></path></g><defs><clipPath id="clip0_40_48064"><rect width="72" height="72" fill="white"></rect></clipPath></defs></svg>注意</h3><div class="relative"><div class="py-2"><p class="whitespace-pre-wrap my-4"><code dir="ltr" class="inline text-code text-secondary dark:text-secondary-dark px-1 rounded-md no-underline bg-gray-30 bg-opacity-10 py-px">React.useActionState</code> 在 Canary 版本中曾被称为 <code dir="ltr" class="inline text-code text-secondary dark:text-secondary-dark px-1 rounded-md no-underline bg-gray-30 bg-opacity-10 py-px">ReactDOM.useFormState</code>，但我们已经将其重命名并弃用了 <code dir="ltr" class="inline text-code text-secondary dark:text-secondary-dark px-1 rounded-md no-underline bg-gray-30 bg-opacity-10 py-px">useFormState</code>。</p><p class="whitespace-pre-wrap my-4">有关更多信息，请参见 <a href="https://github.com/facebook/react/pull/28491" target="_blank" rel="nofollow noopener noreferrer" class="inline text-link dark:text-link-dark border-b border-link border-opacity-0 hover:border-opacity-100 duration-100 ease-in transition leading-normal">#28491</a>。</p></div></div></div>
<p class="whitespace-pre-wrap my-4">相关的更多信息，请参阅文档 <a class="inline text-link dark:text-link-dark border-b border-link border-opacity-0 hover:border-opacity-100 duration-100 ease-in transition leading-normal" href="/reference/react/useActionState"><code dir="ltr" class="inline text-code text-secondary dark:text-secondary-dark px-1 rounded-md no-underline bg-gray-30 bg-opacity-10 py-px">useActionState</code></a>。</p>
<h3 id="form-actions" class="mdx-heading text-2xl font-display leading-9 text-primary dark:text-primary-dark font-bold my-6">React DOM: <code dir="ltr" class="inline text-code text-secondary dark:text-secondary-dark px-1 rounded-md no-underline bg-gray-30 bg-opacity-10 py-px">&lt;form&gt;</code> Actions <a href="#form-actions" aria-label="Link for this heading" title="Link for this heading" class="mdx-header-anchor inline-block"><svg width="1em" height="1em" viewBox="0 0 13 13" xmlns="http://www.w3.org/2000/svg" class="text-gray-70 ms-2 h-5 w-5"><g fill="currentColor" fill-rule="evenodd"><path d="M7.778 7.975a2.5 2.5 0 0 0 .347-3.837L6.017 2.03a2.498 2.498 0 0 0-3.542-.007 2.5 2.5 0 0 0 .006 3.543l1.153 1.15c.07-.29.154-.563.25-.773.036-.077.084-.16.14-.25L3.18 4.85a1.496 1.496 0 0 1 .002-2.12 1.496 1.496 0 0 1 2.12 0l2.124 2.123a1.496 1.496 0 0 1-.333 2.37c.16.246.42.504.685.752z"></path><path d="M5.657 4.557a2.5 2.5 0 0 0-.347 3.837l2.108 2.108a2.498 2.498 0 0 0 3.542.007 2.5 2.5 0 0 0-.006-3.543L9.802 5.815c-.07.29-.154.565-.25.774-.036.076-.084.16-.14.25l.842.84c.585.587.59 1.532 0 2.122-.587.585-1.532.59-2.12 0L6.008 7.68a1.496 1.496 0 0 1 .332-2.372c-.16-.245-.42-.503-.685-.75z"></path></g></svg></a></h3>
<p class="whitespace-pre-wrap my-4">Actions 也与 React 19 的新 <code dir="ltr" class="inline text-code text-secondary dark:text-secondary-dark px-1 rounded-md no-underline bg-gray-30 bg-opacity-10 py-px">&lt;form&gt;</code> 功能集成在 <code dir="ltr" class="inline text-code text-secondary dark:text-secondary-dark px-1 rounded-md no-underline bg-gray-30 bg-opacity-10 py-px">react-dom</code> 中。我们已经添加了对将函数作为 <code dir="ltr" class="inline text-code text-secondary dark:text-secondary-dark px-1 rounded-md no-underline bg-gray-30 bg-opacity-10 py-px">&lt;form&gt;</code>、<code dir="ltr" class="inline text-code text-secondary dark:text-secondary-dark px-1 rounded-md no-underline bg-gray-30 bg-opacity-10 py-px">&lt;input&gt;</code> 和 <code dir="ltr" class="inline text-code text-secondary dark:text-secondary-dark px-1 rounded-md no-underline bg-gray-30 bg-opacity-10 py-px">&lt;button&gt;</code> 元素的 <code dir="ltr" class="inline text-code text-secondary dark:text-secondary-dark px-1 rounded-md no-underline bg-gray-30 bg-opacity-10 py-px">action</code> 和 <code dir="ltr" class="inline text-code text-secondary dark:text-secondary-dark px-1 rounded-md no-underline bg-gray-30 bg-opacity-10 py-px">formAction</code> 属性的支持，以便使用 Actions 自动提交表单：</p>
<!--$--><div dir="ltr" class="sandpack sandpack--codeblock rounded-2xl h-full w-full overflow-x-auto flex items-center bg-wash dark:bg-gray-95 shadow-lg my-8" style="contain:content"><div class="sp-wrapper"><div class="sp-stack"><div class="sp-code-editor"><pre class="sp-cm sp-pristine sp-javascript flex align-start"><code class="sp-pre-placeholder grow-[2]"><div class="cm-line "><span class="sp-syntax-punctuation">&lt;</span><span class="sp-syntax-tag">form</span> <span class="sp-syntax-property">action</span>=<span class="sp-syntax-punctuation">{</span><span class="code-step bg-opacity-10 dark:bg-opacity-20 relative rounded px-1 py-[1.5px] border-b-[2px] border-opacity-60 bg-blue-40 border-blue-40 text-blue-60 dark:text-blue-30">actionFunction</span><span class="sp-syntax-punctuation">}</span><span class="sp-syntax-punctuation">&gt;</span></div></code></pre></div></div></div></div><!--/$-->
<p class="whitespace-pre-wrap my-4">当 <code dir="ltr" class="inline text-code text-secondary dark:text-secondary-dark px-1 rounded-md no-underline bg-gray-30 bg-opacity-10 py-px">&lt;form&gt;</code> Action 成功时，React 将自动为非受控组件重置表单。如果你需要手动重置 <code dir="ltr" class="inline text-code text-secondary dark:text-secondary-dark px-1 rounded-md no-underline bg-gray-30 bg-opacity-10 py-px">&lt;form&gt;</code>，你可以调用新的 <code dir="ltr" class="inline text-code text-secondary dark:text-secondary-dark px-1 rounded-md no-underline bg-gray-30 bg-opacity-10 py-px">requestFormReset</code> React DOM API。</p>
<p class="whitespace-pre-wrap my-4">有关更多信息，请参阅 <code dir="ltr" class="inline text-code text-secondary dark:text-secondary-dark px-1 rounded-md no-underline bg-gray-30 bg-opacity-10 py-px">react-dom</code> 文档中的 <a class="inline text-link dark:text-link-dark border-b border-link border-opacity-0 hover:border-opacity-100 duration-100 ease-in transition leading-normal" href="/reference/react-dom/components/form"><code dir="ltr" class="inline text-code text-secondary dark:text-secondary-dark px-1 rounded-md no-underline bg-gray-30 bg-opacity-10 py-px">&lt;form&gt;</code></a>、<a class="inline text-link dark:text-link-dark border-b border-link border-opacity-0 hover:border-opacity-100 duration-100 ease-in transition leading-normal" href="/reference/react-dom/components/input"><code dir="ltr" class="inline text-code text-secondary dark:text-secondary-dark px-1 rounded-md no-underline bg-gray-30 bg-opacity-10 py-px">&lt;input&gt;</code></a> 和 <code dir="ltr" class="inline text-code text-secondary dark:text-secondary-dark px-1 rounded-md no-underline bg-gray-30 bg-opacity-10 py-px">&lt;button&gt;</code>。</p>
<h3 id="new-hook-useformstatus" class="mdx-heading text-2xl font-display leading-9 text-primary dark:text-primary-dark font-bold my-6">React DOM: 新 Hook: <code dir="ltr" class="inline text-code text-secondary dark:text-secondary-dark px-1 rounded-md no-underline bg-gray-30 bg-opacity-10 py-px">useFormStatus</code> <a href="#new-hook-useformstatus" aria-label="Link for this heading" title="Link for this heading" class="mdx-header-anchor inline-block"><svg width="1em" height="1em" viewBox="0 0 13 13" xmlns="http://www.w3.org/2000/svg" class="text-gray-70 ms-2 h-5 w-5"><g fill="currentColor" fill-rule="evenodd"><path d="M7.778 7.975a2.5 2.5 0 0 0 .347-3.837L6.017 2.03a2.498 2.498 0 0 0-3.542-.007 2.5 2.5 0 0 0 .006 3.543l1.153 1.15c.07-.29.154-.563.25-.773.036-.077.084-.16.14-.25L3.18 4.85a1.496 1.496 0 0 1 .002-2.12 1.496 1.496 0 0 1 2.12 0l2.124 2.123a1.496 1.496 0 0 1-.333 2.37c.16.246.42.504.685.752z"></path><path d="M5.657 4.557a2.5 2.5 0 0 0-.347 3.837l2.108 2.108a2.498 2.498 0 0 0 3.542.007 2.5 2.5 0 0 0-.006-3.543L9.802 5.815c-.07.29-.154.565-.25.774-.036.076-.084.16-.14.25l.842.84c.585.587.59 1.532 0 2.122-.587.585-1.532.59-2.12 0L6.008 7.68a1.496 1.496 0 0 1 .332-2.372c-.16-.245-.42-.503-.685-.75z"></path></g></svg></a></h3>
<p class="whitespace-pre-wrap my-4">在设计系统中，常常需要编写设计一类能够访问其所在的 <code dir="ltr" class="inline text-code text-secondary dark:text-secondary-dark px-1 rounded-md no-underline bg-gray-30 bg-opacity-10 py-px">&lt;form&gt;</code> 的信息而无需将属性传递到组件内的组件。这可以通过 Context 来实现，但为了使这类常见情况更简单，我们添加了一个新的 Hook <code dir="ltr" class="inline text-code text-secondary dark:text-secondary-dark px-1 rounded-md no-underline bg-gray-30 bg-opacity-10 py-px">useFormStatus</code>：</p>
<!--$--><div dir="ltr" class="sandpack sandpack--codeblock rounded-2xl h-full w-full overflow-x-auto flex items-center bg-wash dark:bg-gray-95 shadow-lg my-8" style="contain:content"><div class="sp-wrapper"><div class="sp-stack"><div class="sp-code-editor"><pre class="sp-cm sp-pristine sp-javascript flex align-start"><code class="sp-pre-placeholder grow-[2]"><div class="cm-line "><span class="sp-syntax-keyword">import</span> <span class="sp-syntax-punctuation">{</span><span class="sp-syntax-plain">useFormStatus</span><span class="sp-syntax-punctuation">}</span> <span class="sp-syntax-keyword">from</span> <span class="sp-syntax-string">&#x27;react-dom&#x27;</span><span class="sp-syntax-punctuation">;</span><br/></div><div class="cm-line "><br/></div><div class="cm-line "><span class="sp-syntax-keyword">function</span> <span class="sp-syntax-definition">DesignButton</span><span class="sp-syntax-punctuation">(</span><span class="sp-syntax-punctuation">)</span> <span class="sp-syntax-punctuation">{</span><br/></div><div class="cm-line ">  <span class="sp-syntax-keyword">const</span> <span class="sp-syntax-punctuation">{</span><span class="code-step bg-opacity-10 dark:bg-opacity-20 relative rounded px-1 py-[1.5px] border-b-[2px] border-opacity-60 bg-blue-40 border-blue-40 text-blue-60 dark:text-blue-30">pending</span><span class="sp-syntax-punctuation">}</span> = <span class="sp-syntax-definition">useFormStatus</span><span class="sp-syntax-punctuation">(</span><span class="sp-syntax-punctuation">)</span><span class="sp-syntax-punctuation">;</span><br/></div><div class="cm-line ">  <span class="sp-syntax-keyword">return</span> <span class="sp-syntax-punctuation">&lt;</span><span class="sp-syntax-tag">button</span> <span class="sp-syntax-property">type</span>=<span class="sp-syntax-string">&quot;submit&quot;</span> <span class="sp-syntax-property">disabled</span>=<span class="sp-syntax-punctuation">{</span><span class="code-step bg-opacity-10 dark:bg-opacity-20 relative rounded px-1 py-[1.5px] border-b-[2px] border-opacity-60 bg-blue-40 border-blue-40 text-blue-60 dark:text-blue-30">pending</span><span class="sp-syntax-punctuation">}</span> <span class="sp-syntax-punctuation">/&gt;</span><br/></div><div class="cm-line "><span class="sp-syntax-punctuation">}</span></div></code></pre></div></div></div></div><!--/$-->
<p class="whitespace-pre-wrap my-4"><code dir="ltr" class="inline text-code text-secondary dark:text-secondary-dark px-1 rounded-md no-underline bg-gray-30 bg-opacity-10 py-px">useFormStatus</code> 读取父 <code dir="ltr" class="inline text-code text-secondary dark:text-secondary-dark px-1 rounded-md no-underline bg-gray-30 bg-opacity-10 py-px">&lt;form&gt;</code> 的状态，就像表单是一个 Context 提供者一样。</p>
<p class="whitespace-pre-wrap my-4">有关更多信息，请参阅 <code dir="ltr" class="inline text-code text-secondary dark:text-secondary-dark px-1 rounded-md no-underline bg-gray-30 bg-opacity-10 py-px">react-dom</code> 文档中的 <a class="inline text-link dark:text-link-dark border-b border-link border-opacity-0 hover:border-opacity-100 duration-100 ease-in transition leading-normal" href="/reference/react-dom/hooks/useFormStatus"><code dir="ltr" class="inline text-code text-secondary dark:text-secondary-dark px-1 rounded-md no-underline bg-gray-30 bg-opacity-10 py-px">useFormStatus</code></a>。</p>
<h3 id="new-hook-optimistic-updates" class="mdx-heading text-2xl font-display leading-9 text-primary dark:text-primary-dark font-bold my-6">新 Hook: <code dir="ltr" class="inline text-code text-secondary dark:text-secondary-dark px-1 rounded-md no-underline bg-gray-30 bg-opacity-10 py-px">useOptimistic</code> <a href="#new-hook-optimistic-updates" aria-label="Link for this heading" title="Link for this heading" class="mdx-header-anchor inline-block"><svg width="1em" height="1em" viewBox="0 0 13 13" xmlns="http://www.w3.org/2000/svg" class="text-gray-70 ms-2 h-5 w-5"><g fill="currentColor" fill-rule="evenodd"><path d="M7.778 7.975a2.5 2.5 0 0 0 .347-3.837L6.017 2.03a2.498 2.498 0 0 0-3.542-.007 2.5 2.5 0 0 0 .006 3.543l1.153 1.15c.07-.29.154-.563.25-.773.036-.077.084-.16.14-.25L3.18 4.85a1.496 1.496 0 0 1 .002-2.12 1.496 1.496 0 0 1 2.12 0l2.124 2.123a1.496 1.496 0 0 1-.333 2.37c.16.246.42.504.685.752z"></path><path d="M5.657 4.557a2.5 2.5 0 0 0-.347 3.837l2.108 2.108a2.498 2.498 0 0 0 3.542.007 2.5 2.5 0 0 0-.006-3.543L9.802 5.815c-.07.29-.154.565-.25.774-.036.076-.084.16-.14.25l.842.84c.585.587.59 1.532 0 2.122-.587.585-1.532.59-2.12 0L6.008 7.68a1.496 1.496 0 0 1 .332-2.372c-.16-.245-.42-.503-.685-.75z"></path></g></svg></a></h3>
<p class="whitespace-pre-wrap my-4">执行数据变更时的另一个常见 UI 模式是在异步请求进行时乐观地显示最终状态。在 React 19 中，我们添加了一个名为 <code dir="ltr" class="inline text-code text-secondary dark:text-secondary-dark px-1 rounded-md no-underline bg-gray-30 bg-opacity-10 py-px">useOptimistic</code> 的新 Hook，以便更容易实现这一点：</p>
<!--$--><div dir="ltr" class="sandpack sandpack--codeblock rounded-2xl h-full w-full overflow-x-auto flex items-center bg-wash dark:bg-gray-95 shadow-lg my-8" style="contain:content"><div class="sp-wrapper"><div class="sp-stack"><div class="sp-code-editor"><pre class="sp-cm sp-pristine sp-javascript flex align-start"><code class="sp-pre-placeholder grow-[2]"><div class="cm-line "><span class="sp-syntax-keyword">function</span> <span class="sp-syntax-definition">ChangeName</span><span class="sp-syntax-punctuation">(</span><span class="sp-syntax-punctuation">{</span><span class="sp-syntax-property">currentName</span><span class="sp-syntax-punctuation">,</span> <span class="sp-syntax-property">onUpdateName</span><span class="sp-syntax-punctuation">}</span><span class="sp-syntax-punctuation">)</span> <span class="sp-syntax-punctuation">{</span><br/></div><div class="cm-line bg-github-highlight dark:bg-opacity-10">  <span class="sp-syntax-keyword">const</span> <span class="sp-syntax-punctuation">[</span><span class="sp-syntax-plain">optimisticName</span><span class="sp-syntax-punctuation">,</span> <span class="sp-syntax-plain">setOptimisticName</span><span class="sp-syntax-punctuation">]</span> = <span class="sp-syntax-definition">useOptimistic</span><span class="sp-syntax-punctuation">(</span><span class="sp-syntax-plain">currentName</span><span class="sp-syntax-punctuation">)</span><span class="sp-syntax-punctuation">;</span><br/></div><div class="cm-line "><br/></div><div class="cm-line ">  <span class="sp-syntax-keyword">const</span> <span class="sp-syntax-plain">submitAction</span> = <span class="sp-syntax-keyword">async</span> <span class="sp-syntax-plain">formData</span> <span class="sp-syntax-punctuation">=&gt;</span> <span class="sp-syntax-punctuation">{</span><br/></div><div class="cm-line ">    <span class="sp-syntax-keyword">const</span> <span class="sp-syntax-plain">newName</span> = <span class="sp-syntax-plain">formData</span>.<span class="sp-syntax-property">get</span><span class="sp-syntax-punctuation">(</span><span class="sp-syntax-string">&quot;name&quot;</span><span class="sp-syntax-punctuation">)</span><span class="sp-syntax-punctuation">;</span><br/></div><div class="cm-line bg-github-highlight dark:bg-opacity-10">    <span class="sp-syntax-definition">setOptimisticName</span><span class="sp-syntax-punctuation">(</span><span class="sp-syntax-plain">newName</span><span class="sp-syntax-punctuation">)</span><span class="sp-syntax-punctuation">;</span><br/></div><div class="cm-line ">    <span class="sp-syntax-keyword">const</span> <span class="sp-syntax-plain">updatedName</span> = <span class="sp-syntax-keyword">await</span> <span class="sp-syntax-definition">updateName</span><span class="sp-syntax-punctuation">(</span><span class="sp-syntax-plain">newName</span><span class="sp-syntax-punctuation">)</span><span class="sp-syntax-punctuation">;</span><br/></div><div class="cm-line ">    <span class="sp-syntax-definition">onUpdateName</span><span class="sp-syntax-punctuation">(</span><span class="sp-syntax-plain">updatedName</span><span class="sp-syntax-punctuation">)</span><span class="sp-syntax-punctuation">;</span><br/></div><div class="cm-line ">  <span class="sp-syntax-punctuation">}</span><span class="sp-syntax-punctuation">;</span><br/></div><div class="cm-line "><br/></div><div class="cm-line ">  <span class="sp-syntax-keyword">return</span> <span class="sp-syntax-punctuation">(</span><br/></div><div class="cm-line ">    <span class="sp-syntax-punctuation">&lt;</span><span class="sp-syntax-tag">form</span> <span class="sp-syntax-property">action</span>=<span class="sp-syntax-punctuation">{</span><span class="sp-syntax-plain">submitAction</span><span class="sp-syntax-punctuation">}</span><span class="sp-syntax-punctuation">&gt;</span><br/></div><div class="cm-line bg-github-highlight dark:bg-opacity-10">      <span class="sp-syntax-punctuation">&lt;</span><span class="sp-syntax-tag">p</span><span class="sp-syntax-punctuation">&gt;</span>Your name is: <span class="sp-syntax-punctuation">{</span><span class="sp-syntax-plain">optimisticName</span><span class="sp-syntax-punctuation">}</span><span class="sp-syntax-punctuation">&lt;/</span><span class="sp-syntax-tag">p</span><span class="sp-syntax-punctuation">&gt;</span><br/></div><div class="cm-line ">      <span class="sp-syntax-punctuation">&lt;</span><span class="sp-syntax-tag">p</span><span class="sp-syntax-punctuation">&gt;</span><br/></div><div class="cm-line ">        <span class="sp-syntax-punctuation">&lt;</span><span class="sp-syntax-tag">label</span><span class="sp-syntax-punctuation">&gt;</span>Change Name:<span class="sp-syntax-punctuation">&lt;/</span><span class="sp-syntax-tag">label</span><span class="sp-syntax-punctuation">&gt;</span><br/></div><div class="cm-line ">        <span class="sp-syntax-punctuation">&lt;</span><span class="sp-syntax-tag">input</span><br/></div><div class="cm-line ">          <span class="sp-syntax-property">type</span>=<span class="sp-syntax-string">&quot;text&quot;</span><br/></div><div class="cm-line ">          <span class="sp-syntax-property">name</span>=<span class="sp-syntax-string">&quot;name&quot;</span><br/></div><div class="cm-line bg-github-highlight dark:bg-opacity-10">          <span class="sp-syntax-property">disabled</span>=<span class="sp-syntax-punctuation">{</span><span class="sp-syntax-plain">currentName</span> !== <span class="sp-syntax-plain">optimisticName</span><span class="sp-syntax-punctuation">}</span><br/></div><div class="cm-line ">        <span class="sp-syntax-punctuation">/&gt;</span><br/></div><div class="cm-line ">      <span class="sp-syntax-punctuation">&lt;/</span><span class="sp-syntax-tag">p</span><span class="sp-syntax-punctuation">&gt;</span><br/></div><div class="cm-line ">    <span class="sp-syntax-punctuation">&lt;/</span><span class="sp-syntax-tag">form</span><span class="sp-syntax-punctuation">&gt;</span><br/></div><div class="cm-line ">  <span class="sp-syntax-punctuation">)</span><span class="sp-syntax-punctuation">;</span><br/></div><div class="cm-line "><span class="sp-syntax-punctuation">}</span></div></code></pre></div></div></div></div><!--/$-->
<p class="whitespace-pre-wrap my-4"><code dir="ltr" class="inline text-code text-secondary dark:text-secondary-dark px-1 rounded-md no-underline bg-gray-30 bg-opacity-10 py-px">useOptimistic</code> Hook 会在 <code dir="ltr" class="inline text-code text-secondary dark:text-secondary-dark px-1 rounded-md no-underline bg-gray-30 bg-opacity-10 py-px">updateName</code> 请求进行时立即渲染 <code dir="ltr" class="inline text-code text-secondary dark:text-secondary-dark px-1 rounded-md no-underline bg-gray-30 bg-opacity-10 py-px">optimisticName</code>。当更新完成或出错时，React 将自动切换回 <code dir="ltr" class="inline text-code text-secondary dark:text-secondary-dark px-1 rounded-md no-underline bg-gray-30 bg-opacity-10 py-px">currentName</code> 值。</p>
<p class="whitespace-pre-wrap my-4">有关更多信息，请参阅 <a class="inline text-link dark:text-link-dark border-b border-link border-opacity-0 hover:border-opacity-100 duration-100 ease-in transition leading-normal" href="/reference/react/useOptimistic"><code dir="ltr" class="inline text-code text-secondary dark:text-secondary-dark px-1 rounded-md no-underline bg-gray-30 bg-opacity-10 py-px">useOptimistic</code></a> 文档。</p>
<h3 id="new-feature-use" class="mdx-heading text-2xl font-display leading-9 text-primary dark:text-primary-dark font-bold my-6">新的 API: <code dir="ltr" class="inline text-code text-secondary dark:text-secondary-dark px-1 rounded-md no-underline bg-gray-30 bg-opacity-10 py-px">use</code> <a href="#new-feature-use" aria-label="Link for this heading" title="Link for this heading" class="mdx-header-anchor inline-block"><svg width="1em" height="1em" viewBox="0 0 13 13" xmlns="http://www.w3.org/2000/svg" class="text-gray-70 ms-2 h-5 w-5"><g fill="currentColor" fill-rule="evenodd"><path d="M7.778 7.975a2.5 2.5 0 0 0 .347-3.837L6.017 2.03a2.498 2.498 0 0 0-3.542-.007 2.5 2.5 0 0 0 .006 3.543l1.153 1.15c.07-.29.154-.563.25-.773.036-.077.084-.16.14-.25L3.18 4.85a1.496 1.496 0 0 1 .002-2.12 1.496 1.496 0 0 1 2.12 0l2.124 2.123a1.496 1.496 0 0 1-.333 2.37c.16.246.42.504.685.752z"></path><path d="M5.657 4.557a2.5 2.5 0 0 0-.347 3.837l2.108 2.108a2.498 2.498 0 0 0 3.542.007 2.5 2.5 0 0 0-.006-3.543L9.802 5.815c-.07.29-.154.565-.25.774-.036.076-.084.16-.14.25l.842.84c.585.587.59 1.532 0 2.122-.587.585-1.532.59-2.12 0L6.008 7.68a1.496 1.496 0 0 1 .332-2.372c-.16-.245-.42-.503-.685-.75z"></path></g></svg></a></h3>
<p class="whitespace-pre-wrap my-4">在 React 19 中，我们引入了一个新的 API 来在渲染中读取资源：<code dir="ltr" class="inline text-code text-secondary dark:text-secondary-dark px-1 rounded-md no-underline bg-gray-30 bg-opacity-10 py-px">use</code>。</p>
<p class="whitespace-pre-wrap my-4">例如，你可以使用 <code dir="ltr" class="inline text-code text-secondary dark:text-secondary-dark px-1 rounded-md no-underline bg-gray-30 bg-opacity-10 py-px">use</code> 读取一个 promise，React 将挂起，直到 promise 解析完成：</p>
<!--$--><div dir="ltr" class="sandpack sandpack--codeblock rounded-2xl h-full w-full overflow-x-auto flex items-center bg-wash dark:bg-gray-95 shadow-lg my-8" style="contain:content"><div class="sp-wrapper"><div class="sp-stack"><div class="sp-code-editor"><pre class="sp-cm sp-pristine sp-javascript flex align-start"><code class="sp-pre-placeholder grow-[2]"><div class="cm-line bg-github-highlight dark:bg-opacity-10"><span class="sp-syntax-keyword">import</span> <span class="sp-syntax-punctuation">{</span><span class="sp-syntax-plain">use</span><span class="sp-syntax-punctuation">}</span> <span class="sp-syntax-keyword">from</span> <span class="sp-syntax-string">&#x27;react&#x27;</span><span class="sp-syntax-punctuation">;</span><br/></div><div class="cm-line "><br/></div><div class="cm-line "><span class="sp-syntax-keyword">function</span> <span class="sp-syntax-definition">Comments</span><span class="sp-syntax-punctuation">(</span><span class="sp-syntax-punctuation">{</span><span class="sp-syntax-property">commentsPromise</span><span class="sp-syntax-punctuation">}</span><span class="sp-syntax-punctuation">)</span> <span class="sp-syntax-punctuation">{</span><br/></div><div class="cm-line ">  <span class="sp-syntax-comment">// `use` 将被暂停直到 promise 被解决.</span><br/></div><div class="cm-line bg-github-highlight dark:bg-opacity-10">  <span class="sp-syntax-keyword">const</span> <span class="sp-syntax-plain">comments</span> = <span class="sp-syntax-definition">use</span><span class="sp-syntax-punctuation">(</span><span class="sp-syntax-plain">commentsPromise</span><span class="sp-syntax-punctuation">)</span><span class="sp-syntax-punctuation">;</span><br/></div><div class="cm-line ">  <span class="sp-syntax-keyword">return</span> <span class="sp-syntax-plain">comments</span>.<span class="sp-syntax-property">map</span><span class="sp-syntax-punctuation">(</span><span class="sp-syntax-plain">comment</span> <span class="sp-syntax-punctuation">=&gt;</span> <span class="sp-syntax-punctuation">&lt;</span><span class="sp-syntax-tag">p</span> <span class="sp-syntax-property">key</span>=<span class="sp-syntax-punctuation">{</span><span class="sp-syntax-plain">comment</span>.<span class="sp-syntax-property">id</span><span class="sp-syntax-punctuation">}</span><span class="sp-syntax-punctuation">&gt;</span><span class="sp-syntax-punctuation">{</span><span class="sp-syntax-plain">comment</span><span class="sp-syntax-punctuation">}</span><span class="sp-syntax-punctuation">&lt;/</span><span class="sp-syntax-tag">p</span><span class="sp-syntax-punctuation">&gt;</span><span class="sp-syntax-punctuation">)</span><span class="sp-syntax-punctuation">;</span><br/></div><div class="cm-line "><span class="sp-syntax-punctuation">}</span><br/></div><div class="cm-line "><br/></div><div class="cm-line "><span class="sp-syntax-keyword">function</span> <span class="sp-syntax-definition">Page</span><span class="sp-syntax-punctuation">(</span><span class="sp-syntax-punctuation">{</span><span class="sp-syntax-property">commentsPromise</span><span class="sp-syntax-punctuation">}</span><span class="sp-syntax-punctuation">)</span> <span class="sp-syntax-punctuation">{</span><br/></div><div class="cm-line ">  <span class="sp-syntax-comment">// 当“use”在注释中暂停时,</span><br/></div><div class="cm-line ">  <span class="sp-syntax-comment">// 将显示此悬念边界。</span><br/></div><div class="cm-line ">  <span class="sp-syntax-keyword">return</span> <span class="sp-syntax-punctuation">(</span><br/></div><div class="cm-line ">    <span class="sp-syntax-punctuation">&lt;</span><span class="sp-syntax-definition">Suspense</span> <span class="sp-syntax-property">fallback</span>=<span class="sp-syntax-punctuation">{</span><span class="sp-syntax-punctuation">&lt;</span><span class="sp-syntax-tag">div</span><span class="sp-syntax-punctuation">&gt;</span>Loading...<span class="sp-syntax-punctuation">&lt;/</span><span class="sp-syntax-tag">div</span><span class="sp-syntax-punctuation">&gt;</span><span class="sp-syntax-punctuation">}</span><span class="sp-syntax-punctuation">&gt;</span><br/></div><div class="cm-line ">      <span class="sp-syntax-punctuation">&lt;</span><span class="sp-syntax-definition">Comments</span> <span class="sp-syntax-property">commentsPromise</span>=<span class="sp-syntax-punctuation">{</span><span class="sp-syntax-plain">commentsPromise</span><span class="sp-syntax-punctuation">}</span> <span class="sp-syntax-punctuation">/&gt;</span><br/></div><div class="cm-line ">    <span class="sp-syntax-punctuation">&lt;/</span><span class="sp-syntax-definition">Suspense</span><span class="sp-syntax-punctuation">&gt;</span><br/></div><div class="cm-line ">  <span class="sp-syntax-punctuation">)</span><br/></div><div class="cm-line "><span class="sp-syntax-punctuation">}</span></div></code></pre></div></div></div></div><!--/$-->
<div class="expandable-callout pt-8 pb-4 px-5 sm:px-8 my-8 relative rounded-none shadow-inner-border -mx-5 sm:mx-auto sm:rounded-2xl bg-green-5 dark:bg-green-60 dark:bg-opacity-20 text-primary dark:text-primary-dark text-lg"><h3 class="text-2xl font-display font-bold text-green-60 dark:text-green-40"><svg class="inline me-3 mb-1 text-lg text-green-60 dark:text-green-40" width="2em" height="2em" viewBox="0 0 72 72" fill="none" xmlns="http://www.w3.org/2000/svg"><g clip-path="url(#clip0_40_48064)"><path d="M24 27C24 25.3431 25.3431 24 27 24H45C46.6569 24 48 25.3431 48 27C48 28.6569 46.6569 30 45 30H27C25.3431 30 24 28.6569 24 27Z" fill="currentColor"></path><path d="M24 39C24 37.3431 25.3431 36 27 36H39C40.6569 36 42 37.3431 42 39C42 40.6569 40.6569 42 39 42H27C25.3431 42 24 40.6569 24 39Z" fill="currentColor"></path><path fill-rule="evenodd" clip-rule="evenodd" d="M12 18C12 13.0294 16.0294 9 21 9H51C55.9706 9 60 13.0294 60 18V54C60 58.9706 55.9706 63 51 63H21C16.0294 63 12 58.9706 12 54V18ZM21 15H51C52.6569 15 54 16.3431 54 18V54C54 55.6569 52.6569 57 51 57H21C19.3431 57 18 55.6569 18 54V18C18 16.3431 19.3431 15 21 15Z" fill="currentColor"></path></g><defs><clipPath id="clip0_40_48064"><rect width="72" height="72" fill="white"></rect></clipPath></defs></svg>注意</h3><div class="relative"><div class="py-2"><h4 id="use-does-not-support-promises-created-in-render" class="mdx-heading text-xl font-display font-bold leading-9 my-4"><code dir="ltr" class="inline text-code text-secondary dark:text-secondary-dark px-1 rounded-md no-underline bg-gray-30 bg-opacity-10 py-px">use</code> 不支持在渲染中创建的 promises。 <a href="#use-does-not-support-promises-created-in-render" aria-label="Link for this heading" title="Link for this heading" class="mdx-header-anchor inline-block"><svg width="1em" height="1em" viewBox="0 0 13 13" xmlns="http://www.w3.org/2000/svg" class="text-gray-70 ms-2 h-5 w-5"><g fill="currentColor" fill-rule="evenodd"><path d="M7.778 7.975a2.5 2.5 0 0 0 .347-3.837L6.017 2.03a2.498 2.498 0 0 0-3.542-.007 2.5 2.5 0 0 0 .006 3.543l1.153 1.15c.07-.29.154-.563.25-.773.036-.077.084-.16.14-.25L3.18 4.85a1.496 1.496 0 0 1 .002-2.12 1.496 1.496 0 0 1 2.12 0l2.124 2.123a1.496 1.496 0 0 1-.333 2.37c.16.246.42.504.685.752z"></path><path d="M5.657 4.557a2.5 2.5 0 0 0-.347 3.837l2.108 2.108a2.498 2.498 0 0 0 3.542.007 2.5 2.5 0 0 0-.006-3.543L9.802 5.815c-.07.29-.154.565-.25.774-.036.076-.084.16-.14.25l.842.84c.585.587.59 1.532 0 2.122-.587.585-1.532.59-2.12 0L6.008 7.68a1.496 1.496 0 0 1 .332-2.372c-.16-.245-.42-.503-.685-.75z"></path></g></svg></a></h4><p class="whitespace-pre-wrap my-4">如果你尝试将在渲染中创建的 promise 传递给 <code dir="ltr" class="inline text-code text-secondary dark:text-secondary-dark px-1 rounded-md no-underline bg-gray-30 bg-opacity-10 py-px">use</code>，React 将发出警告：</p><div class="console-block mb-4 text-secondary bg-wash dark:bg-wash-dark rounded-lg" translate="no" dir="ltr"><div class="flex w-full rounded-t-lg bg-gray-200 dark:bg-gray-80"><div class="px-4 py-2 border-gray-300 dark:border-gray-90 border-r"><div class="bg-gray-300 dark:bg-gray-70" style="width:15px;height:17px"></div></div><div class="flex text-sm px-4"><div class="border-b-2 border-gray-300 dark:border-gray-90 text-tertiary dark:text-tertiary-dark">Console</div><div class="px-4 py-2 flex"><div class="me-2 bg-gray-300 dark:bg-gray-70" style="width:60px;height:17px"></div><div class="me-2 hidden md:block bg-gray-300 dark:bg-gray-70" style="width:60px;height:17px"></div><div class="hidden md:block bg-gray-300 dark:bg-gray-70" style="width:60px;height:17px"></div></div></div></div><div class="grid grid-cols-1 divide-y divide-gray-300 dark:divide-gray-70 text-base"><div class="ps-4 pe-2 pt-1 pb-2 grid grid-cols-[18px_auto] font-mono rounded-b-md bg-red-30 text-red-50 dark:text-red-30 bg-opacity-5"><svg class="self-start mt-1.5 text-[.7rem] w-6" width="1.33em" height="1.33em" viewBox="0 0 24 24" xmlns="http://www.w3.org/2000/svg"><circle cx="10.1626" cy="9.99951" r="9.47021" fill="currentColor"></circle><path d="M6.22705 5.95996L14.2798 14.0127" stroke="white"></path><path d="M14.2798 5.95996L6.22705 14.0127" stroke="white"></path></svg><div class="px-2 pt-1 whitespace-break-spaces text-code leading-tight">A component was suspended by an uncached promise. Creating promises inside a Client Component or hook is not yet supported, except via a Suspense-compatible library or framework.</div></div></div></div><p class="whitespace-pre-wrap my-4">为了解决这个问题，你需要从支持 promise 缓存的 Suspense 强化库或框架中传递一个 promise。在未来，我们计划推出功能，使在渲染中缓存 promise 更加容易。</p></div></div></div>
<p class="whitespace-pre-wrap my-4">你也可以使用 <code dir="ltr" class="inline text-code text-secondary dark:text-secondary-dark px-1 rounded-md no-underline bg-gray-30 bg-opacity-10 py-px">use</code> 读取 context，这使你能够在如提前返回之后的情况下有条件地读取 Context：</p>
<!--$--><div dir="ltr" class="sandpack sandpack--codeblock rounded-2xl h-full w-full overflow-x-auto flex items-center bg-wash dark:bg-gray-95 shadow-lg my-8" style="contain:content"><div class="sp-wrapper"><div class="sp-stack"><div class="sp-code-editor"><pre class="sp-cm sp-pristine sp-javascript flex align-start"><code class="sp-pre-placeholder grow-[2]"><div class="cm-line bg-github-highlight dark:bg-opacity-10"><span class="sp-syntax-keyword">import</span> <span class="sp-syntax-punctuation">{</span><span class="sp-syntax-plain">use</span><span class="sp-syntax-punctuation">}</span> <span class="sp-syntax-keyword">from</span> <span class="sp-syntax-string">&#x27;react&#x27;</span><span class="sp-syntax-punctuation">;</span><br/></div><div class="cm-line "><span class="sp-syntax-keyword">import</span> <span class="sp-syntax-plain">ThemeContext</span> <span class="sp-syntax-keyword">from</span> <span class="sp-syntax-string">&#x27;./ThemeContext&#x27;</span><br/></div><div class="cm-line "><br/></div><div class="cm-line "><span class="sp-syntax-keyword">function</span> <span class="sp-syntax-definition">Heading</span><span class="sp-syntax-punctuation">(</span><span class="sp-syntax-punctuation">{</span><span class="sp-syntax-property">children</span><span class="sp-syntax-punctuation">}</span><span class="sp-syntax-punctuation">)</span> <span class="sp-syntax-punctuation">{</span><br/></div><div class="cm-line ">  <span class="sp-syntax-keyword">if</span> <span class="sp-syntax-punctuation">(</span><span class="sp-syntax-plain">children</span> == <span class="sp-syntax-keyword">null</span><span class="sp-syntax-punctuation">)</span> <span class="sp-syntax-punctuation">{</span><br/></div><div class="cm-line ">    <span class="sp-syntax-keyword">return</span> <span class="sp-syntax-keyword">null</span><span class="sp-syntax-punctuation">;</span><br/></div><div class="cm-line ">  <span class="sp-syntax-punctuation">}</span><br/></div><div class="cm-line ">  <br/></div><div class="cm-line ">  <span class="sp-syntax-comment">// 因为过早的返回</span><br/></div><div class="cm-line ">  <span class="sp-syntax-comment">// 这里 useContext 无法正常工作。</span><br/></div><div class="cm-line bg-github-highlight dark:bg-opacity-10">  <span class="sp-syntax-keyword">const</span> <span class="sp-syntax-plain">theme</span> = <span class="sp-syntax-definition">use</span><span class="sp-syntax-punctuation">(</span><span class="sp-syntax-plain">ThemeContext</span><span class="sp-syntax-punctuation">)</span><span class="sp-syntax-punctuation">;</span><br/></div><div class="cm-line ">  <span class="sp-syntax-keyword">return</span> <span class="sp-syntax-punctuation">(</span><br/></div><div class="cm-line ">    <span class="sp-syntax-punctuation">&lt;</span><span class="sp-syntax-tag">h1</span> <span class="sp-syntax-property">style</span>=<span class="sp-syntax-punctuation">{</span><span class="sp-syntax-punctuation">{</span><span class="sp-syntax-property">color</span><span class="sp-syntax-punctuation">:</span> <span class="sp-syntax-plain">theme</span>.<span class="sp-syntax-property">color</span><span class="sp-syntax-punctuation">}</span><span class="sp-syntax-punctuation">}</span><span class="sp-syntax-punctuation">&gt;</span><br/></div><div class="cm-line ">      <span class="sp-syntax-punctuation">{</span><span class="sp-syntax-plain">children</span><span class="sp-syntax-punctuation">}</span><br/></div><div class="cm-line ">    <span class="sp-syntax-punctuation">&lt;/</span><span class="sp-syntax-tag">h1</span><span class="sp-syntax-punctuation">&gt;</span><br/></div><div class="cm-line ">  <span class="sp-syntax-punctuation">)</span><span class="sp-syntax-punctuation">;</span><br/></div><div class="cm-line "><span class="sp-syntax-punctuation">}</span></div></code></pre></div></div></div></div><!--/$-->
<p class="whitespace-pre-wrap my-4"><code dir="ltr" class="inline text-code text-secondary dark:text-secondary-dark px-1 rounded-md no-underline bg-gray-30 bg-opacity-10 py-px">use</code> API 只能在渲染中被调用，类似于 hooks。与 hooks 不同，<code dir="ltr" class="inline text-code text-secondary dark:text-secondary-dark px-1 rounded-md no-underline bg-gray-30 bg-opacity-10 py-px">use</code> 可以被有条件地调用。在未来，我们计划支持在渲染中使用 <code dir="ltr" class="inline text-code text-secondary dark:text-secondary-dark px-1 rounded-md no-underline bg-gray-30 bg-opacity-10 py-px">use</code> 消费更多资源的方式。</p>
<p class="whitespace-pre-wrap my-4">有关更多信息，请参阅 <a class="inline text-link dark:text-link-dark border-b border-link border-opacity-0 hover:border-opacity-100 duration-100 ease-in transition leading-normal" href="/reference/react/use"><code dir="ltr" class="inline text-code text-secondary dark:text-secondary-dark px-1 rounded-md no-underline bg-gray-30 bg-opacity-10 py-px">use</code></a> 文档。</p>
<h2 id="react-server-components" class="mdx-heading text-3xl font-display leading-10 text-primary dark:text-primary-dark font-bold my-6">React 服务器组件 <a href="#react-server-components" aria-label="Link for React 服务器组件 " title="Link for React 服务器组件 " class="mdx-header-anchor inline-block"><svg width="1em" height="1em" viewBox="0 0 13 13" xmlns="http://www.w3.org/2000/svg" class="text-gray-70 ms-2 h-5 w-5"><g fill="currentColor" fill-rule="evenodd"><path d="M7.778 7.975a2.5 2.5 0 0 0 .347-3.837L6.017 2.03a2.498 2.498 0 0 0-3.542-.007 2.5 2.5 0 0 0 .006 3.543l1.153 1.15c.07-.29.154-.563.25-.773.036-.077.084-.16.14-.25L3.18 4.85a1.496 1.496 0 0 1 .002-2.12 1.496 1.496 0 0 1 2.12 0l2.124 2.123a1.496 1.496 0 0 1-.333 2.37c.16.246.42.504.685.752z"></path><path d="M5.657 4.557a2.5 2.5 0 0 0-.347 3.837l2.108 2.108a2.498 2.498 0 0 0 3.542.007 2.5 2.5 0 0 0-.006-3.543L9.802 5.815c-.07.29-.154.565-.25.774-.036.076-.084.16-.14.25l.842.84c.585.587.59 1.532 0 2.122-.587.585-1.532.59-2.12 0L6.008 7.68a1.496 1.496 0 0 1 .332-2.372c-.16-.245-.42-.503-.685-.75z"></path></g></svg></a></h2>
<h3 id="server-components" class="mdx-heading text-2xl font-display leading-9 text-primary dark:text-primary-dark font-bold my-6">服务器组件 <a href="#server-components" aria-label="Link for 服务器组件 " title="Link for 服务器组件 " class="mdx-header-anchor inline-block"><svg width="1em" height="1em" viewBox="0 0 13 13" xmlns="http://www.w3.org/2000/svg" class="text-gray-70 ms-2 h-5 w-5"><g fill="currentColor" fill-rule="evenodd"><path d="M7.778 7.975a2.5 2.5 0 0 0 .347-3.837L6.017 2.03a2.498 2.498 0 0 0-3.542-.007 2.5 2.5 0 0 0 .006 3.543l1.153 1.15c.07-.29.154-.563.25-.773.036-.077.084-.16.14-.25L3.18 4.85a1.496 1.496 0 0 1 .002-2.12 1.496 1.496 0 0 1 2.12 0l2.124 2.123a1.496 1.496 0 0 1-.333 2.37c.16.246.42.504.685.752z"></path><path d="M5.657 4.557a2.5 2.5 0 0 0-.347 3.837l2.108 2.108a2.498 2.498 0 0 0 3.542.007 2.5 2.5 0 0 0-.006-3.543L9.802 5.815c-.07.29-.154.565-.25.774-.036.076-.084.16-.14.25l.842.84c.585.587.59 1.532 0 2.122-.587.585-1.532.59-2.12 0L6.008 7.68a1.496 1.496 0 0 1 .332-2.372c-.16-.245-.42-.503-.685-.75z"></path></g></svg></a></h3>
<p class="whitespace-pre-wrap my-4">服务器组件是一种新的选项，允许在打包前提前渲染组件，在与你的客户端应用程序或 SSR 服务器不同的环境中。这个独立的环境就是 React 服务器组件中的 “服务器”。服务器组件可以在你的 CI 服务器上在构建时运行一次，或者可以在每次请求时使用 web 服务器运行。</p>
<p class="whitespace-pre-wrap my-4">React 19 包含了所有从 Canary 频道引入的 React 服务器组件功能。这意味着，现在可以将 React 19 作为 peer 依赖项来发布带有服务器组件的库，使用 <code dir="ltr" class="inline text-code text-secondary dark:text-secondary-dark px-1 rounded-md no-underline bg-gray-30 bg-opacity-10 py-px">react-server</code> <a href="https://github.com/reactjs/rfcs/blob/main/text/0227-server-module-conventions.md#react-server-conditional-exports" target="_blank" rel="nofollow noopener noreferrer" class="inline text-link dark:text-link-dark border-b border-link border-opacity-0 hover:border-opacity-100 duration-100 ease-in transition leading-normal">导出条件</a> 用于支持 <a class="inline text-link dark:text-link-dark border-b border-link border-opacity-0 hover:border-opacity-100 duration-100 ease-in transition leading-normal" href="/learn/start-a-new-react-project#which-features-make-up-the-react-teams-full-stack-architecture-vision">全栈 React 架构</a> 的框架。</p>
<div class="expandable-callout pt-8 pb-4 px-5 sm:px-8 my-8 relative rounded-none shadow-inner-border -mx-5 sm:mx-auto sm:rounded-2xl bg-green-5 dark:bg-green-60 dark:bg-opacity-20 text-primary dark:text-primary-dark text-lg"><h3 class="text-2xl font-display font-bold text-green-60 dark:text-green-40"><svg class="inline me-3 mb-1 text-lg text-green-60 dark:text-green-40" width="2em" height="2em" viewBox="0 0 72 72" fill="none" xmlns="http://www.w3.org/2000/svg"><g clip-path="url(#clip0_40_48064)"><path d="M24 27C24 25.3431 25.3431 24 27 24H45C46.6569 24 48 25.3431 48 27C48 28.6569 46.6569 30 45 30H27C25.3431 30 24 28.6569 24 27Z" fill="currentColor"></path><path d="M24 39C24 37.3431 25.3431 36 27 36H39C40.6569 36 42 37.3431 42 39C42 40.6569 40.6569 42 39 42H27C25.3431 42 24 40.6569 24 39Z" fill="currentColor"></path><path fill-rule="evenodd" clip-rule="evenodd" d="M12 18C12 13.0294 16.0294 9 21 9H51C55.9706 9 60 13.0294 60 18V54C60 58.9706 55.9706 63 51 63H21C16.0294 63 12 58.9706 12 54V18ZM21 15H51C52.6569 15 54 16.3431 54 18V54C54 55.6569 52.6569 57 51 57H21C19.3431 57 18 55.6569 18 54V18C18 16.3431 19.3431 15 21 15Z" fill="currentColor"></path></g><defs><clipPath id="clip0_40_48064"><rect width="72" height="72" fill="white"></rect></clipPath></defs></svg>注意</h3><div class="relative"><div class="py-2"><h4 id="how-do-i-build-support-for-server-components" class="mdx-heading text-xl font-display font-bold leading-9 my-4">如何构建对服务器组件的支持? <a href="#how-do-i-build-support-for-server-components" aria-label="Link for 如何构建对服务器组件的支持? " title="Link for 如何构建对服务器组件的支持? " class="mdx-header-anchor inline-block"><svg width="1em" height="1em" viewBox="0 0 13 13" xmlns="http://www.w3.org/2000/svg" class="text-gray-70 ms-2 h-5 w-5"><g fill="currentColor" fill-rule="evenodd"><path d="M7.778 7.975a2.5 2.5 0 0 0 .347-3.837L6.017 2.03a2.498 2.498 0 0 0-3.542-.007 2.5 2.5 0 0 0 .006 3.543l1.153 1.15c.07-.29.154-.563.25-.773.036-.077.084-.16.14-.25L3.18 4.85a1.496 1.496 0 0 1 .002-2.12 1.496 1.496 0 0 1 2.12 0l2.124 2.123a1.496 1.496 0 0 1-.333 2.37c.16.246.42.504.685.752z"></path><path d="M5.657 4.557a2.5 2.5 0 0 0-.347 3.837l2.108 2.108a2.498 2.498 0 0 0 3.542.007 2.5 2.5 0 0 0-.006-3.543L9.802 5.815c-.07.29-.154.565-.25.774-.036.076-.084.16-.14.25l.842.84c.585.587.59 1.532 0 2.122-.587.585-1.532.59-2.12 0L6.008 7.68a1.496 1.496 0 0 1 .332-2.372c-.16-.245-.42-.503-.685-.75z"></path></g></svg></a></h4><p class="whitespace-pre-wrap my-4">虽然 React 19 中的 React 服务器组件是稳定的，并且在主版本之间不会发生破坏，但用于实现 React 服务器组件打包器或框架的底层 API 不遵循 semver，并可能在 React 19.x 的小版本之间发生破坏。</p><p class="whitespace-pre-wrap my-4">为了支持 React 服务器组件作为打包器或框架，我们建议固定到特定的 React 版本，或者使用 Canary 发行版。我们将继续与打包器和框架合作，以稳定用于实现 React 服务器组件的 API。</p></div></div></div>
<p class="whitespace-pre-wrap my-4">有关更多信息，请参阅文档 <a class="inline text-link dark:text-link-dark border-b border-link border-opacity-0 hover:border-opacity-100 duration-100 ease-in transition leading-normal" href="/reference/rsc/server-components">React Server Components</a>.</p>
<h3 id="server-actions" class="mdx-heading text-2xl font-display leading-9 text-primary dark:text-primary-dark font-bold my-6">服务器操作 <a href="#server-actions" aria-label="Link for 服务器操作 " title="Link for 服务器操作 " class="mdx-header-anchor inline-block"><svg width="1em" height="1em" viewBox="0 0 13 13" xmlns="http://www.w3.org/2000/svg" class="text-gray-70 ms-2 h-5 w-5"><g fill="currentColor" fill-rule="evenodd"><path d="M7.778 7.975a2.5 2.5 0 0 0 .347-3.837L6.017 2.03a2.498 2.498 0 0 0-3.542-.007 2.5 2.5 0 0 0 .006 3.543l1.153 1.15c.07-.29.154-.563.25-.773.036-.077.084-.16.14-.25L3.18 4.85a1.496 1.496 0 0 1 .002-2.12 1.496 1.496 0 0 1 2.12 0l2.124 2.123a1.496 1.496 0 0 1-.333 2.37c.16.246.42.504.685.752z"></path><path d="M5.657 4.557a2.5 2.5 0 0 0-.347 3.837l2.108 2.108a2.498 2.498 0 0 0 3.542.007 2.5 2.5 0 0 0-.006-3.543L9.802 5.815c-.07.29-.154.565-.25.774-.036.076-.084.16-.14.25l.842.84c.585.587.59 1.532 0 2.122-.587.585-1.532.59-2.12 0L6.008 7.68a1.496 1.496 0 0 1 .332-2.372c-.16-.245-.42-.503-.685-.75z"></path></g></svg></a></h3>
<p class="whitespace-pre-wrap my-4">服务器 Actions 允许客户端组件调用在服务器上执行的异步函数。</p>
<p class="whitespace-pre-wrap my-4">当使用 <code dir="ltr" class="inline text-code text-secondary dark:text-secondary-dark px-1 rounded-md no-underline bg-gray-30 bg-opacity-10 py-px">&quot;use server&quot;</code> 指令定义服务器 Action 时，你的框架将自动创建一个指向服务器函数的引用，并将该引用传递给客户端组件。当在客户端调用该函数时，React 将向服务器发送一个请求来执行该函数，并返回结果。</p>
<div class="expandable-callout pt-8 pb-4 px-5 sm:px-8 my-8 relative rounded-none shadow-inner-border -mx-5 sm:mx-auto sm:rounded-2xl bg-green-5 dark:bg-green-60 dark:bg-opacity-20 text-primary dark:text-primary-dark text-lg"><h3 class="text-2xl font-display font-bold text-green-60 dark:text-green-40"><svg class="inline me-3 mb-1 text-lg text-green-60 dark:text-green-40" width="2em" height="2em" viewBox="0 0 72 72" fill="none" xmlns="http://www.w3.org/2000/svg"><g clip-path="url(#clip0_40_48064)"><path d="M24 27C24 25.3431 25.3431 24 27 24H45C46.6569 24 48 25.3431 48 27C48 28.6569 46.6569 30 45 30H27C25.3431 30 24 28.6569 24 27Z" fill="currentColor"></path><path d="M24 39C24 37.3431 25.3431 36 27 36H39C40.6569 36 42 37.3431 42 39C42 40.6569 40.6569 42 39 42H27C25.3431 42 24 40.6569 24 39Z" fill="currentColor"></path><path fill-rule="evenodd" clip-rule="evenodd" d="M12 18C12 13.0294 16.0294 9 21 9H51C55.9706 9 60 13.0294 60 18V54C60 58.9706 55.9706 63 51 63H21C16.0294 63 12 58.9706 12 54V18ZM21 15H51C52.6569 15 54 16.3431 54 18V54C54 55.6569 52.6569 57 51 57H21C19.3431 57 18 55.6569 18 54V18C18 16.3431 19.3431 15 21 15Z" fill="currentColor"></path></g><defs><clipPath id="clip0_40_48064"><rect width="72" height="72" fill="white"></rect></clipPath></defs></svg>注意</h3><div class="relative"><div class="py-2"><h4 id="there-is-no-directive-for-server-components" class="mdx-heading text-xl font-display font-bold leading-9 my-4">服务器组件没有指令 <a href="#there-is-no-directive-for-server-components" aria-label="Link for 服务器组件没有指令 " title="Link for 服务器组件没有指令 " class="mdx-header-anchor inline-block"><svg width="1em" height="1em" viewBox="0 0 13 13" xmlns="http://www.w3.org/2000/svg" class="text-gray-70 ms-2 h-5 w-5"><g fill="currentColor" fill-rule="evenodd"><path d="M7.778 7.975a2.5 2.5 0 0 0 .347-3.837L6.017 2.03a2.498 2.498 0 0 0-3.542-.007 2.5 2.5 0 0 0 .006 3.543l1.153 1.15c.07-.29.154-.563.25-.773.036-.077.084-.16.14-.25L3.18 4.85a1.496 1.496 0 0 1 .002-2.12 1.496 1.496 0 0 1 2.12 0l2.124 2.123a1.496 1.496 0 0 1-.333 2.37c.16.246.42.504.685.752z"></path><path d="M5.657 4.557a2.5 2.5 0 0 0-.347 3.837l2.108 2.108a2.498 2.498 0 0 0 3.542.007 2.5 2.5 0 0 0-.006-3.543L9.802 5.815c-.07.29-.154.565-.25.774-.036.076-.084.16-.14.25l.842.84c.585.587.59 1.532 0 2.122-.587.585-1.532.59-2.12 0L6.008 7.68a1.496 1.496 0 0 1 .332-2.372c-.16-.245-.42-.503-.685-.75z"></path></g></svg></a></h4><p class="whitespace-pre-wrap my-4">一个常见的误解是服务器组件由 <code dir="ltr" class="inline text-code text-secondary dark:text-secondary-dark px-1 rounded-md no-underline bg-gray-30 bg-opacity-10 py-px">&quot;use server&quot;</code> 指示，但服务器组件没有指令。<code dir="ltr" class="inline text-code text-secondary dark:text-secondary-dark px-1 rounded-md no-underline bg-gray-30 bg-opacity-10 py-px">&quot;use server&quot;</code> 指令用于服务器 Actions。</p><p class="whitespace-pre-wrap my-4">有关更多信息，请参阅 <a class="inline text-link dark:text-link-dark border-b border-link border-opacity-0 hover:border-opacity-100 duration-100 ease-in transition leading-normal" href="/reference/rsc/directives">指令</a> 文档。</p></div></div></div>
<p class="whitespace-pre-wrap my-4">服务器 Actions 可以在服务器组件中创建并作为 props 传递给客户端组件，或者可以在客户端组件中导入和使用。</p>
<p class="whitespace-pre-wrap my-4">有关更多信息，请参阅 <a class="inline text-link dark:text-link-dark border-b border-link border-opacity-0 hover:border-opacity-100 duration-100 ease-in transition leading-normal" href="/reference/rsc/server-actions">React 服务器 Actions</a> 文档。</p>
<h2 id="improvements-in-react-19" class="mdx-heading text-3xl font-display leading-10 text-primary dark:text-primary-dark font-bold my-6">React 19 中的改进 <a href="#improvements-in-react-19" aria-label="Link for React 19 中的改进 " title="Link for React 19 中的改进 " class="mdx-header-anchor inline-block"><svg width="1em" height="1em" viewBox="0 0 13 13" xmlns="http://www.w3.org/2000/svg" class="text-gray-70 ms-2 h-5 w-5"><g fill="currentColor" fill-rule="evenodd"><path d="M7.778 7.975a2.5 2.5 0 0 0 .347-3.837L6.017 2.03a2.498 2.498 0 0 0-3.542-.007 2.5 2.5 0 0 0 .006 3.543l1.153 1.15c.07-.29.154-.563.25-.773.036-.077.084-.16.14-.25L3.18 4.85a1.496 1.496 0 0 1 .002-2.12 1.496 1.496 0 0 1 2.12 0l2.124 2.123a1.496 1.496 0 0 1-.333 2.37c.16.246.42.504.685.752z"></path><path d="M5.657 4.557a2.5 2.5 0 0 0-.347 3.837l2.108 2.108a2.498 2.498 0 0 0 3.542.007 2.5 2.5 0 0 0-.006-3.543L9.802 5.815c-.07.29-.154.565-.25.774-.036.076-.084.16-.14.25l.842.84c.585.587.59 1.532 0 2.122-.587.585-1.532.59-2.12 0L6.008 7.68a1.496 1.496 0 0 1 .332-2.372c-.16-.245-.42-.503-.685-.75z"></path></g></svg></a></h2>
<h3 id="ref-as-a-prop" class="mdx-heading text-2xl font-display leading-9 text-primary dark:text-primary-dark font-bold my-6"><code dir="ltr" class="inline text-code text-secondary dark:text-secondary-dark px-1 rounded-md no-underline bg-gray-30 bg-opacity-10 py-px">ref</code> 作为一个属性 <a href="#ref-as-a-prop" aria-label="Link for this heading" title="Link for this heading" class="mdx-header-anchor inline-block"><svg width="1em" height="1em" viewBox="0 0 13 13" xmlns="http://www.w3.org/2000/svg" class="text-gray-70 ms-2 h-5 w-5"><g fill="currentColor" fill-rule="evenodd"><path d="M7.778 7.975a2.5 2.5 0 0 0 .347-3.837L6.017 2.03a2.498 2.498 0 0 0-3.542-.007 2.5 2.5 0 0 0 .006 3.543l1.153 1.15c.07-.29.154-.563.25-.773.036-.077.084-.16.14-.25L3.18 4.85a1.496 1.496 0 0 1 .002-2.12 1.496 1.496 0 0 1 2.12 0l2.124 2.123a1.496 1.496 0 0 1-.333 2.37c.16.246.42.504.685.752z"></path><path d="M5.657 4.557a2.5 2.5 0 0 0-.347 3.837l2.108 2.108a2.498 2.498 0 0 0 3.542.007 2.5 2.5 0 0 0-.006-3.543L9.802 5.815c-.07.29-.154.565-.25.774-.036.076-.084.16-.14.25l.842.84c.585.587.59 1.532 0 2.122-.587.585-1.532.59-2.12 0L6.008 7.68a1.496 1.496 0 0 1 .332-2.372c-.16-.245-.42-.503-.685-.75z"></path></g></svg></a></h3>
<p class="whitespace-pre-wrap my-4">从 React 19 开始，你现在可以在函数组件中将 <code dir="ltr" class="inline text-code text-secondary dark:text-secondary-dark px-1 rounded-md no-underline bg-gray-30 bg-opacity-10 py-px">ref</code> 作为 prop 进行访问：</p>
<!--$--><div dir="ltr" class="sandpack sandpack--codeblock rounded-2xl h-full w-full overflow-x-auto flex items-center bg-wash dark:bg-gray-95 shadow-lg my-8" style="contain:content"><div class="sp-wrapper"><div class="sp-stack"><div class="sp-code-editor"><pre class="sp-cm sp-pristine sp-javascript flex align-start"><code class="sp-pre-placeholder grow-[2]"><div class="cm-line "><span class="sp-syntax-keyword">function</span> <span class="sp-syntax-definition">MyInput</span><span class="sp-syntax-punctuation">(</span><span class="sp-syntax-punctuation">{</span><span class="sp-syntax-property">placeholder</span><span class="sp-syntax-punctuation">,</span> <span class="code-step bg-opacity-10 dark:bg-opacity-20 relative rounded px-1 py-[1.5px] border-b-[2px] border-opacity-60 bg-blue-40 border-blue-40 text-blue-60 dark:text-blue-30">ref</span><span class="sp-syntax-punctuation">}</span><span class="sp-syntax-punctuation">)</span> <span class="sp-syntax-punctuation">{</span><br/></div><div class="cm-line ">  <span class="sp-syntax-keyword">return</span> <span class="sp-syntax-punctuation">&lt;</span><span class="sp-syntax-tag">input</span> <span class="sp-syntax-property">placeholder</span>=<span class="sp-syntax-punctuation">{</span><span class="sp-syntax-plain">placeholder</span><span class="sp-syntax-punctuation">}</span> <span class="sp-syntax-property">ref</span>=<span class="sp-syntax-punctuation">{</span><span class="code-step bg-opacity-10 dark:bg-opacity-20 relative rounded px-1 py-[1.5px] border-b-[2px] border-opacity-60 bg-blue-40 border-blue-40 text-blue-60 dark:text-blue-30">ref</span><span class="sp-syntax-punctuation">}</span> <span class="sp-syntax-punctuation">/&gt;</span><br/></div><div class="cm-line "><span class="sp-syntax-punctuation">}</span><br/></div><div class="cm-line "><br/></div><div class="cm-line "><span class="sp-syntax-comment">//...</span><br/></div><div class="cm-line "><span class="sp-syntax-punctuation">&lt;</span><span class="sp-syntax-definition">MyInput</span> <span class="sp-syntax-property">ref</span>=<span class="sp-syntax-punctuation">{</span><span class="code-step bg-opacity-10 dark:bg-opacity-20 relative rounded px-1 py-[1.5px] border-b-[2px] border-opacity-60 bg-blue-40 border-blue-40 text-blue-60 dark:text-blue-30">ref</span><span class="sp-syntax-punctuation">}</span> <span class="sp-syntax-punctuation">/&gt;</span></div></code></pre></div></div></div></div><!--/$-->
<p class="whitespace-pre-wrap my-4">新的函数组件将不再需要 <code dir="ltr" class="inline text-code text-secondary dark:text-secondary-dark px-1 rounded-md no-underline bg-gray-30 bg-opacity-10 py-px">forwardRef</code>，我们将发布一个 codemod 来自动更新你的组件以使用新的 <code dir="ltr" class="inline text-code text-secondary dark:text-secondary-dark px-1 rounded-md no-underline bg-gray-30 bg-opacity-10 py-px">ref</code> prop。在未来的版本中，我们将弃用并移除 <code dir="ltr" class="inline text-code text-secondary dark:text-secondary-dark px-1 rounded-md no-underline bg-gray-30 bg-opacity-10 py-px">forwardRef</code>。</p>
<div class="expandable-callout pt-8 pb-4 px-5 sm:px-8 my-8 relative rounded-none shadow-inner-border -mx-5 sm:mx-auto sm:rounded-2xl bg-green-5 dark:bg-green-60 dark:bg-opacity-20 text-primary dark:text-primary-dark text-lg"><h3 class="text-2xl font-display font-bold text-green-60 dark:text-green-40"><svg class="inline me-3 mb-1 text-lg text-green-60 dark:text-green-40" width="2em" height="2em" viewBox="0 0 72 72" fill="none" xmlns="http://www.w3.org/2000/svg"><g clip-path="url(#clip0_40_48064)"><path d="M24 27C24 25.3431 25.3431 24 27 24H45C46.6569 24 48 25.3431 48 27C48 28.6569 46.6569 30 45 30H27C25.3431 30 24 28.6569 24 27Z" fill="currentColor"></path><path d="M24 39C24 37.3431 25.3431 36 27 36H39C40.6569 36 42 37.3431 42 39C42 40.6569 40.6569 42 39 42H27C25.3431 42 24 40.6569 24 39Z" fill="currentColor"></path><path fill-rule="evenodd" clip-rule="evenodd" d="M12 18C12 13.0294 16.0294 9 21 9H51C55.9706 9 60 13.0294 60 18V54C60 58.9706 55.9706 63 51 63H21C16.0294 63 12 58.9706 12 54V18ZM21 15H51C52.6569 15 54 16.3431 54 18V54C54 55.6569 52.6569 57 51 57H21C19.3431 57 18 55.6569 18 54V18C18 16.3431 19.3431 15 21 15Z" fill="currentColor"></path></g><defs><clipPath id="clip0_40_48064"><rect width="72" height="72" fill="white"></rect></clipPath></defs></svg>注意</h3><div class="relative"><div class="py-2"><p class="whitespace-pre-wrap my-4">在类组件中，<code dir="ltr" class="inline text-code text-secondary dark:text-secondary-dark px-1 rounded-md no-underline bg-gray-30 bg-opacity-10 py-px">ref</code> 不作为 props 传递，因为它们引用的是组件实例。这意味着，如果你在类组件中需要访问 <code dir="ltr" class="inline text-code text-secondary dark:text-secondary-dark px-1 rounded-md no-underline bg-gray-30 bg-opacity-10 py-px">ref</code>，你需要使用 <code dir="ltr" class="inline text-code text-secondary dark:text-secondary-dark px-1 rounded-md no-underline bg-gray-30 bg-opacity-10 py-px">React.forwardRef</code> 或者 <code dir="ltr" class="inline text-code text-secondary dark:text-secondary-dark px-1 rounded-md no-underline bg-gray-30 bg-opacity-10 py-px">React.createRef</code>。</p></div></div></div>
<h3 id="diffs-for-hydration-errors" class="mdx-heading text-2xl font-display leading-9 text-primary dark:text-primary-dark font-bold my-6">激活错误的差异 <a href="#diffs-for-hydration-errors" aria-label="Link for 激活错误的差异 " title="Link for 激活错误的差异 " class="mdx-header-anchor inline-block"><svg width="1em" height="1em" viewBox="0 0 13 13" xmlns="http://www.w3.org/2000/svg" class="text-gray-70 ms-2 h-5 w-5"><g fill="currentColor" fill-rule="evenodd"><path d="M7.778 7.975a2.5 2.5 0 0 0 .347-3.837L6.017 2.03a2.498 2.498 0 0 0-3.542-.007 2.5 2.5 0 0 0 .006 3.543l1.153 1.15c.07-.29.154-.563.25-.773.036-.077.084-.16.14-.25L3.18 4.85a1.496 1.496 0 0 1 .002-2.12 1.496 1.496 0 0 1 2.12 0l2.124 2.123a1.496 1.496 0 0 1-.333 2.37c.16.246.42.504.685.752z"></path><path d="M5.657 4.557a2.5 2.5 0 0 0-.347 3.837l2.108 2.108a2.498 2.498 0 0 0 3.542.007 2.5 2.5 0 0 0-.006-3.543L9.802 5.815c-.07.29-.154.565-.25.774-.036.076-.084.16-.14.25l.842.84c.585.587.59 1.532 0 2.122-.587.585-1.532.59-2.12 0L6.008 7.68a1.496 1.496 0 0 1 .332-2.372c-.16-.245-.42-.503-.685-.75z"></path></g></svg></a></h3>
<p class="whitespace-pre-wrap my-4">在 <code dir="ltr" class="inline text-code text-secondary dark:text-secondary-dark px-1 rounded-md no-underline bg-gray-30 bg-opacity-10 py-px">react-dom</code> 中，我们也改进了水合错误的错误报告。例如，现在不再在 DEV 中记录多个没有任何不匹配信息的错误：</p>
<div class="console-block mb-4 text-secondary bg-wash dark:bg-wash-dark rounded-lg" translate="no" dir="ltr"><div class="flex w-full rounded-t-lg bg-gray-200 dark:bg-gray-80"><div class="px-4 py-2 border-gray-300 dark:border-gray-90 border-r"><div class="bg-gray-300 dark:bg-gray-70" style="width:15px;height:17px"></div></div><div class="flex text-sm px-4"><div class="border-b-2 border-gray-300 dark:border-gray-90 text-tertiary dark:text-tertiary-dark">Console</div><div class="px-4 py-2 flex"><div class="me-2 bg-gray-300 dark:bg-gray-70" style="width:60px;height:17px"></div><div class="me-2 hidden md:block bg-gray-300 dark:bg-gray-70" style="width:60px;height:17px"></div><div class="hidden md:block bg-gray-300 dark:bg-gray-70" style="width:60px;height:17px"></div></div></div></div><div class="grid grid-cols-1 divide-y divide-gray-300 dark:divide-gray-70 text-base"><div class="ps-4 pe-2 pt-1 pb-2 grid grid-cols-[18px_auto] font-mono rounded-b-md bg-red-30 text-red-50 dark:text-red-30 bg-opacity-5"><svg class="self-start mt-1.5 text-[.7rem] w-6" width="1.33em" height="1.33em" viewBox="0 0 24 24" xmlns="http://www.w3.org/2000/svg"><circle cx="10.1626" cy="9.99951" r="9.47021" fill="currentColor"></circle><path d="M6.22705 5.95996L14.2798 14.0127" stroke="white"></path><path d="M14.2798 5.95996L6.22705 14.0127" stroke="white"></path></svg><div class="px-2 pt-1 whitespace-break-spaces text-code leading-tight">Warning: Text content did not match. Server: “Server” Client: “Client”
<!-- -->  <!-- -->at span
<!-- -->  <!-- -->at App</div></div><div class="ps-4 pe-2 pt-1 pb-2 grid grid-cols-[18px_auto] font-mono rounded-b-md bg-red-30 text-red-50 dark:text-red-30 bg-opacity-5"><svg class="self-start mt-1.5 text-[.7rem] w-6" width="1.33em" height="1.33em" viewBox="0 0 24 24" xmlns="http://www.w3.org/2000/svg"><circle cx="10.1626" cy="9.99951" r="9.47021" fill="currentColor"></circle><path d="M6.22705 5.95996L14.2798 14.0127" stroke="white"></path><path d="M14.2798 5.95996L6.22705 14.0127" stroke="white"></path></svg><div class="px-2 pt-1 whitespace-break-spaces text-code leading-tight">Warning: An error occurred during hydration. The server HTML was replaced with client content in &lt;div&gt;.</div></div><div class="ps-4 pe-2 pt-1 pb-2 grid grid-cols-[18px_auto] font-mono rounded-b-md bg-red-30 text-red-50 dark:text-red-30 bg-opacity-5"><svg class="self-start mt-1.5 text-[.7rem] w-6" width="1.33em" height="1.33em" viewBox="0 0 24 24" xmlns="http://www.w3.org/2000/svg"><circle cx="10.1626" cy="9.99951" r="9.47021" fill="currentColor"></circle><path d="M6.22705 5.95996L14.2798 14.0127" stroke="white"></path><path d="M14.2798 5.95996L6.22705 14.0127" stroke="white"></path></svg><div class="px-2 pt-1 whitespace-break-spaces text-code leading-tight">Warning: Text content did not match. Server: “Server” Client: “Client”
<!-- -->  <!-- -->at span
<!-- -->  <!-- -->at App</div></div><div class="ps-4 pe-2 pt-1 pb-2 grid grid-cols-[18px_auto] font-mono rounded-b-md bg-red-30 text-red-50 dark:text-red-30 bg-opacity-5"><svg class="self-start mt-1.5 text-[.7rem] w-6" width="1.33em" height="1.33em" viewBox="0 0 24 24" xmlns="http://www.w3.org/2000/svg"><circle cx="10.1626" cy="9.99951" r="9.47021" fill="currentColor"></circle><path d="M6.22705 5.95996L14.2798 14.0127" stroke="white"></path><path d="M14.2798 5.95996L6.22705 14.0127" stroke="white"></path></svg><div class="px-2 pt-1 whitespace-break-spaces text-code leading-tight">Warning: An error occurred during hydration. The server HTML was replaced with client content in &lt;div&gt;.</div></div><div class="ps-4 pe-2 pt-1 pb-2 grid grid-cols-[18px_auto] font-mono rounded-b-md bg-red-30 text-red-50 dark:text-red-30 bg-opacity-5"><svg class="self-start mt-1.5 text-[.7rem] w-6" width="1.33em" height="1.33em" viewBox="0 0 24 24" xmlns="http://www.w3.org/2000/svg"><circle cx="10.1626" cy="9.99951" r="9.47021" fill="currentColor"></circle><path d="M6.22705 5.95996L14.2798 14.0127" stroke="white"></path><path d="M14.2798 5.95996L6.22705 14.0127" stroke="white"></path></svg><div class="px-2 pt-1 whitespace-break-spaces text-code leading-tight">Uncaught Error: Text content does not match server-rendered HTML.
<!-- -->  <!-- -->at checkForUnmatchedText
<!-- -->  <!-- -->…</div></div></div></div>
<p class="whitespace-pre-wrap my-4">现在我们会记录一条带有不匹配差异的单一消息：</p>
<div class="console-block mb-4 text-secondary bg-wash dark:bg-wash-dark rounded-lg" translate="no" dir="ltr"><div class="flex w-full rounded-t-lg bg-gray-200 dark:bg-gray-80"><div class="px-4 py-2 border-gray-300 dark:border-gray-90 border-r"><div class="bg-gray-300 dark:bg-gray-70" style="width:15px;height:17px"></div></div><div class="flex text-sm px-4"><div class="border-b-2 border-gray-300 dark:border-gray-90 text-tertiary dark:text-tertiary-dark">Console</div><div class="px-4 py-2 flex"><div class="me-2 bg-gray-300 dark:bg-gray-70" style="width:60px;height:17px"></div><div class="me-2 hidden md:block bg-gray-300 dark:bg-gray-70" style="width:60px;height:17px"></div><div class="hidden md:block bg-gray-300 dark:bg-gray-70" style="width:60px;height:17px"></div></div></div></div><div class="grid grid-cols-1 divide-y divide-gray-300 dark:divide-gray-70 text-base"><div class="ps-4 pe-2 pt-1 pb-2 grid grid-cols-[18px_auto] font-mono rounded-b-md bg-red-30 text-red-50 dark:text-red-30 bg-opacity-5"><svg class="self-start mt-1.5 text-[.7rem] w-6" width="1.33em" height="1.33em" viewBox="0 0 24 24" xmlns="http://www.w3.org/2000/svg"><circle cx="10.1626" cy="9.99951" r="9.47021" fill="currentColor"></circle><path d="M6.22705 5.95996L14.2798 14.0127" stroke="white"></path><path d="M14.2798 5.95996L6.22705 14.0127" stroke="white"></path></svg><div class="px-2 pt-1 whitespace-break-spaces text-code leading-tight">Uncaught Error: Hydration failed because the server rendered HTML didn’t match the client. As a result this tree will be regenerated on the client. This can happen if an SSR-ed Client Component used:<!-- -->
<!-- -->
- A server/client branch <code dir="ltr" class="inline text-code text-secondary dark:text-secondary-dark px-1 rounded-md no-underline bg-gray-30 bg-opacity-10 py-px">if (typeof window !== &#x27;undefined&#x27;)</code>.
- Variable input such as <code dir="ltr" class="inline text-code text-secondary dark:text-secondary-dark px-1 rounded-md no-underline bg-gray-30 bg-opacity-10 py-px">Date.now()</code> or <code dir="ltr" class="inline text-code text-secondary dark:text-secondary-dark px-1 rounded-md no-underline bg-gray-30 bg-opacity-10 py-px">Math.random()</code> which changes each time it’s called.
- Date formatting in a user’s locale which doesn’t match the server.
- External changing data without sending a snapshot of it along with the HTML.
- Invalid HTML tag nesting.<!-- -->
<!-- -->
It can also happen if the client has a browser extension installed which messes with the HTML before React loaded.<!-- -->
<!-- -->
<a href="https://react.dev/link/hydration-mismatch" target="_blank" rel="nofollow noopener noreferrer" class="inline text-link dark:text-link-dark border-b border-link border-opacity-0 hover:border-opacity-100 duration-100 ease-in transition leading-normal">https://react.dev/link/hydration-mismatch</a> <!-- -->
<!-- -->
<!-- -->  <!-- -->&lt;App&gt;
<!-- -->    <!-- -->&lt;span&gt;
<!-- -->+    <!-- -->Client
<!-- -->-    <!-- -->Server<!-- -->
<!-- -->
<!-- -->  <!-- -->at throwOnHydrationMismatch
<!-- -->  <!-- -->…</div></div></div></div>
<h3 id="context-as-a-provider" class="mdx-heading text-2xl font-display leading-9 text-primary dark:text-primary-dark font-bold my-6"><code dir="ltr" class="inline text-code text-secondary dark:text-secondary-dark px-1 rounded-md no-underline bg-gray-30 bg-opacity-10 py-px">&lt;Context&gt;</code> 作为提供者 <a href="#context-as-a-provider" aria-label="Link for this heading" title="Link for this heading" class="mdx-header-anchor inline-block"><svg width="1em" height="1em" viewBox="0 0 13 13" xmlns="http://www.w3.org/2000/svg" class="text-gray-70 ms-2 h-5 w-5"><g fill="currentColor" fill-rule="evenodd"><path d="M7.778 7.975a2.5 2.5 0 0 0 .347-3.837L6.017 2.03a2.498 2.498 0 0 0-3.542-.007 2.5 2.5 0 0 0 .006 3.543l1.153 1.15c.07-.29.154-.563.25-.773.036-.077.084-.16.14-.25L3.18 4.85a1.496 1.496 0 0 1 .002-2.12 1.496 1.496 0 0 1 2.12 0l2.124 2.123a1.496 1.496 0 0 1-.333 2.37c.16.246.42.504.685.752z"></path><path d="M5.657 4.557a2.5 2.5 0 0 0-.347 3.837l2.108 2.108a2.498 2.498 0 0 0 3.542.007 2.5 2.5 0 0 0-.006-3.543L9.802 5.815c-.07.29-.154.565-.25.774-.036.076-.084.16-.14.25l.842.84c.585.587.59 1.532 0 2.122-.587.585-1.532.59-2.12 0L6.008 7.68a1.496 1.496 0 0 1 .332-2.372c-.16-.245-.42-.503-.685-.75z"></path></g></svg></a></h3>
<p class="whitespace-pre-wrap my-4">在 React 19 中，你可以将 <code dir="ltr" class="inline text-code text-secondary dark:text-secondary-dark px-1 rounded-md no-underline bg-gray-30 bg-opacity-10 py-px">&lt;Context&gt;</code> 渲染为提供者，就无需再使用 <code dir="ltr" class="inline text-code text-secondary dark:text-secondary-dark px-1 rounded-md no-underline bg-gray-30 bg-opacity-10 py-px">&lt;Context.Provider&gt;</code> 了：</p>
<!--$--><div dir="ltr" class="sandpack sandpack--codeblock rounded-2xl h-full w-full overflow-x-auto flex items-center bg-wash dark:bg-gray-95 shadow-lg my-8" style="contain:content"><div class="sp-wrapper"><div class="sp-stack"><div class="sp-code-editor"><pre class="sp-cm sp-pristine sp-javascript flex align-start"><code class="sp-pre-placeholder grow-[2]"><div class="cm-line "><span class="sp-syntax-keyword">const</span> <span class="sp-syntax-plain">ThemeContext</span> = <span class="sp-syntax-definition">createContext</span><span class="sp-syntax-punctuation">(</span><span class="sp-syntax-string">&#x27;&#x27;</span><span class="sp-syntax-punctuation">)</span><span class="sp-syntax-punctuation">;</span><br/></div><div class="cm-line "><br/></div><div class="cm-line "><span class="sp-syntax-keyword">function</span> <span class="sp-syntax-definition">App</span><span class="sp-syntax-punctuation">(</span><span class="sp-syntax-punctuation">{</span><span class="sp-syntax-property">children</span><span class="sp-syntax-punctuation">}</span><span class="sp-syntax-punctuation">)</span> <span class="sp-syntax-punctuation">{</span><br/></div><div class="cm-line ">  <span class="sp-syntax-keyword">return</span> <span class="sp-syntax-punctuation">(</span><br/></div><div class="cm-line bg-github-highlight dark:bg-opacity-10">    <span class="sp-syntax-punctuation">&lt;</span><span class="sp-syntax-definition">ThemeContext</span> <span class="sp-syntax-property">value</span>=<span class="sp-syntax-string">&quot;dark&quot;</span><span class="sp-syntax-punctuation">&gt;</span><br/></div><div class="cm-line ">      <span class="sp-syntax-punctuation">{</span><span class="sp-syntax-plain">children</span><span class="sp-syntax-punctuation">}</span><br/></div><div class="cm-line bg-github-highlight dark:bg-opacity-10">    <span class="sp-syntax-punctuation">&lt;/</span><span class="sp-syntax-definition">ThemeContext</span><span class="sp-syntax-punctuation">&gt;</span><br/></div><div class="cm-line ">  <span class="sp-syntax-punctuation">)</span><span class="sp-syntax-punctuation">;</span>  <br/></div><div class="cm-line "><span class="sp-syntax-punctuation">}</span></div></code></pre></div></div></div></div><!--/$-->
<p class="whitespace-pre-wrap my-4">新的 Context 提供者可以使用 <code dir="ltr" class="inline text-code text-secondary dark:text-secondary-dark px-1 rounded-md no-underline bg-gray-30 bg-opacity-10 py-px">&lt;Context&gt;</code>，我们将发布一个 codemod 来转换现有的提供者。在未来的版本中，我们将弃用 <code dir="ltr" class="inline text-code text-secondary dark:text-secondary-dark px-1 rounded-md no-underline bg-gray-30 bg-opacity-10 py-px">&lt;Context.Provider&gt;</code>。</p>
<h3 id="cleanup-functions-for-refs" class="mdx-heading text-2xl font-display leading-9 text-primary dark:text-primary-dark font-bold my-6">refs 支持清理函数 <a href="#cleanup-functions-for-refs" aria-label="Link for refs 支持清理函数 " title="Link for refs 支持清理函数 " class="mdx-header-anchor inline-block"><svg width="1em" height="1em" viewBox="0 0 13 13" xmlns="http://www.w3.org/2000/svg" class="text-gray-70 ms-2 h-5 w-5"><g fill="currentColor" fill-rule="evenodd"><path d="M7.778 7.975a2.5 2.5 0 0 0 .347-3.837L6.017 2.03a2.498 2.498 0 0 0-3.542-.007 2.5 2.5 0 0 0 .006 3.543l1.153 1.15c.07-.29.154-.563.25-.773.036-.077.084-.16.14-.25L3.18 4.85a1.496 1.496 0 0 1 .002-2.12 1.496 1.496 0 0 1 2.12 0l2.124 2.123a1.496 1.496 0 0 1-.333 2.37c.16.246.42.504.685.752z"></path><path d="M5.657 4.557a2.5 2.5 0 0 0-.347 3.837l2.108 2.108a2.498 2.498 0 0 0 3.542.007 2.5 2.5 0 0 0-.006-3.543L9.802 5.815c-.07.29-.154.565-.25.774-.036.076-.084.16-.14.25l.842.84c.585.587.59 1.532 0 2.122-.587.585-1.532.59-2.12 0L6.008 7.68a1.496 1.496 0 0 1 .332-2.372c-.16-.245-.42-.503-.685-.75z"></path></g></svg></a></h3>
<p class="whitespace-pre-wrap my-4">这将使得在 <code dir="ltr" class="inline text-code text-secondary dark:text-secondary-dark px-1 rounded-md no-underline bg-gray-30 bg-opacity-10 py-px">ref</code> 改变时执行清理操作变得更加容易。例如，你可以在 <code dir="ltr" class="inline text-code text-secondary dark:text-secondary-dark px-1 rounded-md no-underline bg-gray-30 bg-opacity-10 py-px">ref</code> 改变时取消订阅事件：</p>
<!--$--><div dir="ltr" class="sandpack sandpack--codeblock rounded-2xl h-full w-full overflow-x-auto flex items-center bg-wash dark:bg-gray-95 shadow-lg my-8" style="contain:content"><div class="sp-wrapper"><div class="sp-stack"><div class="sp-code-editor"><pre class="sp-cm sp-pristine sp-javascript flex align-start"><code class="sp-pre-placeholder grow-[2]"><div class="cm-line "><span class="sp-syntax-punctuation">&lt;</span><span class="sp-syntax-tag">input</span><br/></div><div class="cm-line ">  <span class="sp-syntax-property">ref</span>=<span class="sp-syntax-punctuation">{</span><span class="sp-syntax-punctuation">(</span><span class="sp-syntax-plain">ref</span><span class="sp-syntax-punctuation">)</span> <span class="sp-syntax-punctuation">=&gt;</span> <span class="sp-syntax-punctuation">{</span><br/></div><div class="cm-line ">    <span class="sp-syntax-comment">// ref 创建</span><br/></div><div class="cm-line "><br/></div><div class="cm-line ">    <span class="sp-syntax-comment">// 新特性: 当元素从 DOM 中被移除时</span><br/></div><div class="cm-line ">    <span class="sp-syntax-comment">// 返回一个清理函数来重置 ref</span><br/></div><div class="cm-line bg-github-highlight dark:bg-opacity-10">    <span class="sp-syntax-keyword">return</span> <span class="sp-syntax-punctuation">(</span><span class="sp-syntax-punctuation">)</span> <span class="sp-syntax-punctuation">=&gt;</span> <span class="sp-syntax-punctuation">{</span><br/></div><div class="cm-line bg-github-highlight dark:bg-opacity-10">      <span class="sp-syntax-comment">// ref cleanup</span><br/></div><div class="cm-line bg-github-highlight dark:bg-opacity-10">    <span class="sp-syntax-punctuation">}</span><span class="sp-syntax-punctuation">;</span><br/></div><div class="cm-line ">  <span class="sp-syntax-punctuation">}</span><span class="sp-syntax-punctuation">}</span><br/></div><div class="cm-line "><span class="sp-syntax-punctuation">/&gt;</span></div></code></pre></div></div></div></div><!--/$-->
<p class="whitespace-pre-wrap my-4">当组件卸载时，React 将调用从 <code dir="ltr" class="inline text-code text-secondary dark:text-secondary-dark px-1 rounded-md no-underline bg-gray-30 bg-opacity-10 py-px">ref</code> 回调返回的清理函数。这适用于 DOM refs，类组件的 refs，以及 <code dir="ltr" class="inline text-code text-secondary dark:text-secondary-dark px-1 rounded-md no-underline bg-gray-30 bg-opacity-10 py-px">useImperativeHandle</code>。</p>
<div class="expandable-callout pt-8 pb-4 px-5 sm:px-8 my-8 relative rounded-none shadow-inner-border -mx-5 sm:mx-auto sm:rounded-2xl bg-green-5 dark:bg-green-60 dark:bg-opacity-20 text-primary dark:text-primary-dark text-lg"><h3 class="text-2xl font-display font-bold text-green-60 dark:text-green-40"><svg class="inline me-3 mb-1 text-lg text-green-60 dark:text-green-40" width="2em" height="2em" viewBox="0 0 72 72" fill="none" xmlns="http://www.w3.org/2000/svg"><g clip-path="url(#clip0_40_48064)"><path d="M24 27C24 25.3431 25.3431 24 27 24H45C46.6569 24 48 25.3431 48 27C48 28.6569 46.6569 30 45 30H27C25.3431 30 24 28.6569 24 27Z" fill="currentColor"></path><path d="M24 39C24 37.3431 25.3431 36 27 36H39C40.6569 36 42 37.3431 42 39C42 40.6569 40.6569 42 39 42H27C25.3431 42 24 40.6569 24 39Z" fill="currentColor"></path><path fill-rule="evenodd" clip-rule="evenodd" d="M12 18C12 13.0294 16.0294 9 21 9H51C55.9706 9 60 13.0294 60 18V54C60 58.9706 55.9706 63 51 63H21C16.0294 63 12 58.9706 12 54V18ZM21 15H51C52.6569 15 54 16.3431 54 18V54C54 55.6569 52.6569 57 51 57H21C19.3431 57 18 55.6569 18 54V18C18 16.3431 19.3431 15 21 15Z" fill="currentColor"></path></g><defs><clipPath id="clip0_40_48064"><rect width="72" height="72" fill="white"></rect></clipPath></defs></svg>注意</h3><div class="relative"><div class="py-2"><p class="whitespace-pre-wrap my-4">以前，当卸载组件时，React 会用 <code dir="ltr" class="inline text-code text-secondary dark:text-secondary-dark px-1 rounded-md no-underline bg-gray-30 bg-opacity-10 py-px">null</code> 调用 <code dir="ltr" class="inline text-code text-secondary dark:text-secondary-dark px-1 rounded-md no-underline bg-gray-30 bg-opacity-10 py-px">ref</code> 函数。如果你的 <code dir="ltr" class="inline text-code text-secondary dark:text-secondary-dark px-1 rounded-md no-underline bg-gray-30 bg-opacity-10 py-px">ref</code> 返回一个清理函数，React 现在将跳过这一步。</p><p class="whitespace-pre-wrap my-4">在未来的版本中，我们将弃用在卸载组件时用 <code dir="ltr" class="inline text-code text-secondary dark:text-secondary-dark px-1 rounded-md no-underline bg-gray-30 bg-opacity-10 py-px">null</code> 调用 refs。</p></div></div></div>
<p class="whitespace-pre-wrap my-4">由于引入了 <code dir="ltr" class="inline text-code text-secondary dark:text-secondary-dark px-1 rounded-md no-underline bg-gray-30 bg-opacity-10 py-px">ref</code> 清理函数，现在 TypeScript 将拒绝从 <code dir="ltr" class="inline text-code text-secondary dark:text-secondary-dark px-1 rounded-md no-underline bg-gray-30 bg-opacity-10 py-px">ref</code> 回调中返回任何其他内容。通常的解决方法是停止使用隐式返回，例如：</p>
<!--$--><div dir="ltr" class="sandpack sandpack--codeblock rounded-2xl h-full w-full overflow-x-auto flex items-center bg-wash dark:bg-gray-95 shadow-lg my-8" style="contain:content"><div class="sp-wrapper"><div class="sp-stack"><div class="sp-code-editor"><pre class="sp-cm sp-pristine sp-javascript flex align-start"><code class="sp-pre-placeholder grow-[2]"><div class="cm-line ">- <span class="sp-syntax-punctuation">&lt;</span><span class="sp-syntax-tag">div</span> <span class="sp-syntax-property">ref</span>=<span class="sp-syntax-punctuation">{</span><span class="sp-syntax-plain">current</span> <span class="sp-syntax-punctuation">=&gt;</span> <span class="code-step bg-opacity-10 dark:bg-opacity-20 relative rounded px-1 py-[1.5px] border-b-[2px] border-opacity-60 bg-blue-40 border-blue-40 text-blue-60 dark:text-blue-30">(</span><span class="sp-syntax-plain">instance</span> = <span class="sp-syntax-plain">current</span><span class="code-step bg-opacity-10 dark:bg-opacity-20 relative rounded px-1 py-[1.5px] border-b-[2px] border-opacity-60 bg-blue-40 border-blue-40 text-blue-60 dark:text-blue-30">)</span><span class="sp-syntax-punctuation">}</span> <span class="sp-syntax-punctuation">/&gt;</span><br/></div><div class="cm-line ">+ <span class="sp-syntax-punctuation">&lt;</span><span class="sp-syntax-tag">div</span> <span class="sp-syntax-property">ref</span>=<span class="sp-syntax-punctuation">{</span><span class="sp-syntax-plain">current</span> <span class="sp-syntax-punctuation">=&gt;</span> <span class="code-step bg-opacity-10 dark:bg-opacity-20 relative rounded px-1 py-[1.5px] border-b-[2px] border-opacity-60 bg-yellow-40 border-yellow-40 text-yellow-60 dark:text-yellow-30">{</span><span class="sp-syntax-plain">instance</span> = <span class="sp-syntax-plain">current</span><span class="code-step bg-opacity-10 dark:bg-opacity-20 relative rounded px-1 py-[1.5px] border-b-[2px] border-opacity-60 bg-yellow-40 border-yellow-40 text-yellow-60 dark:text-yellow-30">}</span><span class="sp-syntax-punctuation">}</span> <span class="sp-syntax-punctuation">/&gt;</span></div></code></pre></div></div></div></div><!--/$-->
<p class="whitespace-pre-wrap my-4">原始代码返回了 <code dir="ltr" class="inline text-code text-secondary dark:text-secondary-dark px-1 rounded-md no-underline bg-gray-30 bg-opacity-10 py-px">HTMLDivElement</code> 的实例，TypeScript 不知道这是否应该是一个清理函数，或者你是否不想返回一个清理函数。</p>
<p class="whitespace-pre-wrap my-4">你可以使用 <a href="https://github.com/eps1lon/types-react-codemod/#no-implicit-ref-callback-return" target="_blank" rel="nofollow noopener noreferrer" class="inline text-link dark:text-link-dark border-b border-link border-opacity-0 hover:border-opacity-100 duration-100 ease-in transition leading-normal"><code dir="ltr" class="inline text-code text-secondary dark:text-secondary-dark px-1 rounded-md no-underline bg-gray-30 bg-opacity-10 py-px">no-implicit-ref-callback-return</code></a> 这个 codemod 来转换这种模式。</p>
<h3 id="use-deferred-value-initial-value" class="mdx-heading text-2xl font-display leading-9 text-primary dark:text-primary-dark font-bold my-6"><code dir="ltr" class="inline text-code text-secondary dark:text-secondary-dark px-1 rounded-md no-underline bg-gray-30 bg-opacity-10 py-px">useDeferredValue</code> 初始化 value <a href="#use-deferred-value-initial-value" aria-label="Link for this heading" title="Link for this heading" class="mdx-header-anchor inline-block"><svg width="1em" height="1em" viewBox="0 0 13 13" xmlns="http://www.w3.org/2000/svg" class="text-gray-70 ms-2 h-5 w-5"><g fill="currentColor" fill-rule="evenodd"><path d="M7.778 7.975a2.5 2.5 0 0 0 .347-3.837L6.017 2.03a2.498 2.498 0 0 0-3.542-.007 2.5 2.5 0 0 0 .006 3.543l1.153 1.15c.07-.29.154-.563.25-.773.036-.077.084-.16.14-.25L3.18 4.85a1.496 1.496 0 0 1 .002-2.12 1.496 1.496 0 0 1 2.12 0l2.124 2.123a1.496 1.496 0 0 1-.333 2.37c.16.246.42.504.685.752z"></path><path d="M5.657 4.557a2.5 2.5 0 0 0-.347 3.837l2.108 2.108a2.498 2.498 0 0 0 3.542.007 2.5 2.5 0 0 0-.006-3.543L9.802 5.815c-.07.29-.154.565-.25.774-.036.076-.084.16-.14.25l.842.84c.585.587.59 1.532 0 2.122-.587.585-1.532.59-2.12 0L6.008 7.68a1.496 1.496 0 0 1 .332-2.372c-.16-.245-.42-.503-.685-.75z"></path></g></svg></a></h3>
<p class="whitespace-pre-wrap my-4">我们为 <code dir="ltr" class="inline text-code text-secondary dark:text-secondary-dark px-1 rounded-md no-underline bg-gray-30 bg-opacity-10 py-px">useDeferredValue</code> 添加了一个 <code dir="ltr" class="inline text-code text-secondary dark:text-secondary-dark px-1 rounded-md no-underline bg-gray-30 bg-opacity-10 py-px">initialValue</code> 选项：</p>
<!--$--><div dir="ltr" class="sandpack sandpack--codeblock rounded-2xl h-full w-full overflow-x-auto flex items-center bg-wash dark:bg-gray-95 shadow-lg my-8" style="contain:content"><div class="sp-wrapper"><div class="sp-stack"><div class="sp-code-editor"><pre class="sp-cm sp-pristine sp-javascript flex align-start"><code class="sp-pre-placeholder grow-[2]"><div class="cm-line "><span class="sp-syntax-keyword">function</span> <span class="sp-syntax-definition">Search</span><span class="sp-syntax-punctuation">(</span><span class="sp-syntax-punctuation">{</span><span class="code-step bg-opacity-10 dark:bg-opacity-20 relative rounded px-1 py-[1.5px] border-b-[2px] border-opacity-60 bg-blue-40 border-blue-40 text-blue-60 dark:text-blue-30">deferredValue</span><span class="sp-syntax-punctuation">}</span><span class="sp-syntax-punctuation">)</span> <span class="sp-syntax-punctuation">{</span><br/></div><div class="cm-line ">  <span class="sp-syntax-comment">// On initial render the value is &#x27;&#x27;.</span><br/></div><div class="cm-line ">  <span class="sp-syntax-comment">// Then a re-render is scheduled with the deferredValue.</span><br/></div><div class="cm-line ">  <span class="sp-syntax-keyword">const</span> <span class="sp-syntax-plain">value</span> = <span class="sp-syntax-definition">useDeferredValue</span><span class="sp-syntax-punctuation">(</span><span class="code-step bg-opacity-10 dark:bg-opacity-20 relative rounded px-1 py-[1.5px] border-b-[2px] border-opacity-60 bg-blue-40 border-blue-40 text-blue-60 dark:text-blue-30">deferredValue</span><span class="sp-syntax-punctuation">,</span> <span class="code-step bg-opacity-10 dark:bg-opacity-20 relative rounded px-1 py-[1.5px] border-b-[2px] border-opacity-60 bg-yellow-40 border-yellow-40 text-yellow-60 dark:text-yellow-30">&#x27;&#x27;</span><span class="sp-syntax-punctuation">)</span><span class="sp-syntax-punctuation">;</span><br/></div><div class="cm-line ">  <br/></div><div class="cm-line ">  <span class="sp-syntax-keyword">return</span> <span class="sp-syntax-punctuation">(</span><br/></div><div class="cm-line ">    <span class="sp-syntax-punctuation">&lt;</span><span class="sp-syntax-definition">Results</span> <span class="sp-syntax-property">query</span>=<span class="sp-syntax-punctuation">{</span><span class="sp-syntax-plain">value</span><span class="sp-syntax-punctuation">}</span> <span class="sp-syntax-punctuation">/&gt;</span><br/></div><div class="cm-line ">  <span class="sp-syntax-punctuation">)</span><span class="sp-syntax-punctuation">;</span><br/></div><div class="cm-line "><span class="sp-syntax-punctuation">}</span></div></code></pre></div></div></div></div><!--/$-->
<p class="whitespace-pre-wrap my-4">当提供了 <span data-step="2" class="code-step bg-opacity-10 dark:bg-opacity-20 relative rounded px-[6px] py-[1.5px] border-b-[2px] border-opacity-60 bg-yellow-40 border-yellow-40 text-yellow-60 dark:text-yellow-30">initialValue</span>, <code dir="ltr" class="inline text-code text-secondary dark:text-secondary-dark px-1 rounded-md no-underline bg-gray-30 bg-opacity-10 py-px">useDeferredValue</code> 将在组件的初始渲染中返回它作为 <code dir="ltr" class="inline text-code text-secondary dark:text-secondary-dark px-1 rounded-md no-underline bg-gray-30 bg-opacity-10 py-px">value</code> , 并在后台安排一个使用返回的  <span data-step="1" class="code-step bg-opacity-10 dark:bg-opacity-20 relative rounded px-[6px] py-[1.5px] border-b-[2px] border-opacity-60 bg-blue-40 border-blue-40 text-blue-60 dark:text-blue-30">deferredValue</span> 重新渲染。</p>
<p class="whitespace-pre-wrap my-4">有关更多信息，请参阅 <a class="inline text-link dark:text-link-dark border-b border-link border-opacity-0 hover:border-opacity-100 duration-100 ease-in transition leading-normal" href="/reference/react/useDeferredValue"><code dir="ltr" class="inline text-code text-secondary dark:text-secondary-dark px-1 rounded-md no-underline bg-gray-30 bg-opacity-10 py-px">useDeferredValue</code></a>。</p>
<h3 id="support-for-metadata-tags" class="mdx-heading text-2xl font-display leading-9 text-primary dark:text-primary-dark font-bold my-6">支持文档元数据 <a href="#support-for-metadata-tags" aria-label="Link for 支持文档元数据 " title="Link for 支持文档元数据 " class="mdx-header-anchor inline-block"><svg width="1em" height="1em" viewBox="0 0 13 13" xmlns="http://www.w3.org/2000/svg" class="text-gray-70 ms-2 h-5 w-5"><g fill="currentColor" fill-rule="evenodd"><path d="M7.778 7.975a2.5 2.5 0 0 0 .347-3.837L6.017 2.03a2.498 2.498 0 0 0-3.542-.007 2.5 2.5 0 0 0 .006 3.543l1.153 1.15c.07-.29.154-.563.25-.773.036-.077.084-.16.14-.25L3.18 4.85a1.496 1.496 0 0 1 .002-2.12 1.496 1.496 0 0 1 2.12 0l2.124 2.123a1.496 1.496 0 0 1-.333 2.37c.16.246.42.504.685.752z"></path><path d="M5.657 4.557a2.5 2.5 0 0 0-.347 3.837l2.108 2.108a2.498 2.498 0 0 0 3.542.007 2.5 2.5 0 0 0-.006-3.543L9.802 5.815c-.07.29-.154.565-.25.774-.036.076-.084.16-.14.25l.842.84c.585.587.59 1.532 0 2.122-.587.585-1.532.59-2.12 0L6.008 7.68a1.496 1.496 0 0 1 .332-2.372c-.16-.245-.42-.503-.685-.75z"></path></g></svg></a></h3>
<p class="whitespace-pre-wrap my-4">在 HTML 中，像 <code dir="ltr" class="inline text-code text-secondary dark:text-secondary-dark px-1 rounded-md no-underline bg-gray-30 bg-opacity-10 py-px">&lt;title&gt;</code>、<code dir="ltr" class="inline text-code text-secondary dark:text-secondary-dark px-1 rounded-md no-underline bg-gray-30 bg-opacity-10 py-px">&lt;link&gt;</code> 和 <code dir="ltr" class="inline text-code text-secondary dark:text-secondary-dark px-1 rounded-md no-underline bg-gray-30 bg-opacity-10 py-px">&lt;meta&gt;</code> 这样的文档元数据标签被保留在文档的 <code dir="ltr" class="inline text-code text-secondary dark:text-secondary-dark px-1 rounded-md no-underline bg-gray-30 bg-opacity-10 py-px">&lt;head&gt;</code> 部分。在 React 中，决定应用程序适合的元数据的组件可能与你渲染 <code dir="ltr" class="inline text-code text-secondary dark:text-secondary-dark px-1 rounded-md no-underline bg-gray-30 bg-opacity-10 py-px">&lt;head&gt;</code> 的地方相距甚远，或者 React 根本不渲染 <code dir="ltr" class="inline text-code text-secondary dark:text-secondary-dark px-1 rounded-md no-underline bg-gray-30 bg-opacity-10 py-px">&lt;head&gt;</code>。在过去，这些元素需要在效果中手动插入，或者通过像 <a href="https://github.com/nfl/react-helmet" target="_blank" rel="nofollow noopener noreferrer" class="inline text-link dark:text-link-dark border-b border-link border-opacity-0 hover:border-opacity-100 duration-100 ease-in transition leading-normal"><code dir="ltr" class="inline text-code text-secondary dark:text-secondary-dark px-1 rounded-md no-underline bg-gray-30 bg-opacity-10 py-px">react-helmet</code></a> 这样的库，并在服务器渲染 React 应用程序时需要小心处理。</p>
<p class="whitespace-pre-wrap my-4">在 React 19 中，我们将原生支持在组件中渲染文档元数据标签：</p>
<!--$--><div dir="ltr" class="sandpack sandpack--codeblock rounded-2xl h-full w-full overflow-x-auto flex items-center bg-wash dark:bg-gray-95 shadow-lg my-8" style="contain:content"><div class="sp-wrapper"><div class="sp-stack"><div class="sp-code-editor"><pre class="sp-cm sp-pristine sp-javascript flex align-start"><code class="sp-pre-placeholder grow-[2]"><div class="cm-line "><span class="sp-syntax-keyword">function</span> <span class="sp-syntax-definition">BlogPost</span><span class="sp-syntax-punctuation">(</span><span class="sp-syntax-punctuation">{</span><span class="sp-syntax-property">post</span><span class="sp-syntax-punctuation">}</span><span class="sp-syntax-punctuation">)</span> <span class="sp-syntax-punctuation">{</span><br/></div><div class="cm-line ">  <span class="sp-syntax-keyword">return</span> <span class="sp-syntax-punctuation">(</span><br/></div><div class="cm-line ">    <span class="sp-syntax-punctuation">&lt;</span><span class="sp-syntax-tag">article</span><span class="sp-syntax-punctuation">&gt;</span><br/></div><div class="cm-line ">      <span class="sp-syntax-punctuation">&lt;</span><span class="sp-syntax-tag">h1</span><span class="sp-syntax-punctuation">&gt;</span><span class="sp-syntax-punctuation">{</span><span class="sp-syntax-plain">post</span>.<span class="sp-syntax-property">title</span><span class="sp-syntax-punctuation">}</span><span class="sp-syntax-punctuation">&lt;/</span><span class="sp-syntax-tag">h1</span><span class="sp-syntax-punctuation">&gt;</span><br/></div><div class="cm-line bg-github-highlight dark:bg-opacity-10">      <span class="sp-syntax-punctuation">&lt;</span><span class="sp-syntax-tag">title</span><span class="sp-syntax-punctuation">&gt;</span><span class="sp-syntax-punctuation">{</span><span class="sp-syntax-plain">post</span>.<span class="sp-syntax-property">title</span><span class="sp-syntax-punctuation">}</span><span class="sp-syntax-punctuation">&lt;/</span><span class="sp-syntax-tag">title</span><span class="sp-syntax-punctuation">&gt;</span><br/></div><div class="cm-line bg-github-highlight dark:bg-opacity-10">      <span class="sp-syntax-punctuation">&lt;</span><span class="sp-syntax-tag">meta</span> <span class="sp-syntax-property">name</span>=<span class="sp-syntax-string">&quot;author&quot;</span> <span class="sp-syntax-property">content</span>=<span class="sp-syntax-string">&quot;Josh&quot;</span> <span class="sp-syntax-punctuation">/&gt;</span><br/></div><div class="cm-line bg-github-highlight dark:bg-opacity-10">      <span class="sp-syntax-punctuation">&lt;</span><span class="sp-syntax-tag">link</span> <span class="sp-syntax-property">rel</span>=<span class="sp-syntax-string">&quot;author&quot;</span> <span class="sp-syntax-property">href</span>=<span class="sp-syntax-string">&quot;https://twitter.com/joshcstory/&quot;</span> <span class="sp-syntax-punctuation">/&gt;</span><br/></div><div class="cm-line bg-github-highlight dark:bg-opacity-10">      <span class="sp-syntax-punctuation">&lt;</span><span class="sp-syntax-tag">meta</span> <span class="sp-syntax-property">name</span>=<span class="sp-syntax-string">&quot;keywords&quot;</span> <span class="sp-syntax-property">content</span>=<span class="sp-syntax-punctuation">{</span><span class="sp-syntax-plain">post</span>.<span class="sp-syntax-property">keywords</span><span class="sp-syntax-punctuation">}</span> <span class="sp-syntax-punctuation">/&gt;</span><br/></div><div class="cm-line ">      <span class="sp-syntax-punctuation">&lt;</span><span class="sp-syntax-tag">p</span><span class="sp-syntax-punctuation">&gt;</span><br/></div><div class="cm-line ">        Eee equals em-see-squared...<br/></div><div class="cm-line ">      <span class="sp-syntax-punctuation">&lt;/</span><span class="sp-syntax-tag">p</span><span class="sp-syntax-punctuation">&gt;</span><br/></div><div class="cm-line ">    <span class="sp-syntax-punctuation">&lt;/</span><span class="sp-syntax-tag">article</span><span class="sp-syntax-punctuation">&gt;</span><br/></div><div class="cm-line ">  <span class="sp-syntax-punctuation">)</span><span class="sp-syntax-punctuation">;</span><br/></div><div class="cm-line "><span class="sp-syntax-punctuation">}</span></div></code></pre></div></div></div></div><!--/$-->
<p class="whitespace-pre-wrap my-4">当 React 渲染这个组件时，它会看到 <code dir="ltr" class="inline text-code text-secondary dark:text-secondary-dark px-1 rounded-md no-underline bg-gray-30 bg-opacity-10 py-px">&lt;title&gt;</code>、<code dir="ltr" class="inline text-code text-secondary dark:text-secondary-dark px-1 rounded-md no-underline bg-gray-30 bg-opacity-10 py-px">&lt;link&gt;</code> 和 <code dir="ltr" class="inline text-code text-secondary dark:text-secondary-dark px-1 rounded-md no-underline bg-gray-30 bg-opacity-10 py-px">&lt;meta&gt;</code> 标签，并自动将它们提升到文档的 <code dir="ltr" class="inline text-code text-secondary dark:text-secondary-dark px-1 rounded-md no-underline bg-gray-30 bg-opacity-10 py-px">&lt;head&gt;</code> 部分。通过原生支持这些元数据标签，我们能够确保它们与仅客户端应用、流式 SSR 和服务器组件一起工作。</p>
<div class="expandable-callout pt-8 pb-4 px-5 sm:px-8 my-8 relative rounded-none shadow-inner-border -mx-5 sm:mx-auto sm:rounded-2xl bg-green-5 dark:bg-green-60 dark:bg-opacity-20 text-primary dark:text-primary-dark text-lg"><h3 class="text-2xl font-display font-bold text-green-60 dark:text-green-40"><svg class="inline me-3 mb-1 text-lg text-green-60 dark:text-green-40" width="2em" height="2em" viewBox="0 0 72 72" fill="none" xmlns="http://www.w3.org/2000/svg"><g clip-path="url(#clip0_40_48064)"><path d="M24 27C24 25.3431 25.3431 24 27 24H45C46.6569 24 48 25.3431 48 27C48 28.6569 46.6569 30 45 30H27C25.3431 30 24 28.6569 24 27Z" fill="currentColor"></path><path d="M24 39C24 37.3431 25.3431 36 27 36H39C40.6569 36 42 37.3431 42 39C42 40.6569 40.6569 42 39 42H27C25.3431 42 24 40.6569 24 39Z" fill="currentColor"></path><path fill-rule="evenodd" clip-rule="evenodd" d="M12 18C12 13.0294 16.0294 9 21 9H51C55.9706 9 60 13.0294 60 18V54C60 58.9706 55.9706 63 51 63H21C16.0294 63 12 58.9706 12 54V18ZM21 15H51C52.6569 15 54 16.3431 54 18V54C54 55.6569 52.6569 57 51 57H21C19.3431 57 18 55.6569 18 54V18C18 16.3431 19.3431 15 21 15Z" fill="currentColor"></path></g><defs><clipPath id="clip0_40_48064"><rect width="72" height="72" fill="white"></rect></clipPath></defs></svg>注意</h3><div class="relative"><div class="py-2"><h4 id="you-may-still-want-a-metadata-library" class="mdx-heading text-xl font-display font-bold leading-9 my-4">你可能仍然需要一个元数据库 <a href="#you-may-still-want-a-metadata-library" aria-label="Link for 你可能仍然需要一个元数据库 " title="Link for 你可能仍然需要一个元数据库 " class="mdx-header-anchor inline-block"><svg width="1em" height="1em" viewBox="0 0 13 13" xmlns="http://www.w3.org/2000/svg" class="text-gray-70 ms-2 h-5 w-5"><g fill="currentColor" fill-rule="evenodd"><path d="M7.778 7.975a2.5 2.5 0 0 0 .347-3.837L6.017 2.03a2.498 2.498 0 0 0-3.542-.007 2.5 2.5 0 0 0 .006 3.543l1.153 1.15c.07-.29.154-.563.25-.773.036-.077.084-.16.14-.25L3.18 4.85a1.496 1.496 0 0 1 .002-2.12 1.496 1.496 0 0 1 2.12 0l2.124 2.123a1.496 1.496 0 0 1-.333 2.37c.16.246.42.504.685.752z"></path><path d="M5.657 4.557a2.5 2.5 0 0 0-.347 3.837l2.108 2.108a2.498 2.498 0 0 0 3.542.007 2.5 2.5 0 0 0-.006-3.543L9.802 5.815c-.07.29-.154.565-.25.774-.036.076-.084.16-.14.25l.842.84c.585.587.59 1.532 0 2.122-.587.585-1.532.59-2.12 0L6.008 7.68a1.496 1.496 0 0 1 .332-2.372c-.16-.245-.42-.503-.685-.75z"></path></g></svg></a></h4><p class="whitespace-pre-wrap my-4">对于简单的用例，渲染文档元数据为标签可能是合适的，但库可以提供更强大的功能，如基于当前路由用特定的元数据覆盖通用元数据。这些功能使得像 <a href="https://github.com/nfl/react-helmet" target="_blank" rel="nofollow noopener noreferrer" class="inline text-link dark:text-link-dark border-b border-link border-opacity-0 hover:border-opacity-100 duration-100 ease-in transition leading-normal"><code dir="ltr" class="inline text-code text-secondary dark:text-secondary-dark px-1 rounded-md no-underline bg-gray-30 bg-opacity-10 py-px">react-helmet</code></a> 这样的框架和库更容易支持元数据标签，而不是替换它们。</p></div></div></div>
<p class="whitespace-pre-wrap my-4">有关更多信息，请参阅文档 <a class="inline text-link dark:text-link-dark border-b border-link border-opacity-0 hover:border-opacity-100 duration-100 ease-in transition leading-normal" href="/reference/react-dom/components/title"><code dir="ltr" class="inline text-code text-secondary dark:text-secondary-dark px-1 rounded-md no-underline bg-gray-30 bg-opacity-10 py-px">&lt;title&gt;</code></a>, <a class="inline text-link dark:text-link-dark border-b border-link border-opacity-0 hover:border-opacity-100 duration-100 ease-in transition leading-normal" href="/reference/react-dom/components/link"><code dir="ltr" class="inline text-code text-secondary dark:text-secondary-dark px-1 rounded-md no-underline bg-gray-30 bg-opacity-10 py-px">&lt;link&gt;</code></a>, and <a class="inline text-link dark:text-link-dark border-b border-link border-opacity-0 hover:border-opacity-100 duration-100 ease-in transition leading-normal" href="/reference/react-dom/components/meta"><code dir="ltr" class="inline text-code text-secondary dark:text-secondary-dark px-1 rounded-md no-underline bg-gray-30 bg-opacity-10 py-px">&lt;meta&gt;</code></a>.</p>
<h3 id="support-for-stylesheets" class="mdx-heading text-2xl font-display leading-9 text-primary dark:text-primary-dark font-bold my-6">支持样式表 <a href="#support-for-stylesheets" aria-label="Link for 支持样式表 " title="Link for 支持样式表 " class="mdx-header-anchor inline-block"><svg width="1em" height="1em" viewBox="0 0 13 13" xmlns="http://www.w3.org/2000/svg" class="text-gray-70 ms-2 h-5 w-5"><g fill="currentColor" fill-rule="evenodd"><path d="M7.778 7.975a2.5 2.5 0 0 0 .347-3.837L6.017 2.03a2.498 2.498 0 0 0-3.542-.007 2.5 2.5 0 0 0 .006 3.543l1.153 1.15c.07-.29.154-.563.25-.773.036-.077.084-.16.14-.25L3.18 4.85a1.496 1.496 0 0 1 .002-2.12 1.496 1.496 0 0 1 2.12 0l2.124 2.123a1.496 1.496 0 0 1-.333 2.37c.16.246.42.504.685.752z"></path><path d="M5.657 4.557a2.5 2.5 0 0 0-.347 3.837l2.108 2.108a2.498 2.498 0 0 0 3.542.007 2.5 2.5 0 0 0-.006-3.543L9.802 5.815c-.07.29-.154.565-.25.774-.036.076-.084.16-.14.25l.842.84c.585.587.59 1.532 0 2.122-.587.585-1.532.59-2.12 0L6.008 7.68a1.496 1.496 0 0 1 .332-2.372c-.16-.245-.42-.503-.685-.75z"></path></g></svg></a></h3>
<p class="whitespace-pre-wrap my-4">样式表，无论是外部链接的 (<code dir="ltr" class="inline text-code text-secondary dark:text-secondary-dark px-1 rounded-md no-underline bg-gray-30 bg-opacity-10 py-px">&lt;link rel=&quot;stylesheet&quot; href=&quot;...&quot;&gt;</code>) 还是内联的 (<code dir="ltr" class="inline text-code text-secondary dark:text-secondary-dark px-1 rounded-md no-underline bg-gray-30 bg-opacity-10 py-px">&lt;style&gt;...&lt;/style&gt;</code>)，都需要在 DOM 中进行精确的定位，因为样式优先级规则。构建一个允许在组件内部进行组合的样式表功能是困难的，所以用户通常要么将所有的样式远离可能依赖它们的组件加载，要么使用一个封装了这种复杂性的样式库。</p>
<p class="whitespace-pre-wrap my-4">在 React 19 中，我们正在解决这个复杂性，并提供更深入的集成到客户端的并发渲染和服务器的流式渲染，内置支持样式表。如果你告诉 React 你的样式表的 <code dir="ltr" class="inline text-code text-secondary dark:text-secondary-dark px-1 rounded-md no-underline bg-gray-30 bg-opacity-10 py-px">precedence</code>，它将管理样式表在 DOM 中的插入顺序，并确保在显示依赖于这些样式规则的内容之前加载样式表（如果是外部的）。</p>
<!--$--><div dir="ltr" class="sandpack sandpack--codeblock rounded-2xl h-full w-full overflow-x-auto flex items-center bg-wash dark:bg-gray-95 shadow-lg my-8" style="contain:content"><div class="sp-wrapper"><div class="sp-stack"><div class="sp-code-editor"><pre class="sp-cm sp-pristine sp-javascript flex align-start"><code class="sp-pre-placeholder grow-[2]"><div class="cm-line "><span class="sp-syntax-keyword">function</span> <span class="sp-syntax-definition">ComponentOne</span><span class="sp-syntax-punctuation">(</span><span class="sp-syntax-punctuation">)</span> <span class="sp-syntax-punctuation">{</span><br/></div><div class="cm-line ">  <span class="sp-syntax-keyword">return</span> <span class="sp-syntax-punctuation">(</span><br/></div><div class="cm-line ">    <span class="sp-syntax-punctuation">&lt;</span><span class="sp-syntax-definition">Suspense</span> <span class="sp-syntax-property">fallback</span>=<span class="sp-syntax-string">&quot;loading...&quot;</span><span class="sp-syntax-punctuation">&gt;</span><br/></div><div class="cm-line bg-github-highlight dark:bg-opacity-10">      <span class="sp-syntax-punctuation">&lt;</span><span class="sp-syntax-tag">link</span> <span class="sp-syntax-property">rel</span>=<span class="sp-syntax-string">&quot;stylesheet&quot;</span> <span class="sp-syntax-property">href</span>=<span class="sp-syntax-string">&quot;foo&quot;</span> <span class="sp-syntax-property">precedence</span>=<span class="sp-syntax-string">&quot;default&quot;</span> <span class="sp-syntax-punctuation">/&gt;</span><br/></div><div class="cm-line bg-github-highlight dark:bg-opacity-10">      <span class="sp-syntax-punctuation">&lt;</span><span class="sp-syntax-tag">link</span> <span class="sp-syntax-property">rel</span>=<span class="sp-syntax-string">&quot;stylesheet&quot;</span> <span class="sp-syntax-property">href</span>=<span class="sp-syntax-string">&quot;bar&quot;</span> <span class="sp-syntax-property">precedence</span>=<span class="sp-syntax-string">&quot;high&quot;</span> <span class="sp-syntax-punctuation">/&gt;</span><br/></div><div class="cm-line ">      <span class="sp-syntax-punctuation">&lt;</span><span class="sp-syntax-tag">article</span> <span class="sp-syntax-property">class</span>=<span class="sp-syntax-string">&quot;foo-class bar-class&quot;</span><span class="sp-syntax-punctuation">&gt;</span><br/></div><div class="cm-line ">        <span class="sp-syntax-punctuation">{</span><span class="sp-syntax-punctuation">...</span>}<br/></div><div class="cm-line ">      <span class="sp-syntax-punctuation">&lt;/</span><span class="sp-syntax-tag">article</span><span class="sp-syntax-punctuation">&gt;</span><br/></div><div class="cm-line ">    <span class="sp-syntax-punctuation">&lt;/</span><span class="sp-syntax-definition">Suspense</span><span class="sp-syntax-punctuation">&gt;</span><br/></div><div class="cm-line ">  <span class="sp-syntax-punctuation">)</span><br/></div><div class="cm-line "><span class="sp-syntax-punctuation">}</span><br/></div><div class="cm-line "><br/></div><div class="cm-line "><span class="sp-syntax-keyword">function</span> <span class="sp-syntax-definition">ComponentTwo</span><span class="sp-syntax-punctuation">(</span><span class="sp-syntax-punctuation">)</span> <span class="sp-syntax-punctuation">{</span><br/></div><div class="cm-line ">  <span class="sp-syntax-keyword">return</span> <span class="sp-syntax-punctuation">(</span><br/></div><div class="cm-line ">    <span class="sp-syntax-punctuation">&lt;</span><span class="sp-syntax-tag">div</span><span class="sp-syntax-punctuation">&gt;</span><br/></div><div class="cm-line ">      <span class="sp-syntax-punctuation">&lt;</span><span class="sp-syntax-tag">p</span><span class="sp-syntax-punctuation">&gt;</span><span class="sp-syntax-punctuation">{</span><span class="sp-syntax-punctuation">...</span>}<span class="sp-syntax-punctuation">&lt;/</span><span class="sp-syntax-tag">p</span><span class="sp-syntax-punctuation">&gt;</span><br/></div><div class="cm-line bg-github-highlight dark:bg-opacity-10">      <span class="sp-syntax-punctuation">&lt;</span><span class="sp-syntax-tag">link</span> <span class="sp-syntax-property">rel</span>=<span class="sp-syntax-string">&quot;stylesheet&quot;</span> <span class="sp-syntax-property">href</span>=<span class="sp-syntax-string">&quot;baz&quot;</span> <span class="sp-syntax-property">precedence</span>=<span class="sp-syntax-string">&quot;default&quot;</span> <span class="sp-syntax-punctuation">/&gt;</span>  <span class="sp-syntax-punctuation">&lt;</span>-- will be inserted between foo &amp; bar<br/></div><div class="cm-line ">    <span class="sp-syntax-punctuation">&lt;/</span><span class="sp-syntax-tag">div</span><span class="sp-syntax-punctuation">&gt;</span><br/></div><div class="cm-line ">  )<br/></div><div class="cm-line ">}</div></code></pre></div></div></div></div><!--/$-->
<p class="whitespace-pre-wrap my-4">在服务器端渲染时，React 会在 <code dir="ltr" class="inline text-code text-secondary dark:text-secondary-dark px-1 rounded-md no-underline bg-gray-30 bg-opacity-10 py-px">&lt;head&gt;</code> 中包含样式表，确保浏览器在加载完样式表之前不会进行绘制。如果在已经开始流式传输后才发现样式表，React 会确保在揭示依赖于该样式表的 Suspense 边界的内容之前，将样式表插入到客户端的 <code dir="ltr" class="inline text-code text-secondary dark:text-secondary-dark px-1 rounded-md no-underline bg-gray-30 bg-opacity-10 py-px">&lt;head&gt;</code> 中。</p>
<p class="whitespace-pre-wrap my-4">在客户端渲染时，React 会等待新渲染的样式表加载完成后再提交渲染。如果你在应用程序的多个地方渲染此组件，React 会只在文档中包含一次样式表：</p>
<!--$--><div dir="ltr" class="sandpack sandpack--codeblock rounded-2xl h-full w-full overflow-x-auto flex items-center bg-wash dark:bg-gray-95 shadow-lg my-8" style="contain:content"><div class="sp-wrapper"><div class="sp-stack"><div class="sp-code-editor"><pre class="sp-cm sp-pristine sp-javascript flex align-start"><code class="sp-pre-placeholder grow-[2]"><div class="cm-line "><span class="sp-syntax-keyword">function</span> <span class="sp-syntax-definition">App</span><span class="sp-syntax-punctuation">(</span><span class="sp-syntax-punctuation">)</span> <span class="sp-syntax-punctuation">{</span><br/></div><div class="cm-line ">  <span class="sp-syntax-keyword">return</span> <span class="sp-syntax-punctuation">&lt;</span><span class="sp-syntax-punctuation">&gt;</span><br/></div><div class="cm-line ">    <span class="sp-syntax-punctuation">&lt;</span><span class="sp-syntax-definition">ComponentOne</span> <span class="sp-syntax-punctuation">/&gt;</span><br/></div><div class="cm-line ">    ...<br/></div><div class="cm-line bg-github-highlight dark:bg-opacity-10">    <span class="sp-syntax-punctuation">&lt;</span><span class="sp-syntax-definition">ComponentOne</span> <span class="sp-syntax-punctuation">/&gt;</span> // won&#x27;t lead to a duplicate stylesheet link in the DOM<br/></div><div class="cm-line ">  <span class="sp-syntax-punctuation">&lt;/</span><span class="sp-syntax-punctuation">&gt;</span><br/></div><div class="cm-line "><span class="sp-syntax-punctuation">}</span></div></code></pre></div></div></div></div><!--/$-->
<p class="whitespace-pre-wrap my-4">对于习惯于手动加载样式表的用户来说，这是一个机会，可以将这些样式表放在依赖它们的组件旁边，从而更好地进行本地推理，并确保只加载你实际依赖的样式表。</p>
<p class="whitespace-pre-wrap my-4">样式库和与打包器的样式集成也可以采用这种新的功能，所以即使你不直接渲染你自己的样式表，你也可以从你的工具升级到使用这个特性中受益。</p>
<p class="whitespace-pre-wrap my-4">有关更多详细信息，请阅读 <a class="inline text-link dark:text-link-dark border-b border-link border-opacity-0 hover:border-opacity-100 duration-100 ease-in transition leading-normal" href="/reference/react-dom/components/link"><code dir="ltr" class="inline text-code text-secondary dark:text-secondary-dark px-1 rounded-md no-underline bg-gray-30 bg-opacity-10 py-px">&lt;link&gt;</code></a> 和 <a class="inline text-link dark:text-link-dark border-b border-link border-opacity-0 hover:border-opacity-100 duration-100 ease-in transition leading-normal" href="/reference/react-dom/components/style"><code dir="ltr" class="inline text-code text-secondary dark:text-secondary-dark px-1 rounded-md no-underline bg-gray-30 bg-opacity-10 py-px">&lt;style&gt;</code></a> 的文档。</p>
<h3 id="support-for-async-scripts" class="mdx-heading text-2xl font-display leading-9 text-primary dark:text-primary-dark font-bold my-6">支持异步脚本 <a href="#support-for-async-scripts" aria-label="Link for 支持异步脚本 " title="Link for 支持异步脚本 " class="mdx-header-anchor inline-block"><svg width="1em" height="1em" viewBox="0 0 13 13" xmlns="http://www.w3.org/2000/svg" class="text-gray-70 ms-2 h-5 w-5"><g fill="currentColor" fill-rule="evenodd"><path d="M7.778 7.975a2.5 2.5 0 0 0 .347-3.837L6.017 2.03a2.498 2.498 0 0 0-3.542-.007 2.5 2.5 0 0 0 .006 3.543l1.153 1.15c.07-.29.154-.563.25-.773.036-.077.084-.16.14-.25L3.18 4.85a1.496 1.496 0 0 1 .002-2.12 1.496 1.496 0 0 1 2.12 0l2.124 2.123a1.496 1.496 0 0 1-.333 2.37c.16.246.42.504.685.752z"></path><path d="M5.657 4.557a2.5 2.5 0 0 0-.347 3.837l2.108 2.108a2.498 2.498 0 0 0 3.542.007 2.5 2.5 0 0 0-.006-3.543L9.802 5.815c-.07.29-.154.565-.25.774-.036.076-.084.16-.14.25l.842.84c.585.587.59 1.532 0 2.122-.587.585-1.532.59-2.12 0L6.008 7.68a1.496 1.496 0 0 1 .332-2.372c-.16-.245-.42-.503-.685-.75z"></path></g></svg></a></h3>
<p class="whitespace-pre-wrap my-4">在 HTML 中，普通脚本 (<code dir="ltr" class="inline text-code text-secondary dark:text-secondary-dark px-1 rounded-md no-underline bg-gray-30 bg-opacity-10 py-px">&lt;script src=&quot;...&quot;&gt;</code>) 和延迟脚本 (<code dir="ltr" class="inline text-code text-secondary dark:text-secondary-dark px-1 rounded-md no-underline bg-gray-30 bg-opacity-10 py-px">&lt;script defer=&quot;&quot; src=&quot;...&quot;&gt;</code>) 按照文档顺序加载，这使得在组件树深处渲染这些类型的脚本变得具有挑战性。然而，异步脚本 (<code dir="ltr" class="inline text-code text-secondary dark:text-secondary-dark px-1 rounded-md no-underline bg-gray-30 bg-opacity-10 py-px">&lt;script async=&quot;&quot; src=&quot;...&quot;&gt;</code>) 将以任意顺序加载。</p>
<p class="whitespace-pre-wrap my-4">在 React 19 中，我们通过允许你在组件树的任何位置，即实际依赖脚本的组件内部，渲染它们，从而为异步脚本提供了更好的支持，无需管理脚本实例的重新定位和去重。</p>
<!--$--><div dir="ltr" class="sandpack sandpack--codeblock rounded-2xl h-full w-full overflow-x-auto flex items-center bg-wash dark:bg-gray-95 shadow-lg my-8" style="contain:content"><div class="sp-wrapper"><div class="sp-stack"><div class="sp-code-editor"><pre class="sp-cm sp-pristine sp-javascript flex align-start"><code class="sp-pre-placeholder grow-[2]"><div class="cm-line "><span class="sp-syntax-keyword">function</span> <span class="sp-syntax-definition">MyComponent</span><span class="sp-syntax-punctuation">(</span><span class="sp-syntax-punctuation">)</span> <span class="sp-syntax-punctuation">{</span><br/></div><div class="cm-line ">  <span class="sp-syntax-keyword">return</span> <span class="sp-syntax-punctuation">(</span><br/></div><div class="cm-line ">    <span class="sp-syntax-punctuation">&lt;</span><span class="sp-syntax-tag">div</span><span class="sp-syntax-punctuation">&gt;</span><br/></div><div class="cm-line bg-github-highlight dark:bg-opacity-10">      <span class="sp-syntax-punctuation">&lt;</span><span class="sp-syntax-tag">script</span> <span class="sp-syntax-property">async</span>=<span class="sp-syntax-punctuation">{</span><span class="sp-syntax-static">true</span><span class="sp-syntax-punctuation">}</span> <span class="sp-syntax-property">src</span>=<span class="sp-syntax-string">&quot;...&quot;</span> <span class="sp-syntax-punctuation">/&gt;</span><br/></div><div class="cm-line ">      Hello World<br/></div><div class="cm-line ">    <span class="sp-syntax-punctuation">&lt;/</span><span class="sp-syntax-tag">div</span><span class="sp-syntax-punctuation">&gt;</span><br/></div><div class="cm-line ">  <span class="sp-syntax-punctuation">)</span><br/></div><div class="cm-line "><span class="sp-syntax-punctuation">}</span><br/></div><div class="cm-line "><br/></div><div class="cm-line "><span class="sp-syntax-keyword">function</span> <span class="sp-syntax-definition">App</span><span class="sp-syntax-punctuation">(</span><span class="sp-syntax-punctuation">)</span> <span class="sp-syntax-punctuation">{</span><br/></div><div class="cm-line ">  <span class="sp-syntax-punctuation">&lt;</span><span class="sp-syntax-tag">html</span><span class="sp-syntax-punctuation">&gt;</span><br/></div><div class="cm-line ">    <span class="sp-syntax-punctuation">&lt;</span><span class="sp-syntax-tag">body</span><span class="sp-syntax-punctuation">&gt;</span><br/></div><div class="cm-line ">      <span class="sp-syntax-punctuation">&lt;</span><span class="sp-syntax-definition">MyComponent</span><span class="sp-syntax-punctuation">&gt;</span><br/></div><div class="cm-line ">      ...<br/></div><div class="cm-line bg-github-highlight dark:bg-opacity-10">      <span class="sp-syntax-punctuation">&lt;</span><span class="sp-syntax-definition">MyComponent</span><span class="sp-syntax-punctuation">&gt;</span> // won&#x27;t lead to duplicate script in the DOM<br/></div><div class="cm-line ">    <span class="sp-syntax-punctuation">&lt;/</span><span class="sp-syntax-tag">body</span><span class="sp-syntax-punctuation">&gt;</span><br/></div><div class="cm-line ">  <span class="sp-syntax-punctuation">&lt;/</span><span class="sp-syntax-tag">html</span><span class="sp-syntax-punctuation">&gt;</span><br/></div><div class="cm-line ">}</div></code></pre></div></div></div></div><!--/$-->
<p class="whitespace-pre-wrap my-4">在所有渲染环境中，异步脚本将被去重，因此即使它被多个不同的组件渲染，React 也只会加载并执行脚本一次。</p>
<p class="whitespace-pre-wrap my-4">在服务器端渲染中，异步脚本将被包含在 <code dir="ltr" class="inline text-code text-secondary dark:text-secondary-dark px-1 rounded-md no-underline bg-gray-30 bg-opacity-10 py-px">&lt;head&gt;</code> 中，并优先于阻塞绘制的更关键的资源，如样式表、字体和图片预加载。</p>
<p class="whitespace-pre-wrap my-4">有关更多详细信息，请阅读 <a class="inline text-link dark:text-link-dark border-b border-link border-opacity-0 hover:border-opacity-100 duration-100 ease-in transition leading-normal" href="/reference/react-dom/components/script"><code dir="ltr" class="inline text-code text-secondary dark:text-secondary-dark px-1 rounded-md no-underline bg-gray-30 bg-opacity-10 py-px">&lt;script&gt;</code></a> 的文档。</p>
<h3 id="support-for-preloading-resources" class="mdx-heading text-2xl font-display leading-9 text-primary dark:text-primary-dark font-bold my-6">支持预加载资源 <a href="#support-for-preloading-resources" aria-label="Link for 支持预加载资源 " title="Link for 支持预加载资源 " class="mdx-header-anchor inline-block"><svg width="1em" height="1em" viewBox="0 0 13 13" xmlns="http://www.w3.org/2000/svg" class="text-gray-70 ms-2 h-5 w-5"><g fill="currentColor" fill-rule="evenodd"><path d="M7.778 7.975a2.5 2.5 0 0 0 .347-3.837L6.017 2.03a2.498 2.498 0 0 0-3.542-.007 2.5 2.5 0 0 0 .006 3.543l1.153 1.15c.07-.29.154-.563.25-.773.036-.077.084-.16.14-.25L3.18 4.85a1.496 1.496 0 0 1 .002-2.12 1.496 1.496 0 0 1 2.12 0l2.124 2.123a1.496 1.496 0 0 1-.333 2.37c.16.246.42.504.685.752z"></path><path d="M5.657 4.557a2.5 2.5 0 0 0-.347 3.837l2.108 2.108a2.498 2.498 0 0 0 3.542.007 2.5 2.5 0 0 0-.006-3.543L9.802 5.815c-.07.29-.154.565-.25.774-.036.076-.084.16-.14.25l.842.84c.585.587.59 1.532 0 2.122-.587.585-1.532.59-2.12 0L6.008 7.68a1.496 1.496 0 0 1 .332-2.372c-.16-.245-.42-.503-.685-.75z"></path></g></svg></a></h3>
<p class="whitespace-pre-wrap my-4">在初始文档加载和客户端更新时，尽早告诉浏览器它可能需要加载的资源，可以显著提高页面性能。</p>
<p class="whitespace-pre-wrap my-4">React 19 包含了一些新的 API，用于加载和预加载浏览器资源，使得构建不受资源加载效率影响的优秀体验变得尽可能容易。</p>
<!--$--><div dir="ltr" class="sandpack sandpack--codeblock rounded-2xl h-full w-full overflow-x-auto flex items-center bg-wash dark:bg-gray-95 shadow-lg my-8" style="contain:content"><div class="sp-wrapper"><div class="sp-stack"><div class="sp-code-editor"><pre class="sp-cm sp-pristine sp-javascript flex align-start"><code class="sp-pre-placeholder grow-[2]"><div class="cm-line "><span class="sp-syntax-keyword">import</span> <span class="sp-syntax-punctuation">{</span> <span class="sp-syntax-plain">prefetchDNS</span><span class="sp-syntax-punctuation">,</span> <span class="sp-syntax-plain">preconnect</span><span class="sp-syntax-punctuation">,</span> <span class="sp-syntax-plain">preload</span><span class="sp-syntax-punctuation">,</span> <span class="sp-syntax-plain">preinit</span> <span class="sp-syntax-punctuation">}</span> <span class="sp-syntax-keyword">from</span> <span class="sp-syntax-string">&#x27;react-dom&#x27;</span><br/></div><div class="cm-line "><span class="sp-syntax-keyword">function</span> <span class="sp-syntax-definition">MyComponent</span><span class="sp-syntax-punctuation">(</span><span class="sp-syntax-punctuation">)</span> <span class="sp-syntax-punctuation">{</span><br/></div><div class="cm-line ">  <span class="sp-syntax-definition">preinit</span><span class="sp-syntax-punctuation">(</span><span class="sp-syntax-string">&#x27;https://.../path/to/some/script.js&#x27;</span><span class="sp-syntax-punctuation">,</span> <span class="sp-syntax-punctuation">{</span><span class="sp-syntax-property">as</span><span class="sp-syntax-punctuation">:</span> <span class="sp-syntax-string">&#x27;script&#x27;</span> <span class="sp-syntax-punctuation">}</span><span class="sp-syntax-punctuation">)</span> <span class="sp-syntax-comment">// loads and executes this script eagerly</span><br/></div><div class="cm-line ">  <span class="sp-syntax-definition">preload</span><span class="sp-syntax-punctuation">(</span><span class="sp-syntax-string">&#x27;https://.../path/to/font.woff&#x27;</span><span class="sp-syntax-punctuation">,</span> <span class="sp-syntax-punctuation">{</span> <span class="sp-syntax-property">as</span><span class="sp-syntax-punctuation">:</span> <span class="sp-syntax-string">&#x27;font&#x27;</span> <span class="sp-syntax-punctuation">}</span><span class="sp-syntax-punctuation">)</span> <span class="sp-syntax-comment">// preloads this font</span><br/></div><div class="cm-line ">  <span class="sp-syntax-definition">preload</span><span class="sp-syntax-punctuation">(</span><span class="sp-syntax-string">&#x27;https://.../path/to/stylesheet.css&#x27;</span><span class="sp-syntax-punctuation">,</span> <span class="sp-syntax-punctuation">{</span> <span class="sp-syntax-property">as</span><span class="sp-syntax-punctuation">:</span> <span class="sp-syntax-string">&#x27;style&#x27;</span> <span class="sp-syntax-punctuation">}</span><span class="sp-syntax-punctuation">)</span> <span class="sp-syntax-comment">// preloads this stylesheet</span><br/></div><div class="cm-line ">  <span class="sp-syntax-definition">prefetchDNS</span><span class="sp-syntax-punctuation">(</span><span class="sp-syntax-string">&#x27;https://...&#x27;</span><span class="sp-syntax-punctuation">)</span> <span class="sp-syntax-comment">// when you may not actually request anything from this host</span><br/></div><div class="cm-line ">  <span class="sp-syntax-definition">preconnect</span><span class="sp-syntax-punctuation">(</span><span class="sp-syntax-string">&#x27;https://...&#x27;</span><span class="sp-syntax-punctuation">)</span> <span class="sp-syntax-comment">// when you will request something but aren&#x27;t sure what</span><br/></div><div class="cm-line "><span class="sp-syntax-punctuation">}</span></div></code></pre></div></div></div></div><!--/$-->
<!--$--><div dir="ltr" class="sandpack sandpack--codeblock rounded-2xl h-full w-full overflow-x-auto flex items-center bg-wash dark:bg-gray-95 shadow-lg my-8" style="contain:content"><div class="sp-wrapper"><div class="sp-stack"><div class="sp-code-editor"><pre class="sp-cm sp-pristine sp-javascript flex align-start"><code class="sp-pre-placeholder grow-[2]"><div class="cm-line "><span class="sp-syntax-comment">&lt;!-- the above would result in the following DOM/HTML --&gt;</span><br/></div><div class="cm-line "><span class="sp-syntax-punctuation">&lt;</span><span class="sp-syntax-definition">html</span><span class="sp-syntax-punctuation">&gt;</span><br/></div><div class="cm-line ">  <span class="sp-syntax-punctuation">&lt;</span><span class="sp-syntax-definition">head</span><span class="sp-syntax-punctuation">&gt;</span><br/></div><div class="cm-line ">    <span class="sp-syntax-comment">&lt;!-- links/scripts are prioritized by their utility to early loading, not call order --&gt;</span><br/></div><div class="cm-line ">    <span class="sp-syntax-punctuation">&lt;</span><span class="sp-syntax-definition">link</span> <span class="sp-syntax-property">rel</span>=<span class="sp-syntax-string">&quot;prefetch-dns&quot;</span> <span class="sp-syntax-property">href</span>=<span class="sp-syntax-string">&quot;https://...&quot;</span><span class="sp-syntax-punctuation">&gt;</span><br/></div><div class="cm-line ">    <span class="sp-syntax-punctuation">&lt;</span><span class="sp-syntax-definition">link</span> <span class="sp-syntax-property">rel</span>=<span class="sp-syntax-string">&quot;preconnect&quot;</span> <span class="sp-syntax-property">href</span>=<span class="sp-syntax-string">&quot;https://...&quot;</span><span class="sp-syntax-punctuation">&gt;</span><br/></div><div class="cm-line ">    <span class="sp-syntax-punctuation">&lt;</span><span class="sp-syntax-definition">link</span> <span class="sp-syntax-property">rel</span>=<span class="sp-syntax-string">&quot;preload&quot;</span> <span class="sp-syntax-property">as</span>=<span class="sp-syntax-string">&quot;font&quot;</span> <span class="sp-syntax-property">href</span>=<span class="sp-syntax-string">&quot;https://.../path/to/font.woff&quot;</span><span class="sp-syntax-punctuation">&gt;</span><br/></div><div class="cm-line ">    <span class="sp-syntax-punctuation">&lt;</span><span class="sp-syntax-definition">link</span> <span class="sp-syntax-property">rel</span>=<span class="sp-syntax-string">&quot;preload&quot;</span> <span class="sp-syntax-property">as</span>=<span class="sp-syntax-string">&quot;style&quot;</span> <span class="sp-syntax-property">href</span>=<span class="sp-syntax-string">&quot;https://.../path/to/stylesheet.css&quot;</span><span class="sp-syntax-punctuation">&gt;</span><br/></div><div class="cm-line ">    <span class="sp-syntax-punctuation">&lt;</span><span class="sp-syntax-definition">script</span> <span class="sp-syntax-property">async</span>=<span class="sp-syntax-string">&quot;&quot;</span> <span class="sp-syntax-property">src</span>=<span class="sp-syntax-string">&quot;https://.../path/to/some/script.js&quot;</span><span class="sp-syntax-punctuation">&gt;</span><span class="sp-syntax-punctuation">&lt;/</span><span class="sp-syntax-definition">script</span><span class="sp-syntax-punctuation">&gt;</span><br/></div><div class="cm-line ">  <span class="sp-syntax-punctuation">&lt;/</span><span class="sp-syntax-definition">head</span><span class="sp-syntax-punctuation">&gt;</span><br/></div><div class="cm-line ">  <span class="sp-syntax-punctuation">&lt;</span><span class="sp-syntax-definition">body</span><span class="sp-syntax-punctuation">&gt;</span><br/></div><div class="cm-line ">    ...<br/></div><div class="cm-line ">  <span class="sp-syntax-punctuation">&lt;/</span><span class="sp-syntax-definition">body</span><span class="sp-syntax-punctuation">&gt;</span><br/></div><div class="cm-line "><span class="sp-syntax-punctuation">&lt;/</span><span class="sp-syntax-definition">html</span><span class="sp-syntax-punctuation">&gt;</span></div></code></pre></div></div></div></div><!--/$-->
<p class="whitespace-pre-wrap my-4">这些 API 可以通过将像字体这样的额外资源的发现从样式表加载中移出来，优化初始页面加载。它们还可以通过预取预期导航使用的资源列表，然后在点击或甚至悬停时积极预加载这些资源，使客户端更新更快。</p>
<p class="whitespace-pre-wrap my-4">有关更多详细信息，请参阅 <a class="inline text-link dark:text-link-dark border-b border-link border-opacity-0 hover:border-opacity-100 duration-100 ease-in transition leading-normal" href="/reference/react-dom#resource-preloading-apis">资源预加载 API</a>。</p>
<h3 id="compatibility-with-third-party-scripts-and-extensions" class="mdx-heading text-2xl font-display leading-9 text-primary dark:text-primary-dark font-bold my-6">兼容第三方脚本和扩展 <a href="#compatibility-with-third-party-scripts-and-extensions" aria-label="Link for 兼容第三方脚本和扩展 " title="Link for 兼容第三方脚本和扩展 " class="mdx-header-anchor inline-block"><svg width="1em" height="1em" viewBox="0 0 13 13" xmlns="http://www.w3.org/2000/svg" class="text-gray-70 ms-2 h-5 w-5"><g fill="currentColor" fill-rule="evenodd"><path d="M7.778 7.975a2.5 2.5 0 0 0 .347-3.837L6.017 2.03a2.498 2.498 0 0 0-3.542-.007 2.5 2.5 0 0 0 .006 3.543l1.153 1.15c.07-.29.154-.563.25-.773.036-.077.084-.16.14-.25L3.18 4.85a1.496 1.496 0 0 1 .002-2.12 1.496 1.496 0 0 1 2.12 0l2.124 2.123a1.496 1.496 0 0 1-.333 2.37c.16.246.42.504.685.752z"></path><path d="M5.657 4.557a2.5 2.5 0 0 0-.347 3.837l2.108 2.108a2.498 2.498 0 0 0 3.542.007 2.5 2.5 0 0 0-.006-3.543L9.802 5.815c-.07.29-.154.565-.25.774-.036.076-.084.16-.14.25l.842.84c.585.587.59 1.532 0 2.122-.587.585-1.532.59-2.12 0L6.008 7.68a1.496 1.496 0 0 1 .332-2.372c-.16-.245-.42-.503-.685-.75z"></path></g></svg></a></h3>
<p class="whitespace-pre-wrap my-4">我们改进了激活机制，以考虑第三方脚本和浏览器扩展。</p>
<p class="whitespace-pre-wrap my-4">在激活过程中，如果在客户端渲染的元素与从服务器获取的 HTML 中找到的元素不匹配，React 将强制进行客户端重新渲染以修复内容。以前，如果一个元素是由第三方脚本或浏览器扩展插入的，它会触发一个不匹配的错误并进行客户端渲染。</p>
<p class="whitespace-pre-wrap my-4">在 React 19 中，<code dir="ltr" class="inline text-code text-secondary dark:text-secondary-dark px-1 rounded-md no-underline bg-gray-30 bg-opacity-10 py-px">&lt;head&gt;</code> 和 <code dir="ltr" class="inline text-code text-secondary dark:text-secondary-dark px-1 rounded-md no-underline bg-gray-30 bg-opacity-10 py-px">&lt;body&gt;</code> 中的意外标签将被跳过，避免了不匹配的错误。如果 React 需要由于无关的激活不匹配而重新渲染整个文档，它将保留由第三方脚本和浏览器扩展插入的样式表。</p>
<h3 id="error-handling" class="mdx-heading text-2xl font-display leading-9 text-primary dark:text-primary-dark font-bold my-6">更好的错误报告 <a href="#error-handling" aria-label="Link for 更好的错误报告 " title="Link for 更好的错误报告 " class="mdx-header-anchor inline-block"><svg width="1em" height="1em" viewBox="0 0 13 13" xmlns="http://www.w3.org/2000/svg" class="text-gray-70 ms-2 h-5 w-5"><g fill="currentColor" fill-rule="evenodd"><path d="M7.778 7.975a2.5 2.5 0 0 0 .347-3.837L6.017 2.03a2.498 2.498 0 0 0-3.542-.007 2.5 2.5 0 0 0 .006 3.543l1.153 1.15c.07-.29.154-.563.25-.773.036-.077.084-.16.14-.25L3.18 4.85a1.496 1.496 0 0 1 .002-2.12 1.496 1.496 0 0 1 2.12 0l2.124 2.123a1.496 1.496 0 0 1-.333 2.37c.16.246.42.504.685.752z"></path><path d="M5.657 4.557a2.5 2.5 0 0 0-.347 3.837l2.108 2.108a2.498 2.498 0 0 0 3.542.007 2.5 2.5 0 0 0-.006-3.543L9.802 5.815c-.07.29-.154.565-.25.774-.036.076-.084.16-.14.25l.842.84c.585.587.59 1.532 0 2.122-.587.585-1.532.59-2.12 0L6.008 7.68a1.496 1.496 0 0 1 .332-2.372c-.16-.245-.42-.503-.685-.75z"></path></g></svg></a></h3>
<p class="whitespace-pre-wrap my-4">在 React 19 中，我们改进了错误处理，以消除重复并提供处理捕获和未捕获错误的选项。例如，当在由错误边界捕获的渲染中出现错误时，以前 React 会抛出两次错误（一次是原始错误，然后在自动恢复失败后再次抛出），然后调用 <code dir="ltr" class="inline text-code text-secondary dark:text-secondary-dark px-1 rounded-md no-underline bg-gray-30 bg-opacity-10 py-px">console.error</code> 提供错误发生的信息。</p>
<p class="whitespace-pre-wrap my-4">这导致每个捕获的错误都有三个错误：</p>
<div class="console-block mb-4 text-secondary bg-wash dark:bg-wash-dark rounded-lg" translate="no" dir="ltr"><div class="flex w-full rounded-t-lg bg-gray-200 dark:bg-gray-80"><div class="px-4 py-2 border-gray-300 dark:border-gray-90 border-r"><div class="bg-gray-300 dark:bg-gray-70" style="width:15px;height:17px"></div></div><div class="flex text-sm px-4"><div class="border-b-2 border-gray-300 dark:border-gray-90 text-tertiary dark:text-tertiary-dark">Console</div><div class="px-4 py-2 flex"><div class="me-2 bg-gray-300 dark:bg-gray-70" style="width:60px;height:17px"></div><div class="me-2 hidden md:block bg-gray-300 dark:bg-gray-70" style="width:60px;height:17px"></div><div class="hidden md:block bg-gray-300 dark:bg-gray-70" style="width:60px;height:17px"></div></div></div></div><div class="grid grid-cols-1 divide-y divide-gray-300 dark:divide-gray-70 text-base"><div class="ps-4 pe-2 pt-1 pb-2 grid grid-cols-[18px_auto] font-mono rounded-b-md bg-red-30 text-red-50 dark:text-red-30 bg-opacity-5"><svg class="self-start mt-1.5 text-[.7rem] w-6" width="1.33em" height="1.33em" viewBox="0 0 24 24" xmlns="http://www.w3.org/2000/svg"><circle cx="10.1626" cy="9.99951" r="9.47021" fill="currentColor"></circle><path d="M6.22705 5.95996L14.2798 14.0127" stroke="white"></path><path d="M14.2798 5.95996L6.22705 14.0127" stroke="white"></path></svg><div class="px-2 pt-1 whitespace-break-spaces text-code leading-tight">Uncaught Error: hit
<!-- -->  <!-- -->at Throws
<!-- -->  <!-- -->at renderWithHooks
<!-- -->  <!-- -->…</div></div><div class="ps-4 pe-2 pt-1 pb-2 grid grid-cols-[18px_auto] font-mono rounded-b-md bg-red-30 text-red-50 dark:text-red-30 bg-opacity-5"><svg class="self-start mt-1.5 text-[.7rem] w-6" width="1.33em" height="1.33em" viewBox="0 0 24 24" xmlns="http://www.w3.org/2000/svg"><circle cx="10.1626" cy="9.99951" r="9.47021" fill="currentColor"></circle><path d="M6.22705 5.95996L14.2798 14.0127" stroke="white"></path><path d="M14.2798 5.95996L6.22705 14.0127" stroke="white"></path></svg><div class="px-2 pt-1 whitespace-break-spaces text-code leading-tight">Uncaught Error: hit<span class="ms-2 text-gray-30">    &lt;--<!-- --> Duplicate</span>
<!-- -->  <!-- -->at Throws
<!-- -->  <!-- -->at renderWithHooks
<!-- -->  <!-- -->…</div></div><div class="ps-4 pe-2 pt-1 pb-2 grid grid-cols-[18px_auto] font-mono rounded-b-md bg-red-30 text-red-50 dark:text-red-30 bg-opacity-5"><svg class="self-start mt-1.5 text-[.7rem] w-6" width="1.33em" height="1.33em" viewBox="0 0 24 24" xmlns="http://www.w3.org/2000/svg"><circle cx="10.1626" cy="9.99951" r="9.47021" fill="currentColor"></circle><path d="M6.22705 5.95996L14.2798 14.0127" stroke="white"></path><path d="M14.2798 5.95996L6.22705 14.0127" stroke="white"></path></svg><div class="px-2 pt-1 whitespace-break-spaces text-code leading-tight">The above error occurred in the Throws component:
<!-- -->  <!-- -->at Throws
<!-- -->  <!-- -->at ErrorBoundary
<!-- -->  <!-- -->at App<!-- -->
<!-- -->
React will try to recreate this component tree from scratch using the error boundary you provided, ErrorBoundary.</div></div></div></div>
<p class="whitespace-pre-wrap my-4">在 React 19 中，我们记录一个包含所有错误信息的单一错误：</p>
<div class="console-block mb-4 text-secondary bg-wash dark:bg-wash-dark rounded-lg" translate="no" dir="ltr"><div class="flex w-full rounded-t-lg bg-gray-200 dark:bg-gray-80"><div class="px-4 py-2 border-gray-300 dark:border-gray-90 border-r"><div class="bg-gray-300 dark:bg-gray-70" style="width:15px;height:17px"></div></div><div class="flex text-sm px-4"><div class="border-b-2 border-gray-300 dark:border-gray-90 text-tertiary dark:text-tertiary-dark">Console</div><div class="px-4 py-2 flex"><div class="me-2 bg-gray-300 dark:bg-gray-70" style="width:60px;height:17px"></div><div class="me-2 hidden md:block bg-gray-300 dark:bg-gray-70" style="width:60px;height:17px"></div><div class="hidden md:block bg-gray-300 dark:bg-gray-70" style="width:60px;height:17px"></div></div></div></div><div class="grid grid-cols-1 divide-y divide-gray-300 dark:divide-gray-70 text-base"><div class="ps-4 pe-2 pt-1 pb-2 grid grid-cols-[18px_auto] font-mono rounded-b-md bg-red-30 text-red-50 dark:text-red-30 bg-opacity-5"><svg class="self-start mt-1.5 text-[.7rem] w-6" width="1.33em" height="1.33em" viewBox="0 0 24 24" xmlns="http://www.w3.org/2000/svg"><circle cx="10.1626" cy="9.99951" r="9.47021" fill="currentColor"></circle><path d="M6.22705 5.95996L14.2798 14.0127" stroke="white"></path><path d="M14.2798 5.95996L6.22705 14.0127" stroke="white"></path></svg><div class="px-2 pt-1 whitespace-break-spaces text-code leading-tight">Error: hit
<!-- -->  <!-- -->at Throws
<!-- -->  <!-- -->at renderWithHooks
<!-- -->  <!-- -->…<!-- -->
<!-- -->
The above error occurred in the Throws component:
<!-- -->  <!-- -->at Throws
<!-- -->  <!-- -->at ErrorBoundary
<!-- -->  <!-- -->at App<!-- -->
<!-- -->
React will try to recreate this component tree from scratch using the error boundary you provided, ErrorBoundary.
<!-- -->  <!-- -->at ErrorBoundary
<!-- -->  <!-- -->at App</div></div></div></div>
<p class="whitespace-pre-wrap my-4">此段代码介绍了 React 19 中添加的两个新的根选项，用于补充 <code dir="ltr" class="inline text-code text-secondary dark:text-secondary-dark px-1 rounded-md no-underline bg-gray-30 bg-opacity-10 py-px">onRecoverableError</code>：</p>
<ul class="ms-6 my-3 list-disc">
<li class="leading-relaxed mb-1"><code dir="ltr" class="inline text-code text-secondary dark:text-secondary-dark px-1 rounded-md no-underline bg-gray-30 bg-opacity-10 py-px">onCaughtError</code>：当 React 在错误边界中捕获错误时调用。</li>
<li class="leading-relaxed mb-1"><code dir="ltr" class="inline text-code text-secondary dark:text-secondary-dark px-1 rounded-md no-underline bg-gray-30 bg-opacity-10 py-px">onUncaughtError</code>：当抛出错误并且未被错误边界捕获时调用。</li>
<li class="leading-relaxed mb-1"><code dir="ltr" class="inline text-code text-secondary dark:text-secondary-dark px-1 rounded-md no-underline bg-gray-30 bg-opacity-10 py-px">onRecoverableError</code>：当抛出错误并自动恢复时调用。</li>
</ul>
<p class="whitespace-pre-wrap my-4">有关更多信息和示例，请参阅 <a class="inline text-link dark:text-link-dark border-b border-link border-opacity-0 hover:border-opacity-100 duration-100 ease-in transition leading-normal" href="/reference/react-dom/client/createRoot"><code dir="ltr" class="inline text-code text-secondary dark:text-secondary-dark px-1 rounded-md no-underline bg-gray-30 bg-opacity-10 py-px">createRoot</code></a> 和 <a class="inline text-link dark:text-link-dark border-b border-link border-opacity-0 hover:border-opacity-100 duration-100 ease-in transition leading-normal" href="/reference/react-dom/client/hydrateRoot"><code dir="ltr" class="inline text-code text-secondary dark:text-secondary-dark px-1 rounded-md no-underline bg-gray-30 bg-opacity-10 py-px">hydrateRoot</code></a> 的文档。</p>
<h3 id="support-for-custom-elements" class="mdx-heading text-2xl font-display leading-9 text-primary dark:text-primary-dark font-bold my-6">支持自定义元素 <a href="#support-for-custom-elements" aria-label="Link for 支持自定义元素 " title="Link for 支持自定义元素 " class="mdx-header-anchor inline-block"><svg width="1em" height="1em" viewBox="0 0 13 13" xmlns="http://www.w3.org/2000/svg" class="text-gray-70 ms-2 h-5 w-5"><g fill="currentColor" fill-rule="evenodd"><path d="M7.778 7.975a2.5 2.5 0 0 0 .347-3.837L6.017 2.03a2.498 2.498 0 0 0-3.542-.007 2.5 2.5 0 0 0 .006 3.543l1.153 1.15c.07-.29.154-.563.25-.773.036-.077.084-.16.14-.25L3.18 4.85a1.496 1.496 0 0 1 .002-2.12 1.496 1.496 0 0 1 2.12 0l2.124 2.123a1.496 1.496 0 0 1-.333 2.37c.16.246.42.504.685.752z"></path><path d="M5.657 4.557a2.5 2.5 0 0 0-.347 3.837l2.108 2.108a2.498 2.498 0 0 0 3.542.007 2.5 2.5 0 0 0-.006-3.543L9.802 5.815c-.07.29-.154.565-.25.774-.036.076-.084.16-.14.25l.842.84c.585.587.59 1.532 0 2.122-.587.585-1.532.59-2.12 0L6.008 7.68a1.496 1.496 0 0 1 .332-2.372c-.16-.245-.42-.503-.685-.75z"></path></g></svg></a></h3>
<p class="whitespace-pre-wrap my-4">React 19 添加了对自定义元素的全面支持，并通过了 <a href="https://custom-elements-everywhere.com/" target="_blank" rel="nofollow noopener noreferrer" class="inline text-link dark:text-link-dark border-b border-link border-opacity-0 hover:border-opacity-100 duration-100 ease-in transition leading-normal">Custom Elements Everywhere</a> 上的所有测试。</p>
<p class="whitespace-pre-wrap my-4">在过去的版本中，使用 React 中的自定义元素很困难，因为 React 将无法识别的 props 视为 HTML attribute 而不是 DOM property。在 React 19 中，我们添加了对 DOM property 的支持，该支持在客户端和 SSR 期间都有效，策略如下：</p>
<ul class="ms-6 my-3 list-disc">
<li class="leading-relaxed mb-1"><strong class="font-bold">服务器端渲染</strong>：传递给自定义元素的 props 将作为 HTML attribute 渲染，如果它们的类型是原始值，如 <code dir="ltr" class="inline text-code text-secondary dark:text-secondary-dark px-1 rounded-md no-underline bg-gray-30 bg-opacity-10 py-px">string</code>、<code dir="ltr" class="inline text-code text-secondary dark:text-secondary-dark px-1 rounded-md no-underline bg-gray-30 bg-opacity-10 py-px">number</code>，或者值为 <code dir="ltr" class="inline text-code text-secondary dark:text-secondary-dark px-1 rounded-md no-underline bg-gray-30 bg-opacity-10 py-px">true</code>。具有非原始类型的 props，如 <code dir="ltr" class="inline text-code text-secondary dark:text-secondary-dark px-1 rounded-md no-underline bg-gray-30 bg-opacity-10 py-px">object</code>、<code dir="ltr" class="inline text-code text-secondary dark:text-secondary-dark px-1 rounded-md no-underline bg-gray-30 bg-opacity-10 py-px">symbol</code>、<code dir="ltr" class="inline text-code text-secondary dark:text-secondary-dark px-1 rounded-md no-underline bg-gray-30 bg-opacity-10 py-px">function</code>，或者值为 <code dir="ltr" class="inline text-code text-secondary dark:text-secondary-dark px-1 rounded-md no-underline bg-gray-30 bg-opacity-10 py-px">false</code> 的 props 将被省略。</li>
<li class="leading-relaxed mb-1"><strong class="font-bold">客户端渲染</strong>：匹配自定义元素实例上的属性的 props 将被赋值为 DOM property，否则它们将被赋值为 HTML attribute。</li>
</ul>
<p class="whitespace-pre-wrap my-4">感谢 <a href="https://github.com/josepharhar" target="_blank" rel="nofollow noopener noreferrer" class="inline text-link dark:text-link-dark border-b border-link border-opacity-0 hover:border-opacity-100 duration-100 ease-in transition leading-normal">Joey Arhar</a> 在 React 中推动自定义元素支持的设计和实现。</p>
<h4 id="how-to-upgrade" class="mdx-heading text-xl font-display font-bold leading-9 my-4">如何升级 <a href="#how-to-upgrade" aria-label="Link for 如何升级 " title="Link for 如何升级 " class="mdx-header-anchor inline-block"><svg width="1em" height="1em" viewBox="0 0 13 13" xmlns="http://www.w3.org/2000/svg" class="text-gray-70 ms-2 h-5 w-5"><g fill="currentColor" fill-rule="evenodd"><path d="M7.778 7.975a2.5 2.5 0 0 0 .347-3.837L6.017 2.03a2.498 2.498 0 0 0-3.542-.007 2.5 2.5 0 0 0 .006 3.543l1.153 1.15c.07-.29.154-.563.25-.773.036-.077.084-.16.14-.25L3.18 4.85a1.496 1.496 0 0 1 .002-2.12 1.496 1.496 0 0 1 2.12 0l2.124 2.123a1.496 1.496 0 0 1-.333 2.37c.16.246.42.504.685.752z"></path><path d="M5.657 4.557a2.5 2.5 0 0 0-.347 3.837l2.108 2.108a2.498 2.498 0 0 0 3.542.007 2.5 2.5 0 0 0-.006-3.543L9.802 5.815c-.07.29-.154.565-.25.774-.036.076-.084.16-.14.25l.842.84c.585.587.59 1.532 0 2.122-.587.585-1.532.59-2.12 0L6.008 7.68a1.496 1.496 0 0 1 .332-2.372c-.16-.245-.42-.503-.685-.75z"></path></g></svg></a></h4>
<p class="whitespace-pre-wrap my-4">请查看 <a class="inline text-link dark:text-link-dark border-b border-link border-opacity-0 hover:border-opacity-100 duration-100 ease-in transition leading-normal" href="/blog/2024/04/25/react-19-upgrade-guide">React 19 升级指南</a> 以获取逐步指导和完整的破坏性和显著变化列表。</p></div></div><div class="grid grid-cols-1 gap-4 py-4 mx-auto max-w-7xl md:grid-cols-2 md:py-12"><a class="flex gap-x-4 md:gap-x-6 items-center w-full md:min-w-80 md:w-fit md:max-w-md px-4 md:px-5 py-6 border-2 border-transparent text-base leading-base text-link dark:text-link-dark rounded-lg group focus:text-link dark:focus:text-link-dark focus:bg-highlight focus:border-link dark:focus:bg-highlight-dark dark:focus:border-link-dark focus:border-opacity-100 focus:border-2 focus:ring-1 focus:ring-offset-4 focus:ring-blue-40 active:ring-0 active:ring-offset-0 hover:bg-gray-5 dark:hover:bg-gray-80" href="/blog/2024/05/22/react-conf-2024-recap"><svg xmlns="http://www.w3.org/2000/svg" width="20" height="20" viewBox="0 0 20 20" class="duration-100 ease-in transition rotate-90 rtl:-rotate-90 inline text-tertiary dark:text-tertiary-dark group-focus:text-link dark:group-focus:text-link-dark" style="min-width:20px;min-height:20px"><g fill="none" fill-rule="evenodd" transform="translate(-446 -398)"><path fill="currentColor" fill-rule="nonzero" d="M95.8838835,240.366117 C95.3957281,239.877961 94.6042719,239.877961 94.1161165,240.366117 C93.6279612,240.854272 93.6279612,241.645728 94.1161165,242.133883 L98.6161165,246.633883 C99.1042719,247.122039 99.8957281,247.122039 100.383883,246.633883 L104.883883,242.133883 C105.372039,241.645728 105.372039,240.854272 104.883883,240.366117 C104.395728,239.877961 103.604272,239.877961 103.116117,240.366117 L99.5,243.982233 L95.8838835,240.366117 Z" transform="translate(356.5 164.5)"></path><polygon points="446 418 466 418 466 398 446 398"></polygon></g></svg><div class="flex flex-col overflow-hidden"><span class="text-sm font-bold tracking-wide no-underline uppercase text-secondary dark:text-secondary-dark group-focus:text-link dark:group-focus:text-link-dark group-focus:text-opacity-100">上一页</span><span class="text-lg break-words group-hover:underline">回顾 React Conf 2024</span></div></a><a class="flex gap-x-4 md:gap-x-6 items-center w-full md:min-w-80 md:w-fit md:max-w-md px-4 md:px-5 py-6 border-2 border-transparent text-base leading-base text-link dark:text-link-dark rounded-lg group focus:text-link dark:focus:text-link-dark focus:bg-highlight focus:border-link dark:focus:bg-highlight-dark dark:focus:border-link-dark focus:border-opacity-100 focus:border-2 focus:ring-1 focus:ring-offset-4 focus:ring-blue-40 active:ring-0 active:ring-offset-0 hover:bg-gray-5 dark:hover:bg-gray-80 flex-row-reverse justify-self-end text-end" href="/blog/2024/04/25/react-19-upgrade-guide"><svg xmlns="http://www.w3.org/2000/svg" width="20" height="20" viewBox="0 0 20 20" class="duration-100 ease-in transition -rotate-90 rtl:rotate-90 inline text-tertiary dark:text-tertiary-dark group-focus:text-link dark:group-focus:text-link-dark" style="min-width:20px;min-height:20px"><g fill="none" fill-rule="evenodd" transform="translate(-446 -398)"><path fill="currentColor" fill-rule="nonzero" d="M95.8838835,240.366117 C95.3957281,239.877961 94.6042719,239.877961 94.1161165,240.366117 C93.6279612,240.854272 93.6279612,241.645728 94.1161165,242.133883 L98.6161165,246.633883 C99.1042719,247.122039 99.8957281,247.122039 100.383883,246.633883 L104.883883,242.133883 C105.372039,241.645728 105.372039,240.854272 104.883883,240.366117 C104.395728,239.877961 103.604272,239.877961 103.116117,240.366117 L99.5,243.982233 L95.8838835,240.366117 Z" transform="translate(356.5 164.5)"></path><polygon points="446 418 466 418 466 398 446 398"></polygon></g></svg><div class="flex flex-col overflow-hidden"><span class="text-sm font-bold tracking-wide no-underline uppercase text-secondary dark:text-secondary-dark group-focus:text-link dark:group-focus:text-link-dark group-focus:text-opacity-100">下一页</span><span class="text-lg break-words group-hover:underline">React 19 RC 升级指南</span></div></a></div></div></div></article><div class="self-stretch w-full"><div class="w-full px-5 pt-10 mx-auto sm:px-12 md:px-12 md:pt-12 lg:pt-10"><hr class="mx-auto max-w-7xl border-border dark:border-border-dark"/></div><div class="py-12 px-5 sm:px-12 md:px-12 sm:py-12 md:py-16 lg:py-14"></div></div></main><!--/$--><div class="hidden -mt-16 lg:max-w-custom-xs 2xl:block"></div></div></div><script id="__NEXT_DATA__" type="application/json">{"props":{"pageProps":{"toc":"[{\"url\":\"#\",\"text\":\"概览\",\"depth\":2},{\"url\":\"#whats-new-in-react-19\",\"depth\":2,\"text\":\"React 19 中的新功能 \"},{\"url\":\"#actions\",\"depth\":3,\"text\":\"Actions \"},{\"url\":\"#new-hook-useactionstate\",\"depth\":3,\"text\":[\"新的 Hook: \",[\"$r\",\"code\",null,{\"children\":\"useActionState\"}],\" \"]},{\"url\":\"#form-actions\",\"depth\":3,\"text\":[\"React DOM: \",[\"$r\",\"code\",null,{\"children\":\"\u003cform\u003e\"}],\" Actions \"]},{\"url\":\"#new-hook-useformstatus\",\"depth\":3,\"text\":[\"React DOM: 新 Hook: \",[\"$r\",\"code\",null,{\"children\":\"useFormStatus\"}],\" \"]},{\"url\":\"#new-hook-optimistic-updates\",\"depth\":3,\"text\":[\"新 Hook: \",[\"$r\",\"code\",null,{\"children\":\"useOptimistic\"}],\" \"]},{\"url\":\"#new-feature-use\",\"depth\":3,\"text\":[\"新的 API: \",[\"$r\",\"code\",null,{\"children\":\"use\"}],\" \"]},{\"url\":\"#react-server-components\",\"depth\":2,\"text\":\"React 服务器组件 \"},{\"url\":\"#server-components\",\"depth\":3,\"text\":\"服务器组件 \"},{\"url\":\"#server-actions\",\"depth\":3,\"text\":\"服务器操作 \"},{\"url\":\"#improvements-in-react-19\",\"depth\":2,\"text\":\"React 19 中的改进 \"},{\"url\":\"#ref-as-a-prop\",\"depth\":3,\"text\":[[\"$r\",\"code\",null,{\"children\":\"ref\"}],\" 作为一个属性 \"]},{\"url\":\"#diffs-for-hydration-errors\",\"depth\":3,\"text\":\"激活错误的差异 \"},{\"url\":\"#context-as-a-provider\",\"depth\":3,\"text\":[[\"$r\",\"code\",null,{\"children\":\"\u003cContext\u003e\"}],\" 作为提供者 \"]},{\"url\":\"#cleanup-functions-for-refs\",\"depth\":3,\"text\":\"refs 支持清理函数 \"},{\"url\":\"#use-deferred-value-initial-value\",\"depth\":3,\"text\":[[\"$r\",\"code\",null,{\"children\":\"useDeferredValue\"}],\" 初始化 value \"]},{\"url\":\"#support-for-metadata-tags\",\"depth\":3,\"text\":\"支持文档元数据 \"},{\"url\":\"#support-for-stylesheets\",\"depth\":3,\"text\":\"支持样式表 \"},{\"url\":\"#support-for-async-scripts\",\"depth\":3,\"text\":\"支持异步脚本 \"},{\"url\":\"#support-for-preloading-resources\",\"depth\":3,\"text\":\"支持预加载资源 \"},{\"url\":\"#compatibility-with-third-party-scripts-and-extensions\",\"depth\":3,\"text\":\"兼容第三方脚本和扩展 \"},{\"url\":\"#error-handling\",\"depth\":3,\"text\":\"更好的错误报告 \"},{\"url\":\"#support-for-custom-elements\",\"depth\":3,\"text\":\"支持自定义元素 \"}]","content":"[[\"$r\",\"MaxWidth\",\"last\",{\"children\":[[\"$r\",\"p\",null,{\"children\":[\"2024 年 4 月 25 日 \",[\"$r\",\"a\",null,{\"href\":\"/community/team\",\"children\":\"The React Team\"}]]}],\"\\n\",[\"$r\",\"hr\",null,{}],\"\\n\",[\"$r\",\"Intro\",null,{\"children\":[\"$r\",\"p\",null,{\"children\":\"React 19 RC 版本现在可以在 npm 上使用了!\"}]}],\"\\n\",[\"$r\",\"p\",null,{\"children\":[\"在我们的 \",[\"$r\",\"a\",null,{\"href\":\"/blog/2024/04/25/react-19-upgrade-guide\",\"children\":\"React 19 RC 升级指南\"}],\" 中, 我们分享了将应用程序升级到 React 19 的分步说明。在这篇文章中，我们将概述 React 19 的新特性，以及如何使用它们。\"]}],\"\\n\",[\"$r\",\"ul\",null,{\"children\":[\"\\n\",[\"$r\",\"li\",null,{\"children\":[\"$r\",\"a\",null,{\"href\":\"#whats-new-in-react-19\",\"children\":\"React 19 中的新功能\"}]}],\"\\n\",[\"$r\",\"li\",null,{\"children\":[\"$r\",\"a\",null,{\"href\":\"#improvements-in-react-19\",\"children\":\"React 19 中的改进\"}]}],\"\\n\",[\"$r\",\"li\",null,{\"children\":[\"$r\",\"a\",null,{\"href\":\"#how-to-upgrade\",\"children\":\"如何升级\"}]}],\"\\n\"]}],\"\\n\",[\"$r\",\"p\",null,{\"children\":[\"有关破坏性更改的列表，请参阅 \",[\"$r\",\"a\",null,{\"href\":\"/blog/2024/04/25/react-19-upgrade-guide\",\"children\":\"升级指南\"}],\"。\"]}],\"\\n\",[\"$r\",\"hr\",null,{}],\"\\n\",[\"$r\",\"h2\",null,{\"id\":\"whats-new-in-react-19\",\"children\":\"React 19 中的新功能 \"}],\"\\n\",[\"$r\",\"h3\",null,{\"id\":\"actions\",\"children\":\"Actions \"}],\"\\n\",[\"$r\",\"p\",null,{\"children\":\"在 React 应用中，一个常见的用例是执行数据变更，然后响应更新状态。例如，当用户提交一个表单来更改他们的名字，你会发起一个 API 请求，然后处理响应。在过去，你需要手动处理待定状态、错误、乐观更新和顺序请求。\"}],\"\\n\",[\"$r\",\"p\",null,{\"children\":[\"例如，你可以在 \",[\"$r\",\"code\",null,{\"children\":\"useState\"}],\" 中处理待定和错误状态：\"]}],\"\\n\",[\"$r\",\"pre\",null,{\"children\":[\"$r\",\"code\",null,{\"className\":\"language-js\",\"children\":\"// 没有 Actions 之前\\r\\nfunction UpdateName({}) {\\r\\n  const [name, setName] = useState(\\\"\\\");\\r\\n  const [error, setError] = useState(null);\\r\\n  const [isPending, setIsPending] = useState(false);\\r\\n\\r\\n  const handleSubmit = async () =\u003e {\\r\\n    setIsPending(true);\\r\\n    const error = await updateName(name);\\r\\n    setIsPending(false);\\r\\n    if (error) {\\r\\n      setError(error);\\r\\n      return;\\r\\n    } \\r\\n    redirect(\\\"/path\\\");\\r\\n  };\\r\\n\\r\\n  return (\\r\\n    \u003cdiv\u003e\\r\\n      \u003cinput value={name} onChange={(event) =\u003e setName(event.target.value)} /\u003e\\r\\n      \u003cbutton onClick={handleSubmit} disabled={isPending}\u003e\\r\\n        Update\\r\\n      \u003c/button\u003e\\r\\n      {error \u0026\u0026 \u003cp\u003e{error}\u003c/p\u003e}\\r\\n    \u003c/div\u003e\\r\\n  );\\r\\n}\\n\"}]}],\"\\n\",[\"$r\",\"p\",null,{\"children\":\"在 React 19 中，我们正在添加在过渡中使用异步函数的支持，以自动处理待定状态、错误、表单和乐观更新。\"}],\"\\n\",[\"$r\",\"p\",null,{\"children\":[\"例如，你可以使用 \",[\"$r\",\"code\",null,{\"children\":\"useTransition\"}],\" 来为你处理待定状态：\"]}],\"\\n\",[\"$r\",\"pre\",null,{\"children\":[\"$r\",\"code\",null,{\"className\":\"language-js\",\"children\":\"// 使用 Actions 中的待定状态\\r\\nfunction UpdateName({}) {\\r\\n  const [name, setName] = useState(\\\"\\\");\\r\\n  const [error, setError] = useState(null);\\r\\n  const [isPending, startTransition] = useTransition();\\r\\n\\r\\n  const handleSubmit = () =\u003e {\\r\\n    startTransition(async () =\u003e {\\r\\n      const error = await updateName(name);\\r\\n      if (error) {\\r\\n        setError(error);\\r\\n        return;\\r\\n      } \\r\\n      redirect(\\\"/path\\\");\\r\\n    })\\r\\n  };\\r\\n\\r\\n  return (\\r\\n    \u003cdiv\u003e\\r\\n      \u003cinput value={name} onChange={(event) =\u003e setName(event.target.value)} /\u003e\\r\\n      \u003cbutton onClick={handleSubmit} disabled={isPending}\u003e\\r\\n        Update\\r\\n      \u003c/button\u003e\\r\\n      {error \u0026\u0026 \u003cp\u003e{error}\u003c/p\u003e}\\r\\n    \u003c/div\u003e\\r\\n  );\\r\\n}\\n\"}]}],\"\\n\",[\"$r\",\"p\",null,{\"children\":[\"异步过渡会立即将 \",[\"$r\",\"code\",null,{\"children\":\"isPending\"}],\" 状态设置为 true，发出异步请求，然后在任何过渡后将 \",[\"$r\",\"code\",null,{\"children\":\"isPending\"}],\" 切换为 \",[\"$r\",\"code\",null,{\"children\":\"false\"}],\"。这使你能够在数据变化时保持当前 UI 的响应性和交互性。\"]}],\"\\n\",[\"$r\",\"Note\",null,{\"children\":[[\"$r\",\"h4\",null,{\"id\":\"by-convention-functions-that-use-async-transitions-are-called-actions\",\"children\":\"按照惯例，使用异步过渡的函数被称为 “Actions”。 \"}],[\"$r\",\"p\",null,{\"children\":\"Actions 自动为你管理数据提交：\"}],[\"$r\",\"ul\",null,{\"children\":[\"\\n\",[\"$r\",\"li\",null,{\"children\":[[\"$r\",\"strong\",null,{\"children\":\"待定状态\"}],\": Actions 提供一个待定状态，该状态在请求开始时启动，并在最终状态更新提交时自动重置。\"]}],\"\\n\",[\"$r\",\"li\",null,{\"children\":[[\"$r\",\"strong\",null,{\"children\":\"乐观更新\"}],\": Actions 支持新的 \",[\"$r\",\"a\",null,{\"href\":\"#new-hook-optimistic-updates\",\"children\":[\"$r\",\"code\",null,{\"children\":\"useOptimistic\"}]}],\"  Hook，因此你可以在请求提交时向用户显示即时反馈。\"]}],\"\\n\",[\"$r\",\"li\",null,{\"children\":[[\"$r\",\"strong\",null,{\"children\":\"错误处理\"}],\": Actions 提供错误处理，因此当请求失败时，你可以显示错误边界，并自动将乐观更新恢复到其原始值。\"]}],\"\\n\",[\"$r\",\"li\",null,{\"children\":[[\"$r\",\"strong\",null,{\"children\":\"表单\"}],\": \",[\"$r\",\"code\",null,{\"children\":\"\u003cform\u003e\"}],\" 元素现在支持将函数传递给 \",[\"$r\",\"code\",null,{\"children\":\"action\"}],\" 和 \",[\"$r\",\"code\",null,{\"children\":\"formAction\"}],\" 属性。将函数传递给 \",[\"$r\",\"code\",null,{\"children\":\"action\"}],\" 属性默认使用 Actions，并在提交后自动重置表单。\"]}],\"\\n\"]}]]}],\"\\n\",[\"$r\",\"p\",null,{\"children\":[\"在 Actions 的基础上，React 19 引入了 \",[\"$r\",\"a\",null,{\"href\":\"#new-hook-optimistic-updates\",\"children\":[\"$r\",\"code\",null,{\"children\":\"useOptimistic\"}]}],\" 来管理乐观更新，以及一个新的 Hook \",[\"$r\",\"a\",null,{\"href\":\"#new-hook-useactionstate\",\"children\":[\"$r\",\"code\",null,{\"children\":\"React.useActionState\"}]}],\" 来处理 Actions 的常见情况。在 \",[\"$r\",\"code\",null,{\"children\":\"react-dom\"}],\" 中我们添加了 \",[\"$r\",\"a\",null,{\"href\":\"#form-actions\",\"children\":[[\"$r\",\"code\",null,{\"children\":\"\u003cform\u003e\"}],\" Actions\"]}],\" 来自动管理表单和 \",[\"$r\",\"code\",null,{\"children\":\"useFormStatus\"}],\" 来支持表单中 Actions 的常见情况。\"]}],\"\\n\",[\"$r\",\"p\",null,{\"children\":\"在 React 19 中，上述示例可以简化为：\"}],\"\\n\",[\"$r\",\"pre\",null,{\"children\":[\"$r\",\"code\",null,{\"className\":\"language-js\",\"children\":\"// 使用表单的 Actions 和 useActionState\\r\\nfunction ChangeName({ name, setName }) {\\r\\n  const [error, submitAction, isPending] = useActionState(\\r\\n    async (previousState, formData) =\u003e {\\r\\n      const error = await updateName(formData.get(\\\"name\\\"));\\r\\n      if (error) {\\r\\n        return error;\\r\\n      }\\r\\n      redirect(\\\"/path\\\");\\r\\n      return null;\\r\\n    },\\r\\n    null,\\r\\n  );\\r\\n\\r\\n  return (\\r\\n    \u003cform action={submitAction}\u003e\\r\\n      \u003cinput type=\\\"text\\\" name=\\\"name\\\" /\u003e\\r\\n      \u003cbutton type=\\\"submit\\\" disabled={isPending}\u003eUpdate\u003c/button\u003e\\r\\n      {error \u0026\u0026 \u003cp\u003e{error}\u003c/p\u003e}\\r\\n    \u003c/form\u003e\\r\\n  );\\r\\n}\\n\"}]}],\"\\n\",[\"$r\",\"p\",null,{\"children\":\"在下一节中，我们将详细介绍 React 19 中的每一个新的 Action 功能。\"}],\"\\n\",[\"$r\",\"h3\",null,{\"id\":\"new-hook-useactionstate\",\"children\":[\"新的 Hook: \",[\"$r\",\"code\",null,{\"children\":\"useActionState\"}],\" \"]}],\"\\n\",[\"$r\",\"p\",null,{\"children\":[\"为了使 Actions 的常见情况更加简单，我们添加了一个名为 \",[\"$r\",\"code\",null,{\"children\":\"useActionState\"}],\" 的新 Hook：\"]}],\"\\n\",[\"$r\",\"pre\",null,{\"children\":[\"$r\",\"code\",null,{\"className\":\"language-js\",\"children\":\"const [error, submitAction, isPending] = useActionState(\\r\\n  async (previousState, newName) =\u003e {\\r\\n    const error = await updateName(newName);\\r\\n    if (error) {\\r\\n      // 您可以返回操作的任何结果。\\r\\n      // 这里，我们只返回错误。\\r\\n      return error;\\r\\n    }\\r\\n\\r\\n    // 处理成功的情况。\\r\\n    return null;\\r\\n  },\\r\\n  null,\\r\\n);\\n\"}]}],\"\\n\",[\"$r\",\"p\",null,{\"children\":[[\"$r\",\"code\",null,{\"children\":\"useActionState\"}],\" 接受一个函数（“Action”），并返回一个被包装的用于调用的 Action。这是因为 Actions 是可以组合的。当调用被包装的 Action 时，\",[\"$r\",\"code\",null,{\"children\":\"useActionState\"}],\" 将返回 Action 的最后结果作为 \",[\"$r\",\"code\",null,{\"children\":\"data\"}],\"，以及 Action 的待定状态作为 \",[\"$r\",\"code\",null,{\"children\":\"pending\"}],\"。\"]}],\"\\n\",[\"$r\",\"Note\",null,{\"children\":[[\"$r\",\"p\",null,{\"children\":[[\"$r\",\"code\",null,{\"children\":\"React.useActionState\"}],\" 在 Canary 版本中曾被称为 \",[\"$r\",\"code\",null,{\"children\":\"ReactDOM.useFormState\"}],\"，但我们已经将其重命名并弃用了 \",[\"$r\",\"code\",null,{\"children\":\"useFormState\"}],\"。\"]}],[\"$r\",\"p\",null,{\"children\":[\"有关更多信息，请参见 \",[\"$r\",\"a\",null,{\"href\":\"https://github.com/facebook/react/pull/28491\",\"target\":\"_blank\",\"rel\":\"nofollow noopener noreferrer\",\"children\":\"#28491\"}],\"。\"]}]]}],\"\\n\",[\"$r\",\"p\",null,{\"children\":[\"相关的更多信息，请参阅文档 \",[\"$r\",\"a\",null,{\"href\":\"/reference/react/useActionState\",\"children\":[\"$r\",\"code\",null,{\"children\":\"useActionState\"}]}],\"。\"]}],\"\\n\",[\"$r\",\"h3\",null,{\"id\":\"form-actions\",\"children\":[\"React DOM: \",[\"$r\",\"code\",null,{\"children\":\"\u003cform\u003e\"}],\" Actions \"]}],\"\\n\",[\"$r\",\"p\",null,{\"children\":[\"Actions 也与 React 19 的新 \",[\"$r\",\"code\",null,{\"children\":\"\u003cform\u003e\"}],\" 功能集成在 \",[\"$r\",\"code\",null,{\"children\":\"react-dom\"}],\" 中。我们已经添加了对将函数作为 \",[\"$r\",\"code\",null,{\"children\":\"\u003cform\u003e\"}],\"、\",[\"$r\",\"code\",null,{\"children\":\"\u003cinput\u003e\"}],\" 和 \",[\"$r\",\"code\",null,{\"children\":\"\u003cbutton\u003e\"}],\" 元素的 \",[\"$r\",\"code\",null,{\"children\":\"action\"}],\" 和 \",[\"$r\",\"code\",null,{\"children\":\"formAction\"}],\" 属性的支持，以便使用 Actions 自动提交表单：\"]}],\"\\n\",[\"$r\",\"pre\",null,{\"children\":[\"$r\",\"code\",null,{\"className\":\"language-js\",\"meta\":\"[[1,1,\\\"actionFunction\\\"]]\",\"children\":\"\u003cform action={actionFunction}\u003e\\n\"}]}],\"\\n\",[\"$r\",\"p\",null,{\"children\":[\"当 \",[\"$r\",\"code\",null,{\"children\":\"\u003cform\u003e\"}],\" Action 成功时，React 将自动为非受控组件重置表单。如果你需要手动重置 \",[\"$r\",\"code\",null,{\"children\":\"\u003cform\u003e\"}],\"，你可以调用新的 \",[\"$r\",\"code\",null,{\"children\":\"requestFormReset\"}],\" React DOM API。\"]}],\"\\n\",[\"$r\",\"p\",null,{\"children\":[\"有关更多信息，请参阅 \",[\"$r\",\"code\",null,{\"children\":\"react-dom\"}],\" 文档中的 \",[\"$r\",\"a\",null,{\"href\":\"/reference/react-dom/components/form\",\"children\":[\"$r\",\"code\",null,{\"children\":\"\u003cform\u003e\"}]}],\"、\",[\"$r\",\"a\",null,{\"href\":\"/reference/react-dom/components/input\",\"children\":[\"$r\",\"code\",null,{\"children\":\"\u003cinput\u003e\"}]}],\" 和 \",[\"$r\",\"code\",null,{\"children\":\"\u003cbutton\u003e\"}],\"。\"]}],\"\\n\",[\"$r\",\"h3\",null,{\"id\":\"new-hook-useformstatus\",\"children\":[\"React DOM: 新 Hook: \",[\"$r\",\"code\",null,{\"children\":\"useFormStatus\"}],\" \"]}],\"\\n\",[\"$r\",\"p\",null,{\"children\":[\"在设计系统中，常常需要编写设计一类能够访问其所在的 \",[\"$r\",\"code\",null,{\"children\":\"\u003cform\u003e\"}],\" 的信息而无需将属性传递到组件内的组件。这可以通过 Context 来实现，但为了使这类常见情况更简单，我们添加了一个新的 Hook \",[\"$r\",\"code\",null,{\"children\":\"useFormStatus\"}],\"：\"]}],\"\\n\",[\"$r\",\"pre\",null,{\"children\":[\"$r\",\"code\",null,{\"className\":\"language-js\",\"meta\":\"[[1, 4, \\\"pending\\\"], [1, 5, \\\"pending\\\"]]\",\"children\":\"import {useFormStatus} from 'react-dom';\\r\\n\\r\\nfunction DesignButton() {\\r\\n  const {pending} = useFormStatus();\\r\\n  return \u003cbutton type=\\\"submit\\\" disabled={pending} /\u003e\\r\\n}\\n\"}]}],\"\\n\",[\"$r\",\"p\",null,{\"children\":[[\"$r\",\"code\",null,{\"children\":\"useFormStatus\"}],\" 读取父 \",[\"$r\",\"code\",null,{\"children\":\"\u003cform\u003e\"}],\" 的状态，就像表单是一个 Context 提供者一样。\"]}],\"\\n\",[\"$r\",\"p\",null,{\"children\":[\"有关更多信息，请参阅 \",[\"$r\",\"code\",null,{\"children\":\"react-dom\"}],\" 文档中的 \",[\"$r\",\"a\",null,{\"href\":\"/reference/react-dom/hooks/useFormStatus\",\"children\":[\"$r\",\"code\",null,{\"children\":\"useFormStatus\"}]}],\"。\"]}],\"\\n\",[\"$r\",\"h3\",null,{\"id\":\"new-hook-optimistic-updates\",\"children\":[\"新 Hook: \",[\"$r\",\"code\",null,{\"children\":\"useOptimistic\"}],\" \"]}],\"\\n\",[\"$r\",\"p\",null,{\"children\":[\"执行数据变更时的另一个常见 UI 模式是在异步请求进行时乐观地显示最终状态。在 React 19 中，我们添加了一个名为 \",[\"$r\",\"code\",null,{\"children\":\"useOptimistic\"}],\" 的新 Hook，以便更容易实现这一点：\"]}],\"\\n\",[\"$r\",\"pre\",null,{\"children\":[\"$r\",\"code\",null,{\"className\":\"language-js\",\"meta\":\"{2,6,13,19}\",\"children\":\"function ChangeName({currentName, onUpdateName}) {\\r\\n  const [optimisticName, setOptimisticName] = useOptimistic(currentName);\\r\\n\\r\\n  const submitAction = async formData =\u003e {\\r\\n    const newName = formData.get(\\\"name\\\");\\r\\n    setOptimisticName(newName);\\r\\n    const updatedName = await updateName(newName);\\r\\n    onUpdateName(updatedName);\\r\\n  };\\r\\n\\r\\n  return (\\r\\n    \u003cform action={submitAction}\u003e\\r\\n      \u003cp\u003eYour name is: {optimisticName}\u003c/p\u003e\\r\\n      \u003cp\u003e\\r\\n        \u003clabel\u003eChange Name:\u003c/label\u003e\\r\\n        \u003cinput\\r\\n          type=\\\"text\\\"\\r\\n          name=\\\"name\\\"\\r\\n          disabled={currentName !== optimisticName}\\r\\n        /\u003e\\r\\n      \u003c/p\u003e\\r\\n    \u003c/form\u003e\\r\\n  );\\r\\n}\\n\"}]}],\"\\n\",[\"$r\",\"p\",null,{\"children\":[[\"$r\",\"code\",null,{\"children\":\"useOptimistic\"}],\" Hook 会在 \",[\"$r\",\"code\",null,{\"children\":\"updateName\"}],\" 请求进行时立即渲染 \",[\"$r\",\"code\",null,{\"children\":\"optimisticName\"}],\"。当更新完成或出错时，React 将自动切换回 \",[\"$r\",\"code\",null,{\"children\":\"currentName\"}],\" 值。\"]}],\"\\n\",[\"$r\",\"p\",null,{\"children\":[\"有关更多信息，请参阅 \",[\"$r\",\"a\",null,{\"href\":\"/reference/react/useOptimistic\",\"children\":[\"$r\",\"code\",null,{\"children\":\"useOptimistic\"}]}],\" 文档。\"]}],\"\\n\",[\"$r\",\"h3\",null,{\"id\":\"new-feature-use\",\"children\":[\"新的 API: \",[\"$r\",\"code\",null,{\"children\":\"use\"}],\" \"]}],\"\\n\",[\"$r\",\"p\",null,{\"children\":[\"在 React 19 中，我们引入了一个新的 API 来在渲染中读取资源：\",[\"$r\",\"code\",null,{\"children\":\"use\"}],\"。\"]}],\"\\n\",[\"$r\",\"p\",null,{\"children\":[\"例如，你可以使用 \",[\"$r\",\"code\",null,{\"children\":\"use\"}],\" 读取一个 promise，React 将挂起，直到 promise 解析完成：\"]}],\"\\n\",[\"$r\",\"pre\",null,{\"children\":[\"$r\",\"code\",null,{\"className\":\"language-js\",\"meta\":\"{1,5}\",\"children\":\"import {use} from 'react';\\r\\n\\r\\nfunction Comments({commentsPromise}) {\\r\\n  // `use` 将被暂停直到 promise 被解决.\\r\\n  const comments = use(commentsPromise);\\r\\n  return comments.map(comment =\u003e \u003cp key={comment.id}\u003e{comment}\u003c/p\u003e);\\r\\n}\\r\\n\\r\\nfunction Page({commentsPromise}) {\\r\\n  // 当“use”在注释中暂停时,\\r\\n  // 将显示此悬念边界。\\r\\n  return (\\r\\n    \u003cSuspense fallback={\u003cdiv\u003eLoading...\u003c/div\u003e}\u003e\\r\\n      \u003cComments commentsPromise={commentsPromise} /\u003e\\r\\n    \u003c/Suspense\u003e\\r\\n  )\\r\\n}\\n\"}]}],\"\\n\",[\"$r\",\"Note\",null,{\"children\":[[\"$r\",\"h4\",null,{\"id\":\"use-does-not-support-promises-created-in-render\",\"children\":[[\"$r\",\"code\",null,{\"children\":\"use\"}],\" 不支持在渲染中创建的 promises。 \"]}],[\"$r\",\"p\",null,{\"children\":[\"如果你尝试将在渲染中创建的 promise 传递给 \",[\"$r\",\"code\",null,{\"children\":\"use\"}],\"，React 将发出警告：\"]}],[\"$r\",\"ConsoleBlockMulti\",null,{\"children\":[\"$r\",\"ConsoleLogLine\",null,{\"level\":\"error\",\"children\":[\"$r\",\"p\",null,{\"children\":\"A component was suspended by an uncached promise. Creating promises inside a Client Component or hook is not yet supported, except via a Suspense-compatible library or framework.\"}]}]}],[\"$r\",\"p\",null,{\"children\":\"为了解决这个问题，你需要从支持 promise 缓存的 Suspense 强化库或框架中传递一个 promise。在未来，我们计划推出功能，使在渲染中缓存 promise 更加容易。\"}]]}],\"\\n\",[\"$r\",\"p\",null,{\"children\":[\"你也可以使用 \",[\"$r\",\"code\",null,{\"children\":\"use\"}],\" 读取 context，这使你能够在如提前返回之后的情况下有条件地读取 Context：\"]}],\"\\n\",[\"$r\",\"pre\",null,{\"children\":[\"$r\",\"code\",null,{\"className\":\"language-js\",\"meta\":\"{1,11}\",\"children\":\"import {use} from 'react';\\r\\nimport ThemeContext from './ThemeContext'\\r\\n\\r\\nfunction Heading({children}) {\\r\\n  if (children == null) {\\r\\n    return null;\\r\\n  }\\r\\n  \\r\\n  // 因为过早的返回\\r\\n  // 这里 useContext 无法正常工作。\\r\\n  const theme = use(ThemeContext);\\r\\n  return (\\r\\n    \u003ch1 style={{color: theme.color}}\u003e\\r\\n      {children}\\r\\n    \u003c/h1\u003e\\r\\n  );\\r\\n}\\n\"}]}],\"\\n\",[\"$r\",\"p\",null,{\"children\":[[\"$r\",\"code\",null,{\"children\":\"use\"}],\" API 只能在渲染中被调用，类似于 hooks。与 hooks 不同，\",[\"$r\",\"code\",null,{\"children\":\"use\"}],\" 可以被有条件地调用。在未来，我们计划支持在渲染中使用 \",[\"$r\",\"code\",null,{\"children\":\"use\"}],\" 消费更多资源的方式。\"]}],\"\\n\",[\"$r\",\"p\",null,{\"children\":[\"有关更多信息，请参阅 \",[\"$r\",\"a\",null,{\"href\":\"/reference/react/use\",\"children\":[\"$r\",\"code\",null,{\"children\":\"use\"}]}],\" 文档。\"]}],\"\\n\",[\"$r\",\"h2\",null,{\"id\":\"react-server-components\",\"children\":\"React 服务器组件 \"}],\"\\n\",[\"$r\",\"h3\",null,{\"id\":\"server-components\",\"children\":\"服务器组件 \"}],\"\\n\",[\"$r\",\"p\",null,{\"children\":\"服务器组件是一种新的选项，允许在打包前提前渲染组件，在与你的客户端应用程序或 SSR 服务器不同的环境中。这个独立的环境就是 React 服务器组件中的 “服务器”。服务器组件可以在你的 CI 服务器上在构建时运行一次，或者可以在每次请求时使用 web 服务器运行。\"}],\"\\n\",[\"$r\",\"p\",null,{\"children\":[\"React 19 包含了所有从 Canary 频道引入的 React 服务器组件功能。这意味着，现在可以将 React 19 作为 peer 依赖项来发布带有服务器组件的库，使用 \",[\"$r\",\"code\",null,{\"children\":\"react-server\"}],\" \",[\"$r\",\"a\",null,{\"href\":\"https://github.com/reactjs/rfcs/blob/main/text/0227-server-module-conventions.md#react-server-conditional-exports\",\"target\":\"_blank\",\"rel\":\"nofollow noopener noreferrer\",\"children\":\"导出条件\"}],\" 用于支持 \",[\"$r\",\"a\",null,{\"href\":\"/learn/start-a-new-react-project#which-features-make-up-the-react-teams-full-stack-architecture-vision\",\"children\":\"全栈 React 架构\"}],\" 的框架。\"]}],\"\\n\",[\"$r\",\"Note\",null,{\"children\":[[\"$r\",\"h4\",null,{\"id\":\"how-do-i-build-support-for-server-components\",\"children\":\"如何构建对服务器组件的支持? \"}],[\"$r\",\"p\",null,{\"children\":\"虽然 React 19 中的 React 服务器组件是稳定的，并且在主版本之间不会发生破坏，但用于实现 React 服务器组件打包器或框架的底层 API 不遵循 semver，并可能在 React 19.x 的小版本之间发生破坏。\"}],[\"$r\",\"p\",null,{\"children\":\"为了支持 React 服务器组件作为打包器或框架，我们建议固定到特定的 React 版本，或者使用 Canary 发行版。我们将继续与打包器和框架合作，以稳定用于实现 React 服务器组件的 API。\"}]]}],\"\\n\",[\"$r\",\"p\",null,{\"children\":[\"有关更多信息，请参阅文档 \",[\"$r\",\"a\",null,{\"href\":\"/reference/rsc/server-components\",\"children\":\"React Server Components\"}],\".\"]}],\"\\n\",[\"$r\",\"h3\",null,{\"id\":\"server-actions\",\"children\":\"服务器操作 \"}],\"\\n\",[\"$r\",\"p\",null,{\"children\":\"服务器 Actions 允许客户端组件调用在服务器上执行的异步函数。\"}],\"\\n\",[\"$r\",\"p\",null,{\"children\":[\"当使用 \",[\"$r\",\"code\",null,{\"children\":\"\\\"use server\\\"\"}],\" 指令定义服务器 Action 时，你的框架将自动创建一个指向服务器函数的引用，并将该引用传递给客户端组件。当在客户端调用该函数时，React 将向服务器发送一个请求来执行该函数，并返回结果。\"]}],\"\\n\",[\"$r\",\"Note\",null,{\"children\":[[\"$r\",\"h4\",null,{\"id\":\"there-is-no-directive-for-server-components\",\"children\":\"服务器组件没有指令 \"}],[\"$r\",\"p\",null,{\"children\":[\"一个常见的误解是服务器组件由 \",[\"$r\",\"code\",null,{\"children\":\"\\\"use server\\\"\"}],\" 指示，但服务器组件没有指令。\",[\"$r\",\"code\",null,{\"children\":\"\\\"use server\\\"\"}],\" 指令用于服务器 Actions。\"]}],[\"$r\",\"p\",null,{\"children\":[\"有关更多信息，请参阅 \",[\"$r\",\"a\",null,{\"href\":\"/reference/rsc/directives\",\"children\":\"指令\"}],\" 文档。\"]}]]}],\"\\n\",[\"$r\",\"p\",null,{\"children\":\"服务器 Actions 可以在服务器组件中创建并作为 props 传递给客户端组件，或者可以在客户端组件中导入和使用。\"}],\"\\n\",[\"$r\",\"p\",null,{\"children\":[\"有关更多信息，请参阅 \",[\"$r\",\"a\",null,{\"href\":\"/reference/rsc/server-actions\",\"children\":\"React 服务器 Actions\"}],\" 文档。\"]}],\"\\n\",[\"$r\",\"h2\",null,{\"id\":\"improvements-in-react-19\",\"children\":\"React 19 中的改进 \"}],\"\\n\",[\"$r\",\"h3\",null,{\"id\":\"ref-as-a-prop\",\"children\":[[\"$r\",\"code\",null,{\"children\":\"ref\"}],\" 作为一个属性 \"]}],\"\\n\",[\"$r\",\"p\",null,{\"children\":[\"从 React 19 开始，你现在可以在函数组件中将 \",[\"$r\",\"code\",null,{\"children\":\"ref\"}],\" 作为 prop 进行访问：\"]}],\"\\n\",[\"$r\",\"pre\",null,{\"children\":[\"$r\",\"code\",null,{\"className\":\"language-js\",\"meta\":\"[[1, 1, \\\"ref\\\"], [1, 2, \\\"ref\\\", 45], [1, 6, \\\"ref\\\", 14]]\",\"children\":\"function MyInput({placeholder, ref}) {\\r\\n  return \u003cinput placeholder={placeholder} ref={ref} /\u003e\\r\\n}\\r\\n\\r\\n//...\\r\\n\u003cMyInput ref={ref} /\u003e\\n\"}]}],\"\\n\",[\"$r\",\"p\",null,{\"children\":[\"新的函数组件将不再需要 \",[\"$r\",\"code\",null,{\"children\":\"forwardRef\"}],\"，我们将发布一个 codemod 来自动更新你的组件以使用新的 \",[\"$r\",\"code\",null,{\"children\":\"ref\"}],\" prop。在未来的版本中，我们将弃用并移除 \",[\"$r\",\"code\",null,{\"children\":\"forwardRef\"}],\"。\"]}],\"\\n\",[\"$r\",\"Note\",null,{\"children\":[\"$r\",\"p\",null,{\"children\":[\"在类组件中，\",[\"$r\",\"code\",null,{\"children\":\"ref\"}],\" 不作为 props 传递，因为它们引用的是组件实例。这意味着，如果你在类组件中需要访问 \",[\"$r\",\"code\",null,{\"children\":\"ref\"}],\"，你需要使用 \",[\"$r\",\"code\",null,{\"children\":\"React.forwardRef\"}],\" 或者 \",[\"$r\",\"code\",null,{\"children\":\"React.createRef\"}],\"。\"]}]}],\"\\n\",[\"$r\",\"h3\",null,{\"id\":\"diffs-for-hydration-errors\",\"children\":\"激活错误的差异 \"}],\"\\n\",[\"$r\",\"p\",null,{\"children\":[\"在 \",[\"$r\",\"code\",null,{\"children\":\"react-dom\"}],\" 中，我们也改进了水合错误的错误报告。例如，现在不再在 DEV 中记录多个没有任何不匹配信息的错误：\"]}],\"\\n\",[\"$r\",\"ConsoleBlockMulti\",null,{\"children\":[[\"$r\",\"ConsoleLogLine\",null,{\"level\":\"error\",\"children\":[\"$r\",\"p\",null,{\"children\":[\"Warning: Text content did not match. Server: “Server” Client: “Client”\\r\\n\",\"  \",\"at span\\r\\n\",\"  \",\"at App\"]}]}],[\"$r\",\"ConsoleLogLine\",null,{\"level\":\"error\",\"children\":[\"$r\",\"p\",null,{\"children\":\"Warning: An error occurred during hydration. The server HTML was replaced with client content in \u003cdiv\u003e.\"}]}],[\"$r\",\"ConsoleLogLine\",null,{\"level\":\"error\",\"children\":[\"$r\",\"p\",null,{\"children\":[\"Warning: Text content did not match. Server: “Server” Client: “Client”\\r\\n\",\"  \",\"at span\\r\\n\",\"  \",\"at App\"]}]}],[\"$r\",\"ConsoleLogLine\",null,{\"level\":\"error\",\"children\":[\"$r\",\"p\",null,{\"children\":\"Warning: An error occurred during hydration. The server HTML was replaced with client content in \u003cdiv\u003e.\"}]}],[\"$r\",\"ConsoleLogLine\",null,{\"level\":\"error\",\"children\":[\"$r\",\"p\",null,{\"children\":[\"Uncaught Error: Text content does not match server-rendered HTML.\\r\\n\",\"  \",\"at checkForUnmatchedText\\r\\n\",\"  \",\"…\"]}]}]]}],\"\\n\",[\"$r\",\"p\",null,{\"children\":\"现在我们会记录一条带有不匹配差异的单一消息：\"}],\"\\n\",[\"$r\",\"ConsoleBlockMulti\",null,{\"children\":[\"$r\",\"ConsoleLogLine\",null,{\"level\":\"error\",\"children\":[\"$r\",\"p\",null,{\"children\":[\"Uncaught Error: Hydration failed because the server rendered HTML didn’t match the client. As a result this tree will be regenerated on the client. This can happen if an SSR-ed Client Component used:\",\"\\n\",\"\\r\\n- A server/client branch \",[\"$r\",\"code\",null,{\"children\":\"if (typeof window !== 'undefined')\"}],\".\\r\\n- Variable input such as \",[\"$r\",\"code\",null,{\"children\":\"Date.now()\"}],\" or \",[\"$r\",\"code\",null,{\"children\":\"Math.random()\"}],\" which changes each time it’s called.\\r\\n- Date formatting in a user’s locale which doesn’t match the server.\\r\\n- External changing data without sending a snapshot of it along with the HTML.\\r\\n- Invalid HTML tag nesting.\",\"\\n\",\"\\r\\nIt can also happen if the client has a browser extension installed which messes with the HTML before React loaded.\",\"\\n\",\"\\r\\n\",[\"$r\",\"a\",null,{\"href\":\"https://react.dev/link/hydration-mismatch\",\"target\":\"_blank\",\"rel\":\"nofollow noopener noreferrer\",\"children\":\"https://react.dev/link/hydration-mismatch\"}],\" \",\"\\n\",\"\\r\\n\",\"  \",\"\u003cApp\u003e\\r\\n\",\"    \",\"\u003cspan\u003e\\r\\n\",\"+    \",\"Client\\r\\n\",\"-    \",\"Server\",\"\\n\",\"\\r\\n\",\"  \",\"at throwOnHydrationMismatch\\r\\n\",\"  \",\"…\"]}]}]}],\"\\n\",[\"$r\",\"h3\",null,{\"id\":\"context-as-a-provider\",\"children\":[[\"$r\",\"code\",null,{\"children\":\"\u003cContext\u003e\"}],\" 作为提供者 \"]}],\"\\n\",[\"$r\",\"p\",null,{\"children\":[\"在 React 19 中，你可以将 \",[\"$r\",\"code\",null,{\"children\":\"\u003cContext\u003e\"}],\" 渲染为提供者，就无需再使用 \",[\"$r\",\"code\",null,{\"children\":\"\u003cContext.Provider\u003e\"}],\" 了：\"]}],\"\\n\",[\"$r\",\"pre\",null,{\"children\":[\"$r\",\"code\",null,{\"className\":\"language-js\",\"meta\":\"{5,7}\",\"children\":\"const ThemeContext = createContext('');\\r\\n\\r\\nfunction App({children}) {\\r\\n  return (\\r\\n    \u003cThemeContext value=\\\"dark\\\"\u003e\\r\\n      {children}\\r\\n    \u003c/ThemeContext\u003e\\r\\n  );  \\r\\n}\\n\"}]}],\"\\n\",[\"$r\",\"p\",null,{\"children\":[\"新的 Context 提供者可以使用 \",[\"$r\",\"code\",null,{\"children\":\"\u003cContext\u003e\"}],\"，我们将发布一个 codemod 来转换现有的提供者。在未来的版本中，我们将弃用 \",[\"$r\",\"code\",null,{\"children\":\"\u003cContext.Provider\u003e\"}],\"。\"]}],\"\\n\",[\"$r\",\"h3\",null,{\"id\":\"cleanup-functions-for-refs\",\"children\":\"refs 支持清理函数 \"}],\"\\n\",[\"$r\",\"p\",null,{\"children\":[\"这将使得在 \",[\"$r\",\"code\",null,{\"children\":\"ref\"}],\" 改变时执行清理操作变得更加容易。例如，你可以在 \",[\"$r\",\"code\",null,{\"children\":\"ref\"}],\" 改变时取消订阅事件：\"]}],\"\\n\",[\"$r\",\"pre\",null,{\"children\":[\"$r\",\"code\",null,{\"className\":\"language-js\",\"meta\":\"{7-9}\",\"children\":\"\u003cinput\\r\\n  ref={(ref) =\u003e {\\r\\n    // ref 创建\\r\\n\\r\\n    // 新特性: 当元素从 DOM 中被移除时\\r\\n    // 返回一个清理函数来重置 ref\\r\\n    return () =\u003e {\\r\\n      // ref cleanup\\r\\n    };\\r\\n  }}\\r\\n/\u003e\\n\"}]}],\"\\n\",[\"$r\",\"p\",null,{\"children\":[\"当组件卸载时，React 将调用从 \",[\"$r\",\"code\",null,{\"children\":\"ref\"}],\" 回调返回的清理函数。这适用于 DOM refs，类组件的 refs，以及 \",[\"$r\",\"code\",null,{\"children\":\"useImperativeHandle\"}],\"。\"]}],\"\\n\",[\"$r\",\"Note\",null,{\"children\":[[\"$r\",\"p\",null,{\"children\":[\"以前，当卸载组件时，React 会用 \",[\"$r\",\"code\",null,{\"children\":\"null\"}],\" 调用 \",[\"$r\",\"code\",null,{\"children\":\"ref\"}],\" 函数。如果你的 \",[\"$r\",\"code\",null,{\"children\":\"ref\"}],\" 返回一个清理函数，React 现在将跳过这一步。\"]}],[\"$r\",\"p\",null,{\"children\":[\"在未来的版本中，我们将弃用在卸载组件时用 \",[\"$r\",\"code\",null,{\"children\":\"null\"}],\" 调用 refs。\"]}]]}],\"\\n\",[\"$r\",\"p\",null,{\"children\":[\"由于引入了 \",[\"$r\",\"code\",null,{\"children\":\"ref\"}],\" 清理函数，现在 TypeScript 将拒绝从 \",[\"$r\",\"code\",null,{\"children\":\"ref\"}],\" 回调中返回任何其他内容。通常的解决方法是停止使用隐式返回，例如：\"]}],\"\\n\",[\"$r\",\"pre\",null,{\"children\":[\"$r\",\"code\",null,{\"className\":\"language-diff\",\"meta\":\"[[1, 1, \\\"(\\\"], [1, 1, \\\")\\\"], [2, 2, \\\"{\\\", 15], [2, 2, \\\"}\\\", 1]]\",\"children\":\"- \u003cdiv ref={current =\u003e (instance = current)} /\u003e\\r\\n+ \u003cdiv ref={current =\u003e {instance = current}} /\u003e\\n\"}]}],\"\\n\",[\"$r\",\"p\",null,{\"children\":[\"原始代码返回了 \",[\"$r\",\"code\",null,{\"children\":\"HTMLDivElement\"}],\" 的实例，TypeScript 不知道这是否应该是一个清理函数，或者你是否不想返回一个清理函数。\"]}],\"\\n\",[\"$r\",\"p\",null,{\"children\":[\"你可以使用 \",[\"$r\",\"a\",null,{\"href\":\"https://github.com/eps1lon/types-react-codemod/#no-implicit-ref-callback-return\",\"target\":\"_blank\",\"rel\":\"nofollow noopener noreferrer\",\"children\":[\"$r\",\"code\",null,{\"children\":\"no-implicit-ref-callback-return\"}]}],\" 这个 codemod 来转换这种模式。\"]}],\"\\n\",[\"$r\",\"h3\",null,{\"id\":\"use-deferred-value-initial-value\",\"children\":[[\"$r\",\"code\",null,{\"children\":\"useDeferredValue\"}],\" 初始化 value \"]}],\"\\n\",[\"$r\",\"p\",null,{\"children\":[\"我们为 \",[\"$r\",\"code\",null,{\"children\":\"useDeferredValue\"}],\" 添加了一个 \",[\"$r\",\"code\",null,{\"children\":\"initialValue\"}],\" 选项：\"]}],\"\\n\",[\"$r\",\"pre\",null,{\"children\":[\"$r\",\"code\",null,{\"className\":\"language-js\",\"meta\":\"[[1, 1, \\\"deferredValue\\\"], [1, 4, \\\"deferredValue\\\"], [2, 4, \\\"''\\\"]]\",\"children\":\"function Search({deferredValue}) {\\r\\n  // On initial render the value is ''.\\r\\n  // Then a re-render is scheduled with the deferredValue.\\r\\n  const value = useDeferredValue(deferredValue, '');\\r\\n  \\r\\n  return (\\r\\n    \u003cResults query={value} /\u003e\\r\\n  );\\r\\n}\\n\"}]}],\"\\n\",[\"$r\",\"p\",null,{\"children\":[\"当提供了 \",[\"$r\",\"CodeStep\",null,{\"step\":2,\"children\":\"initialValue\"}],\", \",[\"$r\",\"code\",null,{\"children\":\"useDeferredValue\"}],\" 将在组件的初始渲染中返回它作为 \",[\"$r\",\"code\",null,{\"children\":\"value\"}],\" , 并在后台安排一个使用返回的  \",[\"$r\",\"CodeStep\",null,{\"step\":1,\"children\":\"deferredValue\"}],\" 重新渲染。\"]}],\"\\n\",[\"$r\",\"p\",null,{\"children\":[\"有关更多信息，请参阅 \",[\"$r\",\"a\",null,{\"href\":\"/reference/react/useDeferredValue\",\"children\":[\"$r\",\"code\",null,{\"children\":\"useDeferredValue\"}]}],\"。\"]}],\"\\n\",[\"$r\",\"h3\",null,{\"id\":\"support-for-metadata-tags\",\"children\":\"支持文档元数据 \"}],\"\\n\",[\"$r\",\"p\",null,{\"children\":[\"在 HTML 中，像 \",[\"$r\",\"code\",null,{\"children\":\"\u003ctitle\u003e\"}],\"、\",[\"$r\",\"code\",null,{\"children\":\"\u003clink\u003e\"}],\" 和 \",[\"$r\",\"code\",null,{\"children\":\"\u003cmeta\u003e\"}],\" 这样的文档元数据标签被保留在文档的 \",[\"$r\",\"code\",null,{\"children\":\"\u003chead\u003e\"}],\" 部分。在 React 中，决定应用程序适合的元数据的组件可能与你渲染 \",[\"$r\",\"code\",null,{\"children\":\"\u003chead\u003e\"}],\" 的地方相距甚远，或者 React 根本不渲染 \",[\"$r\",\"code\",null,{\"children\":\"\u003chead\u003e\"}],\"。在过去，这些元素需要在效果中手动插入，或者通过像 \",[\"$r\",\"a\",null,{\"href\":\"https://github.com/nfl/react-helmet\",\"target\":\"_blank\",\"rel\":\"nofollow noopener noreferrer\",\"children\":[\"$r\",\"code\",null,{\"children\":\"react-helmet\"}]}],\" 这样的库，并在服务器渲染 React 应用程序时需要小心处理。\"]}],\"\\n\",[\"$r\",\"p\",null,{\"children\":\"在 React 19 中，我们将原生支持在组件中渲染文档元数据标签：\"}],\"\\n\",[\"$r\",\"pre\",null,{\"children\":[\"$r\",\"code\",null,{\"className\":\"language-js\",\"meta\":\"{5-8}\",\"children\":\"function BlogPost({post}) {\\r\\n  return (\\r\\n    \u003carticle\u003e\\r\\n      \u003ch1\u003e{post.title}\u003c/h1\u003e\\r\\n      \u003ctitle\u003e{post.title}\u003c/title\u003e\\r\\n      \u003cmeta name=\\\"author\\\" content=\\\"Josh\\\" /\u003e\\r\\n      \u003clink rel=\\\"author\\\" href=\\\"https://twitter.com/joshcstory/\\\" /\u003e\\r\\n      \u003cmeta name=\\\"keywords\\\" content={post.keywords} /\u003e\\r\\n      \u003cp\u003e\\r\\n        Eee equals em-see-squared...\\r\\n      \u003c/p\u003e\\r\\n    \u003c/article\u003e\\r\\n  );\\r\\n}\\n\"}]}],\"\\n\",[\"$r\",\"p\",null,{\"children\":[\"当 React 渲染这个组件时，它会看到 \",[\"$r\",\"code\",null,{\"children\":\"\u003ctitle\u003e\"}],\"、\",[\"$r\",\"code\",null,{\"children\":\"\u003clink\u003e\"}],\" 和 \",[\"$r\",\"code\",null,{\"children\":\"\u003cmeta\u003e\"}],\" 标签，并自动将它们提升到文档的 \",[\"$r\",\"code\",null,{\"children\":\"\u003chead\u003e\"}],\" 部分。通过原生支持这些元数据标签，我们能够确保它们与仅客户端应用、流式 SSR 和服务器组件一起工作。\"]}],\"\\n\",[\"$r\",\"Note\",null,{\"children\":[[\"$r\",\"h4\",null,{\"id\":\"you-may-still-want-a-metadata-library\",\"children\":\"你可能仍然需要一个元数据库 \"}],[\"$r\",\"p\",null,{\"children\":[\"对于简单的用例，渲染文档元数据为标签可能是合适的，但库可以提供更强大的功能，如基于当前路由用特定的元数据覆盖通用元数据。这些功能使得像 \",[\"$r\",\"a\",null,{\"href\":\"https://github.com/nfl/react-helmet\",\"target\":\"_blank\",\"rel\":\"nofollow noopener noreferrer\",\"children\":[\"$r\",\"code\",null,{\"children\":\"react-helmet\"}]}],\" 这样的框架和库更容易支持元数据标签，而不是替换它们。\"]}]]}],\"\\n\",[\"$r\",\"p\",null,{\"children\":[\"有关更多信息，请参阅文档 \",[\"$r\",\"a\",null,{\"href\":\"/reference/react-dom/components/title\",\"children\":[\"$r\",\"code\",null,{\"children\":\"\u003ctitle\u003e\"}]}],\", \",[\"$r\",\"a\",null,{\"href\":\"/reference/react-dom/components/link\",\"children\":[\"$r\",\"code\",null,{\"children\":\"\u003clink\u003e\"}]}],\", and \",[\"$r\",\"a\",null,{\"href\":\"/reference/react-dom/components/meta\",\"children\":[\"$r\",\"code\",null,{\"children\":\"\u003cmeta\u003e\"}]}],\".\"]}],\"\\n\",[\"$r\",\"h3\",null,{\"id\":\"support-for-stylesheets\",\"children\":\"支持样式表 \"}],\"\\n\",[\"$r\",\"p\",null,{\"children\":[\"样式表，无论是外部链接的 (\",[\"$r\",\"code\",null,{\"children\":\"\u003clink rel=\\\"stylesheet\\\" href=\\\"...\\\"\u003e\"}],\") 还是内联的 (\",[\"$r\",\"code\",null,{\"children\":\"\u003cstyle\u003e...\u003c/style\u003e\"}],\")，都需要在 DOM 中进行精确的定位，因为样式优先级规则。构建一个允许在组件内部进行组合的样式表功能是困难的，所以用户通常要么将所有的样式远离可能依赖它们的组件加载，要么使用一个封装了这种复杂性的样式库。\"]}],\"\\n\",[\"$r\",\"p\",null,{\"children\":[\"在 React 19 中，我们正在解决这个复杂性，并提供更深入的集成到客户端的并发渲染和服务器的流式渲染，内置支持样式表。如果你告诉 React 你的样式表的 \",[\"$r\",\"code\",null,{\"children\":\"precedence\"}],\"，它将管理样式表在 DOM 中的插入顺序，并确保在显示依赖于这些样式规则的内容之前加载样式表（如果是外部的）。\"]}],\"\\n\",[\"$r\",\"pre\",null,{\"children\":[\"$r\",\"code\",null,{\"className\":\"language-js\",\"meta\":\"{4,5,17}\",\"children\":\"function ComponentOne() {\\r\\n  return (\\r\\n    \u003cSuspense fallback=\\\"loading...\\\"\u003e\\r\\n      \u003clink rel=\\\"stylesheet\\\" href=\\\"foo\\\" precedence=\\\"default\\\" /\u003e\\r\\n      \u003clink rel=\\\"stylesheet\\\" href=\\\"bar\\\" precedence=\\\"high\\\" /\u003e\\r\\n      \u003carticle class=\\\"foo-class bar-class\\\"\u003e\\r\\n        {...}\\r\\n      \u003c/article\u003e\\r\\n    \u003c/Suspense\u003e\\r\\n  )\\r\\n}\\r\\n\\r\\nfunction ComponentTwo() {\\r\\n  return (\\r\\n    \u003cdiv\u003e\\r\\n      \u003cp\u003e{...}\u003c/p\u003e\\r\\n      \u003clink rel=\\\"stylesheet\\\" href=\\\"baz\\\" precedence=\\\"default\\\" /\u003e  \u003c-- will be inserted between foo \u0026 bar\\r\\n    \u003c/div\u003e\\r\\n  )\\r\\n}\\n\"}]}],\"\\n\",[\"$r\",\"p\",null,{\"children\":[\"在服务器端渲染时，React 会在 \",[\"$r\",\"code\",null,{\"children\":\"\u003chead\u003e\"}],\" 中包含样式表，确保浏览器在加载完样式表之前不会进行绘制。如果在已经开始流式传输后才发现样式表，React 会确保在揭示依赖于该样式表的 Suspense 边界的内容之前，将样式表插入到客户端的 \",[\"$r\",\"code\",null,{\"children\":\"\u003chead\u003e\"}],\" 中。\"]}],\"\\n\",[\"$r\",\"p\",null,{\"children\":\"在客户端渲染时，React 会等待新渲染的样式表加载完成后再提交渲染。如果你在应用程序的多个地方渲染此组件，React 会只在文档中包含一次样式表：\"}],\"\\n\",[\"$r\",\"pre\",null,{\"children\":[\"$r\",\"code\",null,{\"className\":\"language-js\",\"meta\":\"{5}\",\"children\":\"function App() {\\r\\n  return \u003c\u003e\\r\\n    \u003cComponentOne /\u003e\\r\\n    ...\\r\\n    \u003cComponentOne /\u003e // won't lead to a duplicate stylesheet link in the DOM\\r\\n  \u003c/\u003e\\r\\n}\\n\"}]}],\"\\n\",[\"$r\",\"p\",null,{\"children\":\"对于习惯于手动加载样式表的用户来说，这是一个机会，可以将这些样式表放在依赖它们的组件旁边，从而更好地进行本地推理，并确保只加载你实际依赖的样式表。\"}],\"\\n\",[\"$r\",\"p\",null,{\"children\":\"样式库和与打包器的样式集成也可以采用这种新的功能，所以即使你不直接渲染你自己的样式表，你也可以从你的工具升级到使用这个特性中受益。\"}],\"\\n\",[\"$r\",\"p\",null,{\"children\":[\"有关更多详细信息，请阅读 \",[\"$r\",\"a\",null,{\"href\":\"/reference/react-dom/components/link\",\"children\":[\"$r\",\"code\",null,{\"children\":\"\u003clink\u003e\"}]}],\" 和 \",[\"$r\",\"a\",null,{\"href\":\"/reference/react-dom/components/style\",\"children\":[\"$r\",\"code\",null,{\"children\":\"\u003cstyle\u003e\"}]}],\" 的文档。\"]}],\"\\n\",[\"$r\",\"h3\",null,{\"id\":\"support-for-async-scripts\",\"children\":\"支持异步脚本 \"}],\"\\n\",[\"$r\",\"p\",null,{\"children\":[\"在 HTML 中，普通脚本 (\",[\"$r\",\"code\",null,{\"children\":\"\u003cscript src=\\\"...\\\"\u003e\"}],\") 和延迟脚本 (\",[\"$r\",\"code\",null,{\"children\":\"\u003cscript defer=\\\"\\\" src=\\\"...\\\"\u003e\"}],\") 按照文档顺序加载，这使得在组件树深处渲染这些类型的脚本变得具有挑战性。然而，异步脚本 (\",[\"$r\",\"code\",null,{\"children\":\"\u003cscript async=\\\"\\\" src=\\\"...\\\"\u003e\"}],\") 将以任意顺序加载。\"]}],\"\\n\",[\"$r\",\"p\",null,{\"children\":\"在 React 19 中，我们通过允许你在组件树的任何位置，即实际依赖脚本的组件内部，渲染它们，从而为异步脚本提供了更好的支持，无需管理脚本实例的重新定位和去重。\"}],\"\\n\",[\"$r\",\"pre\",null,{\"children\":[\"$r\",\"code\",null,{\"className\":\"language-js\",\"meta\":\"{4,15}\",\"children\":\"function MyComponent() {\\r\\n  return (\\r\\n    \u003cdiv\u003e\\r\\n      \u003cscript async={true} src=\\\"...\\\" /\u003e\\r\\n      Hello World\\r\\n    \u003c/div\u003e\\r\\n  )\\r\\n}\\r\\n\\r\\nfunction App() {\\r\\n  \u003chtml\u003e\\r\\n    \u003cbody\u003e\\r\\n      \u003cMyComponent\u003e\\r\\n      ...\\r\\n      \u003cMyComponent\u003e // won't lead to duplicate script in the DOM\\r\\n    \u003c/body\u003e\\r\\n  \u003c/html\u003e\\r\\n}\\n\"}]}],\"\\n\",[\"$r\",\"p\",null,{\"children\":\"在所有渲染环境中，异步脚本将被去重，因此即使它被多个不同的组件渲染，React 也只会加载并执行脚本一次。\"}],\"\\n\",[\"$r\",\"p\",null,{\"children\":[\"在服务器端渲染中，异步脚本将被包含在 \",[\"$r\",\"code\",null,{\"children\":\"\u003chead\u003e\"}],\" 中，并优先于阻塞绘制的更关键的资源，如样式表、字体和图片预加载。\"]}],\"\\n\",[\"$r\",\"p\",null,{\"children\":[\"有关更多详细信息，请阅读 \",[\"$r\",\"a\",null,{\"href\":\"/reference/react-dom/components/script\",\"children\":[\"$r\",\"code\",null,{\"children\":\"\u003cscript\u003e\"}]}],\" 的文档。\"]}],\"\\n\",[\"$r\",\"h3\",null,{\"id\":\"support-for-preloading-resources\",\"children\":\"支持预加载资源 \"}],\"\\n\",[\"$r\",\"p\",null,{\"children\":\"在初始文档加载和客户端更新时，尽早告诉浏览器它可能需要加载的资源，可以显著提高页面性能。\"}],\"\\n\",[\"$r\",\"p\",null,{\"children\":\"React 19 包含了一些新的 API，用于加载和预加载浏览器资源，使得构建不受资源加载效率影响的优秀体验变得尽可能容易。\"}],\"\\n\",[\"$r\",\"pre\",null,{\"children\":[\"$r\",\"code\",null,{\"className\":\"language-js\",\"children\":\"import { prefetchDNS, preconnect, preload, preinit } from 'react-dom'\\r\\nfunction MyComponent() {\\r\\n  preinit('https://.../path/to/some/script.js', {as: 'script' }) // loads and executes this script eagerly\\r\\n  preload('https://.../path/to/font.woff', { as: 'font' }) // preloads this font\\r\\n  preload('https://.../path/to/stylesheet.css', { as: 'style' }) // preloads this stylesheet\\r\\n  prefetchDNS('https://...') // when you may not actually request anything from this host\\r\\n  preconnect('https://...') // when you will request something but aren't sure what\\r\\n}\\n\"}]}],\"\\n\",[\"$r\",\"pre\",null,{\"children\":[\"$r\",\"code\",null,{\"className\":\"language-html\",\"children\":\"\u003c!-- the above would result in the following DOM/HTML --\u003e\\r\\n\u003chtml\u003e\\r\\n  \u003chead\u003e\\r\\n    \u003c!-- links/scripts are prioritized by their utility to early loading, not call order --\u003e\\r\\n    \u003clink rel=\\\"prefetch-dns\\\" href=\\\"https://...\\\"\u003e\\r\\n    \u003clink rel=\\\"preconnect\\\" href=\\\"https://...\\\"\u003e\\r\\n    \u003clink rel=\\\"preload\\\" as=\\\"font\\\" href=\\\"https://.../path/to/font.woff\\\"\u003e\\r\\n    \u003clink rel=\\\"preload\\\" as=\\\"style\\\" href=\\\"https://.../path/to/stylesheet.css\\\"\u003e\\r\\n    \u003cscript async=\\\"\\\" src=\\\"https://.../path/to/some/script.js\\\"\u003e\u003c/script\u003e\\r\\n  \u003c/head\u003e\\r\\n  \u003cbody\u003e\\r\\n    ...\\r\\n  \u003c/body\u003e\\r\\n\u003c/html\u003e\\n\"}]}],\"\\n\",[\"$r\",\"p\",null,{\"children\":\"这些 API 可以通过将像字体这样的额外资源的发现从样式表加载中移出来，优化初始页面加载。它们还可以通过预取预期导航使用的资源列表，然后在点击或甚至悬停时积极预加载这些资源，使客户端更新更快。\"}],\"\\n\",[\"$r\",\"p\",null,{\"children\":[\"有关更多详细信息，请参阅 \",[\"$r\",\"a\",null,{\"href\":\"/reference/react-dom#resource-preloading-apis\",\"children\":\"资源预加载 API\"}],\"。\"]}],\"\\n\",[\"$r\",\"h3\",null,{\"id\":\"compatibility-with-third-party-scripts-and-extensions\",\"children\":\"兼容第三方脚本和扩展 \"}],\"\\n\",[\"$r\",\"p\",null,{\"children\":\"我们改进了激活机制，以考虑第三方脚本和浏览器扩展。\"}],\"\\n\",[\"$r\",\"p\",null,{\"children\":\"在激活过程中，如果在客户端渲染的元素与从服务器获取的 HTML 中找到的元素不匹配，React 将强制进行客户端重新渲染以修复内容。以前，如果一个元素是由第三方脚本或浏览器扩展插入的，它会触发一个不匹配的错误并进行客户端渲染。\"}],\"\\n\",[\"$r\",\"p\",null,{\"children\":[\"在 React 19 中，\",[\"$r\",\"code\",null,{\"children\":\"\u003chead\u003e\"}],\" 和 \",[\"$r\",\"code\",null,{\"children\":\"\u003cbody\u003e\"}],\" 中的意外标签将被跳过，避免了不匹配的错误。如果 React 需要由于无关的激活不匹配而重新渲染整个文档，它将保留由第三方脚本和浏览器扩展插入的样式表。\"]}],\"\\n\",[\"$r\",\"h3\",null,{\"id\":\"error-handling\",\"children\":\"更好的错误报告 \"}],\"\\n\",[\"$r\",\"p\",null,{\"children\":[\"在 React 19 中，我们改进了错误处理，以消除重复并提供处理捕获和未捕获错误的选项。例如，当在由错误边界捕获的渲染中出现错误时，以前 React 会抛出两次错误（一次是原始错误，然后在自动恢复失败后再次抛出），然后调用 \",[\"$r\",\"code\",null,{\"children\":\"console.error\"}],\" 提供错误发生的信息。\"]}],\"\\n\",[\"$r\",\"p\",null,{\"children\":\"这导致每个捕获的错误都有三个错误：\"}],\"\\n\",[\"$r\",\"ConsoleBlockMulti\",null,{\"children\":[[\"$r\",\"ConsoleLogLine\",null,{\"level\":\"error\",\"children\":[\"$r\",\"p\",null,{\"children\":[\"Uncaught Error: hit\\r\\n\",\"  \",\"at Throws\\r\\n\",\"  \",\"at renderWithHooks\\r\\n\",\"  \",\"…\"]}]}],[\"$r\",\"ConsoleLogLine\",null,{\"level\":\"error\",\"children\":[\"$r\",\"p\",null,{\"children\":[\"Uncaught Error: hit\",[\"$r\",\"span\",null,{\"className\":\"ms-2 text-gray-30\",\"children\":[\"    \u003c--\",\" Duplicate\"]}],\"\\r\\n\",\"  \",\"at Throws\\r\\n\",\"  \",\"at renderWithHooks\\r\\n\",\"  \",\"…\"]}]}],[\"$r\",\"ConsoleLogLine\",null,{\"level\":\"error\",\"children\":[\"$r\",\"p\",null,{\"children\":[\"The above error occurred in the Throws component:\\r\\n\",\"  \",\"at Throws\\r\\n\",\"  \",\"at ErrorBoundary\\r\\n\",\"  \",\"at App\",\"\\n\",\"\\r\\nReact will try to recreate this component tree from scratch using the error boundary you provided, ErrorBoundary.\"]}]}]]}],\"\\n\",[\"$r\",\"p\",null,{\"children\":\"在 React 19 中，我们记录一个包含所有错误信息的单一错误：\"}],\"\\n\",[\"$r\",\"ConsoleBlockMulti\",null,{\"children\":[\"$r\",\"ConsoleLogLine\",null,{\"level\":\"error\",\"children\":[\"$r\",\"p\",null,{\"children\":[\"Error: hit\\r\\n\",\"  \",\"at Throws\\r\\n\",\"  \",\"at renderWithHooks\\r\\n\",\"  \",\"…\",\"\\n\",\"\\r\\nThe above error occurred in the Throws component:\\r\\n\",\"  \",\"at Throws\\r\\n\",\"  \",\"at ErrorBoundary\\r\\n\",\"  \",\"at App\",\"\\n\",\"\\r\\nReact will try to recreate this component tree from scratch using the error boundary you provided, ErrorBoundary.\\r\\n\",\"  \",\"at ErrorBoundary\\r\\n\",\"  \",\"at App\"]}]}]}],\"\\n\",[\"$r\",\"p\",null,{\"children\":[\"此段代码介绍了 React 19 中添加的两个新的根选项，用于补充 \",[\"$r\",\"code\",null,{\"children\":\"onRecoverableError\"}],\"：\"]}],\"\\n\",[\"$r\",\"ul\",null,{\"children\":[\"\\n\",[\"$r\",\"li\",null,{\"children\":[[\"$r\",\"code\",null,{\"children\":\"onCaughtError\"}],\"：当 React 在错误边界中捕获错误时调用。\"]}],\"\\n\",[\"$r\",\"li\",null,{\"children\":[[\"$r\",\"code\",null,{\"children\":\"onUncaughtError\"}],\"：当抛出错误并且未被错误边界捕获时调用。\"]}],\"\\n\",[\"$r\",\"li\",null,{\"children\":[[\"$r\",\"code\",null,{\"children\":\"onRecoverableError\"}],\"：当抛出错误并自动恢复时调用。\"]}],\"\\n\"]}],\"\\n\",[\"$r\",\"p\",null,{\"children\":[\"有关更多信息和示例，请参阅 \",[\"$r\",\"a\",null,{\"href\":\"/reference/react-dom/client/createRoot\",\"children\":[\"$r\",\"code\",null,{\"children\":\"createRoot\"}]}],\" 和 \",[\"$r\",\"a\",null,{\"href\":\"/reference/react-dom/client/hydrateRoot\",\"children\":[\"$r\",\"code\",null,{\"children\":\"hydrateRoot\"}]}],\" 的文档。\"]}],\"\\n\",[\"$r\",\"h3\",null,{\"id\":\"support-for-custom-elements\",\"children\":\"支持自定义元素 \"}],\"\\n\",[\"$r\",\"p\",null,{\"children\":[\"React 19 添加了对自定义元素的全面支持，并通过了 \",[\"$r\",\"a\",null,{\"href\":\"https://custom-elements-everywhere.com/\",\"target\":\"_blank\",\"rel\":\"nofollow noopener noreferrer\",\"children\":\"Custom Elements Everywhere\"}],\" 上的所有测试。\"]}],\"\\n\",[\"$r\",\"p\",null,{\"children\":\"在过去的版本中，使用 React 中的自定义元素很困难，因为 React 将无法识别的 props 视为 HTML attribute 而不是 DOM property。在 React 19 中，我们添加了对 DOM property 的支持，该支持在客户端和 SSR 期间都有效，策略如下：\"}],\"\\n\",[\"$r\",\"ul\",null,{\"children\":[\"\\n\",[\"$r\",\"li\",null,{\"children\":[[\"$r\",\"strong\",null,{\"children\":\"服务器端渲染\"}],\"：传递给自定义元素的 props 将作为 HTML attribute 渲染，如果它们的类型是原始值，如 \",[\"$r\",\"code\",null,{\"children\":\"string\"}],\"、\",[\"$r\",\"code\",null,{\"children\":\"number\"}],\"，或者值为 \",[\"$r\",\"code\",null,{\"children\":\"true\"}],\"。具有非原始类型的 props，如 \",[\"$r\",\"code\",null,{\"children\":\"object\"}],\"、\",[\"$r\",\"code\",null,{\"children\":\"symbol\"}],\"、\",[\"$r\",\"code\",null,{\"children\":\"function\"}],\"，或者值为 \",[\"$r\",\"code\",null,{\"children\":\"false\"}],\" 的 props 将被省略。\"]}],\"\\n\",[\"$r\",\"li\",null,{\"children\":[[\"$r\",\"strong\",null,{\"children\":\"客户端渲染\"}],\"：匹配自定义元素实例上的属性的 props 将被赋值为 DOM property，否则它们将被赋值为 HTML attribute。\"]}],\"\\n\"]}],\"\\n\",[\"$r\",\"p\",null,{\"children\":[\"感谢 \",[\"$r\",\"a\",null,{\"href\":\"https://github.com/josepharhar\",\"target\":\"_blank\",\"rel\":\"nofollow noopener noreferrer\",\"children\":\"Joey Arhar\"}],\" 在 React 中推动自定义元素支持的设计和实现。\"]}],\"\\n\",[\"$r\",\"h4\",null,{\"id\":\"how-to-upgrade\",\"children\":\"如何升级 \"}],\"\\n\",[\"$r\",\"p\",null,{\"children\":[\"请查看 \",[\"$r\",\"a\",null,{\"href\":\"/blog/2024/04/25/react-19-upgrade-guide\",\"children\":\"React 19 升级指南\"}],\" 以获取逐步指导和完整的破坏性和显著变化列表。\"]}]]}]]","meta":{"title":"React 19 RC","author":"The React Team","date":"2024/04/25","description":"React 19 RC 版现在可以在 npm 上使用了! 在这篇文章中，我们将概述 React 19 的新特性，以及如何使用它们。"},"languages":null},"__N_SSG":true},"page":"/[[...markdownPath]]","query":{"markdownPath":["blog","2024","04","25","react-19"]},"buildId":"o3sV9gi4zL8eH-vfCdLA_","isFallback":false,"gsp":true,"scriptLoader":[]}</script></body></html>