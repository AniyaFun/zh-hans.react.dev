<!DOCTYPE html><html lang="zh-hans" dir="ltr"><head><meta charSet="utf-8"/><link rel="preconnect" href="https://1FCF9AYYAT-dsn.algolia.net"/><link rel="preload" as="style" href="/_next/static/css/69c3dd7f95e90f41.css"/><script async="" src="https://www.googletagmanager.com/gtag/js?id=G-B1E83PJ3RT"></script><link rel="preload" as="script" href="/_next/static/chunks/webpack-7aa5606533a0da22.js"/><link rel="preload" as="script" href="/_next/static/chunks/framework-60dbcc17f2b10a40.js"/><link rel="preload" as="script" href="/_next/static/chunks/main-691602c61f9ae952.js"/><link rel="preload" as="script" href="/_next/static/chunks/pages/_app-91cab47494e285be.js"/><link rel="preload" as="script" href="/_next/static/chunks/181-0c884f228c508338.js"/><link rel="preload" as="script" href="/_next/static/chunks/962-d27b3139d5233d22.js"/><link rel="preload" as="script" href="/_next/static/chunks/pages/%5B%5B...markdownPath%5D%5D-3fa615249ba59b83.js"/><link rel="preload" as="script" href="/_next/static/o3sV9gi4zL8eH-vfCdLA_/_buildManifest.js"/><link rel="preload" as="script" href="/_next/static/o3sV9gi4zL8eH-vfCdLA_/_ssgManifest.js"/><link rel="preload" href="/fonts/Source-Code-Pro-Regular.woff2" as="font" type="font/woff2" crossorigin="anonymous"/><link rel="preload" href="https://react.dev/fonts/Optimistic_Display_W_Md.woff2" as="font" type="font/woff2" crossorigin="anonymous"/><link rel="preload" href="https://react.dev/fonts/Optimistic_Display_W_SBd.woff2" as="font" type="font/woff2" crossorigin="anonymous"/><link rel="preload" href="https://react.dev/fonts/Optimistic_Display_W_Bd.woff2" as="font" type="font/woff2" crossorigin="anonymous"/><link rel="preload" href="https://react.dev/fonts/Optimistic_Text_W_Md.woff2" as="font" type="font/woff2" crossorigin="anonymous"/><link rel="preload" href="https://react.dev/fonts/Optimistic_Text_W_Bd.woff2" as="font" type="font/woff2" crossorigin="anonymous"/><link rel="preload" href="https://react.dev/fonts/Optimistic_Text_W_Rg.woff2" as="font" type="font/woff2" crossorigin="anonymous"/><link rel="preload" href="https://react.dev/fonts/Optimistic_Text_W_It.woff2" as="font" type="font/woff2" crossorigin="anonymous"/><link rel="preload" href="/_next/static/css/69c3dd7f95e90f41.css" as="style"/><meta name="viewport" content="width=device-width, initial-scale=1"/><title>移除 Effect 依赖 – React 中文文档</title><link rel="canonical" href="https://zh-hans.react.dev/learn/removing-effect-dependencies"/><link rel="alternate" href="https://react.dev/learn/removing-effect-dependencies" hrefLang="x-default"/><link rel="alternate" hrefLang="en" href="https://react.dev/learn/removing-effect-dependencies"/><link rel="alternate" hrefLang="zh-hans" href="https://zh-hans.react.dev/learn/removing-effect-dependencies"/><link rel="alternate" hrefLang="es" href="https://es.react.dev/learn/removing-effect-dependencies"/><link rel="alternate" hrefLang="fr" href="https://fr.react.dev/learn/removing-effect-dependencies"/><link rel="alternate" hrefLang="ja" href="https://ja.react.dev/learn/removing-effect-dependencies"/><link rel="alternate" hrefLang="tr" href="https://tr.react.dev/learn/removing-effect-dependencies"/><link rel="alternate" hrefLang="ko" href="https://ko.react.dev/learn/removing-effect-dependencies"/><meta property="fb:app_id" content="623268441017527"/><meta property="og:type" content="website"/><meta property="og:url" content="https://zh-hans.react.dev/learn/removing-effect-dependencies"/><meta property="og:title" content="移除 Effect 依赖 – React 中文文档"/><meta property="og:description" content="The library for web and native user interfaces"/><meta property="og:image" content="https://zh-hans.react.dev/images/og-learn.png"/><meta name="twitter:card" content="summary_large_image"/><meta name="twitter:site" content="@reactjs"/><meta name="twitter:creator" content="@reactjs"/><meta name="twitter:title" content="移除 Effect 依赖 – React 中文文档"/><meta name="twitter:description" content="The library for web and native user interfaces"/><meta name="twitter:image" content="https://zh-hans.react.dev/images/og-learn.png"/><meta name="google-site-verification" content="sIlAGs48RulR4DdP95YSWNKZIEtCqQmRjzn-Zq-CcD0"/><meta name="algolia-search-order" content="47"/><meta name="next-head-count" content="36"/><link rel="apple-touch-icon" sizes="180x180" href="/apple-touch-icon.png"/><link rel="icon" type="image/png" sizes="32x32" href="/favicon-32x32.png"/><link rel="icon" type="image/png" sizes="16x16" href="/favicon-16x16.png"/><link rel="manifest" href="/site.webmanifest"/><link rel="mask-icon" href="/safari-pinned-tab.svg" color="#404756"/><meta name="msapplication-TileColor" content="#2b5797"/><meta name="theme-color" content="#23272f"/><link rel="preload" as="image" imageSrcSet="/_next/image?url=%2Fimages%2Fuwu.png&amp;w=64&amp;q=75 1x, /_next/image?url=%2Fimages%2Fuwu.png&amp;w=128&amp;q=75 2x" fetchPriority="high"/><link rel="stylesheet" href="/_next/static/css/69c3dd7f95e90f41.css" data-n-g=""/><noscript data-n-css=""></noscript><script defer="" noModule="" src="/_next/static/chunks/polyfills-c67a75d1b6f99dc8.js"></script><script src="/_next/static/chunks/webpack-7aa5606533a0da22.js" defer=""></script><script src="/_next/static/chunks/framework-60dbcc17f2b10a40.js" defer=""></script><script src="/_next/static/chunks/main-691602c61f9ae952.js" defer=""></script><script src="/_next/static/chunks/pages/_app-91cab47494e285be.js" defer=""></script><script src="/_next/static/chunks/181-0c884f228c508338.js" defer=""></script><script src="/_next/static/chunks/962-d27b3139d5233d22.js" defer=""></script><script src="/_next/static/chunks/pages/%5B%5B...markdownPath%5D%5D-3fa615249ba59b83.js" defer=""></script><script src="/_next/static/o3sV9gi4zL8eH-vfCdLA_/_buildManifest.js" defer=""></script><script src="/_next/static/o3sV9gi4zL8eH-vfCdLA_/_ssgManifest.js" defer=""></script></head><script>window.dataLayer = window.dataLayer || [];function gtag(){dataLayer.push(arguments);}gtag('js', new Date());gtag('config', 'G-B1E83PJ3RT');</script><body class="font-text font-medium antialiased text-lg bg-wash dark:bg-wash-dark text-secondary dark:text-secondary-dark leading-base"><script>
              (function () {
                try {
                  let logShown = false;
                  function setUwu(isUwu) {
                    try {
                      if (isUwu) {
                        localStorage.setItem('uwu', true);
                        document.documentElement.classList.add('uwu');
                        if (!logShown) {
                          console.log('uwu mode! turn off with ?uwu=0');
                          console.log('logo credit to @sawaratsuki1004 via https://github.com/SAWARATSUKI/ServiceLogos');
                          logShown = true;
                        }
                      } else {
                        localStorage.removeItem('uwu');
                        document.documentElement.classList.remove('uwu');
                        console.log('uwu mode off. turn on with ?uwu');
                      }
                    } catch (err) { }
                  }
                  window.__setUwu = setUwu;
                  function checkQueryParam() {
                    const params = new URLSearchParams(window.location.search);
                    const value = params.get('uwu');
                    switch(value) {
                      case '':
                      case 'true':
                      case '1':
                        return true;
                      case 'false':
                      case '0':
                        return false;
                      default:
                        return null;
                    }
                  }
                  function checkLocalStorage() {
                    try {
                      return localStorage.getItem('uwu') === 'true';
                    } catch (err) {
                      return false;
                    }
                  }
                  const uwuQueryParam = checkQueryParam();
                  if (uwuQueryParam != null) {
                    setUwu(uwuQueryParam);
                  } else if (checkLocalStorage()) {
                    document.documentElement.classList.add('uwu');
                  }
                } catch (err) { }
              })();
            </script><script>
                (function () {
                  function setTheme(newTheme) {
                    window.__theme = newTheme;
                    if (newTheme === 'dark') {
                      document.documentElement.classList.add('dark');
                    } else if (newTheme === 'light') {
                      document.documentElement.classList.remove('dark');
                    }
                  }

                  var preferredTheme;
                  try {
                    preferredTheme = localStorage.getItem('theme');
                  } catch (err) { }

                  window.__setPreferredTheme = function(newTheme) {
                    preferredTheme = newTheme;
                    setTheme(newTheme);
                    try {
                      localStorage.setItem('theme', newTheme);
                    } catch (err) { }
                  };

                  var initialTheme = preferredTheme;
                  var darkQuery = window.matchMedia('(prefers-color-scheme: dark)');

                  if (!initialTheme) {
                    initialTheme = darkQuery.matches ? 'dark' : 'light';
                  }
                  setTheme(initialTheme);

                  darkQuery.addEventListener('change', function (e) {
                    if (!preferredTheme) {
                      setTheme(e.matches ? 'dark' : 'light');
                    }
                  });

                  // Detect whether the browser is Mac to display platform specific content
                  // An example of such content can be the keyboard shortcut displayed in the search bar
                  document.documentElement.classList.add(
                      window.navigator.platform.includes('Mac')
                      ? "platform-mac" 
                      : "platform-win"
                  );
                })();
              </script><div id="__next"><div></div><div class="z-40 sticky top-0"><nav class="duration-300 backdrop-filter backdrop-blur-lg backdrop-saturate-200 transition-shadow bg-opacity-90 items-center w-full flex justify-between bg-wash dark:bg-wash-dark dark:bg-opacity-95 px-1.5 lg:pe-5 lg:ps-4 z-40"><div class="flex items-center justify-between w-full h-16 gap-0 sm:gap-3"><div class="flex flex-row 3xl:flex-1 items-centers"><button type="button" aria-label="Menu" class="active:scale-95 transition-transform flex lg:hidden w-12 h-12 rounded-full items-center justify-center hover:bg-primary/5 hover:dark:bg-primary-dark/5 outline-link"><svg width="1.33em" height="1.33em" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><line x1="3" y1="12" x2="21" y2="12"></line><line x1="3" y1="6" x2="21" y2="6"></line><line x1="3" y1="18" x2="21" y2="18"></line></svg></button><span data-state="closed" class="flex items-center" style="-webkit-touch-callout:none"><div class="flex items-center"><div class="uwu-visible flex items-center justify-center h-full"><a href="/"><img alt="logo by @sawaratsuki1004" title="logo by @sawaratsuki1004" fetchPriority="high" width="63" height="32" decoding="async" data-nimg="1" class="h-8" style="color:transparent" srcSet="/_next/image?url=%2Fimages%2Fuwu.png&amp;w=64&amp;q=75 1x, /_next/image?url=%2Fimages%2Fuwu.png&amp;w=128&amp;q=75 2x" src="/_next/image?url=%2Fimages%2Fuwu.png&amp;w=128&amp;q=75"/></a></div><div class="uwu-hidden"><a class="active:scale-95 overflow-hidden transition-transform relative items-center text-primary dark:text-primary-dark p-1 whitespace-nowrap outline-link rounded-full 3xl:rounded-xl inline-flex text-lg font-normal gap-2" href="/"><svg width="100%" height="100%" viewBox="-10.5 -9.45 21 18.9" fill="none" xmlns="http://www.w3.org/2000/svg" class="text-sm me-0 w-10 h-10 text-brand dark:text-brand-dark flex origin-center transition-all ease-in-out"><circle cx="0" cy="0" r="2" fill="currentColor"></circle><g stroke="currentColor" stroke-width="1" fill="none"><ellipse rx="10" ry="4.5"></ellipse><ellipse rx="10" ry="4.5" transform="rotate(60)"></ellipse><ellipse rx="10" ry="4.5" transform="rotate(120)"></ellipse></g></svg><span class="sr-only 3xl:not-sr-only">React</span></a></div></div></span><div class="flex flex-column justify-center items-center"><a class=" flex py-2 flex-column justify-center items-center text-gray-50 dark:text-gray-30 hover:text-link hover:dark:text-link-dark hover:underline text-sm ms-1 cursor-pointer" href="/versions">v<!-- -->18.3.1</a></div></div><div class="items-center justify-center flex-1 hidden w-full md:flex 3xl:w-auto 3xl:shrink-0 3xl:justify-center"><button type="button" class="flex 3xl:w-[56rem] 3xl:mx-0 relative ps-4 pe-1 py-1 h-10 bg-gray-30/20 dark:bg-gray-40/20 outline-none focus:outline-link betterhover:hover:bg-opacity-80 pointer items-center text-start w-full text-gray-30 rounded-full align-middle text-base"><svg width="1em" height="1em" viewBox="0 0 20 20" class="align-middle me-3 text-gray-30 shrink-0 group-betterhover:hover:text-gray-70"><path d="M14.386 14.386l4.0877 4.0877-4.0877-4.0877c-2.9418 2.9419-7.7115 2.9419-10.6533 0-2.9419-2.9418-2.9419-7.7115 0-10.6533 2.9418-2.9419 7.7115-2.9419 10.6533 0 2.9419 2.9418 2.9419 7.7115 0 10.6533z" stroke="currentColor" fill="none" stroke-width="2" fill-rule="evenodd" stroke-linecap="round" stroke-linejoin="round"></path></svg>搜索<span class="hidden ms-auto sm:flex item-center me-1"><kbd class="w-5 h-5 border border-transparent me-1 bg-wash dark:bg-wash-dark text-gray-30 align-middle p-0 inline-flex justify-center items-center text-xs text-center rounded-md" data-platform="mac">⌘</kbd><kbd class="w-10 h-5 border border-transparent me-1 bg-wash dark:bg-wash-dark text-gray-30 align-middle p-0 inline-flex justify-center items-center text-xs text-center rounded-md" data-platform="win">Ctrl</kbd><kbd class="w-5 h-5 border border-transparent me-1 bg-wash dark:bg-wash-dark text-gray-30 align-middle p-0 inline-flex justify-center items-center text-xs text-center rounded-md">K</kbd></span></button></div><div class="text-base justify-center items-center gap-1.5 flex 3xl:flex-1 flex-row 3xl:justify-end"><div class="mx-2.5 gap-1.5 hidden lg:flex"></div><div class="flex w-full md:hidden"></div><div class="flex items-center -space-x-2.5 xs:space-x-0 "><div class="flex md:hidden"><button aria-label="Search" type="button" class="flex items-center justify-center w-12 h-12 transition-transform rounded-full active:scale-95 md:hidden hover:bg-secondary-button hover:dark:bg-secondary-button-dark outline-link"><svg width="1em" height="1em" viewBox="0 0 20 20" class="w-5 h-5 align-middle"><path d="M14.386 14.386l4.0877 4.0877-4.0877-4.0877c-2.9418 2.9419-7.7115 2.9419-10.6533 0-2.9419-2.9418-2.9419-7.7115 0-10.6533 2.9418-2.9419 7.7115-2.9419 10.6533 0 2.9419 2.9418 2.9419 7.7115 0 10.6533z" stroke="currentColor" fill="none" stroke-width="2" fill-rule="evenodd" stroke-linecap="round" stroke-linejoin="round"></path></svg></button></div><div class="flex dark:hidden"><button type="button" aria-label="Use Dark Mode" class="flex items-center justify-center w-12 h-12 transition-transform rounded-full active:scale-95 hover:bg-primary/5 hover:dark:bg-primary-dark/5 outline-link"><svg xmlns="http://www.w3.org/2000/svg" width="28" height="28" viewBox="0 0 32 32"><g fill="none" fill-rule="evenodd" transform="translate(-440 -200)"><path fill="currentColor" fill-rule="nonzero" stroke="currentColor" stroke-width="0.5" d="M102,21 C102,18.1017141 103.307179,15.4198295 105.51735,13.6246624 C106.001939,13.2310647 105.821611,12.4522936 105.21334,12.3117518 C104.322006,12.1058078 103.414758,12 102.5,12 C95.8722864,12 90.5,17.3722864 90.5,24 C90.5,30.6277136 95.8722864,36 102.5,36 C106.090868,36 109.423902,34.4109093 111.690274,31.7128995 C112.091837,31.2348572 111.767653,30.5041211 111.143759,30.4810139 C106.047479,30.2922628 102,26.1097349 102,21 Z M102.5,34.5 C96.7007136,34.5 92,29.7992864 92,24 C92,18.2007136 96.7007136,13.5 102.5,13.5 C102.807386,13.5 103.113925,13.5136793 103.419249,13.5407785 C101.566047,15.5446378 100.5,18.185162 100.5,21 C100.5,26.3198526 104.287549,30.7714322 109.339814,31.7756638 L109.516565,31.8092927 C107.615276,33.5209452 105.138081,34.5 102.5,34.5 Z" transform="translate(354.5 192)"></path><polygon points="444 228 468 228 468 204 444 204"></polygon></g></svg></button></div><div class="hidden dark:flex"><button type="button" aria-label="Use Light Mode" class="flex items-center justify-center w-12 h-12 transition-transform rounded-full active:scale-95 hover:bg-primary/5 hover:dark:bg-primary-dark/5 outline-link"><svg xmlns="http://www.w3.org/2000/svg" width="32" height="32" viewBox="0 0 32 32"><g fill="none" fill-rule="evenodd" transform="translate(-442 -200)"><g fill="currentColor" transform="translate(356 144)"><path fill-rule="nonzero" d="M108.5 24C108.5 27.5902136 105.590214 30.5 102 30.5 98.4097864 30.5 95.5 27.5902136 95.5 24 95.5 20.4097864 98.4097864 17.5 102 17.5 105.590214 17.5 108.5 20.4097864 108.5 24zM107 24C107 21.2382136 104.761786 19 102 19 99.2382136 19 97 21.2382136 97 24 97 26.7617864 99.2382136 29 102 29 104.761786 29 107 26.7617864 107 24zM101 12.75L101 14.75C101 15.1642136 101.335786 15.5 101.75 15.5 102.164214 15.5 102.5 15.1642136 102.5 14.75L102.5 12.75C102.5 12.3357864 102.164214 12 101.75 12 101.335786 12 101 12.3357864 101 12.75zM95.7255165 14.6323616L96.7485165 16.4038616C96.9556573 16.7625614 97.4143618 16.8854243 97.7730616 16.6782835 98.1317614 16.4711427 98.2546243 16.0124382 98.0474835 15.6537384L97.0244835 13.8822384C96.8173427 13.5235386 96.3586382 13.4006757 95.9999384 13.6078165 95.6412386 13.8149573 95.5183757 14.2736618 95.7255165 14.6323616zM91.8822384 19.0244835L93.6537384 20.0474835C94.0124382 20.2546243 94.4711427 20.1317614 94.6782835 19.7730616 94.8854243 19.4143618 94.7625614 18.9556573 94.4038616 18.7485165L92.6323616 17.7255165C92.2736618 17.5183757 91.8149573 17.6412386 91.6078165 17.9999384 91.4006757 18.3586382 91.5235386 18.8173427 91.8822384 19.0244835zM90.75 25L92.75 25C93.1642136 25 93.5 24.6642136 93.5 24.25 93.5 23.8357864 93.1642136 23.5 92.75 23.5L90.75 23.5C90.3357864 23.5 90 23.8357864 90 24.25 90 24.6642136 90.3357864 25 90.75 25zM92.6323616 30.2744835L94.4038616 29.2514835C94.7625614 29.0443427 94.8854243 28.5856382 94.6782835 28.2269384 94.4711427 27.8682386 94.0124382 27.7453757 93.6537384 27.9525165L91.8822384 28.9755165C91.5235386 29.1826573 91.4006757 29.6413618 91.6078165 30.0000616 91.8149573 30.3587614 92.2736618 30.4816243 92.6323616 30.2744835zM97.0244835 34.1177616L98.0474835 32.3462616C98.2546243 31.9875618 98.1317614 31.5288573 97.7730616 31.3217165 97.4143618 31.1145757 96.9556573 31.2374386 96.7485165 31.5961384L95.7255165 33.3676384C95.5183757 33.7263382 95.6412386 34.1850427 95.9999384 34.3921835 96.3586382 34.5993243 96.8173427 34.4764614 97.0244835 34.1177616zM103 35.25L103 33.25C103 32.8357864 102.664214 32.5 102.25 32.5 101.835786 32.5 101.5 32.8357864 101.5 33.25L101.5 35.25C101.5 35.6642136 101.835786 36 102.25 36 102.664214 36 103 35.6642136 103 35.25zM108.274483 33.3676384L107.251483 31.5961384C107.044343 31.2374386 106.585638 31.1145757 106.226938 31.3217165 105.868239 31.5288573 105.745376 31.9875618 105.952517 32.3462616L106.975517 34.1177616C107.182657 34.4764614 107.641362 34.5993243 108.000062 34.3921835 108.358761 34.1850427 108.481624 33.7263382 108.274483 33.3676384zM112.117762 28.9755165L110.346262 27.9525165C109.987562 27.7453757 109.528857 27.8682386 109.321717 28.2269384 109.114576 28.5856382 109.237439 29.0443427 109.596138 29.2514835L111.367638 30.2744835C111.726338 30.4816243 112.185043 30.3587614 112.392183 30.0000616 112.599324 29.6413618 112.476461 29.1826573 112.117762 28.9755165zM113.25 23L111.25 23C110.835786 23 110.5 23.3357864 110.5 23.75 110.5 24.1642136 110.835786 24.5 111.25 24.5L113.25 24.5C113.664214 24.5 114 24.1642136 114 23.75 114 23.3357864 113.664214 23 113.25 23zM111.367638 17.7255165L109.596138 18.7485165C109.237439 18.9556573 109.114576 19.4143618 109.321717 19.7730616 109.528857 20.1317614 109.987562 20.2546243 110.346262 20.0474835L112.117762 19.0244835C112.476461 18.8173427 112.599324 18.3586382 112.392183 17.9999384 112.185043 17.6412386 111.726338 17.5183757 111.367638 17.7255165zM106.975517 13.8822384L105.952517 15.6537384C105.745376 16.0124382 105.868239 16.4711427 106.226938 16.6782835 106.585638 16.8854243 107.044343 16.7625614 107.251483 16.4038616L108.274483 14.6323616C108.481624 14.2736618 108.358761 13.8149573 108.000062 13.6078165 107.641362 13.4006757 107.182657 13.5235386 106.975517 13.8822384z" transform="translate(0 48)" stroke="currentColor" stroke-width="0.25"></path><path d="M98.6123,60.1372 C98.6123,59.3552 98.8753,58.6427 99.3368,58.0942 C99.5293,57.8657 99.3933,57.5092 99.0943,57.5017 C99.0793,57.5012 99.0633,57.5007 99.0483,57.5007 C97.1578,57.4747 95.5418,59.0312 95.5008,60.9217 C95.4578,62.8907 97.0408,64.5002 98.9998,64.5002 C99.7793,64.5002 100.4983,64.2452 101.0798,63.8142 C101.3183,63.6372 101.2358,63.2627 100.9478,63.1897 C99.5923,62.8457 98.6123,61.6072 98.6123,60.1372" transform="translate(3 11)"></path></g><polygon points="444 228 468 228 468 204 444 204"></polygon></g></svg></button></div><div class="flex"><a class="active:scale-95 transition-transform flex w-12 h-12 rounded-full items-center justify-center hover:bg-primary/5 hover:dark:bg-primary-dark/5 outline-link" aria-label="Translations" href="/community/translations"><svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24"><path fill="currentColor" d=" M12.87 15.07l-2.54-2.51.03-.03c1.74-1.94 2.98-4.17 3.71-6.53H17V4h-7V2H8v2H1v1.99h11.17C11.5 7.92 10.44 9.75 9 11.35 8.07 10.32 7.3 9.19 6.69 8h-2c.73 1.63 1.73 3.17 2.98 4.56l-5.09 5.02L4 19l5-5 3.11 3.11.76-2.04zM18.5 10h-2L12 22h2l1.12-3h4.75L21 22h2l-4.5-12zm-2.62 7l1.62-4.33L19.12 17h-3.24z "></path></svg></a></div><div class="flex"></div></div></div></div></nav></div><div class="grid grid-cols-only-content lg:grid-cols-sidebar-content 2xl:grid-cols-sidebar-content-toc"><div class="lg:-mt-16 z-10"><div class="fixed top-0 py-0 shadow lg:pt-16 lg:sticky start-0 end-0 lg:shadow-none"><div class="sticky top-0 lg:bottom-0 lg:h-[calc(100vh-4rem)] flex flex-col"><div class="overflow-y-scroll no-bg-scrollbar lg:w-[342px] grow bg-wash dark:bg-wash-dark" style="overscroll-behavior:contain"><aside class="lg:grow flex-col w-full pb-8 lg:pb-0 lg:max-w-custom-xs z-10 hidden lg:block"><nav role="navigation" style="--bg-opacity:.2" class="w-full pt-6 scrolling-touch lg:h-auto grow pe-0 lg:pe-5 lg:pb-16 md:pt-4 lg:pt-4 scrolling-gpu"><!--$--><ul><h3 class="mb-1 text-sm font-bold ms-5 text-tertiary dark:text-tertiary-dark">起步</h3><li><a title="快速入门" target="" class="p-2 pe-2 w-full rounded-none lg:rounded-e-2xl text-start hover:bg-gray-5 dark:hover:bg-gray-80 relative flex items-center justify-between ps-5 text-base font-bold text-primary dark:text-primary-dark" href="/learn"><div>快速入门<!-- --> </div><span class="pe-1 text-tertiary dark:text-tertiary-dark"><svg xmlns="http://www.w3.org/2000/svg" width="20" height="20" viewBox="0 0 20 20" class="duration-100 ease-in transition -rotate-90 rtl:rotate-90" style="min-width:20px;min-height:20px"><g fill="none" fill-rule="evenodd" transform="translate(-446 -398)"><path fill="currentColor" fill-rule="nonzero" d="M95.8838835,240.366117 C95.3957281,239.877961 94.6042719,239.877961 94.1161165,240.366117 C93.6279612,240.854272 93.6279612,241.645728 94.1161165,242.133883 L98.6161165,246.633883 C99.1042719,247.122039 99.8957281,247.122039 100.383883,246.633883 L104.883883,242.133883 C105.372039,241.645728 105.372039,240.854272 104.883883,240.366117 C104.395728,239.877961 103.604272,239.877961 103.116117,240.366117 L99.5,243.982233 L95.8838835,240.366117 Z" transform="translate(356.5 164.5)"></path><polygon points="446 418 466 418 466 398 446 398"></polygon></g></svg></span></a><div class="opacity-50" style="transition:opacity 250ms ease-in-out"><div id="react-collapsed-panel-:R8im6:" aria-hidden="true" role="region" style="box-sizing:border-box;display:none;height:0px;overflow:hidden"><ul><li><a title="教程：井字棋游戏" target="" class="p-2 pe-2 w-full rounded-none lg:rounded-e-2xl text-start hover:bg-gray-5 dark:hover:bg-gray-80 relative flex items-center justify-between text-sm ps-6 ps-5 text-base text-secondary dark:text-secondary-dark" href="/learn/tutorial-tic-tac-toe"><div>教程：井字棋游戏<!-- --> </div></a></li><li><a title="React 哲学" target="" class="p-2 pe-2 w-full rounded-none lg:rounded-e-2xl text-start hover:bg-gray-5 dark:hover:bg-gray-80 relative flex items-center justify-between text-sm ps-6 ps-5 text-base text-secondary dark:text-secondary-dark" href="/learn/thinking-in-react"><div>React 哲学<!-- --> </div></a></li></ul></div></div></li><li><a title="安装" target="" class="p-2 pe-2 w-full rounded-none lg:rounded-e-2xl text-start hover:bg-gray-5 dark:hover:bg-gray-80 relative flex items-center justify-between ps-5 text-base font-bold text-primary dark:text-primary-dark" href="/learn/installation"><div>安装<!-- --> </div><span class="pe-1 text-tertiary dark:text-tertiary-dark"><svg xmlns="http://www.w3.org/2000/svg" width="20" height="20" viewBox="0 0 20 20" class="duration-100 ease-in transition -rotate-90 rtl:rotate-90" style="min-width:20px;min-height:20px"><g fill="none" fill-rule="evenodd" transform="translate(-446 -398)"><path fill="currentColor" fill-rule="nonzero" d="M95.8838835,240.366117 C95.3957281,239.877961 94.6042719,239.877961 94.1161165,240.366117 C93.6279612,240.854272 93.6279612,241.645728 94.1161165,242.133883 L98.6161165,246.633883 C99.1042719,247.122039 99.8957281,247.122039 100.383883,246.633883 L104.883883,242.133883 C105.372039,241.645728 105.372039,240.854272 104.883883,240.366117 C104.395728,239.877961 103.604272,239.877961 103.116117,240.366117 L99.5,243.982233 L95.8838835,240.366117 Z" transform="translate(356.5 164.5)"></path><polygon points="446 418 466 418 466 398 446 398"></polygon></g></svg></span></a><div class="opacity-50" style="transition:opacity 250ms ease-in-out"><div id="react-collapsed-panel-:R8qm6:" aria-hidden="true" role="region" style="box-sizing:border-box;display:none;height:0px;overflow:hidden"><ul><li><a title="启动一个新的 React 项目" target="" class="p-2 pe-2 w-full rounded-none lg:rounded-e-2xl text-start hover:bg-gray-5 dark:hover:bg-gray-80 relative flex items-center justify-between text-sm ps-6 ps-5 text-base text-secondary dark:text-secondary-dark" href="/learn/start-a-new-react-project"><div>启动一个新的 React 项目<!-- --> </div></a></li><li><a title="将 React 添加到现有项目中" target="" class="p-2 pe-2 w-full rounded-none lg:rounded-e-2xl text-start hover:bg-gray-5 dark:hover:bg-gray-80 relative flex items-center justify-between text-sm ps-6 ps-5 text-base text-secondary dark:text-secondary-dark" href="/learn/add-react-to-an-existing-project"><div>将 React 添加到现有项目中<!-- --> </div></a></li><li><a title="编辑器设置" target="" class="p-2 pe-2 w-full rounded-none lg:rounded-e-2xl text-start hover:bg-gray-5 dark:hover:bg-gray-80 relative flex items-center justify-between text-sm ps-6 ps-5 text-base text-secondary dark:text-secondary-dark" href="/learn/editor-setup"><div>编辑器设置<!-- --> </div></a></li><li><a title="使用 TypeScript" target="" class="p-2 pe-2 w-full rounded-none lg:rounded-e-2xl text-start hover:bg-gray-5 dark:hover:bg-gray-80 relative flex items-center justify-between text-sm ps-6 ps-5 text-base text-secondary dark:text-secondary-dark" href="/learn/typescript"><div>使用 TypeScript<!-- --> </div></a></li><li><a title="React 开发者工具" target="" class="p-2 pe-2 w-full rounded-none lg:rounded-e-2xl text-start hover:bg-gray-5 dark:hover:bg-gray-80 relative flex items-center justify-between text-sm ps-6 ps-5 text-base text-secondary dark:text-secondary-dark" href="/learn/react-developer-tools"><div>React 开发者工具<!-- --> </div></a></li><li><a title="React Compiler" target="" class="p-2 pe-2 w-full rounded-none lg:rounded-e-2xl text-start hover:bg-gray-5 dark:hover:bg-gray-80 relative flex items-center justify-between text-sm ps-6 ps-5 text-base text-secondary dark:text-secondary-dark" href="/learn/react-compiler"><div>React Compiler<!-- --> <svg class="ms-2 text-gray-30 dark:text-gray-60 inline-block w-4 h-4 align-[-3px]" width="20px" height="20px" viewBox="0 0 20 20" version="1.1" xmlns="http://www.w3.org/2000/svg"><title> - This feature is available in the latest Canary</title><g stroke="none" stroke-width="1" fill="none" fill-rule="evenodd"><g id="noun-labs-1201738-(2)" transform="translate(2, 0)" fill="currentColor" fill-rule="nonzero"><path d="M10.2865804,5.55665262 L10.2865804,2.22331605 L10.8591544,2.22331605 C11.0103911,2.22244799 11.1551447,2.16342155 11.2617505,2.05914367 C11.3684534,1.95486857 11.4282767,1.81370176 11.4282767,1.66667106 L11.4282767,0.556642208 C11.4282767,0.40907262 11.3678934,0.26747526 11.2605218,0.16308627 C11.1531503,0.0587028348 11.0074938,0 10.8556998,0 L5.14338868,0 C4.9915947,0 4.84594391,0.0587028348 4.73856664,0.16308627 C4.63119507,0.267469704 4.57081178,0.40907262 4.57081178,0.556642208 L4.57081178,1.66667106 C4.57081178,1.81434899 4.63119507,1.95594912 4.73856664,2.06033811 C4.8459382,2.16472155 4.9915947,2.22331605 5.14338868,2.22331605 L5.71596273,2.22331605 L5.71596273,5.55665262 C5.71596273,8.38665538 2.97295619,9.88999017 0.651686904,15.5566623 C-0.0957823782,17.360053 -2.00560068,20 7.99951567,20 C18.004632,20 16.0948137,17.3600252 15.3507732,15.5566623 C13.0124432,9.88999017 10.2865804,8.38665538 10.2865804,5.55665262 Z M9.89570197,10.709991 C10.0921412,10.709991 10.2805515,10.7858383 10.4193876,10.9209301 C10.5583466,11.0559135 10.6363652,11.2390693 10.6363652,11.4300417 C10.6363652,11.6210141 10.5583466,11.8040698 10.4193876,11.9391533 C10.2805401,12.0741367 10.0921412,12.1499813 9.89570197,12.1499813 C9.6992627,12.1499813 9.51096673,12.074134 9.37201631,11.9391533 C9.23316875,11.8040615 9.15515307,11.6210141 9.15515307,11.4300417 C9.15515307,11.2390693 9.2331716,11.0559024 9.37201631,10.9209301 C9.57264221,10.7258996 9.61239426,10.709991 9.89570197,10.709991 Z M8.98919546,9.04212824 C9.09790709,9.14792278 9.15884755,9.29158681 9.1585213,9.44110085 C9.15829001,9.59073155 9.09678989,9.73407335 8.98763252,9.83954568 C8.87847514,9.945018 8.73069852,10.0039347 8.57678157,10.0033977 C8.42286747,10.0027392 8.27565088,9.94273467 8.16727355,9.83639845 C8.05900765,9.73006224 7.99873866,9.58628988 7.99963013,9.43664806 C8.00052304,9.28788403 8.0620221,9.14542556 8.17051087,9.04048101 C8.27911107,8.93555591 8.42599335,8.87663641 8.57913312,8.87663641 C8.73291864,8.87665585 8.88047525,8.93622535 8.98919546,9.04212824 Z M7.99965585,17.9999981 C4.91377349,17.9999981 3.29882839,17.7332867 2.51364277,17.4999976 C2.37780966,17.4476975 2.26954376,17.3439641 2.21396931,17.2125528 C2.15838628,17.0811499 2.16006066,16.9334692 2.21876871,16.8033858 C2.6144474,15.5921346 3.14916224,14.4280501 3.81316983,13.3333824 C5.980145,9.82337899 8.22941036,13.8867718 10.0980836,13.8867718 C11.9666996,13.8867718 11.4695868,12.1534924 12.1827971,13.3333824 C12.8511505,14.4269112 13.3916656,15.5896902 13.794259,16.8000524 C13.8533022,16.9322137 13.8537479,17.0822749 13.7952635,17.2147751 C13.7368889,17.3472613 13.6248314,17.4504531 13.4856467,17.5000531 C12.6833967,17.7332867 11.0855382,17.9999981 7.99965585,17.9999981 Z" id="Shape"></path></g></g></svg></div></a></li></ul></div></div></li><li role="separator" class="mt-4 mb-2 ms-5 border-b border-border dark:border-border-dark"></li><h3 class="mb-1 text-sm font-bold ms-5 text-tertiary dark:text-tertiary-dark mt-2">学习 React</h3><li><a title="描述 UI" target="" class="p-2 pe-2 w-full rounded-none lg:rounded-e-2xl text-start hover:bg-gray-5 dark:hover:bg-gray-80 relative flex items-center justify-between ps-5 text-base font-bold text-primary dark:text-primary-dark" href="/learn/describing-the-ui"><div>描述 UI<!-- --> </div><span class="pe-1 text-tertiary dark:text-tertiary-dark"><svg xmlns="http://www.w3.org/2000/svg" width="20" height="20" viewBox="0 0 20 20" class="duration-100 ease-in transition -rotate-90 rtl:rotate-90" style="min-width:20px;min-height:20px"><g fill="none" fill-rule="evenodd" transform="translate(-446 -398)"><path fill="currentColor" fill-rule="nonzero" d="M95.8838835,240.366117 C95.3957281,239.877961 94.6042719,239.877961 94.1161165,240.366117 C93.6279612,240.854272 93.6279612,241.645728 94.1161165,242.133883 L98.6161165,246.633883 C99.1042719,247.122039 99.8957281,247.122039 100.383883,246.633883 L104.883883,242.133883 C105.372039,241.645728 105.372039,240.854272 104.883883,240.366117 C104.395728,239.877961 103.604272,239.877961 103.116117,240.366117 L99.5,243.982233 L95.8838835,240.366117 Z" transform="translate(356.5 164.5)"></path><polygon points="446 418 466 418 466 398 446 398"></polygon></g></svg></span></a><div class="opacity-50" style="transition:opacity 250ms ease-in-out"><div id="react-collapsed-panel-:R9am6:" aria-hidden="true" role="region" style="box-sizing:border-box;display:none;height:0px;overflow:hidden"><ul><li><a title="你的第一个组件" target="" class="p-2 pe-2 w-full rounded-none lg:rounded-e-2xl text-start hover:bg-gray-5 dark:hover:bg-gray-80 relative flex items-center justify-between text-sm ps-6 ps-5 text-base text-secondary dark:text-secondary-dark" href="/learn/your-first-component"><div>你的第一个组件<!-- --> </div></a></li><li><a title="组件的导入与导出" target="" class="p-2 pe-2 w-full rounded-none lg:rounded-e-2xl text-start hover:bg-gray-5 dark:hover:bg-gray-80 relative flex items-center justify-between text-sm ps-6 ps-5 text-base text-secondary dark:text-secondary-dark" href="/learn/importing-and-exporting-components"><div>组件的导入与导出<!-- --> </div></a></li><li><a title="使用 JSX 书写标签语言" target="" class="p-2 pe-2 w-full rounded-none lg:rounded-e-2xl text-start hover:bg-gray-5 dark:hover:bg-gray-80 relative flex items-center justify-between text-sm ps-6 ps-5 text-base text-secondary dark:text-secondary-dark" href="/learn/writing-markup-with-jsx"><div>使用 JSX 书写标签语言<!-- --> </div></a></li><li><a title="在 JSX 中通过大括号使用 JavaScript" target="" class="p-2 pe-2 w-full rounded-none lg:rounded-e-2xl text-start hover:bg-gray-5 dark:hover:bg-gray-80 relative flex items-center justify-between text-sm ps-6 ps-5 text-base text-secondary dark:text-secondary-dark" href="/learn/javascript-in-jsx-with-curly-braces"><div>在 JSX 中通过大括号使用 JavaScript<!-- --> </div></a></li><li><a title="将 Props 传递给组件" target="" class="p-2 pe-2 w-full rounded-none lg:rounded-e-2xl text-start hover:bg-gray-5 dark:hover:bg-gray-80 relative flex items-center justify-between text-sm ps-6 ps-5 text-base text-secondary dark:text-secondary-dark" href="/learn/passing-props-to-a-component"><div>将 Props 传递给组件<!-- --> </div></a></li><li><a title="条件渲染" target="" class="p-2 pe-2 w-full rounded-none lg:rounded-e-2xl text-start hover:bg-gray-5 dark:hover:bg-gray-80 relative flex items-center justify-between text-sm ps-6 ps-5 text-base text-secondary dark:text-secondary-dark" href="/learn/conditional-rendering"><div>条件渲染<!-- --> </div></a></li><li><a title="渲染列表" target="" class="p-2 pe-2 w-full rounded-none lg:rounded-e-2xl text-start hover:bg-gray-5 dark:hover:bg-gray-80 relative flex items-center justify-between text-sm ps-6 ps-5 text-base text-secondary dark:text-secondary-dark" href="/learn/rendering-lists"><div>渲染列表<!-- --> </div></a></li><li><a title="保持组件纯粹" target="" class="p-2 pe-2 w-full rounded-none lg:rounded-e-2xl text-start hover:bg-gray-5 dark:hover:bg-gray-80 relative flex items-center justify-between text-sm ps-6 ps-5 text-base text-secondary dark:text-secondary-dark" href="/learn/keeping-components-pure"><div>保持组件纯粹<!-- --> </div></a></li><li><a title="将 UI 视为树" target="" class="p-2 pe-2 w-full rounded-none lg:rounded-e-2xl text-start hover:bg-gray-5 dark:hover:bg-gray-80 relative flex items-center justify-between text-sm ps-6 ps-5 text-base text-secondary dark:text-secondary-dark" href="/learn/understanding-your-ui-as-a-tree"><div>将 UI 视为树<!-- --> </div></a></li></ul></div></div></li><li><a title="添加交互" target="" class="p-2 pe-2 w-full rounded-none lg:rounded-e-2xl text-start hover:bg-gray-5 dark:hover:bg-gray-80 relative flex items-center justify-between ps-5 text-base font-bold text-primary dark:text-primary-dark" href="/learn/adding-interactivity"><div>添加交互<!-- --> </div><span class="pe-1 text-tertiary dark:text-tertiary-dark"><svg xmlns="http://www.w3.org/2000/svg" width="20" height="20" viewBox="0 0 20 20" class="duration-100 ease-in transition -rotate-90 rtl:rotate-90" style="min-width:20px;min-height:20px"><g fill="none" fill-rule="evenodd" transform="translate(-446 -398)"><path fill="currentColor" fill-rule="nonzero" d="M95.8838835,240.366117 C95.3957281,239.877961 94.6042719,239.877961 94.1161165,240.366117 C93.6279612,240.854272 93.6279612,241.645728 94.1161165,242.133883 L98.6161165,246.633883 C99.1042719,247.122039 99.8957281,247.122039 100.383883,246.633883 L104.883883,242.133883 C105.372039,241.645728 105.372039,240.854272 104.883883,240.366117 C104.395728,239.877961 103.604272,239.877961 103.116117,240.366117 L99.5,243.982233 L95.8838835,240.366117 Z" transform="translate(356.5 164.5)"></path><polygon points="446 418 466 418 466 398 446 398"></polygon></g></svg></span></a><div class="opacity-50" style="transition:opacity 250ms ease-in-out"><div id="react-collapsed-panel-:R9im6:" aria-hidden="true" role="region" style="box-sizing:border-box;display:none;height:0px;overflow:hidden"><ul><li><a title="响应事件" target="" class="p-2 pe-2 w-full rounded-none lg:rounded-e-2xl text-start hover:bg-gray-5 dark:hover:bg-gray-80 relative flex items-center justify-between text-sm ps-6 ps-5 text-base text-secondary dark:text-secondary-dark" href="/learn/responding-to-events"><div>响应事件<!-- --> </div></a></li><li><a title="state：组件的记忆" target="" class="p-2 pe-2 w-full rounded-none lg:rounded-e-2xl text-start hover:bg-gray-5 dark:hover:bg-gray-80 relative flex items-center justify-between text-sm ps-6 ps-5 text-base text-secondary dark:text-secondary-dark" href="/learn/state-a-components-memory"><div>state：组件的记忆<!-- --> </div></a></li><li><a title="渲染和提交" target="" class="p-2 pe-2 w-full rounded-none lg:rounded-e-2xl text-start hover:bg-gray-5 dark:hover:bg-gray-80 relative flex items-center justify-between text-sm ps-6 ps-5 text-base text-secondary dark:text-secondary-dark" href="/learn/render-and-commit"><div>渲染和提交<!-- --> </div></a></li><li><a title="state 如同一张快照" target="" class="p-2 pe-2 w-full rounded-none lg:rounded-e-2xl text-start hover:bg-gray-5 dark:hover:bg-gray-80 relative flex items-center justify-between text-sm ps-6 ps-5 text-base text-secondary dark:text-secondary-dark" href="/learn/state-as-a-snapshot"><div>state 如同一张快照<!-- --> </div></a></li><li><a title="把一系列 state 更新加入队列" target="" class="p-2 pe-2 w-full rounded-none lg:rounded-e-2xl text-start hover:bg-gray-5 dark:hover:bg-gray-80 relative flex items-center justify-between text-sm ps-6 ps-5 text-base text-secondary dark:text-secondary-dark" href="/learn/queueing-a-series-of-state-updates"><div>把一系列 state 更新加入队列<!-- --> </div></a></li><li><a title="更新 state 中的对象" target="" class="p-2 pe-2 w-full rounded-none lg:rounded-e-2xl text-start hover:bg-gray-5 dark:hover:bg-gray-80 relative flex items-center justify-between text-sm ps-6 ps-5 text-base text-secondary dark:text-secondary-dark" href="/learn/updating-objects-in-state"><div>更新 state 中的对象<!-- --> </div></a></li><li><a title="更新 state 中的数组" target="" class="p-2 pe-2 w-full rounded-none lg:rounded-e-2xl text-start hover:bg-gray-5 dark:hover:bg-gray-80 relative flex items-center justify-between text-sm ps-6 ps-5 text-base text-secondary dark:text-secondary-dark" href="/learn/updating-arrays-in-state"><div>更新 state 中的数组<!-- --> </div></a></li></ul></div></div></li><li><a title="状态管理" target="" class="p-2 pe-2 w-full rounded-none lg:rounded-e-2xl text-start hover:bg-gray-5 dark:hover:bg-gray-80 relative flex items-center justify-between ps-5 text-base font-bold text-primary dark:text-primary-dark" href="/learn/managing-state"><div>状态管理<!-- --> </div><span class="pe-1 text-tertiary dark:text-tertiary-dark"><svg xmlns="http://www.w3.org/2000/svg" width="20" height="20" viewBox="0 0 20 20" class="duration-100 ease-in transition -rotate-90 rtl:rotate-90" style="min-width:20px;min-height:20px"><g fill="none" fill-rule="evenodd" transform="translate(-446 -398)"><path fill="currentColor" fill-rule="nonzero" d="M95.8838835,240.366117 C95.3957281,239.877961 94.6042719,239.877961 94.1161165,240.366117 C93.6279612,240.854272 93.6279612,241.645728 94.1161165,242.133883 L98.6161165,246.633883 C99.1042719,247.122039 99.8957281,247.122039 100.383883,246.633883 L104.883883,242.133883 C105.372039,241.645728 105.372039,240.854272 104.883883,240.366117 C104.395728,239.877961 103.604272,239.877961 103.116117,240.366117 L99.5,243.982233 L95.8838835,240.366117 Z" transform="translate(356.5 164.5)"></path><polygon points="446 418 466 418 466 398 446 398"></polygon></g></svg></span></a><div class="opacity-50" style="transition:opacity 250ms ease-in-out"><div id="react-collapsed-panel-:R9qm6:" aria-hidden="true" role="region" style="box-sizing:border-box;display:none;height:0px;overflow:hidden"><ul><li><a title="用 State 响应输入" target="" class="p-2 pe-2 w-full rounded-none lg:rounded-e-2xl text-start hover:bg-gray-5 dark:hover:bg-gray-80 relative flex items-center justify-between text-sm ps-6 ps-5 text-base text-secondary dark:text-secondary-dark" href="/learn/reacting-to-input-with-state"><div>用 State 响应输入<!-- --> </div></a></li><li><a title="选择 State 结构" target="" class="p-2 pe-2 w-full rounded-none lg:rounded-e-2xl text-start hover:bg-gray-5 dark:hover:bg-gray-80 relative flex items-center justify-between text-sm ps-6 ps-5 text-base text-secondary dark:text-secondary-dark" href="/learn/choosing-the-state-structure"><div>选择 State 结构<!-- --> </div></a></li><li><a title="在组件间共享状态" target="" class="p-2 pe-2 w-full rounded-none lg:rounded-e-2xl text-start hover:bg-gray-5 dark:hover:bg-gray-80 relative flex items-center justify-between text-sm ps-6 ps-5 text-base text-secondary dark:text-secondary-dark" href="/learn/sharing-state-between-components"><div>在组件间共享状态<!-- --> </div></a></li><li><a title="对 state 进行保留和重置" target="" class="p-2 pe-2 w-full rounded-none lg:rounded-e-2xl text-start hover:bg-gray-5 dark:hover:bg-gray-80 relative flex items-center justify-between text-sm ps-6 ps-5 text-base text-secondary dark:text-secondary-dark" href="/learn/preserving-and-resetting-state"><div>对 state 进行保留和重置<!-- --> </div></a></li><li><a title="迁移状态逻辑至 Reducer 中" target="" class="p-2 pe-2 w-full rounded-none lg:rounded-e-2xl text-start hover:bg-gray-5 dark:hover:bg-gray-80 relative flex items-center justify-between text-sm ps-6 ps-5 text-base text-secondary dark:text-secondary-dark" href="/learn/extracting-state-logic-into-a-reducer"><div>迁移状态逻辑至 Reducer 中<!-- --> </div></a></li><li><a title="使用 Context 深层传递参数" target="" class="p-2 pe-2 w-full rounded-none lg:rounded-e-2xl text-start hover:bg-gray-5 dark:hover:bg-gray-80 relative flex items-center justify-between text-sm ps-6 ps-5 text-base text-secondary dark:text-secondary-dark" href="/learn/passing-data-deeply-with-context"><div>使用 Context 深层传递参数<!-- --> </div></a></li><li><a title="使用 Reducer 和 Context 拓展你的应用" target="" class="p-2 pe-2 w-full rounded-none lg:rounded-e-2xl text-start hover:bg-gray-5 dark:hover:bg-gray-80 relative flex items-center justify-between text-sm ps-6 ps-5 text-base text-secondary dark:text-secondary-dark" href="/learn/scaling-up-with-reducer-and-context"><div>使用 Reducer 和 Context 拓展你的应用<!-- --> </div></a></li></ul></div></div></li><li><a title="脱围机制" target="" class="p-2 pe-2 w-full rounded-none lg:rounded-e-2xl text-start hover:bg-gray-5 dark:hover:bg-gray-80 relative flex items-center justify-between ps-5 text-base font-bold text-primary dark:text-primary-dark" href="/learn/escape-hatches"><div>脱围机制<!-- --> </div><span class="pe-1 text-link dark:text-link-dark"><svg xmlns="http://www.w3.org/2000/svg" width="20" height="20" viewBox="0 0 20 20" class="duration-100 ease-in transition rotate-0" style="min-width:20px;min-height:20px"><g fill="none" fill-rule="evenodd" transform="translate(-446 -398)"><path fill="currentColor" fill-rule="nonzero" d="M95.8838835,240.366117 C95.3957281,239.877961 94.6042719,239.877961 94.1161165,240.366117 C93.6279612,240.854272 93.6279612,241.645728 94.1161165,242.133883 L98.6161165,246.633883 C99.1042719,247.122039 99.8957281,247.122039 100.383883,246.633883 L104.883883,242.133883 C105.372039,241.645728 105.372039,240.854272 104.883883,240.366117 C104.395728,239.877961 103.604272,239.877961 103.116117,240.366117 L99.5,243.982233 L95.8838835,240.366117 Z" transform="translate(356.5 164.5)"></path><polygon points="446 418 466 418 466 398 446 398"></polygon></g></svg></span></a><div class="opacity-100" style="transition:opacity 250ms ease-in-out"><div id="react-collapsed-panel-:Ra2m6:" aria-hidden="false" role="region" style="box-sizing:border-box"><ul><li><a title="使用 ref 引用值" target="" class="p-2 pe-2 w-full rounded-none lg:rounded-e-2xl text-start hover:bg-gray-5 dark:hover:bg-gray-80 relative flex items-center justify-between text-sm ps-6 ps-5 text-base text-secondary dark:text-secondary-dark" href="/learn/referencing-values-with-refs"><div>使用 ref 引用值<!-- --> </div></a></li><li><a title="使用 ref 操作 DOM" target="" class="p-2 pe-2 w-full rounded-none lg:rounded-e-2xl text-start hover:bg-gray-5 dark:hover:bg-gray-80 relative flex items-center justify-between text-sm ps-6 ps-5 text-base text-secondary dark:text-secondary-dark" href="/learn/manipulating-the-dom-with-refs"><div>使用 ref 操作 DOM<!-- --> </div></a></li><li><a title="使用 Effect 进行同步" target="" class="p-2 pe-2 w-full rounded-none lg:rounded-e-2xl text-start hover:bg-gray-5 dark:hover:bg-gray-80 relative flex items-center justify-between text-sm ps-6 ps-5 text-base text-secondary dark:text-secondary-dark" href="/learn/synchronizing-with-effects"><div>使用 Effect 进行同步<!-- --> </div></a></li><li><a title="你可能不需要 Effect" target="" class="p-2 pe-2 w-full rounded-none lg:rounded-e-2xl text-start hover:bg-gray-5 dark:hover:bg-gray-80 relative flex items-center justify-between text-sm ps-6 ps-5 text-base text-secondary dark:text-secondary-dark" href="/learn/you-might-not-need-an-effect"><div>你可能不需要 Effect<!-- --> </div></a></li><li><a title="响应式 Effect 的生命周期" target="" class="p-2 pe-2 w-full rounded-none lg:rounded-e-2xl text-start hover:bg-gray-5 dark:hover:bg-gray-80 relative flex items-center justify-between text-sm ps-6 ps-5 text-base text-secondary dark:text-secondary-dark" href="/learn/lifecycle-of-reactive-effects"><div>响应式 Effect 的生命周期<!-- --> </div></a></li><li><a title="将事件从 Effect 中分开" target="" class="p-2 pe-2 w-full rounded-none lg:rounded-e-2xl text-start hover:bg-gray-5 dark:hover:bg-gray-80 relative flex items-center justify-between text-sm ps-6 ps-5 text-base text-secondary dark:text-secondary-dark" href="/learn/separating-events-from-effects"><div>将事件从 Effect 中分开<!-- --> </div></a></li><li><a title="移除 Effect 依赖" target="" aria-current="page" class="p-2 pe-2 w-full rounded-none lg:rounded-e-2xl text-start hover:bg-gray-5 dark:hover:bg-gray-80 relative flex items-center justify-between text-sm ps-6 ps-5 text-base text-link dark:text-link-dark bg-highlight dark:bg-highlight-dark border-blue-40 hover:bg-highlight hover:text-link dark:hover:bg-highlight-dark dark:hover:text-link-dark" href="/learn/removing-effect-dependencies"><div>移除 Effect 依赖<!-- --> </div></a></li><li><a title="使用自定义 Hook 复用逻辑" target="" class="p-2 pe-2 w-full rounded-none lg:rounded-e-2xl text-start hover:bg-gray-5 dark:hover:bg-gray-80 relative flex items-center justify-between text-sm ps-6 ps-5 text-base text-secondary dark:text-secondary-dark" href="/learn/reusing-logic-with-custom-hooks"><div>使用自定义 Hook 复用逻辑<!-- --> </div></a></li></ul></div></div></li></ul><!--/$--><div class="h-20"></div></nav><div class="fixed bottom-0 hidden lg:block"><div class="max-w-custom-xs w-80 lg:w-auto py-3 shadow-lg rounded-lg m-4 bg-wash dark:bg-gray-95 px-4 flex"><p class="w-full text-lg font-bold text-primary dark:text-primary-dark me-4">这个页面对你有帮助吗？</p><button aria-label="Yes" class="px-3 rounded-lg bg-secondary-button dark:bg-secondary-button-dark text-primary dark:text-primary-dark me-2"><svg width="16" height="18" viewBox="0 0 16 18" fill="none" xmlns="http://www.w3.org/2000/svg"><path fill-rule="evenodd" clip-rule="evenodd" d="M9.36603 0.384603C9.36605 0.384617 9.36601 0.384588 9.36603 0.384603L9.45902 0.453415C9.99732 0.851783 10.3873 1.42386 10.5654 2.07648C10.7435 2.72909 10.6993 3.42385 10.44 4.04763L9.27065 6.86008H12.6316C13.5249 6.86008 14.3817 7.22121 15.0134 7.86402C15.6451 8.50683 16 9.37868 16 10.2877V13.7154C16 14.8518 15.5564 15.9416 14.7668 16.7451C13.9771 17.5486 12.9062 18 11.7895 18H5.05263C3.71259 18 2.42743 17.4583 1.47988 16.4941C0.532325 15.5299 0 14.2221 0 12.8585V11.2511C2.40928e-06 9.87711 0.463526 8.54479 1.31308 7.47688L6.66804 0.745592C6.98662 0.345136 7.44414 0.08434 7.94623 0.0171605C8.4483 -0.0500155 8.95656 0.0815891 9.36603 0.384603ZM8.37542 1.77064C8.31492 1.72587 8.23987 1.70646 8.16579 1.71637C8.09171 1.72628 8.02415 1.76477 7.97708 1.82393L2.62213 8.55522C2.0153 9.31801 1.68421 10.2697 1.68421 11.2511V12.8585C1.68421 13.7676 2.03909 14.6394 2.67079 15.2822C3.30249 15.925 4.15927 16.2862 5.05263 16.2862H11.7895C12.4595 16.2862 13.1021 16.0153 13.5759 15.5332C14.0496 15.0511 14.3158 14.3972 14.3158 13.7154V10.2877C14.3158 9.83321 14.1383 9.39729 13.8225 9.07588C13.5066 8.75448 13.0783 8.57392 12.6316 8.57392H8C7.71763 8.57392 7.45405 8.4299 7.29806 8.19039C7.14206 7.95087 7.11442 7.64774 7.22445 7.38311L8.88886 3.37986C9 3.11253 9.01896 2.81477 8.94262 2.53507C8.8663 2.25541 8.69921 2.01027 8.46853 1.83954L8.37542 1.77064Z" fill="currentColor"></path></svg></button><button aria-label="No" class="px-3 rounded-lg bg-secondary-button dark:bg-secondary-button-dark text-primary dark:text-primary-dark"><svg width="16" height="18" viewBox="0 0 16 18" fill="none" xmlns="http://www.w3.org/2000/svg"><path fill-rule="evenodd" clip-rule="evenodd" d="M6.63397 17.6154C6.63395 17.6154 6.63399 17.6154 6.63397 17.6154L6.54098 17.5466C6.00268 17.1482 5.61269 16.5761 5.43458 15.9235C5.25648 15.2709 5.30069 14.5761 5.56004 13.9524L6.72935 11.1399L3.36842 11.1399C2.47506 11.1399 1.61829 10.7788 0.986585 10.136C0.354883 9.49316 8.1991e-07 8.62132 8.99384e-07 7.71225L1.19904e-06 4.28458C1.29838e-06 3.14824 0.443605 2.05844 1.23323 1.25492C2.02286 0.451403 3.09383 -1.12829e-06 4.21053 -1.03067e-06L10.9474 -4.41715e-07C12.2874 -3.24565e-07 13.5726 0.541687 14.5201 1.50591C15.4677 2.47013 16 3.77789 16 5.1415L16 6.74893C16 8.12289 15.5365 9.45521 14.6869 10.5231L9.33196 17.2544C9.01338 17.6549 8.55586 17.9157 8.05377 17.9828C7.5517 18.05 7.04344 17.9184 6.63397 17.6154ZM7.62458 16.2294C7.68508 16.2741 7.76013 16.2935 7.83421 16.2836C7.90829 16.2737 7.97585 16.2352 8.02292 16.1761L13.3779 9.44478C13.9847 8.68199 14.3158 7.73033 14.3158 6.74892L14.3158 5.1415C14.3158 4.23242 13.9609 3.36058 13.3292 2.71777C12.6975 2.07496 11.8407 1.71383 10.9474 1.71383L4.21053 1.71383C3.5405 1.71383 2.89793 1.98468 2.42415 2.46679C1.95038 2.94889 1.68421 3.60277 1.68421 4.28458L1.68421 7.71225C1.68421 8.16679 1.86166 8.60271 2.1775 8.92411C2.49335 9.24552 2.92174 9.42608 3.36842 9.42608L8 9.42608C8.28237 9.42608 8.54595 9.5701 8.70195 9.80961C8.85794 10.0491 8.88558 10.3523 8.77555 10.6169L7.11114 14.6201C7 14.8875 6.98105 15.1852 7.05738 15.4649C7.1337 15.7446 7.30079 15.9897 7.53147 16.1605L7.62458 16.2294Z" fill="currentColor"></path></svg></button></div></div></aside></div></div></div></div><!--$--><main class="min-w-0 isolate"><article class="font-normal break-words text-primary dark:text-primary-dark"><div class="ps-0"><div class=""><div class="px-5 sm:px-12 pt-3.5"><div class="max-w-4xl ms-0 2xl:mx-auto"><div class="flex flex-wrap"><div class="flex mb-3 mt-0.5 items-center"><a class="text-link dark:text-link-dark text-sm tracking-wide font-bold uppercase me-1 hover:underline" href="/learn">学习 React</a><span class="inline-block me-1 text-link dark:text-link-dark text-lg rtl:rotate-180"><svg width="20" height="20" viewBox="0 0 20 20" fill="none" xmlns="http://www.w3.org/2000/svg"><path d="M6.86612 13.6161C6.37796 14.1043 6.37796 14.8957 6.86612 15.3839C7.35427 15.872 8.14572 15.872 8.63388 15.3839L13.1339 10.8839C13.622 10.3957 13.622 9.60428 13.1339 9.11612L8.63388 4.61612C8.14572 4.12797 7.35427 4.12797 6.86612 4.61612C6.37796 5.10428 6.37796 5.89573 6.86612 6.38388L10.4822 10L6.86612 13.6161Z" fill="currentColor"></path></svg></span></div><div class="flex mb-3 mt-0.5 items-center"><a class="text-link dark:text-link-dark text-sm tracking-wide font-bold uppercase me-1 hover:underline" href="/learn/escape-hatches">脱围机制</a><span class="inline-block me-1 text-link dark:text-link-dark text-lg rtl:rotate-180"><svg width="20" height="20" viewBox="0 0 20 20" fill="none" xmlns="http://www.w3.org/2000/svg"><path d="M6.86612 13.6161C6.37796 14.1043 6.37796 14.8957 6.86612 15.3839C7.35427 15.872 8.14572 15.872 8.63388 15.3839L13.1339 10.8839C13.622 10.3957 13.622 9.60428 13.1339 9.11612L8.63388 4.61612C8.14572 4.12797 7.35427 4.12797 6.86612 4.61612C6.37796 5.10428 6.37796 5.89573 6.86612 6.38388L10.4822 10L6.86612 13.6161Z" fill="currentColor"></path></svg></span></div></div><h1 class="mdx-heading mt-0 text-primary dark:text-primary-dark -mx-.5 break-words text-5xl font-display font-bold leading-tight">移除 Effect 依赖<a href="#undefined" aria-label="Link for this heading" title="Link for this heading" class="mdx-header-anchor hidden"><svg width="1em" height="1em" viewBox="0 0 13 13" xmlns="http://www.w3.org/2000/svg" class="text-gray-70 ms-2 h-5 w-5"><g fill="currentColor" fill-rule="evenodd"><path d="M7.778 7.975a2.5 2.5 0 0 0 .347-3.837L6.017 2.03a2.498 2.498 0 0 0-3.542-.007 2.5 2.5 0 0 0 .006 3.543l1.153 1.15c.07-.29.154-.563.25-.773.036-.077.084-.16.14-.25L3.18 4.85a1.496 1.496 0 0 1 .002-2.12 1.496 1.496 0 0 1 2.12 0l2.124 2.123a1.496 1.496 0 0 1-.333 2.37c.16.246.42.504.685.752z"></path><path d="M5.657 4.557a2.5 2.5 0 0 0-.347 3.837l2.108 2.108a2.498 2.498 0 0 0 3.542.007 2.5 2.5 0 0 0-.006-3.543L9.802 5.815c-.07.29-.154.565-.25.774-.036.076-.084.16-.14.25l.842.84c.585.587.59 1.532 0 2.122-.587.585-1.532.59-2.12 0L6.008 7.68a1.496 1.496 0 0 1 .332-2.372c-.16-.245-.42-.503-.685-.75z"></path></g></svg></a></h1></div></div></div><div class="px-5 sm:px-12"><div class="max-w-7xl mx-auto"><div class="max-w-4xl ms-0 2xl:mx-auto"><div class="font-display text-xl text-primary dark:text-primary-dark leading-relaxed"><p class="whitespace-pre-wrap my-4">当编写 Effect 时，linter 会验证是否已经将 Effect 读取的每一个响应式值（如 props 和 state）包含在 Effect 的依赖中。这可以确保 Effect 与组件的 props 和 state 保持同步。不必要的依赖可能会导致 Effect 运行过于频繁，甚至产生无限循环。请按照本指南审查并移除 Effect 中不必要的依赖。</p></div>
<div class="p-6 xl:p-8 pb-4 xl:pb-6 bg-card dark:bg-card-dark rounded-2xl shadow-inner-border dark:shadow-inner-border-dark text-base text-secondary dark:text-secondary-dark my-8"><h3 class="mdx-heading text-primary dark:text-primary-dark mt-0 mb-3 leading-tight text-2xl font-display leading-9 text-primary dark:text-primary-dark font-bold my-6">你将会学习到</h3><ul class="ms-6 my-3 list-disc">
<li class="leading-relaxed mb-1">修复无限的 Effect 依赖性循环</li>
<li class="leading-relaxed mb-1">当你想移除依赖时，该怎么做</li>
<li class="leading-relaxed mb-1">从 Effect 中读取值而不对它作出“反应”</li>
<li class="leading-relaxed mb-1">为什么以及如何避免对象和函数的依赖？</li>
<li class="leading-relaxed mb-1">为什么抑制依赖代码检查器的检查是危险的，以及应该如何做？</li>
</ul></div>
<h2 id="dependencies-should-match-the-code" class="mdx-heading text-3xl font-display leading-10 text-primary dark:text-primary-dark font-bold my-6">依赖应该和代码保持一致 <a href="#dependencies-should-match-the-code" aria-label="Link for 依赖应该和代码保持一致 " title="Link for 依赖应该和代码保持一致 " class="mdx-header-anchor inline-block"><svg width="1em" height="1em" viewBox="0 0 13 13" xmlns="http://www.w3.org/2000/svg" class="text-gray-70 ms-2 h-5 w-5"><g fill="currentColor" fill-rule="evenodd"><path d="M7.778 7.975a2.5 2.5 0 0 0 .347-3.837L6.017 2.03a2.498 2.498 0 0 0-3.542-.007 2.5 2.5 0 0 0 .006 3.543l1.153 1.15c.07-.29.154-.563.25-.773.036-.077.084-.16.14-.25L3.18 4.85a1.496 1.496 0 0 1 .002-2.12 1.496 1.496 0 0 1 2.12 0l2.124 2.123a1.496 1.496 0 0 1-.333 2.37c.16.246.42.504.685.752z"></path><path d="M5.657 4.557a2.5 2.5 0 0 0-.347 3.837l2.108 2.108a2.498 2.498 0 0 0 3.542.007 2.5 2.5 0 0 0-.006-3.543L9.802 5.815c-.07.29-.154.565-.25.774-.036.076-.084.16-.14.25l.842.84c.585.587.59 1.532 0 2.122-.587.585-1.532.59-2.12 0L6.008 7.68a1.496 1.496 0 0 1 .332-2.372c-.16-.245-.42-.503-.685-.75z"></path></g></svg></a></h2>
<p class="whitespace-pre-wrap my-4">当你编写 Effect 时，无论这个 Effect 要做什么，你首先要明确其 <a class="inline text-link dark:text-link-dark border-b border-link border-opacity-0 hover:border-opacity-100 duration-100 ease-in transition leading-normal" href="/learn/lifecycle-of-reactive-effects#the-lifecycle-of-an-effect">生命周期</a>：</p>
<!--$--><div dir="ltr" class="sandpack sandpack--codeblock rounded-2xl h-full w-full overflow-x-auto flex items-center bg-wash dark:bg-gray-95 shadow-lg my-8" style="contain:content"><div class="sp-wrapper"><div class="sp-stack"><div class="sp-code-editor"><pre class="sp-cm sp-pristine sp-javascript flex align-start"><code class="sp-pre-placeholder grow-[2]"><div class="cm-line "><span class="sp-syntax-keyword">const</span> <span class="sp-syntax-plain">serverUrl</span> = <span class="sp-syntax-string">&#x27;https://localhost:1234&#x27;</span><span class="sp-syntax-punctuation">;</span><br/></div><div class="cm-line "><br/></div><div class="cm-line "><span class="sp-syntax-keyword">function</span> <span class="sp-syntax-definition">ChatRoom</span><span class="sp-syntax-punctuation">(</span><span class="sp-syntax-punctuation">{</span> <span class="sp-syntax-property">roomId</span> <span class="sp-syntax-punctuation">}</span><span class="sp-syntax-punctuation">)</span> <span class="sp-syntax-punctuation">{</span><br/></div><div class="cm-line ">  <span class="sp-syntax-definition">useEffect</span><span class="sp-syntax-punctuation">(</span><span class="sp-syntax-punctuation">(</span><span class="sp-syntax-punctuation">)</span> <span class="sp-syntax-punctuation">=&gt;</span> <span class="sp-syntax-punctuation">{</span><br/></div><div class="cm-line bg-github-highlight dark:bg-opacity-10">    <span class="sp-syntax-keyword">const</span> <span class="sp-syntax-plain">connection</span> = <span class="sp-syntax-definition">createConnection</span><span class="sp-syntax-punctuation">(</span><span class="sp-syntax-plain">serverUrl</span><span class="sp-syntax-punctuation">,</span> <span class="sp-syntax-plain">roomId</span><span class="sp-syntax-punctuation">)</span><span class="sp-syntax-punctuation">;</span><br/></div><div class="cm-line bg-github-highlight dark:bg-opacity-10">    <span class="sp-syntax-plain">connection</span>.<span class="sp-syntax-property">connect</span><span class="sp-syntax-punctuation">(</span><span class="sp-syntax-punctuation">)</span><span class="sp-syntax-punctuation">;</span><br/></div><div class="cm-line bg-github-highlight dark:bg-opacity-10">    <span class="sp-syntax-keyword">return</span> <span class="sp-syntax-punctuation">(</span><span class="sp-syntax-punctuation">)</span> <span class="sp-syntax-punctuation">=&gt;</span> <span class="sp-syntax-plain">connection</span>.<span class="sp-syntax-property">disconnect</span><span class="sp-syntax-punctuation">(</span><span class="sp-syntax-punctuation">)</span><span class="sp-syntax-punctuation">;</span><br/></div><div class="cm-line ">  	<span class="sp-syntax-comment">// ...</span><br/></div><div class="cm-line "><span class="sp-syntax-punctuation">}</span></div></code></pre></div></div></div></div><!--/$-->
<p class="whitespace-pre-wrap my-4">如果你设置 Effect 的依赖是空数组（<code dir="ltr" class="inline text-code text-secondary dark:text-secondary-dark px-1 rounded-md no-underline bg-gray-30 bg-opacity-10 py-px">[]</code>），那么 linter 将会建议合适的依赖：</p>
</div><!--$--><div class="sandpack sandpack--playground w-full my-8" dir="ltr"><div class="sp-wrapper"><div class="shadow-lg dark:shadow-lg-dark rounded-lg" style="contain:content"><div class="bg-wash dark:bg-card-dark flex justify-between items-center relative z-10 border-b border-border dark:border-border-dark rounded-t-lg text-lg"><div class="flex-1 grow min-w-0 px-4 lg:px-6"><div><div class="relative overflow-hidden"><div class="w-[fit-content] invisible"><div class=" sp-tabs" translate="no"><div aria-label="Select active file" class=" sp-tabs-scrollable-container" role="tablist"><button aria-selected="true" class="  sp-tab-button" data-active="true" role="tab" title="/src/App.js" type="button">App.js</button><button aria-selected="false" class="  sp-tab-button" data-active="false" role="tab" title="/src/chat.js" type="button">chat.js</button></div></div></div><button class="absolute top-0 start-[2px]" id="headlessui-listbox-button-:R9iicq6:" aria-haspopup="true" aria-expanded="false" data-headlessui-state=""><span class="h-full py-2 px-1 mt-px -mb-px flex border-b text-link dark:text-link-dark border-link dark:border-link-dark items-center text-md leading-tight truncate" style="max-width:160px">App.js<span class="ms-2"><svg class="rotate-0" xmlns="http://www.w3.org/2000/svg" width="20" height="20" viewBox="0 0 20 20"><g fill="none" fill-rule="evenodd" transform="translate(-446 -398)"><path fill="currentColor" fill-rule="nonzero" d="M95.8838835,240.366117 C95.3957281,239.877961 94.6042719,239.877961 94.1161165,240.366117 C93.6279612,240.854272 93.6279612,241.645728 94.1161165,242.133883 L98.6161165,246.633883 C99.1042719,247.122039 99.8957281,247.122039 100.383883,246.633883 L104.883883,242.133883 C105.372039,241.645728 105.372039,240.854272 104.883883,240.366117 C104.395728,239.877961 103.604272,239.877961 103.116117,240.366117 L99.5,243.982233 L95.8838835,240.366117 Z" transform="translate(356.5 164.5)"></path><polygon points="446 418 466 418 466 398 446 398"></polygon></g></svg></span></span></button></div></div></div><div class="px-3 flex items-center justify-end text-start" translate="yes"><button class="text-sm text-primary dark:text-primary-dark inline-flex items-center hover:text-link duration-100 ease-in transition mx-1" title="Reset Sandbox" type="button"><svg width="1em" height="1em" viewBox="0 0 24 24" fill="none" xmlns="http://www.w3.org/2000/svg" class="inline mx-1 relative"><path d="M13.8982 5.20844C12.4626 4.88688 10.9686 4.93769 9.55821 5.35604L11.8524 3.06184C11.8989 3.0154 11.9357 2.96028 11.9608 2.89961C11.986 2.83894 11.9989 2.77391 11.9989 2.70824C11.9989 2.64256 11.986 2.57754 11.9608 2.51686C11.9357 2.45619 11.8989 2.40107 11.8524 2.35464L11.1456 1.64784C11.0992 1.60139 11.0441 1.56455 10.9834 1.53942C10.9227 1.51428 10.8577 1.50134 10.792 1.50134C10.7263 1.50134 10.6613 1.51428 10.6006 1.53942C10.54 1.56455 10.4848 1.60139 10.4384 1.64784L6.14571 5.94054C6.00654 6.07969 5.89615 6.2449 5.82083 6.42673C5.74551 6.60855 5.70675 6.80343 5.70675 7.00024C5.70675 7.19704 5.74551 7.39192 5.82083 7.57374C5.89615 7.75557 6.00654 7.92078 6.14571 8.05994L10.4387 12.3529C10.5325 12.4465 10.6595 12.4991 10.792 12.4991C10.9245 12.4991 11.0516 12.4465 11.1453 12.3529L11.8527 11.6455C11.9463 11.5518 11.9989 11.4247 11.9989 11.2922C11.9989 11.1598 11.9463 11.0327 11.8527 10.9389L8.77481 7.86104C9.99795 7.16236 11.415 6.8801 12.8125 7.05678C14.21 7.23347 15.5122 7.85953 16.523 8.84064C17.5338 9.82176 18.1983 11.1048 18.4165 12.4964C18.6347 13.888 18.3947 15.3129 17.7328 16.5562C17.0708 17.7996 16.0227 18.7942 14.7463 19.3902C13.47 19.9861 12.0345 20.1511 10.6563 19.8603C9.27798 19.5695 8.03152 18.8387 7.10469 17.778C6.17786 16.7172 5.62086 15.384 5.51761 13.9791C5.51156 13.8512 5.45689 13.7303 5.36477 13.6413C5.27265 13.5522 5.15001 13.5017 5.02191 13.5H4.02081C3.95297 13.4996 3.88574 13.5129 3.8232 13.5392C3.76065 13.5655 3.70408 13.6042 3.6569 13.6529C3.60972 13.7017 3.57291 13.7595 3.54869 13.8228C3.52448 13.8862 3.51336 13.9538 3.51601 14.0216C3.61349 15.5965 4.1473 17.1132 5.0577 18.4019C5.9681 19.6906 7.21917 20.7006 8.6709 21.3188C10.1226 21.937 11.7178 22.139 13.2778 21.9022C14.8378 21.6654 16.3011 20.9992 17.504 19.978C18.7069 18.9569 19.6019 17.6212 20.0889 16.1203C20.5759 14.6195 20.6356 13.0128 20.2614 11.4799C19.8872 9.94705 19.0938 8.54858 17.97 7.44098C16.8462 6.33339 15.4363 5.56037 13.8982 5.20844V5.20844Z" fill="currentColor"></path></svg> 重置</button><a href="https://codesandbox.io/api/v1/sandboxes/define?undefined&amp;environment=create-react-app" rel="noreferrer noopener" target="_blank" title="Open in CodeSandbox" class="text-sm text-primary dark:text-primary-dark inline-flex items-center hover:text-link duration-100 ease-in transition mx-1 ms-2 md:ms-1"><svg width="1em" height="1em" viewBox="0 0 24 24" fill="none" xmlns="http://www.w3.org/2000/svg" class="inline mx-1 relative top-[1px]"><path d="M20.5001 2H15.5001C15.3675 2 15.2403 2.05268 15.1465 2.14645C15.0528 2.24021 15.0001 2.36739 15.0001 2.5V3.5C15.0001 3.63261 15.0528 3.75979 15.1465 3.85355C15.2403 3.94732 15.3675 4 15.5001 4H18.5901L7.6501 14.94C7.60323 14.9865 7.56604 15.0418 7.54065 15.1027C7.51527 15.1636 7.5022 15.229 7.5022 15.295C7.5022 15.361 7.51527 15.4264 7.54065 15.4873C7.56604 15.5482 7.60323 15.6035 7.6501 15.65L8.3501 16.35C8.39658 16.3969 8.45188 16.4341 8.51281 16.4594C8.57374 16.4848 8.63909 16.4979 8.7051 16.4979C8.7711 16.4979 8.83646 16.4848 8.89738 16.4594C8.95831 16.4341 9.01362 16.3969 9.0601 16.35L20.0001 5.41V8.5C20.0001 8.63261 20.0528 8.75979 20.1465 8.85355C20.2403 8.94732 20.3675 9 20.5001 9H21.5001C21.6327 9 21.7599 8.94732 21.8537 8.85355C21.9474 8.75979 22.0001 8.63261 22.0001 8.5V3.5C22.0001 3.10218 21.8421 2.72064 21.5608 2.43934C21.2795 2.15804 20.8979 2 20.5001 2V2Z" fill="currentColor"></path><path d="M21.5 13H20.5C20.3674 13 20.2402 13.0527 20.1464 13.1464C20.0527 13.2402 20 13.3674 20 13.5V20H4V4H10.5C10.6326 4 10.7598 3.94732 10.8536 3.85355C10.9473 3.75979 11 3.63261 11 3.5V2.5C11 2.36739 10.9473 2.24021 10.8536 2.14645C10.7598 2.05268 10.6326 2 10.5 2H3.5C3.10218 2 2.72064 2.15804 2.43934 2.43934C2.15804 2.72064 2 3.10218 2 3.5V20.5C2 20.8978 2.15804 21.2794 2.43934 21.5607C2.72064 21.842 3.10218 22 3.5 22H20.5C20.8978 22 21.2794 21.842 21.5607 21.5607C21.842 21.2794 22 20.8978 22 20.5V13.5C22 13.3674 21.9473 13.2402 21.8536 13.1464C21.7598 13.0527 21.6326 13 21.5 13Z" fill="currentColor"></path></svg><span class="hidden md:block">Fork</span></a></div></div><div class=" sp-layout"><div class=" sp-editor sp-stack"><div class=" sp-code-editor"><div aria-autocomplete="list" aria-label="Code Editor for App.js" aria-multiline="true" class="sp-pristine sp-javascript   sp-cm" role="textbox" tabindex="0" translate="no"><pre class=" sp-pre-placeholder" style="margin-left:var(--sp-space-11)"><span class="sp-syntax-keyword">import</span> <span class="sp-syntax-punctuation">{</span> <span class="sp-syntax-plain">useState</span><span class="sp-syntax-punctuation">,</span> <span class="sp-syntax-plain">useEffect</span> <span class="sp-syntax-punctuation">}</span> <span class="sp-syntax-keyword">from</span> <span class="sp-syntax-string">&#x27;react&#x27;</span><span class="sp-syntax-punctuation">;</span>
<span class="sp-syntax-keyword">import</span> <span class="sp-syntax-punctuation">{</span> <span class="sp-syntax-plain">createConnection</span> <span class="sp-syntax-punctuation">}</span> <span class="sp-syntax-keyword">from</span> <span class="sp-syntax-string">&#x27;./chat.js&#x27;</span><span class="sp-syntax-punctuation">;</span>

<span class="sp-syntax-keyword">const</span> <span class="sp-syntax-plain">serverUrl</span> = <span class="sp-syntax-string">&#x27;https://localhost:1234&#x27;</span><span class="sp-syntax-punctuation">;</span>

<span class="sp-syntax-keyword">function</span> <span class="sp-syntax-definition">ChatRoom</span><span class="sp-syntax-punctuation">(</span><span class="sp-syntax-punctuation">{</span> <span class="sp-syntax-property">roomId</span> <span class="sp-syntax-punctuation">}</span><span class="sp-syntax-punctuation">)</span> <span class="sp-syntax-punctuation">{</span>
  <span class="sp-syntax-definition">useEffect</span><span class="sp-syntax-punctuation">(</span><span class="sp-syntax-punctuation">(</span><span class="sp-syntax-punctuation">)</span> <span class="sp-syntax-punctuation">=&gt;</span> <span class="sp-syntax-punctuation">{</span>
    <span class="sp-syntax-keyword">const</span> <span class="sp-syntax-plain">connection</span> = <span class="sp-syntax-definition">createConnection</span><span class="sp-syntax-punctuation">(</span><span class="sp-syntax-plain">serverUrl</span><span class="sp-syntax-punctuation">,</span> <span class="sp-syntax-plain">roomId</span><span class="sp-syntax-punctuation">)</span><span class="sp-syntax-punctuation">;</span>
    <span class="sp-syntax-plain">connection</span>.<span class="sp-syntax-property">connect</span><span class="sp-syntax-punctuation">(</span><span class="sp-syntax-punctuation">)</span><span class="sp-syntax-punctuation">;</span>
    <span class="sp-syntax-keyword">return</span> <span class="sp-syntax-punctuation">(</span><span class="sp-syntax-punctuation">)</span> <span class="sp-syntax-punctuation">=&gt;</span> <span class="sp-syntax-plain">connection</span>.<span class="sp-syntax-property">disconnect</span><span class="sp-syntax-punctuation">(</span><span class="sp-syntax-punctuation">)</span><span class="sp-syntax-punctuation">;</span>
  <span class="sp-syntax-punctuation">}</span><span class="sp-syntax-punctuation">,</span> <span class="sp-syntax-punctuation">[</span><span class="sp-syntax-punctuation">]</span><span class="sp-syntax-punctuation">)</span><span class="sp-syntax-punctuation">;</span> <span class="sp-syntax-comment">// &lt;-- 修复这里的依赖！</span>
  <span class="sp-syntax-keyword">return</span> <span class="sp-syntax-punctuation">&lt;</span><span class="sp-syntax-tag">h1</span><span class="sp-syntax-punctuation">&gt;</span>欢迎来到 <span class="sp-syntax-punctuation">{</span><span class="sp-syntax-plain">roomId</span><span class="sp-syntax-punctuation">}</span> 房间！<span class="sp-syntax-punctuation">&lt;/</span><span class="sp-syntax-tag">h1</span><span class="sp-syntax-punctuation">&gt;</span><span class="sp-syntax-punctuation">;</span>
<span class="sp-syntax-punctuation">}</span>

<span class="sp-syntax-keyword">export</span> <span class="sp-syntax-keyword">default</span> <span class="sp-syntax-keyword">function</span> <span class="sp-syntax-definition">App</span><span class="sp-syntax-punctuation">(</span><span class="sp-syntax-punctuation">)</span> <span class="sp-syntax-punctuation">{</span>
  <span class="sp-syntax-keyword">const</span> <span class="sp-syntax-punctuation">[</span><span class="sp-syntax-plain">roomId</span><span class="sp-syntax-punctuation">,</span> <span class="sp-syntax-plain">setRoomId</span><span class="sp-syntax-punctuation">]</span> = <span class="sp-syntax-definition">useState</span><span class="sp-syntax-punctuation">(</span><span class="sp-syntax-string">&#x27;所有&#x27;</span><span class="sp-syntax-punctuation">)</span><span class="sp-syntax-punctuation">;</span>
  <span class="sp-syntax-keyword">return</span> <span class="sp-syntax-punctuation">(</span>
    <span class="sp-syntax-punctuation">&lt;</span><span class="sp-syntax-punctuation">&gt;</span>
      <span class="sp-syntax-punctuation">&lt;</span><span class="sp-syntax-tag">label</span><span class="sp-syntax-punctuation">&gt;</span>
        选择聊天室：
        <span class="sp-syntax-punctuation">&lt;</span><span class="sp-syntax-tag">select</span>
          <span class="sp-syntax-property">value</span>=<span class="sp-syntax-punctuation">{</span><span class="sp-syntax-plain">roomId</span><span class="sp-syntax-punctuation">}</span>
          <span class="sp-syntax-property">onChange</span>=<span class="sp-syntax-punctuation">{</span><span class="sp-syntax-plain">e</span> <span class="sp-syntax-punctuation">=&gt;</span> <span class="sp-syntax-definition">setRoomId</span><span class="sp-syntax-punctuation">(</span><span class="sp-syntax-plain">e</span>.<span class="sp-syntax-property">target</span>.<span class="sp-syntax-property">value</span><span class="sp-syntax-punctuation">)</span><span class="sp-syntax-punctuation">}</span>
        <span class="sp-syntax-punctuation">&gt;</span>
          <span class="sp-syntax-punctuation">&lt;</span><span class="sp-syntax-tag">option</span> <span class="sp-syntax-property">value</span>=<span class="sp-syntax-string">&quot;所有&quot;</span><span class="sp-syntax-punctuation">&gt;</span>所有<span class="sp-syntax-punctuation">&lt;/</span><span class="sp-syntax-tag">option</span><span class="sp-syntax-punctuation">&gt;</span>
          <span class="sp-syntax-punctuation">&lt;</span><span class="sp-syntax-tag">option</span> <span class="sp-syntax-property">value</span>=<span class="sp-syntax-string">&quot;旅游&quot;</span><span class="sp-syntax-punctuation">&gt;</span>旅游<span class="sp-syntax-punctuation">&lt;/</span><span class="sp-syntax-tag">option</span><span class="sp-syntax-punctuation">&gt;</span>
          <span class="sp-syntax-punctuation">&lt;</span><span class="sp-syntax-tag">option</span> <span class="sp-syntax-property">value</span>=<span class="sp-syntax-string">&quot;音乐&quot;</span><span class="sp-syntax-punctuation">&gt;</span>音乐<span class="sp-syntax-punctuation">&lt;/</span><span class="sp-syntax-tag">option</span><span class="sp-syntax-punctuation">&gt;</span>
        <span class="sp-syntax-punctuation">&lt;/</span><span class="sp-syntax-tag">select</span><span class="sp-syntax-punctuation">&gt;</span>
      <span class="sp-syntax-punctuation">&lt;/</span><span class="sp-syntax-tag">label</span><span class="sp-syntax-punctuation">&gt;</span>
      <span class="sp-syntax-punctuation">&lt;</span><span class="sp-syntax-tag">hr</span> <span class="sp-syntax-punctuation">/&gt;</span>
      <span class="sp-syntax-punctuation">&lt;</span><span class="sp-syntax-definition">ChatRoom</span> <span class="sp-syntax-property">roomId</span>=<span class="sp-syntax-punctuation">{</span><span class="sp-syntax-plain">roomId</span><span class="sp-syntax-punctuation">}</span> <span class="sp-syntax-punctuation">/&gt;</span>
    <span class="sp-syntax-punctuation">&lt;/</span><span class="sp-syntax-punctuation">&gt;</span>
  <span class="sp-syntax-punctuation">)</span><span class="sp-syntax-punctuation">;</span>
<span class="sp-syntax-punctuation">}</span>

</pre></div></div></div><div class=" order-last xl:order-2 sp-stack"><div class="p-0 sm:p-2 md:p-4 lg:p-8 bg-card dark:bg-wash-dark h-full relative md:rounded-b-lg lg:rounded-b-none"><div style="position:relative"><iframe class="rounded-t-none bg-white md:shadow-md sm:rounded-lg w-full max-w-full transition-opacity absolute opacity-0 pointer-events-none duration-75" title="Sandbox Preview" style="height:15px;z-index:-1"></iframe></div></div></div><button translate="yes" class="sandpack-expand flex text-base justify-between dark:border-card-dark bg-wash dark:bg-card-dark items-center z-10 p-1 w-full order-2 xl:order-last border-b-1 relative top-0"><span class="flex p-2 focus:outline-none text-primary dark:text-primary-dark leading-[20px]"><svg class="rotate-0 inline me-1.5 text-xl" xmlns="http://www.w3.org/2000/svg" width="20" height="20" viewBox="0 0 20 20"><g fill="none" fill-rule="evenodd" transform="translate(-446 -398)"><path fill="currentColor" fill-rule="nonzero" d="M95.8838835,240.366117 C95.3957281,239.877961 94.6042719,239.877961 94.1161165,240.366117 C93.6279612,240.854272 93.6279612,241.645728 94.1161165,242.133883 L98.6161165,246.633883 C99.1042719,247.122039 99.8957281,247.122039 100.383883,246.633883 L104.883883,242.133883 C105.372039,241.645728 105.372039,240.854272 104.883883,240.366117 C104.395728,239.877961 103.604272,239.877961 103.116117,240.366117 L99.5,243.982233 L95.8838835,240.366117 Z" transform="translate(356.5 164.5)"></path><polygon points="446 418 466 418 466 398 446 398"></polygon></g></svg>显示更多</span></button></div></div></div></div><!--/$--><div class="max-w-4xl ms-0 2xl:mx-auto">
<p class="whitespace-pre-wrap my-4">按照 linter 的建议，把它们填进去：</p>
<!--$--><div dir="ltr" class="sandpack sandpack--codeblock rounded-2xl h-full w-full overflow-x-auto flex items-center bg-wash dark:bg-gray-95 shadow-lg my-8" style="contain:content"><div class="sp-wrapper"><div class="sp-stack"><div class="sp-code-editor"><pre class="sp-cm sp-pristine sp-javascript flex align-start"><code class="sp-pre-placeholder grow-[2]"><div class="cm-line "><span class="sp-syntax-keyword">function</span> <span class="sp-syntax-definition">ChatRoom</span><span class="sp-syntax-punctuation">(</span><span class="sp-syntax-punctuation">{</span> <span class="sp-syntax-property">roomId</span> <span class="sp-syntax-punctuation">}</span><span class="sp-syntax-punctuation">)</span> <span class="sp-syntax-punctuation">{</span><br/></div><div class="cm-line ">  <span class="sp-syntax-definition">useEffect</span><span class="sp-syntax-punctuation">(</span><span class="sp-syntax-punctuation">(</span><span class="sp-syntax-punctuation">)</span> <span class="sp-syntax-punctuation">=&gt;</span> <span class="sp-syntax-punctuation">{</span><br/></div><div class="cm-line ">    <span class="sp-syntax-keyword">const</span> <span class="sp-syntax-plain">connection</span> = <span class="sp-syntax-definition">createConnection</span><span class="sp-syntax-punctuation">(</span><span class="sp-syntax-plain">serverUrl</span><span class="sp-syntax-punctuation">,</span> <span class="sp-syntax-plain">roomId</span><span class="sp-syntax-punctuation">)</span><span class="sp-syntax-punctuation">;</span><br/></div><div class="cm-line ">    <span class="sp-syntax-plain">connection</span>.<span class="sp-syntax-property">connect</span><span class="sp-syntax-punctuation">(</span><span class="sp-syntax-punctuation">)</span><span class="sp-syntax-punctuation">;</span><br/></div><div class="cm-line ">    <span class="sp-syntax-keyword">return</span> <span class="sp-syntax-punctuation">(</span><span class="sp-syntax-punctuation">)</span> <span class="sp-syntax-punctuation">=&gt;</span> <span class="sp-syntax-plain">connection</span>.<span class="sp-syntax-property">disconnect</span><span class="sp-syntax-punctuation">(</span><span class="sp-syntax-punctuation">)</span><span class="sp-syntax-punctuation">;</span><br/></div><div class="cm-line bg-github-highlight dark:bg-opacity-10">  <span class="sp-syntax-punctuation">}</span><span class="sp-syntax-punctuation">,</span> <span class="sp-syntax-punctuation">[</span><span class="sp-syntax-plain">roomId</span><span class="sp-syntax-punctuation">]</span><span class="sp-syntax-punctuation">)</span><span class="sp-syntax-punctuation">;</span> <span class="sp-syntax-comment">// ✅ 所有依赖已声明</span><br/></div><div class="cm-line ">  <span class="sp-syntax-comment">// ...</span><br/></div><div class="cm-line "><span class="sp-syntax-punctuation">}</span></div></code></pre></div></div></div></div><!--/$-->
<p class="whitespace-pre-wrap my-4"><a class="inline text-link dark:text-link-dark border-b border-link border-opacity-0 hover:border-opacity-100 duration-100 ease-in transition leading-normal" href="/learn/lifecycle-of-reactive-effects#effects-react-to-reactive-values">Effect “反应”响应式值</a> 因为这里的 <code dir="ltr" class="inline text-code text-secondary dark:text-secondary-dark px-1 rounded-md no-underline bg-gray-30 bg-opacity-10 py-px">roomId</code> 是一个响应式值（它可能随重新渲染而改变），所以 linter 会验证你是否将它指定为依赖。如果 <code dir="ltr" class="inline text-code text-secondary dark:text-secondary-dark px-1 rounded-md no-underline bg-gray-30 bg-opacity-10 py-px">roomId</code> 变成不同的值，React 将重新运行 Effect。这可以确保聊天界面与所选房间保持一致，并把变化“反馈”给下拉菜单：</p>
</div><!--$--><div class="sandpack sandpack--playground w-full my-8" dir="ltr"><div class="sp-wrapper"><div class="shadow-lg dark:shadow-lg-dark rounded-lg" style="contain:content"><div class="bg-wash dark:bg-card-dark flex justify-between items-center relative z-10 border-b border-border dark:border-border-dark rounded-t-lg text-lg"><div class="flex-1 grow min-w-0 px-4 lg:px-6"><div><div class="relative overflow-hidden"><div class="w-[fit-content] invisible"><div class=" sp-tabs" translate="no"><div aria-label="Select active file" class=" sp-tabs-scrollable-container" role="tablist"><button aria-selected="true" class="  sp-tab-button" data-active="true" role="tab" title="/src/App.js" type="button">App.js</button><button aria-selected="false" class="  sp-tab-button" data-active="false" role="tab" title="/src/chat.js" type="button">chat.js</button></div></div></div><button class="absolute top-0 start-[2px]" id="headlessui-listbox-button-:R9ikcq6:" aria-haspopup="true" aria-expanded="false" data-headlessui-state=""><span class="h-full py-2 px-1 mt-px -mb-px flex border-b text-link dark:text-link-dark border-link dark:border-link-dark items-center text-md leading-tight truncate" style="max-width:160px">App.js<span class="ms-2"><svg class="rotate-0" xmlns="http://www.w3.org/2000/svg" width="20" height="20" viewBox="0 0 20 20"><g fill="none" fill-rule="evenodd" transform="translate(-446 -398)"><path fill="currentColor" fill-rule="nonzero" d="M95.8838835,240.366117 C95.3957281,239.877961 94.6042719,239.877961 94.1161165,240.366117 C93.6279612,240.854272 93.6279612,241.645728 94.1161165,242.133883 L98.6161165,246.633883 C99.1042719,247.122039 99.8957281,247.122039 100.383883,246.633883 L104.883883,242.133883 C105.372039,241.645728 105.372039,240.854272 104.883883,240.366117 C104.395728,239.877961 103.604272,239.877961 103.116117,240.366117 L99.5,243.982233 L95.8838835,240.366117 Z" transform="translate(356.5 164.5)"></path><polygon points="446 418 466 418 466 398 446 398"></polygon></g></svg></span></span></button></div></div></div><div class="px-3 flex items-center justify-end text-start" translate="yes"><button class="text-sm text-primary dark:text-primary-dark inline-flex items-center hover:text-link duration-100 ease-in transition mx-1" title="Reset Sandbox" type="button"><svg width="1em" height="1em" viewBox="0 0 24 24" fill="none" xmlns="http://www.w3.org/2000/svg" class="inline mx-1 relative"><path d="M13.8982 5.20844C12.4626 4.88688 10.9686 4.93769 9.55821 5.35604L11.8524 3.06184C11.8989 3.0154 11.9357 2.96028 11.9608 2.89961C11.986 2.83894 11.9989 2.77391 11.9989 2.70824C11.9989 2.64256 11.986 2.57754 11.9608 2.51686C11.9357 2.45619 11.8989 2.40107 11.8524 2.35464L11.1456 1.64784C11.0992 1.60139 11.0441 1.56455 10.9834 1.53942C10.9227 1.51428 10.8577 1.50134 10.792 1.50134C10.7263 1.50134 10.6613 1.51428 10.6006 1.53942C10.54 1.56455 10.4848 1.60139 10.4384 1.64784L6.14571 5.94054C6.00654 6.07969 5.89615 6.2449 5.82083 6.42673C5.74551 6.60855 5.70675 6.80343 5.70675 7.00024C5.70675 7.19704 5.74551 7.39192 5.82083 7.57374C5.89615 7.75557 6.00654 7.92078 6.14571 8.05994L10.4387 12.3529C10.5325 12.4465 10.6595 12.4991 10.792 12.4991C10.9245 12.4991 11.0516 12.4465 11.1453 12.3529L11.8527 11.6455C11.9463 11.5518 11.9989 11.4247 11.9989 11.2922C11.9989 11.1598 11.9463 11.0327 11.8527 10.9389L8.77481 7.86104C9.99795 7.16236 11.415 6.8801 12.8125 7.05678C14.21 7.23347 15.5122 7.85953 16.523 8.84064C17.5338 9.82176 18.1983 11.1048 18.4165 12.4964C18.6347 13.888 18.3947 15.3129 17.7328 16.5562C17.0708 17.7996 16.0227 18.7942 14.7463 19.3902C13.47 19.9861 12.0345 20.1511 10.6563 19.8603C9.27798 19.5695 8.03152 18.8387 7.10469 17.778C6.17786 16.7172 5.62086 15.384 5.51761 13.9791C5.51156 13.8512 5.45689 13.7303 5.36477 13.6413C5.27265 13.5522 5.15001 13.5017 5.02191 13.5H4.02081C3.95297 13.4996 3.88574 13.5129 3.8232 13.5392C3.76065 13.5655 3.70408 13.6042 3.6569 13.6529C3.60972 13.7017 3.57291 13.7595 3.54869 13.8228C3.52448 13.8862 3.51336 13.9538 3.51601 14.0216C3.61349 15.5965 4.1473 17.1132 5.0577 18.4019C5.9681 19.6906 7.21917 20.7006 8.6709 21.3188C10.1226 21.937 11.7178 22.139 13.2778 21.9022C14.8378 21.6654 16.3011 20.9992 17.504 19.978C18.7069 18.9569 19.6019 17.6212 20.0889 16.1203C20.5759 14.6195 20.6356 13.0128 20.2614 11.4799C19.8872 9.94705 19.0938 8.54858 17.97 7.44098C16.8462 6.33339 15.4363 5.56037 13.8982 5.20844V5.20844Z" fill="currentColor"></path></svg> 重置</button><a href="https://codesandbox.io/api/v1/sandboxes/define?undefined&amp;environment=create-react-app" rel="noreferrer noopener" target="_blank" title="Open in CodeSandbox" class="text-sm text-primary dark:text-primary-dark inline-flex items-center hover:text-link duration-100 ease-in transition mx-1 ms-2 md:ms-1"><svg width="1em" height="1em" viewBox="0 0 24 24" fill="none" xmlns="http://www.w3.org/2000/svg" class="inline mx-1 relative top-[1px]"><path d="M20.5001 2H15.5001C15.3675 2 15.2403 2.05268 15.1465 2.14645C15.0528 2.24021 15.0001 2.36739 15.0001 2.5V3.5C15.0001 3.63261 15.0528 3.75979 15.1465 3.85355C15.2403 3.94732 15.3675 4 15.5001 4H18.5901L7.6501 14.94C7.60323 14.9865 7.56604 15.0418 7.54065 15.1027C7.51527 15.1636 7.5022 15.229 7.5022 15.295C7.5022 15.361 7.51527 15.4264 7.54065 15.4873C7.56604 15.5482 7.60323 15.6035 7.6501 15.65L8.3501 16.35C8.39658 16.3969 8.45188 16.4341 8.51281 16.4594C8.57374 16.4848 8.63909 16.4979 8.7051 16.4979C8.7711 16.4979 8.83646 16.4848 8.89738 16.4594C8.95831 16.4341 9.01362 16.3969 9.0601 16.35L20.0001 5.41V8.5C20.0001 8.63261 20.0528 8.75979 20.1465 8.85355C20.2403 8.94732 20.3675 9 20.5001 9H21.5001C21.6327 9 21.7599 8.94732 21.8537 8.85355C21.9474 8.75979 22.0001 8.63261 22.0001 8.5V3.5C22.0001 3.10218 21.8421 2.72064 21.5608 2.43934C21.2795 2.15804 20.8979 2 20.5001 2V2Z" fill="currentColor"></path><path d="M21.5 13H20.5C20.3674 13 20.2402 13.0527 20.1464 13.1464C20.0527 13.2402 20 13.3674 20 13.5V20H4V4H10.5C10.6326 4 10.7598 3.94732 10.8536 3.85355C10.9473 3.75979 11 3.63261 11 3.5V2.5C11 2.36739 10.9473 2.24021 10.8536 2.14645C10.7598 2.05268 10.6326 2 10.5 2H3.5C3.10218 2 2.72064 2.15804 2.43934 2.43934C2.15804 2.72064 2 3.10218 2 3.5V20.5C2 20.8978 2.15804 21.2794 2.43934 21.5607C2.72064 21.842 3.10218 22 3.5 22H20.5C20.8978 22 21.2794 21.842 21.5607 21.5607C21.842 21.2794 22 20.8978 22 20.5V13.5C22 13.3674 21.9473 13.2402 21.8536 13.1464C21.7598 13.0527 21.6326 13 21.5 13Z" fill="currentColor"></path></svg><span class="hidden md:block">Fork</span></a></div></div><div class=" sp-layout"><div class=" sp-editor sp-stack"><div class=" sp-code-editor"><div aria-autocomplete="list" aria-label="Code Editor for App.js" aria-multiline="true" class="sp-pristine sp-javascript   sp-cm" role="textbox" tabindex="0" translate="no"><pre class=" sp-pre-placeholder" style="margin-left:var(--sp-space-11)"><span class="sp-syntax-keyword">import</span> <span class="sp-syntax-punctuation">{</span> <span class="sp-syntax-plain">useState</span><span class="sp-syntax-punctuation">,</span> <span class="sp-syntax-plain">useEffect</span> <span class="sp-syntax-punctuation">}</span> <span class="sp-syntax-keyword">from</span> <span class="sp-syntax-string">&#x27;react&#x27;</span><span class="sp-syntax-punctuation">;</span>
<span class="sp-syntax-keyword">import</span> <span class="sp-syntax-punctuation">{</span> <span class="sp-syntax-plain">createConnection</span> <span class="sp-syntax-punctuation">}</span> <span class="sp-syntax-keyword">from</span> <span class="sp-syntax-string">&#x27;./chat.js&#x27;</span><span class="sp-syntax-punctuation">;</span>

<span class="sp-syntax-keyword">const</span> <span class="sp-syntax-plain">serverUrl</span> = <span class="sp-syntax-string">&#x27;https://localhost:1234&#x27;</span><span class="sp-syntax-punctuation">;</span>

<span class="sp-syntax-keyword">function</span> <span class="sp-syntax-definition">ChatRoom</span><span class="sp-syntax-punctuation">(</span><span class="sp-syntax-punctuation">{</span> <span class="sp-syntax-property">roomId</span> <span class="sp-syntax-punctuation">}</span><span class="sp-syntax-punctuation">)</span> <span class="sp-syntax-punctuation">{</span>
  <span class="sp-syntax-definition">useEffect</span><span class="sp-syntax-punctuation">(</span><span class="sp-syntax-punctuation">(</span><span class="sp-syntax-punctuation">)</span> <span class="sp-syntax-punctuation">=&gt;</span> <span class="sp-syntax-punctuation">{</span>
    <span class="sp-syntax-keyword">const</span> <span class="sp-syntax-plain">connection</span> = <span class="sp-syntax-definition">createConnection</span><span class="sp-syntax-punctuation">(</span><span class="sp-syntax-plain">serverUrl</span><span class="sp-syntax-punctuation">,</span> <span class="sp-syntax-plain">roomId</span><span class="sp-syntax-punctuation">)</span><span class="sp-syntax-punctuation">;</span>
    <span class="sp-syntax-plain">connection</span>.<span class="sp-syntax-property">connect</span><span class="sp-syntax-punctuation">(</span><span class="sp-syntax-punctuation">)</span><span class="sp-syntax-punctuation">;</span>
    <span class="sp-syntax-keyword">return</span> <span class="sp-syntax-punctuation">(</span><span class="sp-syntax-punctuation">)</span> <span class="sp-syntax-punctuation">=&gt;</span> <span class="sp-syntax-plain">connection</span>.<span class="sp-syntax-property">disconnect</span><span class="sp-syntax-punctuation">(</span><span class="sp-syntax-punctuation">)</span><span class="sp-syntax-punctuation">;</span>
  <span class="sp-syntax-punctuation">}</span><span class="sp-syntax-punctuation">,</span> <span class="sp-syntax-punctuation">[</span><span class="sp-syntax-plain">roomId</span><span class="sp-syntax-punctuation">]</span><span class="sp-syntax-punctuation">)</span><span class="sp-syntax-punctuation">;</span>
  <span class="sp-syntax-keyword">return</span> <span class="sp-syntax-punctuation">&lt;</span><span class="sp-syntax-tag">h1</span><span class="sp-syntax-punctuation">&gt;</span>欢迎来到 <span class="sp-syntax-punctuation">{</span><span class="sp-syntax-plain">roomId</span><span class="sp-syntax-punctuation">}</span> 房间！<span class="sp-syntax-punctuation">&lt;/</span><span class="sp-syntax-tag">h1</span><span class="sp-syntax-punctuation">&gt;</span><span class="sp-syntax-punctuation">;</span>
<span class="sp-syntax-punctuation">}</span>

<span class="sp-syntax-keyword">export</span> <span class="sp-syntax-keyword">default</span> <span class="sp-syntax-keyword">function</span> <span class="sp-syntax-definition">App</span><span class="sp-syntax-punctuation">(</span><span class="sp-syntax-punctuation">)</span> <span class="sp-syntax-punctuation">{</span>
  <span class="sp-syntax-keyword">const</span> <span class="sp-syntax-punctuation">[</span><span class="sp-syntax-plain">roomId</span><span class="sp-syntax-punctuation">,</span> <span class="sp-syntax-plain">setRoomId</span><span class="sp-syntax-punctuation">]</span> = <span class="sp-syntax-definition">useState</span><span class="sp-syntax-punctuation">(</span><span class="sp-syntax-string">&#x27;所有&#x27;</span><span class="sp-syntax-punctuation">)</span><span class="sp-syntax-punctuation">;</span>
  <span class="sp-syntax-keyword">return</span> <span class="sp-syntax-punctuation">(</span>
    <span class="sp-syntax-punctuation">&lt;</span><span class="sp-syntax-punctuation">&gt;</span>
      <span class="sp-syntax-punctuation">&lt;</span><span class="sp-syntax-tag">label</span><span class="sp-syntax-punctuation">&gt;</span>
        选择聊天室：
        <span class="sp-syntax-punctuation">&lt;</span><span class="sp-syntax-tag">select</span>
          <span class="sp-syntax-property">value</span>=<span class="sp-syntax-punctuation">{</span><span class="sp-syntax-plain">roomId</span><span class="sp-syntax-punctuation">}</span>
          <span class="sp-syntax-property">onChange</span>=<span class="sp-syntax-punctuation">{</span><span class="sp-syntax-plain">e</span> <span class="sp-syntax-punctuation">=&gt;</span> <span class="sp-syntax-definition">setRoomId</span><span class="sp-syntax-punctuation">(</span><span class="sp-syntax-plain">e</span>.<span class="sp-syntax-property">target</span>.<span class="sp-syntax-property">value</span><span class="sp-syntax-punctuation">)</span><span class="sp-syntax-punctuation">}</span>
        <span class="sp-syntax-punctuation">&gt;</span>
          <span class="sp-syntax-punctuation">&lt;</span><span class="sp-syntax-tag">option</span> <span class="sp-syntax-property">value</span>=<span class="sp-syntax-string">&quot;所有&quot;</span><span class="sp-syntax-punctuation">&gt;</span>所有<span class="sp-syntax-punctuation">&lt;/</span><span class="sp-syntax-tag">option</span><span class="sp-syntax-punctuation">&gt;</span>
          <span class="sp-syntax-punctuation">&lt;</span><span class="sp-syntax-tag">option</span> <span class="sp-syntax-property">value</span>=<span class="sp-syntax-string">&quot;旅游&quot;</span><span class="sp-syntax-punctuation">&gt;</span>旅游<span class="sp-syntax-punctuation">&lt;/</span><span class="sp-syntax-tag">option</span><span class="sp-syntax-punctuation">&gt;</span>
          <span class="sp-syntax-punctuation">&lt;</span><span class="sp-syntax-tag">option</span> <span class="sp-syntax-property">value</span>=<span class="sp-syntax-string">&quot;音乐&quot;</span><span class="sp-syntax-punctuation">&gt;</span>音乐<span class="sp-syntax-punctuation">&lt;/</span><span class="sp-syntax-tag">option</span><span class="sp-syntax-punctuation">&gt;</span>
        <span class="sp-syntax-punctuation">&lt;/</span><span class="sp-syntax-tag">select</span><span class="sp-syntax-punctuation">&gt;</span>
      <span class="sp-syntax-punctuation">&lt;/</span><span class="sp-syntax-tag">label</span><span class="sp-syntax-punctuation">&gt;</span>
      <span class="sp-syntax-punctuation">&lt;</span><span class="sp-syntax-tag">hr</span> <span class="sp-syntax-punctuation">/&gt;</span>
      <span class="sp-syntax-punctuation">&lt;</span><span class="sp-syntax-definition">ChatRoom</span> <span class="sp-syntax-property">roomId</span>=<span class="sp-syntax-punctuation">{</span><span class="sp-syntax-plain">roomId</span><span class="sp-syntax-punctuation">}</span> <span class="sp-syntax-punctuation">/&gt;</span>
    <span class="sp-syntax-punctuation">&lt;/</span><span class="sp-syntax-punctuation">&gt;</span>
  <span class="sp-syntax-punctuation">)</span><span class="sp-syntax-punctuation">;</span>
<span class="sp-syntax-punctuation">}</span>

</pre></div></div></div><div class=" order-last xl:order-2 sp-stack"><div class="p-0 sm:p-2 md:p-4 lg:p-8 bg-card dark:bg-wash-dark h-full relative md:rounded-b-lg lg:rounded-b-none"><div style="position:relative"><iframe class="rounded-t-none bg-white md:shadow-md sm:rounded-lg w-full max-w-full transition-opacity absolute opacity-0 pointer-events-none duration-75" title="Sandbox Preview" style="height:15px;z-index:-1"></iframe></div></div></div><button translate="yes" class="sandpack-expand flex text-base justify-between dark:border-card-dark bg-wash dark:bg-card-dark items-center z-10 p-1 w-full order-2 xl:order-last border-b-1 relative top-0"><span class="flex p-2 focus:outline-none text-primary dark:text-primary-dark leading-[20px]"><svg class="rotate-0 inline me-1.5 text-xl" xmlns="http://www.w3.org/2000/svg" width="20" height="20" viewBox="0 0 20 20"><g fill="none" fill-rule="evenodd" transform="translate(-446 -398)"><path fill="currentColor" fill-rule="nonzero" d="M95.8838835,240.366117 C95.3957281,239.877961 94.6042719,239.877961 94.1161165,240.366117 C93.6279612,240.854272 93.6279612,241.645728 94.1161165,242.133883 L98.6161165,246.633883 C99.1042719,247.122039 99.8957281,247.122039 100.383883,246.633883 L104.883883,242.133883 C105.372039,241.645728 105.372039,240.854272 104.883883,240.366117 C104.395728,239.877961 103.604272,239.877961 103.116117,240.366117 L99.5,243.982233 L95.8838835,240.366117 Z" transform="translate(356.5 164.5)"></path><polygon points="446 418 466 418 466 398 446 398"></polygon></g></svg>显示更多</span></button></div></div></div></div><!--/$--><div class="max-w-4xl ms-0 2xl:mx-auto">
<h3 id="to-remove-a-dependency-prove-that-its-not-a-dependency" class="mdx-heading text-2xl font-display leading-9 text-primary dark:text-primary-dark font-bold my-6">当要移除一个依赖时，请证明它不是一个依赖 <a href="#to-remove-a-dependency-prove-that-its-not-a-dependency" aria-label="Link for 当要移除一个依赖时，请证明它不是一个依赖 " title="Link for 当要移除一个依赖时，请证明它不是一个依赖 " class="mdx-header-anchor inline-block"><svg width="1em" height="1em" viewBox="0 0 13 13" xmlns="http://www.w3.org/2000/svg" class="text-gray-70 ms-2 h-5 w-5"><g fill="currentColor" fill-rule="evenodd"><path d="M7.778 7.975a2.5 2.5 0 0 0 .347-3.837L6.017 2.03a2.498 2.498 0 0 0-3.542-.007 2.5 2.5 0 0 0 .006 3.543l1.153 1.15c.07-.29.154-.563.25-.773.036-.077.084-.16.14-.25L3.18 4.85a1.496 1.496 0 0 1 .002-2.12 1.496 1.496 0 0 1 2.12 0l2.124 2.123a1.496 1.496 0 0 1-.333 2.37c.16.246.42.504.685.752z"></path><path d="M5.657 4.557a2.5 2.5 0 0 0-.347 3.837l2.108 2.108a2.498 2.498 0 0 0 3.542.007 2.5 2.5 0 0 0-.006-3.543L9.802 5.815c-.07.29-.154.565-.25.774-.036.076-.084.16-.14.25l.842.84c.585.587.59 1.532 0 2.122-.587.585-1.532.59-2.12 0L6.008 7.68a1.496 1.496 0 0 1 .332-2.372c-.16-.245-.42-.503-.685-.75z"></path></g></svg></a></h3>
<p class="whitespace-pre-wrap my-4">注意，你不能“选择” Effect 的依赖。每个被 Effect 所使用的<span data-step="2" class="code-step bg-opacity-10 dark:bg-opacity-20 relative rounded px-[6px] py-[1.5px] border-b-[2px] border-opacity-60 bg-yellow-40 border-yellow-40 text-yellow-60 dark:text-yellow-30">响应式值</span>，必须在依赖中声明。依赖是由 Effect 的代码决定的：</p>
<!--$--><div dir="ltr" class="sandpack sandpack--codeblock rounded-2xl h-full w-full overflow-x-auto flex items-center bg-wash dark:bg-gray-95 shadow-lg my-8" style="contain:content"><div class="sp-wrapper"><div class="sp-stack"><div class="sp-code-editor"><pre class="sp-cm sp-pristine sp-javascript flex align-start"><code class="sp-pre-placeholder grow-[2]"><div class="cm-line "><span class="sp-syntax-keyword">const</span> <span class="sp-syntax-plain">serverUrl</span> = <span class="sp-syntax-string">&#x27;https://localhost:1234&#x27;</span><span class="sp-syntax-punctuation">;</span><br/></div><div class="cm-line "><br/></div><div class="cm-line "><span class="sp-syntax-keyword">function</span> <span class="sp-syntax-definition">ChatRoom</span><span class="sp-syntax-punctuation">(</span><span class="sp-syntax-punctuation">{</span> <span class="code-step bg-opacity-10 dark:bg-opacity-20 relative rounded px-1 py-[1.5px] border-b-[2px] border-opacity-60 bg-yellow-40 border-yellow-40 text-yellow-60 dark:text-yellow-30">roomId</span> <span class="sp-syntax-punctuation">}</span><span class="sp-syntax-punctuation">)</span> <span class="sp-syntax-punctuation">{</span> <span class="sp-syntax-comment">// 这是一个响应式值</span><br/></div><div class="cm-line ">  <span class="sp-syntax-definition">useEffect</span><span class="sp-syntax-punctuation">(</span><span class="sp-syntax-punctuation">(</span><span class="sp-syntax-punctuation">)</span> <span class="sp-syntax-punctuation">=&gt;</span> <span class="sp-syntax-punctuation">{</span><br/></div><div class="cm-line ">    <span class="sp-syntax-keyword">const</span> <span class="sp-syntax-plain">connection</span> = <span class="sp-syntax-definition">createConnection</span><span class="sp-syntax-punctuation">(</span><span class="sp-syntax-plain">serverUrl</span><span class="sp-syntax-punctuation">,</span> <span class="code-step bg-opacity-10 dark:bg-opacity-20 relative rounded px-1 py-[1.5px] border-b-[2px] border-opacity-60 bg-yellow-40 border-yellow-40 text-yellow-60 dark:text-yellow-30">roomId</span><span class="sp-syntax-punctuation">)</span><span class="sp-syntax-punctuation">;</span> <span class="sp-syntax-comment">// Effect 在这里读取响应式值</span><br/></div><div class="cm-line ">    <span class="sp-syntax-plain">connection</span>.<span class="sp-syntax-property">connect</span><span class="sp-syntax-punctuation">(</span><span class="sp-syntax-punctuation">)</span><span class="sp-syntax-punctuation">;</span><br/></div><div class="cm-line ">    <span class="sp-syntax-keyword">return</span> <span class="sp-syntax-punctuation">(</span><span class="sp-syntax-punctuation">)</span> <span class="sp-syntax-punctuation">=&gt;</span> <span class="sp-syntax-plain">connection</span>.<span class="sp-syntax-property">disconnect</span><span class="sp-syntax-punctuation">(</span><span class="sp-syntax-punctuation">)</span><span class="sp-syntax-punctuation">;</span><br/></div><div class="cm-line ">  <span class="sp-syntax-punctuation">}</span><span class="sp-syntax-punctuation">,</span> <span class="sp-syntax-punctuation">[</span><span class="code-step bg-opacity-10 dark:bg-opacity-20 relative rounded px-1 py-[1.5px] border-b-[2px] border-opacity-60 bg-yellow-40 border-yellow-40 text-yellow-60 dark:text-yellow-30">roomId</span><span class="sp-syntax-punctuation">]</span><span class="sp-syntax-punctuation">)</span><span class="sp-syntax-punctuation">;</span> <span class="sp-syntax-comment">// ✅ 所以你必须在依赖中声明 Effect 使用的响应式值</span><br/></div><div class="cm-line ">  <span class="sp-syntax-comment">// ...</span><br/></div><div class="cm-line "><span class="sp-syntax-punctuation">}</span></div></code></pre></div></div></div></div><!--/$-->
<p class="whitespace-pre-wrap my-4"><a class="inline text-link dark:text-link-dark border-b border-link border-opacity-0 hover:border-opacity-100 duration-100 ease-in transition leading-normal" href="/learn/lifecycle-of-reactive-effects#all-variables-declared-in-the-component-body-are-reactive">响应式值</a> 包括 props 以及所有你直接在组件中声明的变量和函数。由于 <code dir="ltr" class="inline text-code text-secondary dark:text-secondary-dark px-1 rounded-md no-underline bg-gray-30 bg-opacity-10 py-px">roomId</code> 是响应式值，你不能把它从依赖中移除。linter 不允许这样做：</p>
<!--$--><div dir="ltr" class="sandpack sandpack--codeblock rounded-2xl h-full w-full overflow-x-auto flex items-center bg-wash dark:bg-gray-95 shadow-lg my-8" style="contain:content"><div class="sp-wrapper"><div class="sp-stack"><div class="sp-code-editor"><pre class="sp-cm sp-pristine sp-javascript flex align-start"><code class="sp-pre-placeholder grow-[2]"><div class="cm-line "><span class="sp-syntax-keyword">const</span> <span class="sp-syntax-plain">serverUrl</span> = <span class="sp-syntax-string">&#x27;https://localhost:1234&#x27;</span><span class="sp-syntax-punctuation">;</span><br/></div><div class="cm-line "><br/></div><div class="cm-line "><span class="sp-syntax-keyword">function</span> <span class="sp-syntax-definition">ChatRoom</span><span class="sp-syntax-punctuation">(</span><span class="sp-syntax-punctuation">{</span> <span class="sp-syntax-property">roomId</span> <span class="sp-syntax-punctuation">}</span><span class="sp-syntax-punctuation">)</span> <span class="sp-syntax-punctuation">{</span><br/></div><div class="cm-line ">  <span class="sp-syntax-definition">useEffect</span><span class="sp-syntax-punctuation">(</span><span class="sp-syntax-punctuation">(</span><span class="sp-syntax-punctuation">)</span> <span class="sp-syntax-punctuation">=&gt;</span> <span class="sp-syntax-punctuation">{</span><br/></div><div class="cm-line ">    <span class="sp-syntax-keyword">const</span> <span class="sp-syntax-plain">connection</span> = <span class="sp-syntax-definition">createConnection</span><span class="sp-syntax-punctuation">(</span><span class="sp-syntax-plain">serverUrl</span><span class="sp-syntax-punctuation">,</span> <span class="sp-syntax-plain">roomId</span><span class="sp-syntax-punctuation">)</span><span class="sp-syntax-punctuation">;</span><br/></div><div class="cm-line ">    <span class="sp-syntax-plain">connection</span>.<span class="sp-syntax-property">connect</span><span class="sp-syntax-punctuation">(</span><span class="sp-syntax-punctuation">)</span><span class="sp-syntax-punctuation">;</span><br/></div><div class="cm-line ">    <span class="sp-syntax-keyword">return</span> <span class="sp-syntax-punctuation">(</span><span class="sp-syntax-punctuation">)</span> <span class="sp-syntax-punctuation">=&gt;</span> <span class="sp-syntax-plain">connection</span>.<span class="sp-syntax-property">disconnect</span><span class="sp-syntax-punctuation">(</span><span class="sp-syntax-punctuation">)</span><span class="sp-syntax-punctuation">;</span><br/></div><div class="cm-line bg-github-highlight dark:bg-opacity-10">  <span class="sp-syntax-punctuation">}</span><span class="sp-syntax-punctuation">,</span> <span class="sp-syntax-punctuation">[</span><span class="sp-syntax-punctuation">]</span><span class="sp-syntax-punctuation">)</span><span class="sp-syntax-punctuation">;</span> <span class="sp-syntax-comment">// 🔴 React Hook useEffect 缺失依赖: &#x27;roomId&#x27;</span><br/></div><div class="cm-line ">  <span class="sp-syntax-comment">// ...</span><br/></div><div class="cm-line "><span class="sp-syntax-punctuation">}</span></div></code></pre></div></div></div></div><!--/$-->
<p class="whitespace-pre-wrap my-4">linter 是对的！ 由于 <code dir="ltr" class="inline text-code text-secondary dark:text-secondary-dark px-1 rounded-md no-underline bg-gray-30 bg-opacity-10 py-px">roomId</code> 可能会随时间变化，这会在代码中引入错误。</p>
<p class="whitespace-pre-wrap my-4"><strong class="font-bold">移除一个依赖，你需要向 linter 证明其不需要这个依赖</strong>。例如，你可以将 <code dir="ltr" class="inline text-code text-secondary dark:text-secondary-dark px-1 rounded-md no-underline bg-gray-30 bg-opacity-10 py-px">roomId</code> 移出组件，以证明它不是响应的，也不会在重新渲染时改变：</p>
<!--$--><div dir="ltr" class="sandpack sandpack--codeblock rounded-2xl h-full w-full overflow-x-auto flex items-center bg-wash dark:bg-gray-95 shadow-lg my-8" style="contain:content"><div class="sp-wrapper"><div class="sp-stack"><div class="sp-code-editor"><pre class="sp-cm sp-pristine sp-javascript flex align-start"><code class="sp-pre-placeholder grow-[2]"><div class="cm-line "><span class="sp-syntax-keyword">const</span> <span class="sp-syntax-plain">serverUrl</span> = <span class="sp-syntax-string">&#x27;https://localhost:1234&#x27;</span><span class="sp-syntax-punctuation">;</span><br/></div><div class="cm-line bg-github-highlight dark:bg-opacity-10"><span class="sp-syntax-keyword">const</span> <span class="sp-syntax-plain">roomId</span> = <span class="sp-syntax-string">&#x27;音乐&#x27;</span><span class="sp-syntax-punctuation">;</span> <span class="sp-syntax-comment">// 不再是响应式值</span><br/></div><div class="cm-line "><br/></div><div class="cm-line "><span class="sp-syntax-keyword">function</span> <span class="sp-syntax-definition">ChatRoom</span><span class="sp-syntax-punctuation">(</span><span class="sp-syntax-punctuation">)</span> <span class="sp-syntax-punctuation">{</span><br/></div><div class="cm-line ">  <span class="sp-syntax-definition">useEffect</span><span class="sp-syntax-punctuation">(</span><span class="sp-syntax-punctuation">(</span><span class="sp-syntax-punctuation">)</span> <span class="sp-syntax-punctuation">=&gt;</span> <span class="sp-syntax-punctuation">{</span><br/></div><div class="cm-line ">    <span class="sp-syntax-keyword">const</span> <span class="sp-syntax-plain">connection</span> = <span class="sp-syntax-definition">createConnection</span><span class="sp-syntax-punctuation">(</span><span class="sp-syntax-plain">serverUrl</span><span class="sp-syntax-punctuation">,</span> <span class="sp-syntax-plain">roomId</span><span class="sp-syntax-punctuation">)</span><span class="sp-syntax-punctuation">;</span><br/></div><div class="cm-line ">    <span class="sp-syntax-plain">connection</span>.<span class="sp-syntax-property">connect</span><span class="sp-syntax-punctuation">(</span><span class="sp-syntax-punctuation">)</span><span class="sp-syntax-punctuation">;</span><br/></div><div class="cm-line ">    <span class="sp-syntax-keyword">return</span> <span class="sp-syntax-punctuation">(</span><span class="sp-syntax-punctuation">)</span> <span class="sp-syntax-punctuation">=&gt;</span> <span class="sp-syntax-plain">connection</span>.<span class="sp-syntax-property">disconnect</span><span class="sp-syntax-punctuation">(</span><span class="sp-syntax-punctuation">)</span><span class="sp-syntax-punctuation">;</span><br/></div><div class="cm-line bg-github-highlight dark:bg-opacity-10">  <span class="sp-syntax-punctuation">}</span><span class="sp-syntax-punctuation">,</span> <span class="sp-syntax-punctuation">[</span><span class="sp-syntax-punctuation">]</span><span class="sp-syntax-punctuation">)</span><span class="sp-syntax-punctuation">;</span> <span class="sp-syntax-comment">// ✅ 所有依赖已声明</span><br/></div><div class="cm-line ">  <span class="sp-syntax-comment">// ...</span><br/></div><div class="cm-line "><span class="sp-syntax-punctuation">}</span></div></code></pre></div></div></div></div><!--/$-->
<p class="whitespace-pre-wrap my-4">现在 <code dir="ltr" class="inline text-code text-secondary dark:text-secondary-dark px-1 rounded-md no-underline bg-gray-30 bg-opacity-10 py-px">roomId</code> 不是响应式值（并且不能在重新渲染时改变），那它不就不是依赖：</p>
</div><!--$--><div class="sandpack sandpack--playground w-full my-8" dir="ltr"><div class="sp-wrapper"><div class="shadow-lg dark:shadow-lg-dark rounded-lg" style="contain:content"><div class="bg-wash dark:bg-card-dark flex justify-between items-center relative z-10 border-b border-border dark:border-border-dark rounded-t-lg text-lg"><div class="flex-1 grow min-w-0 px-4 lg:px-6"><div><div class="relative overflow-hidden"><div class="w-[fit-content] invisible"><div class=" sp-tabs" translate="no"><div aria-label="Select active file" class=" sp-tabs-scrollable-container" role="tablist"><button aria-selected="true" class="  sp-tab-button" data-active="true" role="tab" title="/src/App.js" type="button">App.js</button><button aria-selected="false" class="  sp-tab-button" data-active="false" role="tab" title="/src/chat.js" type="button">chat.js</button></div></div></div><button class="absolute top-0 start-[2px]" id="headlessui-listbox-button-:R9imcq6:" aria-haspopup="true" aria-expanded="false" data-headlessui-state=""><span class="h-full py-2 px-1 mt-px -mb-px flex border-b text-link dark:text-link-dark border-link dark:border-link-dark items-center text-md leading-tight truncate" style="max-width:160px">App.js<span class="ms-2"><svg class="rotate-0" xmlns="http://www.w3.org/2000/svg" width="20" height="20" viewBox="0 0 20 20"><g fill="none" fill-rule="evenodd" transform="translate(-446 -398)"><path fill="currentColor" fill-rule="nonzero" d="M95.8838835,240.366117 C95.3957281,239.877961 94.6042719,239.877961 94.1161165,240.366117 C93.6279612,240.854272 93.6279612,241.645728 94.1161165,242.133883 L98.6161165,246.633883 C99.1042719,247.122039 99.8957281,247.122039 100.383883,246.633883 L104.883883,242.133883 C105.372039,241.645728 105.372039,240.854272 104.883883,240.366117 C104.395728,239.877961 103.604272,239.877961 103.116117,240.366117 L99.5,243.982233 L95.8838835,240.366117 Z" transform="translate(356.5 164.5)"></path><polygon points="446 418 466 418 466 398 446 398"></polygon></g></svg></span></span></button></div></div></div><div class="px-3 flex items-center justify-end text-start" translate="yes"><button class="text-sm text-primary dark:text-primary-dark inline-flex items-center hover:text-link duration-100 ease-in transition mx-1" title="Reset Sandbox" type="button"><svg width="1em" height="1em" viewBox="0 0 24 24" fill="none" xmlns="http://www.w3.org/2000/svg" class="inline mx-1 relative"><path d="M13.8982 5.20844C12.4626 4.88688 10.9686 4.93769 9.55821 5.35604L11.8524 3.06184C11.8989 3.0154 11.9357 2.96028 11.9608 2.89961C11.986 2.83894 11.9989 2.77391 11.9989 2.70824C11.9989 2.64256 11.986 2.57754 11.9608 2.51686C11.9357 2.45619 11.8989 2.40107 11.8524 2.35464L11.1456 1.64784C11.0992 1.60139 11.0441 1.56455 10.9834 1.53942C10.9227 1.51428 10.8577 1.50134 10.792 1.50134C10.7263 1.50134 10.6613 1.51428 10.6006 1.53942C10.54 1.56455 10.4848 1.60139 10.4384 1.64784L6.14571 5.94054C6.00654 6.07969 5.89615 6.2449 5.82083 6.42673C5.74551 6.60855 5.70675 6.80343 5.70675 7.00024C5.70675 7.19704 5.74551 7.39192 5.82083 7.57374C5.89615 7.75557 6.00654 7.92078 6.14571 8.05994L10.4387 12.3529C10.5325 12.4465 10.6595 12.4991 10.792 12.4991C10.9245 12.4991 11.0516 12.4465 11.1453 12.3529L11.8527 11.6455C11.9463 11.5518 11.9989 11.4247 11.9989 11.2922C11.9989 11.1598 11.9463 11.0327 11.8527 10.9389L8.77481 7.86104C9.99795 7.16236 11.415 6.8801 12.8125 7.05678C14.21 7.23347 15.5122 7.85953 16.523 8.84064C17.5338 9.82176 18.1983 11.1048 18.4165 12.4964C18.6347 13.888 18.3947 15.3129 17.7328 16.5562C17.0708 17.7996 16.0227 18.7942 14.7463 19.3902C13.47 19.9861 12.0345 20.1511 10.6563 19.8603C9.27798 19.5695 8.03152 18.8387 7.10469 17.778C6.17786 16.7172 5.62086 15.384 5.51761 13.9791C5.51156 13.8512 5.45689 13.7303 5.36477 13.6413C5.27265 13.5522 5.15001 13.5017 5.02191 13.5H4.02081C3.95297 13.4996 3.88574 13.5129 3.8232 13.5392C3.76065 13.5655 3.70408 13.6042 3.6569 13.6529C3.60972 13.7017 3.57291 13.7595 3.54869 13.8228C3.52448 13.8862 3.51336 13.9538 3.51601 14.0216C3.61349 15.5965 4.1473 17.1132 5.0577 18.4019C5.9681 19.6906 7.21917 20.7006 8.6709 21.3188C10.1226 21.937 11.7178 22.139 13.2778 21.9022C14.8378 21.6654 16.3011 20.9992 17.504 19.978C18.7069 18.9569 19.6019 17.6212 20.0889 16.1203C20.5759 14.6195 20.6356 13.0128 20.2614 11.4799C19.8872 9.94705 19.0938 8.54858 17.97 7.44098C16.8462 6.33339 15.4363 5.56037 13.8982 5.20844V5.20844Z" fill="currentColor"></path></svg> 重置</button><a href="https://codesandbox.io/api/v1/sandboxes/define?undefined&amp;environment=create-react-app" rel="noreferrer noopener" target="_blank" title="Open in CodeSandbox" class="text-sm text-primary dark:text-primary-dark inline-flex items-center hover:text-link duration-100 ease-in transition mx-1 ms-2 md:ms-1"><svg width="1em" height="1em" viewBox="0 0 24 24" fill="none" xmlns="http://www.w3.org/2000/svg" class="inline mx-1 relative top-[1px]"><path d="M20.5001 2H15.5001C15.3675 2 15.2403 2.05268 15.1465 2.14645C15.0528 2.24021 15.0001 2.36739 15.0001 2.5V3.5C15.0001 3.63261 15.0528 3.75979 15.1465 3.85355C15.2403 3.94732 15.3675 4 15.5001 4H18.5901L7.6501 14.94C7.60323 14.9865 7.56604 15.0418 7.54065 15.1027C7.51527 15.1636 7.5022 15.229 7.5022 15.295C7.5022 15.361 7.51527 15.4264 7.54065 15.4873C7.56604 15.5482 7.60323 15.6035 7.6501 15.65L8.3501 16.35C8.39658 16.3969 8.45188 16.4341 8.51281 16.4594C8.57374 16.4848 8.63909 16.4979 8.7051 16.4979C8.7711 16.4979 8.83646 16.4848 8.89738 16.4594C8.95831 16.4341 9.01362 16.3969 9.0601 16.35L20.0001 5.41V8.5C20.0001 8.63261 20.0528 8.75979 20.1465 8.85355C20.2403 8.94732 20.3675 9 20.5001 9H21.5001C21.6327 9 21.7599 8.94732 21.8537 8.85355C21.9474 8.75979 22.0001 8.63261 22.0001 8.5V3.5C22.0001 3.10218 21.8421 2.72064 21.5608 2.43934C21.2795 2.15804 20.8979 2 20.5001 2V2Z" fill="currentColor"></path><path d="M21.5 13H20.5C20.3674 13 20.2402 13.0527 20.1464 13.1464C20.0527 13.2402 20 13.3674 20 13.5V20H4V4H10.5C10.6326 4 10.7598 3.94732 10.8536 3.85355C10.9473 3.75979 11 3.63261 11 3.5V2.5C11 2.36739 10.9473 2.24021 10.8536 2.14645C10.7598 2.05268 10.6326 2 10.5 2H3.5C3.10218 2 2.72064 2.15804 2.43934 2.43934C2.15804 2.72064 2 3.10218 2 3.5V20.5C2 20.8978 2.15804 21.2794 2.43934 21.5607C2.72064 21.842 3.10218 22 3.5 22H20.5C20.8978 22 21.2794 21.842 21.5607 21.5607C21.842 21.2794 22 20.8978 22 20.5V13.5C22 13.3674 21.9473 13.2402 21.8536 13.1464C21.7598 13.0527 21.6326 13 21.5 13Z" fill="currentColor"></path></svg><span class="hidden md:block">Fork</span></a></div></div><div class=" rounded-b-lg overflow-hidden sp-layout"><div class=" sp-editor sp-stack"><div class=" sp-code-editor"><div aria-autocomplete="list" aria-label="Code Editor for App.js" aria-multiline="true" class="sp-pristine sp-javascript   sp-cm" role="textbox" tabindex="0" translate="no"><pre class=" sp-pre-placeholder" style="margin-left:var(--sp-space-11)"><span class="sp-syntax-keyword">import</span> <span class="sp-syntax-punctuation">{</span> <span class="sp-syntax-plain">useState</span><span class="sp-syntax-punctuation">,</span> <span class="sp-syntax-plain">useEffect</span> <span class="sp-syntax-punctuation">}</span> <span class="sp-syntax-keyword">from</span> <span class="sp-syntax-string">&#x27;react&#x27;</span><span class="sp-syntax-punctuation">;</span>
<span class="sp-syntax-keyword">import</span> <span class="sp-syntax-punctuation">{</span> <span class="sp-syntax-plain">createConnection</span> <span class="sp-syntax-punctuation">}</span> <span class="sp-syntax-keyword">from</span> <span class="sp-syntax-string">&#x27;./chat.js&#x27;</span><span class="sp-syntax-punctuation">;</span>

<span class="sp-syntax-keyword">const</span> <span class="sp-syntax-plain">serverUrl</span> = <span class="sp-syntax-string">&#x27;https://localhost:1234&#x27;</span><span class="sp-syntax-punctuation">;</span>
<span class="sp-syntax-keyword">const</span> <span class="sp-syntax-plain">roomId</span> = <span class="sp-syntax-string">&#x27;音乐&#x27;</span><span class="sp-syntax-punctuation">;</span>

<span class="sp-syntax-keyword">export</span> <span class="sp-syntax-keyword">default</span> <span class="sp-syntax-keyword">function</span> <span class="sp-syntax-definition">ChatRoom</span><span class="sp-syntax-punctuation">(</span><span class="sp-syntax-punctuation">)</span> <span class="sp-syntax-punctuation">{</span>
  <span class="sp-syntax-definition">useEffect</span><span class="sp-syntax-punctuation">(</span><span class="sp-syntax-punctuation">(</span><span class="sp-syntax-punctuation">)</span> <span class="sp-syntax-punctuation">=&gt;</span> <span class="sp-syntax-punctuation">{</span>
    <span class="sp-syntax-keyword">const</span> <span class="sp-syntax-plain">connection</span> = <span class="sp-syntax-definition">createConnection</span><span class="sp-syntax-punctuation">(</span><span class="sp-syntax-plain">serverUrl</span><span class="sp-syntax-punctuation">,</span> <span class="sp-syntax-plain">roomId</span><span class="sp-syntax-punctuation">)</span><span class="sp-syntax-punctuation">;</span>
    <span class="sp-syntax-plain">connection</span>.<span class="sp-syntax-property">connect</span><span class="sp-syntax-punctuation">(</span><span class="sp-syntax-punctuation">)</span><span class="sp-syntax-punctuation">;</span>
    <span class="sp-syntax-keyword">return</span> <span class="sp-syntax-punctuation">(</span><span class="sp-syntax-punctuation">)</span> <span class="sp-syntax-punctuation">=&gt;</span> <span class="sp-syntax-plain">connection</span>.<span class="sp-syntax-property">disconnect</span><span class="sp-syntax-punctuation">(</span><span class="sp-syntax-punctuation">)</span><span class="sp-syntax-punctuation">;</span>
  <span class="sp-syntax-punctuation">}</span><span class="sp-syntax-punctuation">,</span> <span class="sp-syntax-punctuation">[</span><span class="sp-syntax-punctuation">]</span><span class="sp-syntax-punctuation">)</span><span class="sp-syntax-punctuation">;</span>
  <span class="sp-syntax-keyword">return</span> <span class="sp-syntax-punctuation">&lt;</span><span class="sp-syntax-tag">h1</span><span class="sp-syntax-punctuation">&gt;</span>欢迎来到 <span class="sp-syntax-punctuation">{</span><span class="sp-syntax-plain">roomId</span><span class="sp-syntax-punctuation">}</span> 房间！<span class="sp-syntax-punctuation">&lt;/</span><span class="sp-syntax-tag">h1</span><span class="sp-syntax-punctuation">&gt;</span><span class="sp-syntax-punctuation">;</span>
<span class="sp-syntax-punctuation">}</span>

</pre></div></div></div><div class=" order-last xl:order-2 sp-stack"><div class="p-0 sm:p-2 md:p-4 lg:p-8 bg-card dark:bg-wash-dark h-full relative md:rounded-b-lg lg:rounded-b-none"><div style="position:relative"><iframe class="rounded-t-none bg-white md:shadow-md sm:rounded-lg w-full max-w-full transition-opacity absolute opacity-0 pointer-events-none duration-75" title="Sandbox Preview" style="height:15px;z-index:-1"></iframe></div></div></div></div></div></div></div><!--/$--><div class="max-w-4xl ms-0 2xl:mx-auto">
<p class="whitespace-pre-wrap my-4">这就是为什么你现在可以指定 <a class="inline text-link dark:text-link-dark border-b border-link border-opacity-0 hover:border-opacity-100 duration-100 ease-in transition leading-normal" href="/learn/lifecycle-of-reactive-effects#what-an-effect-with-empty-dependencies-means">空（<code dir="ltr" class="inline text-code text-secondary dark:text-secondary-dark px-1 rounded-md no-underline bg-gray-30 bg-opacity-10 py-px">[]</code>）依赖</a>。Effect <strong class="font-bold">真的不</strong> 依赖任何响应式值了，也 <strong class="font-bold">真的不</strong> 需要在组件的 props 或 state 改变时重新运行。</p>
<h3 id="to-change-the-dependencies-change-the-code" class="mdx-heading text-2xl font-display leading-9 text-primary dark:text-primary-dark font-bold my-6">要改变依赖，请改变代码 <a href="#to-change-the-dependencies-change-the-code" aria-label="Link for 要改变依赖，请改变代码 " title="Link for 要改变依赖，请改变代码 " class="mdx-header-anchor inline-block"><svg width="1em" height="1em" viewBox="0 0 13 13" xmlns="http://www.w3.org/2000/svg" class="text-gray-70 ms-2 h-5 w-5"><g fill="currentColor" fill-rule="evenodd"><path d="M7.778 7.975a2.5 2.5 0 0 0 .347-3.837L6.017 2.03a2.498 2.498 0 0 0-3.542-.007 2.5 2.5 0 0 0 .006 3.543l1.153 1.15c.07-.29.154-.563.25-.773.036-.077.084-.16.14-.25L3.18 4.85a1.496 1.496 0 0 1 .002-2.12 1.496 1.496 0 0 1 2.12 0l2.124 2.123a1.496 1.496 0 0 1-.333 2.37c.16.246.42.504.685.752z"></path><path d="M5.657 4.557a2.5 2.5 0 0 0-.347 3.837l2.108 2.108a2.498 2.498 0 0 0 3.542.007 2.5 2.5 0 0 0-.006-3.543L9.802 5.815c-.07.29-.154.565-.25.774-.036.076-.084.16-.14.25l.842.84c.585.587.59 1.532 0 2.122-.587.585-1.532.59-2.12 0L6.008 7.68a1.496 1.496 0 0 1 .332-2.372c-.16-.245-.42-.503-.685-.75z"></path></g></svg></a></h3>
<p class="whitespace-pre-wrap my-4">你可能已经注意到工作流程中有一个模式：</p>
<ol class="ms-6 my-3 list-decimal">
<li class="leading-relaxed mb-1">首先，你 <strong class="font-bold">改变 Effect 的代码</strong> 或响应式值的声明方式。</li>
<li class="leading-relaxed mb-1">然后，你采纳 linter 的建议，调整依赖，以 <strong class="font-bold">匹配你所改变的代码</strong>。</li>
<li class="leading-relaxed mb-1">如果你对依赖不满意，你可以 <strong class="font-bold">回到第一步</strong>（并再次修改代码）。</li>
</ol>
<p class="whitespace-pre-wrap my-4">最后一部分很重要。<strong class="font-bold">如果你想改变依赖，首先要改变所涉及到的代码</strong>。你可以把依赖看作是 <a class="inline text-link dark:text-link-dark border-b border-link border-opacity-0 hover:border-opacity-100 duration-100 ease-in transition leading-normal" href="/learn/lifecycle-of-reactive-effects#react-verifies-that-you-specified-every-reactive-value-as-a-dependency">Effect的代码所依赖的所有响应式值的列表</a>。你不要 <strong class="font-bold">选择</strong> 把什么放在这个列表上。该列表 <strong class="font-bold">描述了</strong> 代码。要改变依赖，请改变代码。</p>
<p class="whitespace-pre-wrap my-4">这可能感觉就像解方程一样。你有一个目标（例如，移除一个依赖），你需要“找到”与该目标相匹配的代码。不是每个人都觉得解方程很有趣，写 Effect 也是如此！幸运的是，下面有一些常见的解决方案你可以去尝试。</p>
<div class="expandable-callout pt-8 pb-4 px-5 sm:px-8 my-8 relative rounded-none shadow-inner-border -mx-5 sm:mx-auto sm:rounded-2xl bg-yellow-5 dark:bg-yellow-60 dark:bg-opacity-20"><h3 class="text-2xl font-display font-bold text-yellow-50 dark:text-yellow-40"><svg class="inline me-3 mb-1 text-lg text-yellow-50 dark:text-yellow-40" width="2em" height="2em" viewBox="0 0 72 72" fill="none" xmlns="http://www.w3.org/2000/svg"><g clip-path="url(#clip0_738_836)"><path fill-rule="evenodd" clip-rule="evenodd" d="M27 48L27 57.3409L40.0772 48L55.6975 48C57.1595 48 58.1986 47.0112 58.3851 45.8604C59.1824 40.9398 60 34.619 60 29.625C60 24.7282 59.2125 18.7546 58.4302 14.0813C58.2445 12.9721 57.2326 12 55.7805 12L16.2195 12C14.7674 12 13.7555 12.9721 13.5698 14.0813C12.7875 18.7546 12 24.7282 12 29.625C12 34.619 12.8176 40.9398 13.6149 45.8604C13.8014 47.0112 14.8404 48 16.3025 48H27ZM42 54H55.6975C59.9534 54 63.6271 51.0213 64.3078 46.8201C65.1161 41.8322 66 35.1209 66 29.625C66 24.2196 65.1449 17.8522 64.3478 13.0906C63.6513 8.93026 59.9987 6 55.7805 6H16.2195C12.0013 6 8.34867 8.93026 7.65218 13.0906C6.85505 17.8522 6 24.2196 6 29.625C6 35.1209 6.88391 41.8322 7.69215 46.8201C8.37291 51.0213 12.0466 54 16.3025 54H21L21 63.1704C21 65.6106 23.7581 67.0299 25.7437 65.6116L42 54ZM39 39.3686C39 40.9422 38 41.9912 36 41.9912C34 41.9912 33 40.9422 33 39.3686C33 37.7951 34 36.746 36 36.746C38 36.746 39 37.7951 39 39.3686ZM38.1771 20.2412C38.1771 18.9986 37.1697 17.9912 35.9271 17.9912C34.6845 17.9912 33.6771 18.9986 33.6771 20.2412V31.5956C33.6771 32.8382 34.6845 33.8456 35.9271 33.8456C37.1697 33.8456 38.1771 32.8382 38.1771 31.5956V20.2412Z" fill="currentColor"></path></g><defs><clipPath id="clip0_738_836"><rect width="72" height="72" fill="white"></rect></clipPath></defs></svg>陷阱</h3><div class="relative"><div class="py-2"><p class="whitespace-pre-wrap my-4">如果你有一个已经存在的代码库，你可能会有一些像这样抑制 linter 的代码：</p><!--$--><div dir="ltr" class="sandpack sandpack--codeblock rounded-2xl h-full w-full overflow-x-auto flex items-center bg-wash dark:bg-gray-95 shadow-lg my-8" style="contain:content"><div class="sp-wrapper"><div class="sp-stack"><div class="sp-code-editor"><pre class="sp-cm sp-pristine sp-javascript flex align-start"><code class="sp-pre-placeholder grow-[2]"><div class="cm-line "><span class="sp-syntax-definition">useEffect</span><span class="sp-syntax-punctuation">(</span><span class="sp-syntax-punctuation">(</span><span class="sp-syntax-punctuation">)</span> <span class="sp-syntax-punctuation">=&gt;</span> <span class="sp-syntax-punctuation">{</span><br/></div><div class="cm-line ">  <span class="sp-syntax-comment">// ...</span><br/></div><div class="cm-line bg-github-highlight dark:bg-opacity-10">  <span class="sp-syntax-comment">// 🔴 避免像这样抑制 linter 的警告或错误提示：</span><br/></div><div class="cm-line bg-github-highlight dark:bg-opacity-10">  <span class="sp-syntax-comment">// eslint-ignore-next-line react-hooks/exhaustive-deps</span><br/></div><div class="cm-line "><span class="sp-syntax-punctuation">}</span><span class="sp-syntax-punctuation">,</span> <span class="sp-syntax-punctuation">[</span><span class="sp-syntax-punctuation">]</span><span class="sp-syntax-punctuation">)</span><span class="sp-syntax-punctuation">;</span></div></code></pre></div></div></div></div><!--/$--><p class="whitespace-pre-wrap my-4"><strong class="font-bold">当依赖与代码不匹配时，极有可能引入 bug</strong>。通过抑制 linter，你是在 Effect 所依赖的值上对 React “撒谎”。</p><p class="whitespace-pre-wrap my-4">你可以使用如下技术。</p></div></div></div>
<details class="my-12 rounded-2xl shadow-inner-border dark:shadow-inner-border-dark relative dark:bg-opacity-20 dark:bg-purple-60 bg-purple-5"><summary class="list-none p-8" tabindex="-1"><h5 class="mb-4 uppercase font-bold flex items-center text-sm dark:text-purple-30 text-purple-50"><svg class="inline me-2 dark:text-purple-30 text-purple-40" width="1.5em" height="1.5em" viewBox="0 0 72 72" fill="none" xmlns="http://www.w3.org/2000/svg"><path fill-rule="evenodd" clip-rule="evenodd" d="M34.7409 59.7228L32.9567 58.9094C27.2672 56.3157 20.7328 56.3157 15.0433 58.9094C12.6018 60.0224 9.39163 59.0275 8.44602 56.0621C7.45647 52.9589 5.99975 46.5898 6 35.9997C6.00029 23.5648 8.00803 18.3599 9.11099 16.4196C9.67795 15.4222 10.5255 14.8455 11.2254 14.5264L12.0179 14.1651C19.6351 10.6926 28.4011 10.6738 36 14.1733C43.5989 10.6738 52.3649 10.6926 59.9821 14.1651L60.7746 14.5264C61.4745 14.8455 62.3221 15.4222 62.889 16.4196C63.992 18.3599 65.9997 23.5648 66 35.9997C66.0002 46.5898 64.5435 52.9589 63.554 56.0621C62.6084 59.0275 59.3982 60.0224 56.9567 58.9094C51.2672 56.3157 44.7328 56.3157 39.0433 58.9094L37.2591 59.7228C37.1986 59.7508 37.1373 59.7767 37.0753 59.8004C36.4484 60.0411 35.7556 60.0653 35.1102 59.8648C34.9847 59.8258 34.8613 59.7784 34.7409 59.7228ZM14.5068 19.6246C20.3733 16.9501 27.0874 16.8775 33 19.4067V52.473C26.7613 50.32 19.9378 50.471 13.7811 52.9261C13.0005 49.9843 11.9998 44.547 12 35.9998C12.0002 25.5786 13.4879 21.1893 14.1179 19.8018L14.5068 19.6246ZM39 52.473C45.2387 50.32 52.0622 50.471 58.2189 52.9261C58.9995 49.9843 60.0002 44.547 60 35.9998C59.9998 25.5786 58.5121 21.1893 57.8821 19.8018L57.4932 19.6246C51.6267 16.9501 44.9126 16.8775 39 19.4067V52.473Z" fill="currentColor"></path></svg>深入探讨</h5><div class="mb-4"><h4 id="why-is-suppressing-the-dependency-linter-so-dangerous" class="mdx-heading text-xl font-bold text-primary dark:text-primary-dark text-xl font-display font-bold leading-9 my-4">为什么抑制 linter 对依赖的检查如此危险？ <a href="#why-is-suppressing-the-dependency-linter-so-dangerous" aria-label="Link for 为什么抑制 linter 对依赖的检查如此危险？ " title="Link for 为什么抑制 linter 对依赖的检查如此危险？ " class="mdx-header-anchor inline-block"><svg width="1em" height="1em" viewBox="0 0 13 13" xmlns="http://www.w3.org/2000/svg" class="text-gray-70 ms-2 h-5 w-5"><g fill="currentColor" fill-rule="evenodd"><path d="M7.778 7.975a2.5 2.5 0 0 0 .347-3.837L6.017 2.03a2.498 2.498 0 0 0-3.542-.007 2.5 2.5 0 0 0 .006 3.543l1.153 1.15c.07-.29.154-.563.25-.773.036-.077.084-.16.14-.25L3.18 4.85a1.496 1.496 0 0 1 .002-2.12 1.496 1.496 0 0 1 2.12 0l2.124 2.123a1.496 1.496 0 0 1-.333 2.37c.16.246.42.504.685.752z"></path><path d="M5.657 4.557a2.5 2.5 0 0 0-.347 3.837l2.108 2.108a2.498 2.498 0 0 0 3.542.007 2.5 2.5 0 0 0-.006-3.543L9.802 5.815c-.07.29-.154.565-.25.774-.036.076-.084.16-.14.25l.842.84c.585.587.59 1.532 0 2.122-.587.585-1.532.59-2.12 0L6.008 7.68a1.496 1.496 0 0 1 .332-2.372c-.16-.245-.42-.503-.685-.75z"></path></g></svg></a></h4></div><button class="bg-purple-50 border-purple-50 hover:bg-purple-40 focus:bg-purple-50 active:bg-purple-50 text-base leading-tight font-bold rounded-full py-2 px-4 focus:outline focus:outline-offset-2 focus:outline-link dark:focus:outline-link-dark inline-flex items-center my-1 bg-link border-link text-white hover:bg-link focus:bg-link active:bg-link"><span class="me-1"><svg class="rotate-0" xmlns="http://www.w3.org/2000/svg" width="20" height="20" viewBox="0 0 20 20"><g fill="none" fill-rule="evenodd" transform="translate(-446 -398)"><path fill="currentColor" fill-rule="nonzero" d="M95.8838835,240.366117 C95.3957281,239.877961 94.6042719,239.877961 94.1161165,240.366117 C93.6279612,240.854272 93.6279612,241.645728 94.1161165,242.133883 L98.6161165,246.633883 C99.1042719,247.122039 99.8957281,247.122039 100.383883,246.633883 L104.883883,242.133883 C105.372039,241.645728 105.372039,240.854272 104.883883,240.366117 C104.395728,239.877961 103.604272,239.877961 103.116117,240.366117 L99.5,243.982233 L95.8838835,240.366117 Z" transform="translate(356.5 164.5)"></path><polygon points="446 418 466 418 466 398 446 398"></polygon></g></svg></span>显示更多</button></summary><div class="p-8 border-t dark:border-purple-60 border-purple-10 "><p class="whitespace-pre-wrap my-4">抑制 linter 会导致非常不直观的 bug，这将很难发现和修复。这里有一个例子：</p><!--$--><div class="sandpack sandpack--playground w-full my-8" dir="ltr"><div class="sp-wrapper"><div class="shadow-lg dark:shadow-lg-dark rounded-lg" style="contain:content"><div class="bg-wash dark:bg-card-dark flex justify-between items-center relative z-10 border-b border-border dark:border-border-dark rounded-t-lg text-lg"><div class="flex-1 grow min-w-0 px-4 lg:px-6"><div><div class="relative overflow-hidden"><div class="w-[fit-content] invisible"><div class=" sp-tabs" translate="no"><div aria-label="Select active file" class=" sp-tabs-scrollable-container" role="tablist"><button aria-selected="true" class="  sp-tab-button" data-active="true" role="tab" title="/src/App.js" type="button">App.js</button></div></div></div><button class="absolute top-0 start-[2px]" id="headlessui-listbox-button-:R2cl887cq6:" aria-haspopup="true" aria-expanded="false" data-headlessui-state=""><span class="h-full py-2 px-1 mt-px -mb-px flex border-b text-link dark:text-link-dark border-link dark:border-link-dark items-center text-md leading-tight truncate" style="max-width:160px">App.js</span></button></div></div></div><div class="px-3 flex items-center justify-end text-start" translate="yes"><button class="text-sm text-primary dark:text-primary-dark inline-flex items-center hover:text-link duration-100 ease-in transition mx-1" title="Reset Sandbox" type="button"><svg width="1em" height="1em" viewBox="0 0 24 24" fill="none" xmlns="http://www.w3.org/2000/svg" class="inline mx-1 relative"><path d="M13.8982 5.20844C12.4626 4.88688 10.9686 4.93769 9.55821 5.35604L11.8524 3.06184C11.8989 3.0154 11.9357 2.96028 11.9608 2.89961C11.986 2.83894 11.9989 2.77391 11.9989 2.70824C11.9989 2.64256 11.986 2.57754 11.9608 2.51686C11.9357 2.45619 11.8989 2.40107 11.8524 2.35464L11.1456 1.64784C11.0992 1.60139 11.0441 1.56455 10.9834 1.53942C10.9227 1.51428 10.8577 1.50134 10.792 1.50134C10.7263 1.50134 10.6613 1.51428 10.6006 1.53942C10.54 1.56455 10.4848 1.60139 10.4384 1.64784L6.14571 5.94054C6.00654 6.07969 5.89615 6.2449 5.82083 6.42673C5.74551 6.60855 5.70675 6.80343 5.70675 7.00024C5.70675 7.19704 5.74551 7.39192 5.82083 7.57374C5.89615 7.75557 6.00654 7.92078 6.14571 8.05994L10.4387 12.3529C10.5325 12.4465 10.6595 12.4991 10.792 12.4991C10.9245 12.4991 11.0516 12.4465 11.1453 12.3529L11.8527 11.6455C11.9463 11.5518 11.9989 11.4247 11.9989 11.2922C11.9989 11.1598 11.9463 11.0327 11.8527 10.9389L8.77481 7.86104C9.99795 7.16236 11.415 6.8801 12.8125 7.05678C14.21 7.23347 15.5122 7.85953 16.523 8.84064C17.5338 9.82176 18.1983 11.1048 18.4165 12.4964C18.6347 13.888 18.3947 15.3129 17.7328 16.5562C17.0708 17.7996 16.0227 18.7942 14.7463 19.3902C13.47 19.9861 12.0345 20.1511 10.6563 19.8603C9.27798 19.5695 8.03152 18.8387 7.10469 17.778C6.17786 16.7172 5.62086 15.384 5.51761 13.9791C5.51156 13.8512 5.45689 13.7303 5.36477 13.6413C5.27265 13.5522 5.15001 13.5017 5.02191 13.5H4.02081C3.95297 13.4996 3.88574 13.5129 3.8232 13.5392C3.76065 13.5655 3.70408 13.6042 3.6569 13.6529C3.60972 13.7017 3.57291 13.7595 3.54869 13.8228C3.52448 13.8862 3.51336 13.9538 3.51601 14.0216C3.61349 15.5965 4.1473 17.1132 5.0577 18.4019C5.9681 19.6906 7.21917 20.7006 8.6709 21.3188C10.1226 21.937 11.7178 22.139 13.2778 21.9022C14.8378 21.6654 16.3011 20.9992 17.504 19.978C18.7069 18.9569 19.6019 17.6212 20.0889 16.1203C20.5759 14.6195 20.6356 13.0128 20.2614 11.4799C19.8872 9.94705 19.0938 8.54858 17.97 7.44098C16.8462 6.33339 15.4363 5.56037 13.8982 5.20844V5.20844Z" fill="currentColor"></path></svg> 重置</button><a href="https://codesandbox.io/api/v1/sandboxes/define?undefined&amp;environment=create-react-app" rel="noreferrer noopener" target="_blank" title="Open in CodeSandbox" class="text-sm text-primary dark:text-primary-dark inline-flex items-center hover:text-link duration-100 ease-in transition mx-1 ms-2 md:ms-1"><svg width="1em" height="1em" viewBox="0 0 24 24" fill="none" xmlns="http://www.w3.org/2000/svg" class="inline mx-1 relative top-[1px]"><path d="M20.5001 2H15.5001C15.3675 2 15.2403 2.05268 15.1465 2.14645C15.0528 2.24021 15.0001 2.36739 15.0001 2.5V3.5C15.0001 3.63261 15.0528 3.75979 15.1465 3.85355C15.2403 3.94732 15.3675 4 15.5001 4H18.5901L7.6501 14.94C7.60323 14.9865 7.56604 15.0418 7.54065 15.1027C7.51527 15.1636 7.5022 15.229 7.5022 15.295C7.5022 15.361 7.51527 15.4264 7.54065 15.4873C7.56604 15.5482 7.60323 15.6035 7.6501 15.65L8.3501 16.35C8.39658 16.3969 8.45188 16.4341 8.51281 16.4594C8.57374 16.4848 8.63909 16.4979 8.7051 16.4979C8.7711 16.4979 8.83646 16.4848 8.89738 16.4594C8.95831 16.4341 9.01362 16.3969 9.0601 16.35L20.0001 5.41V8.5C20.0001 8.63261 20.0528 8.75979 20.1465 8.85355C20.2403 8.94732 20.3675 9 20.5001 9H21.5001C21.6327 9 21.7599 8.94732 21.8537 8.85355C21.9474 8.75979 22.0001 8.63261 22.0001 8.5V3.5C22.0001 3.10218 21.8421 2.72064 21.5608 2.43934C21.2795 2.15804 20.8979 2 20.5001 2V2Z" fill="currentColor"></path><path d="M21.5 13H20.5C20.3674 13 20.2402 13.0527 20.1464 13.1464C20.0527 13.2402 20 13.3674 20 13.5V20H4V4H10.5C10.6326 4 10.7598 3.94732 10.8536 3.85355C10.9473 3.75979 11 3.63261 11 3.5V2.5C11 2.36739 10.9473 2.24021 10.8536 2.14645C10.7598 2.05268 10.6326 2 10.5 2H3.5C3.10218 2 2.72064 2.15804 2.43934 2.43934C2.15804 2.72064 2 3.10218 2 3.5V20.5C2 20.8978 2.15804 21.2794 2.43934 21.5607C2.72064 21.842 3.10218 22 3.5 22H20.5C20.8978 22 21.2794 21.842 21.5607 21.5607C21.842 21.2794 22 20.8978 22 20.5V13.5C22 13.3674 21.9473 13.2402 21.8536 13.1464C21.7598 13.0527 21.6326 13 21.5 13Z" fill="currentColor"></path></svg><span class="hidden md:block">Fork</span></a></div></div><div class=" sp-layout"><div class=" sp-editor sp-stack"><div class=" sp-code-editor"><div aria-autocomplete="list" aria-label="Code Editor for App.js" aria-multiline="true" class="sp-pristine sp-javascript   sp-cm" role="textbox" tabindex="0" translate="no"><pre class=" sp-pre-placeholder" style="margin-left:var(--sp-space-11)"><span class="sp-syntax-keyword">import</span> <span class="sp-syntax-punctuation">{</span> <span class="sp-syntax-plain">useState</span><span class="sp-syntax-punctuation">,</span> <span class="sp-syntax-plain">useEffect</span> <span class="sp-syntax-punctuation">}</span> <span class="sp-syntax-keyword">from</span> <span class="sp-syntax-string">&#x27;react&#x27;</span><span class="sp-syntax-punctuation">;</span>

<span class="sp-syntax-keyword">export</span> <span class="sp-syntax-keyword">default</span> <span class="sp-syntax-keyword">function</span> <span class="sp-syntax-definition">Timer</span><span class="sp-syntax-punctuation">(</span><span class="sp-syntax-punctuation">)</span> <span class="sp-syntax-punctuation">{</span>
  <span class="sp-syntax-keyword">const</span> <span class="sp-syntax-punctuation">[</span><span class="sp-syntax-plain">count</span><span class="sp-syntax-punctuation">,</span> <span class="sp-syntax-plain">setCount</span><span class="sp-syntax-punctuation">]</span> = <span class="sp-syntax-definition">useState</span><span class="sp-syntax-punctuation">(</span><span class="sp-syntax-static">0</span><span class="sp-syntax-punctuation">)</span><span class="sp-syntax-punctuation">;</span>
  <span class="sp-syntax-keyword">const</span> <span class="sp-syntax-punctuation">[</span><span class="sp-syntax-plain">increment</span><span class="sp-syntax-punctuation">,</span> <span class="sp-syntax-plain">setIncrement</span><span class="sp-syntax-punctuation">]</span> = <span class="sp-syntax-definition">useState</span><span class="sp-syntax-punctuation">(</span><span class="sp-syntax-static">1</span><span class="sp-syntax-punctuation">)</span><span class="sp-syntax-punctuation">;</span>

  <span class="sp-syntax-keyword">function</span> <span class="sp-syntax-definition">onTick</span><span class="sp-syntax-punctuation">(</span><span class="sp-syntax-punctuation">)</span> <span class="sp-syntax-punctuation">{</span>
	<span class="sp-syntax-definition">setCount</span><span class="sp-syntax-punctuation">(</span><span class="sp-syntax-plain">count</span> + <span class="sp-syntax-plain">increment</span><span class="sp-syntax-punctuation">)</span><span class="sp-syntax-punctuation">;</span>
  <span class="sp-syntax-punctuation">}</span>

  <span class="sp-syntax-definition">useEffect</span><span class="sp-syntax-punctuation">(</span><span class="sp-syntax-punctuation">(</span><span class="sp-syntax-punctuation">)</span> <span class="sp-syntax-punctuation">=&gt;</span> <span class="sp-syntax-punctuation">{</span>
    <span class="sp-syntax-keyword">const</span> <span class="sp-syntax-plain">id</span> = <span class="sp-syntax-definition">setInterval</span><span class="sp-syntax-punctuation">(</span><span class="sp-syntax-plain">onTick</span><span class="sp-syntax-punctuation">,</span> <span class="sp-syntax-static">1000</span><span class="sp-syntax-punctuation">)</span><span class="sp-syntax-punctuation">;</span>
    <span class="sp-syntax-keyword">return</span> <span class="sp-syntax-punctuation">(</span><span class="sp-syntax-punctuation">)</span> <span class="sp-syntax-punctuation">=&gt;</span> <span class="sp-syntax-definition">clearInterval</span><span class="sp-syntax-punctuation">(</span><span class="sp-syntax-plain">id</span><span class="sp-syntax-punctuation">)</span><span class="sp-syntax-punctuation">;</span>
    <span class="sp-syntax-comment">// eslint-disable-next-line react-hooks/exhaustive-deps</span>
  <span class="sp-syntax-punctuation">}</span><span class="sp-syntax-punctuation">,</span> <span class="sp-syntax-punctuation">[</span><span class="sp-syntax-punctuation">]</span><span class="sp-syntax-punctuation">)</span><span class="sp-syntax-punctuation">;</span>

  <span class="sp-syntax-keyword">return</span> <span class="sp-syntax-punctuation">(</span>
    <span class="sp-syntax-punctuation">&lt;</span><span class="sp-syntax-punctuation">&gt;</span>
      <span class="sp-syntax-punctuation">&lt;</span><span class="sp-syntax-tag">h1</span><span class="sp-syntax-punctuation">&gt;</span>
        计数器：<span class="sp-syntax-punctuation">{</span><span class="sp-syntax-plain">count</span><span class="sp-syntax-punctuation">}</span>
        <span class="sp-syntax-punctuation">&lt;</span><span class="sp-syntax-tag">button</span> <span class="sp-syntax-property">onClick</span>=<span class="sp-syntax-punctuation">{</span><span class="sp-syntax-punctuation">(</span><span class="sp-syntax-punctuation">)</span> <span class="sp-syntax-punctuation">=&gt;</span> <span class="sp-syntax-definition">setCount</span><span class="sp-syntax-punctuation">(</span><span class="sp-syntax-static">0</span><span class="sp-syntax-punctuation">)</span><span class="sp-syntax-punctuation">}</span><span class="sp-syntax-punctuation">&gt;</span>重制<span class="sp-syntax-punctuation">&lt;/</span><span class="sp-syntax-tag">button</span><span class="sp-syntax-punctuation">&gt;</span>
      <span class="sp-syntax-punctuation">&lt;/</span><span class="sp-syntax-tag">h1</span><span class="sp-syntax-punctuation">&gt;</span>
      <span class="sp-syntax-punctuation">&lt;</span><span class="sp-syntax-tag">hr</span> <span class="sp-syntax-punctuation">/&gt;</span>
      <span class="sp-syntax-punctuation">&lt;</span><span class="sp-syntax-tag">p</span><span class="sp-syntax-punctuation">&gt;</span>
        每秒递增：
        <span class="sp-syntax-punctuation">&lt;</span><span class="sp-syntax-tag">button</span> <span class="sp-syntax-property">disabled</span>=<span class="sp-syntax-punctuation">{</span><span class="sp-syntax-plain">increment</span> === <span class="sp-syntax-static">0</span><span class="sp-syntax-punctuation">}</span> <span class="sp-syntax-property">onClick</span>=<span class="sp-syntax-punctuation">{</span><span class="sp-syntax-punctuation">(</span><span class="sp-syntax-punctuation">)</span> <span class="sp-syntax-punctuation">=&gt;</span> <span class="sp-syntax-punctuation">{</span>
          <span class="sp-syntax-definition">setIncrement</span><span class="sp-syntax-punctuation">(</span><span class="sp-syntax-plain">i</span> <span class="sp-syntax-punctuation">=&gt;</span> <span class="sp-syntax-plain">i</span> - <span class="sp-syntax-static">1</span><span class="sp-syntax-punctuation">)</span><span class="sp-syntax-punctuation">;</span>
        <span class="sp-syntax-punctuation">}</span><span class="sp-syntax-punctuation">}</span><span class="sp-syntax-punctuation">&gt;</span>–<span class="sp-syntax-punctuation">&lt;/</span><span class="sp-syntax-tag">button</span><span class="sp-syntax-punctuation">&gt;</span>
        <span class="sp-syntax-punctuation">&lt;</span><span class="sp-syntax-tag">b</span><span class="sp-syntax-punctuation">&gt;</span><span class="sp-syntax-punctuation">{</span><span class="sp-syntax-plain">increment</span><span class="sp-syntax-punctuation">}</span><span class="sp-syntax-punctuation">&lt;/</span><span class="sp-syntax-tag">b</span><span class="sp-syntax-punctuation">&gt;</span>
        <span class="sp-syntax-punctuation">&lt;</span><span class="sp-syntax-tag">button</span> <span class="sp-syntax-property">onClick</span>=<span class="sp-syntax-punctuation">{</span><span class="sp-syntax-punctuation">(</span><span class="sp-syntax-punctuation">)</span> <span class="sp-syntax-punctuation">=&gt;</span> <span class="sp-syntax-punctuation">{</span>
          <span class="sp-syntax-definition">setIncrement</span><span class="sp-syntax-punctuation">(</span><span class="sp-syntax-plain">i</span> <span class="sp-syntax-punctuation">=&gt;</span> <span class="sp-syntax-plain">i</span> + <span class="sp-syntax-static">1</span><span class="sp-syntax-punctuation">)</span><span class="sp-syntax-punctuation">;</span>
        <span class="sp-syntax-punctuation">}</span><span class="sp-syntax-punctuation">}</span><span class="sp-syntax-punctuation">&gt;</span>+<span class="sp-syntax-punctuation">&lt;/</span><span class="sp-syntax-tag">button</span><span class="sp-syntax-punctuation">&gt;</span>
      <span class="sp-syntax-punctuation">&lt;/</span><span class="sp-syntax-tag">p</span><span class="sp-syntax-punctuation">&gt;</span>
    <span class="sp-syntax-punctuation">&lt;/</span><span class="sp-syntax-punctuation">&gt;</span>
  <span class="sp-syntax-punctuation">)</span><span class="sp-syntax-punctuation">;</span>
<span class="sp-syntax-punctuation">}</span>

</pre></div></div></div><div class=" order-last xl:order-2 sp-stack"><div class="p-0 sm:p-2 md:p-4 lg:p-8 bg-card dark:bg-wash-dark h-full relative md:rounded-b-lg lg:rounded-b-none"><div style="position:relative"><iframe class="rounded-t-none bg-white md:shadow-md sm:rounded-lg w-full max-w-full transition-opacity absolute opacity-0 pointer-events-none duration-75" title="Sandbox Preview" style="height:15px;z-index:-1"></iframe></div></div></div><button translate="yes" class="sandpack-expand flex text-base justify-between dark:border-card-dark bg-wash dark:bg-card-dark items-center z-10 p-1 w-full order-2 xl:order-last border-b-1 relative top-0"><span class="flex p-2 focus:outline-none text-primary dark:text-primary-dark leading-[20px]"><svg class="rotate-0 inline me-1.5 text-xl" xmlns="http://www.w3.org/2000/svg" width="20" height="20" viewBox="0 0 20 20"><g fill="none" fill-rule="evenodd" transform="translate(-446 -398)"><path fill="currentColor" fill-rule="nonzero" d="M95.8838835,240.366117 C95.3957281,239.877961 94.6042719,239.877961 94.1161165,240.366117 C93.6279612,240.854272 93.6279612,241.645728 94.1161165,242.133883 L98.6161165,246.633883 C99.1042719,247.122039 99.8957281,247.122039 100.383883,246.633883 L104.883883,242.133883 C105.372039,241.645728 105.372039,240.854272 104.883883,240.366117 C104.395728,239.877961 103.604272,239.877961 103.116117,240.366117 L99.5,243.982233 L95.8838835,240.366117 Z" transform="translate(356.5 164.5)"></path><polygon points="446 418 466 418 466 398 446 398"></polygon></g></svg>显示更多</span></button></div></div></div></div><!--/$--><p class="whitespace-pre-wrap my-4">比方说，你想“只在 mount 时”运行 Effect。你已经知道可以通过设置 <a class="inline text-link dark:text-link-dark border-b border-link border-opacity-0 hover:border-opacity-100 duration-100 ease-in transition leading-normal" href="/learn/lifecycle-of-reactive-effects#what-an-effect-with-empty-dependencies-means">空（<code dir="ltr" class="inline text-code text-secondary dark:text-secondary-dark px-1 rounded-md no-underline bg-gray-30 bg-opacity-10 py-px">[]</code>）依赖</a> 来达到这种效果，所以你决定忽略 linter 的检查，强行指定 <code dir="ltr" class="inline text-code text-secondary dark:text-secondary-dark px-1 rounded-md no-underline bg-gray-30 bg-opacity-10 py-px">[]</code> 为依赖。</p><p class="whitespace-pre-wrap my-4">上面的计数器例子，本应该每秒递增，递增量可以通过两个按钮来控制。然而，由于你对 React “撒谎”，说这个 Effect 不依赖于任何东西，React 便一直使用初次渲染时的 <code dir="ltr" class="inline text-code text-secondary dark:text-secondary-dark px-1 rounded-md no-underline bg-gray-30 bg-opacity-10 py-px">onTick</code> 函数。<a class="inline text-link dark:text-link-dark border-b border-link border-opacity-0 hover:border-opacity-100 duration-100 ease-in transition leading-normal" href="/learn/state-as-a-snapshot#rendering-takes-a-snapshot-in-time">在后续渲染中</a>， <code dir="ltr" class="inline text-code text-secondary dark:text-secondary-dark px-1 rounded-md no-underline bg-gray-30 bg-opacity-10 py-px">count</code> 总是 <code dir="ltr" class="inline text-code text-secondary dark:text-secondary-dark px-1 rounded-md no-underline bg-gray-30 bg-opacity-10 py-px">0</code> ，<code dir="ltr" class="inline text-code text-secondary dark:text-secondary-dark px-1 rounded-md no-underline bg-gray-30 bg-opacity-10 py-px">increment</code> 总是 <code dir="ltr" class="inline text-code text-secondary dark:text-secondary-dark px-1 rounded-md no-underline bg-gray-30 bg-opacity-10 py-px">1</code>。为什么？因为定时器每秒调用 <code dir="ltr" class="inline text-code text-secondary dark:text-secondary-dark px-1 rounded-md no-underline bg-gray-30 bg-opacity-10 py-px">onTick</code> 函数，实际运行的是 <code dir="ltr" class="inline text-code text-secondary dark:text-secondary-dark px-1 rounded-md no-underline bg-gray-30 bg-opacity-10 py-px">setCount(0 + 1)</code><sup><a class="inline text-link dark:text-link-dark border-b border-link border-opacity-0 hover:border-opacity-100 duration-100 ease-in transition leading-normal" href="#note1">[1]</a></sup>，所以你总是看到 <code dir="ltr" class="inline text-code text-secondary dark:text-secondary-dark px-1 rounded-md no-underline bg-gray-30 bg-opacity-10 py-px">1</code>。像这样的错误，当它们分散在多个组件中时，就更难解决了。</p><p class="whitespace-pre-wrap my-4">这里有一个比忽略 linter 更好的解决方案! 那便是将 <code dir="ltr" class="inline text-code text-secondary dark:text-secondary-dark px-1 rounded-md no-underline bg-gray-30 bg-opacity-10 py-px">onTick</code> 添加到依赖中。(为了确保 interval 只设置一次，<a class="inline text-link dark:text-link-dark border-b border-link border-opacity-0 hover:border-opacity-100 duration-100 ease-in transition leading-normal" href="/learn/separating-events-from-effects#reading-latest-props-and-state-with-effect-events">使 <code dir="ltr" class="inline text-code text-secondary dark:text-secondary-dark px-1 rounded-md no-underline bg-gray-30 bg-opacity-10 py-px">onTick</code> 成为 Effect Event</a>。)</p><p class="whitespace-pre-wrap my-4"><strong class="font-bold">我们建议将依赖性 lint 错误作为一个编译错误来处理。如果你不抑制它，你将永远不会遇到像上面这样的错误</strong>。本页面的剩下部分将介绍这个和其他情况的替代方案。</p></div></details>
<h2 id="removing-unnecessary-dependencies" class="mdx-heading text-3xl font-display leading-10 text-primary dark:text-primary-dark font-bold my-6">移除非必需的依赖 <a href="#removing-unnecessary-dependencies" aria-label="Link for 移除非必需的依赖 " title="Link for 移除非必需的依赖 " class="mdx-header-anchor inline-block"><svg width="1em" height="1em" viewBox="0 0 13 13" xmlns="http://www.w3.org/2000/svg" class="text-gray-70 ms-2 h-5 w-5"><g fill="currentColor" fill-rule="evenodd"><path d="M7.778 7.975a2.5 2.5 0 0 0 .347-3.837L6.017 2.03a2.498 2.498 0 0 0-3.542-.007 2.5 2.5 0 0 0 .006 3.543l1.153 1.15c.07-.29.154-.563.25-.773.036-.077.084-.16.14-.25L3.18 4.85a1.496 1.496 0 0 1 .002-2.12 1.496 1.496 0 0 1 2.12 0l2.124 2.123a1.496 1.496 0 0 1-.333 2.37c.16.246.42.504.685.752z"></path><path d="M5.657 4.557a2.5 2.5 0 0 0-.347 3.837l2.108 2.108a2.498 2.498 0 0 0 3.542.007 2.5 2.5 0 0 0-.006-3.543L9.802 5.815c-.07.29-.154.565-.25.774-.036.076-.084.16-.14.25l.842.84c.585.587.59 1.532 0 2.122-.587.585-1.532.59-2.12 0L6.008 7.68a1.496 1.496 0 0 1 .332-2.372c-.16-.245-.42-.503-.685-.75z"></path></g></svg></a></h2>
<p class="whitespace-pre-wrap my-4">每当你调整 Effect 的依赖以适配代码时，请注意一下当前的依赖。当这些依赖发生变化时，让 Effect 重新运行是否有意义？有时，答案是“不”：</p>
<ul class="ms-6 my-3 list-disc">
<li class="leading-relaxed mb-1">你可能想在不同的条件下重新执行 Effect 的 <strong class="font-bold">不同部分</strong>。</li>
<li class="leading-relaxed mb-1">你可能想只读取某个依赖的 <strong class="font-bold">最新值</strong>，而不是对其变化做出“反应”。</li>
<li class="leading-relaxed mb-1">依赖可能会因为它的类型是对象或函数而 <strong class="font-bold">无意间</strong> 改变太频繁。</li>
</ul>
<p class="whitespace-pre-wrap my-4">为了找到正确的解决方案，你需要回答关于 Effect 的几个问题。让我们来看看这些问题。</p>
<h3 id="should-this-code-move-to-an-event-handler" class="mdx-heading text-2xl font-display leading-9 text-primary dark:text-primary-dark font-bold my-6">这段代码应该移到事件处理程序中吗？ <a href="#should-this-code-move-to-an-event-handler" aria-label="Link for 这段代码应该移到事件处理程序中吗？ " title="Link for 这段代码应该移到事件处理程序中吗？ " class="mdx-header-anchor inline-block"><svg width="1em" height="1em" viewBox="0 0 13 13" xmlns="http://www.w3.org/2000/svg" class="text-gray-70 ms-2 h-5 w-5"><g fill="currentColor" fill-rule="evenodd"><path d="M7.778 7.975a2.5 2.5 0 0 0 .347-3.837L6.017 2.03a2.498 2.498 0 0 0-3.542-.007 2.5 2.5 0 0 0 .006 3.543l1.153 1.15c.07-.29.154-.563.25-.773.036-.077.084-.16.14-.25L3.18 4.85a1.496 1.496 0 0 1 .002-2.12 1.496 1.496 0 0 1 2.12 0l2.124 2.123a1.496 1.496 0 0 1-.333 2.37c.16.246.42.504.685.752z"></path><path d="M5.657 4.557a2.5 2.5 0 0 0-.347 3.837l2.108 2.108a2.498 2.498 0 0 0 3.542.007 2.5 2.5 0 0 0-.006-3.543L9.802 5.815c-.07.29-.154.565-.25.774-.036.076-.084.16-.14.25l.842.84c.585.587.59 1.532 0 2.122-.587.585-1.532.59-2.12 0L6.008 7.68a1.496 1.496 0 0 1 .332-2.372c-.16-.245-.42-.503-.685-.75z"></path></g></svg></a></h3>
<p class="whitespace-pre-wrap my-4">你应该考虑的第一件事是，这段代码是否应该成为 Effect。</p>
<p class="whitespace-pre-wrap my-4">想象一个表单，在提交时你将 <code dir="ltr" class="inline text-code text-secondary dark:text-secondary-dark px-1 rounded-md no-underline bg-gray-30 bg-opacity-10 py-px">submitted</code> 状态变量设置为 <code dir="ltr" class="inline text-code text-secondary dark:text-secondary-dark px-1 rounded-md no-underline bg-gray-30 bg-opacity-10 py-px">true</code>，并在 <code dir="ltr" class="inline text-code text-secondary dark:text-secondary-dark px-1 rounded-md no-underline bg-gray-30 bg-opacity-10 py-px">submitted</code> 为 <code dir="ltr" class="inline text-code text-secondary dark:text-secondary-dark px-1 rounded-md no-underline bg-gray-30 bg-opacity-10 py-px">true</code> 时，需要发送 POST 请求并显示通知。你把这个逻辑放在 Effect 内，并根据 <code dir="ltr" class="inline text-code text-secondary dark:text-secondary-dark px-1 rounded-md no-underline bg-gray-30 bg-opacity-10 py-px">submitted</code> 为 <code dir="ltr" class="inline text-code text-secondary dark:text-secondary-dark px-1 rounded-md no-underline bg-gray-30 bg-opacity-10 py-px">true</code> “反应”。</p>
<!--$--><div dir="ltr" class="sandpack sandpack--codeblock rounded-2xl h-full w-full overflow-x-auto flex items-center bg-wash dark:bg-gray-95 shadow-lg my-8" style="contain:content"><div class="sp-wrapper"><div class="sp-stack"><div class="sp-code-editor"><pre class="sp-cm sp-pristine sp-javascript flex align-start"><code class="sp-pre-placeholder grow-[2]"><div class="cm-line "><span class="sp-syntax-keyword">function</span> <span class="sp-syntax-definition">Form</span><span class="sp-syntax-punctuation">(</span><span class="sp-syntax-punctuation">)</span> <span class="sp-syntax-punctuation">{</span><br/></div><div class="cm-line ">  <span class="sp-syntax-keyword">const</span> <span class="sp-syntax-punctuation">[</span><span class="sp-syntax-plain">submitted</span><span class="sp-syntax-punctuation">,</span> <span class="sp-syntax-plain">setSubmitted</span><span class="sp-syntax-punctuation">]</span> = <span class="sp-syntax-definition">useState</span><span class="sp-syntax-punctuation">(</span><span class="sp-syntax-static">false</span><span class="sp-syntax-punctuation">)</span><span class="sp-syntax-punctuation">;</span><br/></div><div class="cm-line "><br/></div><div class="cm-line ">  <span class="sp-syntax-definition">useEffect</span><span class="sp-syntax-punctuation">(</span><span class="sp-syntax-punctuation">(</span><span class="sp-syntax-punctuation">)</span> <span class="sp-syntax-punctuation">=&gt;</span> <span class="sp-syntax-punctuation">{</span><br/></div><div class="cm-line ">    <span class="sp-syntax-keyword">if</span> <span class="sp-syntax-punctuation">(</span><span class="sp-syntax-plain">submitted</span><span class="sp-syntax-punctuation">)</span> <span class="sp-syntax-punctuation">{</span><br/></div><div class="cm-line bg-github-highlight dark:bg-opacity-10">      <span class="sp-syntax-comment">// 🔴 避免: Effect 中有特定事件的逻辑</span><br/></div><div class="cm-line bg-github-highlight dark:bg-opacity-10">      <span class="sp-syntax-definition">post</span><span class="sp-syntax-punctuation">(</span><span class="sp-syntax-string">&#x27;/api/register&#x27;</span><span class="sp-syntax-punctuation">)</span><span class="sp-syntax-punctuation">;</span><br/></div><div class="cm-line bg-github-highlight dark:bg-opacity-10">      <span class="sp-syntax-definition">showNotification</span><span class="sp-syntax-punctuation">(</span><span class="sp-syntax-string">&#x27;Successfully registered!&#x27;</span><span class="sp-syntax-punctuation">)</span><span class="sp-syntax-punctuation">;</span><br/></div><div class="cm-line ">    <span class="sp-syntax-punctuation">}</span><br/></div><div class="cm-line ">  <span class="sp-syntax-punctuation">}</span><span class="sp-syntax-punctuation">,</span> <span class="sp-syntax-punctuation">[</span><span class="sp-syntax-plain">submitted</span><span class="sp-syntax-punctuation">]</span><span class="sp-syntax-punctuation">)</span><span class="sp-syntax-punctuation">;</span><br/></div><div class="cm-line "><br/></div><div class="cm-line ">  <span class="sp-syntax-keyword">function</span> <span class="sp-syntax-definition">handleSubmit</span><span class="sp-syntax-punctuation">(</span><span class="sp-syntax-punctuation">)</span> <span class="sp-syntax-punctuation">{</span><br/></div><div class="cm-line ">    <span class="sp-syntax-definition">setSubmitted</span><span class="sp-syntax-punctuation">(</span><span class="sp-syntax-static">true</span><span class="sp-syntax-punctuation">)</span><span class="sp-syntax-punctuation">;</span><br/></div><div class="cm-line ">  <span class="sp-syntax-punctuation">}</span><br/></div><div class="cm-line "><br/></div><div class="cm-line ">  <span class="sp-syntax-comment">// ...</span><br/></div><div class="cm-line "><span class="sp-syntax-punctuation">}</span></div></code></pre></div></div></div></div><!--/$-->
<p class="whitespace-pre-wrap my-4">后来，你想通过读取当前的主题值来调整通知信息的样式。因为 <code dir="ltr" class="inline text-code text-secondary dark:text-secondary-dark px-1 rounded-md no-underline bg-gray-30 bg-opacity-10 py-px">theme</code> 是在组件中声明的，所以它是响应式值，你决定把它作为依赖加入：</p>
<!--$--><div dir="ltr" class="sandpack sandpack--codeblock rounded-2xl h-full w-full overflow-x-auto flex items-center bg-wash dark:bg-gray-95 shadow-lg my-8" style="contain:content"><div class="sp-wrapper"><div class="sp-stack"><div class="sp-code-editor"><pre class="sp-cm sp-pristine sp-javascript flex align-start"><code class="sp-pre-placeholder grow-[2]"><div class="cm-line "><span class="sp-syntax-keyword">function</span> <span class="sp-syntax-definition">Form</span><span class="sp-syntax-punctuation">(</span><span class="sp-syntax-punctuation">)</span> <span class="sp-syntax-punctuation">{</span><br/></div><div class="cm-line ">  <span class="sp-syntax-keyword">const</span> <span class="sp-syntax-punctuation">[</span><span class="sp-syntax-plain">submitted</span><span class="sp-syntax-punctuation">,</span> <span class="sp-syntax-plain">setSubmitted</span><span class="sp-syntax-punctuation">]</span> = <span class="sp-syntax-definition">useState</span><span class="sp-syntax-punctuation">(</span><span class="sp-syntax-static">false</span><span class="sp-syntax-punctuation">)</span><span class="sp-syntax-punctuation">;</span><br/></div><div class="cm-line bg-github-highlight dark:bg-opacity-10">  <span class="sp-syntax-keyword">const</span> <span class="sp-syntax-plain">theme</span> = <span class="sp-syntax-definition">useContext</span><span class="sp-syntax-punctuation">(</span><span class="sp-syntax-plain">ThemeContext</span><span class="sp-syntax-punctuation">)</span><span class="sp-syntax-punctuation">;</span><br/></div><div class="cm-line "><br/></div><div class="cm-line ">  <span class="sp-syntax-definition">useEffect</span><span class="sp-syntax-punctuation">(</span><span class="sp-syntax-punctuation">(</span><span class="sp-syntax-punctuation">)</span> <span class="sp-syntax-punctuation">=&gt;</span> <span class="sp-syntax-punctuation">{</span><br/></div><div class="cm-line ">    <span class="sp-syntax-keyword">if</span> <span class="sp-syntax-punctuation">(</span><span class="sp-syntax-plain">submitted</span><span class="sp-syntax-punctuation">)</span> <span class="sp-syntax-punctuation">{</span><br/></div><div class="cm-line ">      <span class="sp-syntax-comment">// 🔴 避免: Effect 中有特定事件的逻辑</span><br/></div><div class="cm-line ">      <span class="sp-syntax-definition">post</span><span class="sp-syntax-punctuation">(</span><span class="sp-syntax-string">&#x27;/api/register&#x27;</span><span class="sp-syntax-punctuation">)</span><span class="sp-syntax-punctuation">;</span><br/></div><div class="cm-line bg-github-highlight dark:bg-opacity-10">      <span class="sp-syntax-definition">showNotification</span><span class="sp-syntax-punctuation">(</span><span class="sp-syntax-string">&#x27;Successfully registered!&#x27;</span><span class="sp-syntax-punctuation">,</span> <span class="sp-syntax-plain">theme</span><span class="sp-syntax-punctuation">)</span><span class="sp-syntax-punctuation">;</span><br/></div><div class="cm-line ">    <span class="sp-syntax-punctuation">}</span><br/></div><div class="cm-line bg-github-highlight dark:bg-opacity-10">  <span class="sp-syntax-punctuation">}</span><span class="sp-syntax-punctuation">,</span> <span class="sp-syntax-punctuation">[</span><span class="sp-syntax-plain">submitted</span><span class="sp-syntax-punctuation">,</span> <span class="sp-syntax-plain">theme</span><span class="sp-syntax-punctuation">]</span><span class="sp-syntax-punctuation">)</span><span class="sp-syntax-punctuation">;</span> <span class="sp-syntax-comment">// ✅ 所有依赖已声明</span><br/></div><div class="cm-line "><br/></div><div class="cm-line ">  <span class="sp-syntax-keyword">function</span> <span class="sp-syntax-definition">handleSubmit</span><span class="sp-syntax-punctuation">(</span><span class="sp-syntax-punctuation">)</span> <span class="sp-syntax-punctuation">{</span><br/></div><div class="cm-line ">    <span class="sp-syntax-definition">setSubmitted</span><span class="sp-syntax-punctuation">(</span><span class="sp-syntax-static">true</span><span class="sp-syntax-punctuation">)</span><span class="sp-syntax-punctuation">;</span><br/></div><div class="cm-line ">  <span class="sp-syntax-punctuation">}</span>  <br/></div><div class="cm-line "><br/></div><div class="cm-line ">  <span class="sp-syntax-comment">// ...</span><br/></div><div class="cm-line "><span class="sp-syntax-punctuation">}</span></div></code></pre></div></div></div></div><!--/$-->
<p class="whitespace-pre-wrap my-4">如果这么做，你将引入一个错误。想象一下，你先提交表单，然后切换暗亮主题。当 <code dir="ltr" class="inline text-code text-secondary dark:text-secondary-dark px-1 rounded-md no-underline bg-gray-30 bg-opacity-10 py-px">theme</code> 改变后，Effect 重新运行，这将导致显示两次相同的通知！</p>
<p class="whitespace-pre-wrap my-4"><strong class="font-bold">首先，这里的问题是，代码不应该以 Effect 实现</strong>。你想发送这个 POST 请求，并在 <strong class="font-bold">提交表单时显示通知</strong>，这是一个特定的交互。特定的交互请将该逻辑直接放到相应的事件处理程序中：</p>
<!--$--><div dir="ltr" class="sandpack sandpack--codeblock rounded-2xl h-full w-full overflow-x-auto flex items-center bg-wash dark:bg-gray-95 shadow-lg my-8" style="contain:content"><div class="sp-wrapper"><div class="sp-stack"><div class="sp-code-editor"><pre class="sp-cm sp-pristine sp-javascript flex align-start"><code class="sp-pre-placeholder grow-[2]"><div class="cm-line "><span class="sp-syntax-keyword">function</span> <span class="sp-syntax-definition">Form</span><span class="sp-syntax-punctuation">(</span><span class="sp-syntax-punctuation">)</span> <span class="sp-syntax-punctuation">{</span><br/></div><div class="cm-line ">  <span class="sp-syntax-keyword">const</span> <span class="sp-syntax-plain">theme</span> = <span class="sp-syntax-definition">useContext</span><span class="sp-syntax-punctuation">(</span><span class="sp-syntax-plain">ThemeContext</span><span class="sp-syntax-punctuation">)</span><span class="sp-syntax-punctuation">;</span><br/></div><div class="cm-line "><br/></div><div class="cm-line ">  <span class="sp-syntax-keyword">function</span> <span class="sp-syntax-definition">handleSubmit</span><span class="sp-syntax-punctuation">(</span><span class="sp-syntax-punctuation">)</span> <span class="sp-syntax-punctuation">{</span><br/></div><div class="cm-line ">    <span class="sp-syntax-comment">// ✅ 好：从事件处理程序调用特定于事件的逻辑</span><br/></div><div class="cm-line bg-github-highlight dark:bg-opacity-10">    <span class="sp-syntax-definition">post</span><span class="sp-syntax-punctuation">(</span><span class="sp-syntax-string">&#x27;/api/register&#x27;</span><span class="sp-syntax-punctuation">)</span><span class="sp-syntax-punctuation">;</span><br/></div><div class="cm-line bg-github-highlight dark:bg-opacity-10">    <span class="sp-syntax-definition">showNotification</span><span class="sp-syntax-punctuation">(</span><span class="sp-syntax-string">&#x27;Successfully registered!&#x27;</span><span class="sp-syntax-punctuation">,</span> <span class="sp-syntax-plain">theme</span><span class="sp-syntax-punctuation">)</span><span class="sp-syntax-punctuation">;</span><br/></div><div class="cm-line ">  <span class="sp-syntax-punctuation">}</span>  <br/></div><div class="cm-line "><br/></div><div class="cm-line ">  <span class="sp-syntax-comment">// ...</span><br/></div><div class="cm-line "><span class="sp-syntax-punctuation">}</span></div></code></pre></div></div></div></div><!--/$-->
<p class="whitespace-pre-wrap my-4">现在，代码在事件处理程序中，它不是响应式的 —— 所以它只在用户提交表单时运行。阅读更多关于 <a class="inline text-link dark:text-link-dark border-b border-link border-opacity-0 hover:border-opacity-100 duration-100 ease-in transition leading-normal" href="/learn/separating-events-from-effects#reactive-values-and-reactive-logic">在事件处理程序和 Effect 之间做出选择</a> 和 <a class="inline text-link dark:text-link-dark border-b border-link border-opacity-0 hover:border-opacity-100 duration-100 ease-in transition leading-normal" href="/learn/you-might-not-need-an-effect">如何删除不必要的 Effect</a>。</p>
<h3 id="is-your-effect-doing-several-unrelated-things" class="mdx-heading text-2xl font-display leading-9 text-primary dark:text-primary-dark font-bold my-6">Effect 是否在做几件不相关的事情？ <a href="#is-your-effect-doing-several-unrelated-things" aria-label="Link for Effect 是否在做几件不相关的事情？ " title="Link for Effect 是否在做几件不相关的事情？ " class="mdx-header-anchor inline-block"><svg width="1em" height="1em" viewBox="0 0 13 13" xmlns="http://www.w3.org/2000/svg" class="text-gray-70 ms-2 h-5 w-5"><g fill="currentColor" fill-rule="evenodd"><path d="M7.778 7.975a2.5 2.5 0 0 0 .347-3.837L6.017 2.03a2.498 2.498 0 0 0-3.542-.007 2.5 2.5 0 0 0 .006 3.543l1.153 1.15c.07-.29.154-.563.25-.773.036-.077.084-.16.14-.25L3.18 4.85a1.496 1.496 0 0 1 .002-2.12 1.496 1.496 0 0 1 2.12 0l2.124 2.123a1.496 1.496 0 0 1-.333 2.37c.16.246.42.504.685.752z"></path><path d="M5.657 4.557a2.5 2.5 0 0 0-.347 3.837l2.108 2.108a2.498 2.498 0 0 0 3.542.007 2.5 2.5 0 0 0-.006-3.543L9.802 5.815c-.07.29-.154.565-.25.774-.036.076-.084.16-.14.25l.842.84c.585.587.59 1.532 0 2.122-.587.585-1.532.59-2.12 0L6.008 7.68a1.496 1.496 0 0 1 .332-2.372c-.16-.245-.42-.503-.685-.75z"></path></g></svg></a></h3>
<p class="whitespace-pre-wrap my-4">下一个应该问自己的问题是，Effect 是否在做几件不相关的事情。</p>
<p class="whitespace-pre-wrap my-4">如下例子，你正在实现运输表单，用户需要选择他们的城市和地区。你根据所选的“国家”从服务器上获取“城市”列表，然后在下拉菜单中显示：</p>
<!--$--><div dir="ltr" class="sandpack sandpack--codeblock rounded-2xl h-full w-full overflow-x-auto flex items-center bg-wash dark:bg-gray-95 shadow-lg my-8" style="contain:content"><div class="sp-wrapper"><div class="sp-stack"><div class="sp-code-editor"><pre class="sp-cm sp-pristine sp-javascript flex align-start"><code class="sp-pre-placeholder grow-[2]"><div class="cm-line "><span class="sp-syntax-keyword">function</span> <span class="sp-syntax-definition">ShippingForm</span><span class="sp-syntax-punctuation">(</span><span class="sp-syntax-punctuation">{</span> <span class="sp-syntax-property">country</span> <span class="sp-syntax-punctuation">}</span><span class="sp-syntax-punctuation">)</span> <span class="sp-syntax-punctuation">{</span><br/></div><div class="cm-line ">  <span class="sp-syntax-keyword">const</span> <span class="sp-syntax-punctuation">[</span><span class="sp-syntax-plain">cities</span><span class="sp-syntax-punctuation">,</span> <span class="sp-syntax-plain">setCities</span><span class="sp-syntax-punctuation">]</span> = <span class="sp-syntax-definition">useState</span><span class="sp-syntax-punctuation">(</span><span class="sp-syntax-keyword">null</span><span class="sp-syntax-punctuation">)</span><span class="sp-syntax-punctuation">;</span><br/></div><div class="cm-line ">  <span class="sp-syntax-keyword">const</span> <span class="sp-syntax-punctuation">[</span><span class="sp-syntax-plain">city</span><span class="sp-syntax-punctuation">,</span> <span class="sp-syntax-plain">setCity</span><span class="sp-syntax-punctuation">]</span> = <span class="sp-syntax-definition">useState</span><span class="sp-syntax-punctuation">(</span><span class="sp-syntax-keyword">null</span><span class="sp-syntax-punctuation">)</span><span class="sp-syntax-punctuation">;</span><br/></div><div class="cm-line "><br/></div><div class="cm-line ">  <span class="sp-syntax-definition">useEffect</span><span class="sp-syntax-punctuation">(</span><span class="sp-syntax-punctuation">(</span><span class="sp-syntax-punctuation">)</span> <span class="sp-syntax-punctuation">=&gt;</span> <span class="sp-syntax-punctuation">{</span><br/></div><div class="cm-line ">    <span class="sp-syntax-keyword">let</span> <span class="sp-syntax-plain">ignore</span> = <span class="sp-syntax-static">false</span><span class="sp-syntax-punctuation">;</span><br/></div><div class="cm-line ">    <span class="sp-syntax-definition">fetch</span><span class="sp-syntax-punctuation">(</span><span class="sp-syntax-string">`/api/cities?country=</span><span class="sp-syntax-punctuation">${</span><span class="sp-syntax-plain">country</span><span class="sp-syntax-punctuation">}</span><span class="sp-syntax-string">`</span><span class="sp-syntax-punctuation">)</span><br/></div><div class="cm-line ">      .<span class="sp-syntax-property">then</span><span class="sp-syntax-punctuation">(</span><span class="sp-syntax-plain">response</span> <span class="sp-syntax-punctuation">=&gt;</span> <span class="sp-syntax-plain">response</span>.<span class="sp-syntax-property">json</span><span class="sp-syntax-punctuation">(</span><span class="sp-syntax-punctuation">)</span><span class="sp-syntax-punctuation">)</span><br/></div><div class="cm-line ">      .<span class="sp-syntax-property">then</span><span class="sp-syntax-punctuation">(</span><span class="sp-syntax-plain">json</span> <span class="sp-syntax-punctuation">=&gt;</span> <span class="sp-syntax-punctuation">{</span><br/></div><div class="cm-line ">        <span class="sp-syntax-keyword">if</span> <span class="sp-syntax-punctuation">(</span>!<span class="sp-syntax-plain">ignore</span><span class="sp-syntax-punctuation">)</span> <span class="sp-syntax-punctuation">{</span><br/></div><div class="cm-line ">          <span class="sp-syntax-definition">setCities</span><span class="sp-syntax-punctuation">(</span><span class="sp-syntax-plain">json</span><span class="sp-syntax-punctuation">)</span><span class="sp-syntax-punctuation">;</span><br/></div><div class="cm-line ">        <span class="sp-syntax-punctuation">}</span><br/></div><div class="cm-line ">      <span class="sp-syntax-punctuation">}</span><span class="sp-syntax-punctuation">)</span><span class="sp-syntax-punctuation">;</span><br/></div><div class="cm-line ">    <span class="sp-syntax-keyword">return</span> <span class="sp-syntax-punctuation">(</span><span class="sp-syntax-punctuation">)</span> <span class="sp-syntax-punctuation">=&gt;</span> <span class="sp-syntax-punctuation">{</span><br/></div><div class="cm-line ">      <span class="sp-syntax-plain">ignore</span> = <span class="sp-syntax-static">true</span><span class="sp-syntax-punctuation">;</span><br/></div><div class="cm-line ">    <span class="sp-syntax-punctuation">}</span><span class="sp-syntax-punctuation">;</span><br/></div><div class="cm-line ">  <span class="sp-syntax-punctuation">}</span><span class="sp-syntax-punctuation">,</span> <span class="sp-syntax-punctuation">[</span><span class="sp-syntax-plain">country</span><span class="sp-syntax-punctuation">]</span><span class="sp-syntax-punctuation">)</span><span class="sp-syntax-punctuation">;</span> <span class="sp-syntax-comment">// ✅ 所有依赖已声明</span><br/></div><div class="cm-line "><br/></div><div class="cm-line ">  <span class="sp-syntax-comment">// ...</span></div></code></pre></div></div></div></div><!--/$-->
<p class="whitespace-pre-wrap my-4">这是一个 <a class="inline text-link dark:text-link-dark border-b border-link border-opacity-0 hover:border-opacity-100 duration-100 ease-in transition leading-normal" href="/learn/you-might-not-need-an-effect#fetching-data">在Effect中获取数据</a> 的好例子：<code dir="ltr" class="inline text-code text-secondary dark:text-secondary-dark px-1 rounded-md no-underline bg-gray-30 bg-opacity-10 py-px">cities</code> state 通过网络和 <code dir="ltr" class="inline text-code text-secondary dark:text-secondary-dark px-1 rounded-md no-underline bg-gray-30 bg-opacity-10 py-px">country</code> props 进行“同步”。但你不能在事件处理程序中这样做，因为你需要在 <code dir="ltr" class="inline text-code text-secondary dark:text-secondary-dark px-1 rounded-md no-underline bg-gray-30 bg-opacity-10 py-px">ShippingForm</code> 显示时和 <code dir="ltr" class="inline text-code text-secondary dark:text-secondary-dark px-1 rounded-md no-underline bg-gray-30 bg-opacity-10 py-px">country</code> 发生变化时（不管是哪个交互导致的）立即获取。</p>
<p class="whitespace-pre-wrap my-4">现在我们假设你要为城市区域添加第二个选择框，它应该获取当前选择的 <code dir="ltr" class="inline text-code text-secondary dark:text-secondary-dark px-1 rounded-md no-underline bg-gray-30 bg-opacity-10 py-px">city</code> 的 <code dir="ltr" class="inline text-code text-secondary dark:text-secondary-dark px-1 rounded-md no-underline bg-gray-30 bg-opacity-10 py-px">areas</code>。你也许会在同一个 Effect 中添加第二个 <code dir="ltr" class="inline text-code text-secondary dark:text-secondary-dark px-1 rounded-md no-underline bg-gray-30 bg-opacity-10 py-px">fetch</code> 调用来获取地区列表：</p>
<!--$--><div dir="ltr" class="sandpack sandpack--codeblock rounded-2xl h-full w-full overflow-x-auto flex items-center bg-wash dark:bg-gray-95 shadow-lg my-8" style="contain:content"><div class="sp-wrapper"><div class="sp-stack"><div class="sp-code-editor"><pre class="sp-cm sp-pristine sp-javascript flex align-start"><code class="sp-pre-placeholder grow-[2]"><div class="cm-line "><span class="sp-syntax-keyword">function</span> <span class="sp-syntax-definition">ShippingForm</span><span class="sp-syntax-punctuation">(</span><span class="sp-syntax-punctuation">{</span> <span class="sp-syntax-property">country</span> <span class="sp-syntax-punctuation">}</span><span class="sp-syntax-punctuation">)</span> <span class="sp-syntax-punctuation">{</span><br/></div><div class="cm-line ">  <span class="sp-syntax-keyword">const</span> <span class="sp-syntax-punctuation">[</span><span class="sp-syntax-plain">cities</span><span class="sp-syntax-punctuation">,</span> <span class="sp-syntax-plain">setCities</span><span class="sp-syntax-punctuation">]</span> = <span class="sp-syntax-definition">useState</span><span class="sp-syntax-punctuation">(</span><span class="sp-syntax-keyword">null</span><span class="sp-syntax-punctuation">)</span><span class="sp-syntax-punctuation">;</span><br/></div><div class="cm-line ">  <span class="sp-syntax-keyword">const</span> <span class="sp-syntax-punctuation">[</span><span class="sp-syntax-plain">city</span><span class="sp-syntax-punctuation">,</span> <span class="sp-syntax-plain">setCity</span><span class="sp-syntax-punctuation">]</span> = <span class="sp-syntax-definition">useState</span><span class="sp-syntax-punctuation">(</span><span class="sp-syntax-keyword">null</span><span class="sp-syntax-punctuation">)</span><span class="sp-syntax-punctuation">;</span><br/></div><div class="cm-line ">  <span class="sp-syntax-keyword">const</span> <span class="sp-syntax-punctuation">[</span><span class="sp-syntax-plain">areas</span><span class="sp-syntax-punctuation">,</span> <span class="sp-syntax-plain">setAreas</span><span class="sp-syntax-punctuation">]</span> = <span class="sp-syntax-definition">useState</span><span class="sp-syntax-punctuation">(</span><span class="sp-syntax-keyword">null</span><span class="sp-syntax-punctuation">)</span><span class="sp-syntax-punctuation">;</span><br/></div><div class="cm-line "><br/></div><div class="cm-line ">  <span class="sp-syntax-definition">useEffect</span><span class="sp-syntax-punctuation">(</span><span class="sp-syntax-punctuation">(</span><span class="sp-syntax-punctuation">)</span> <span class="sp-syntax-punctuation">=&gt;</span> <span class="sp-syntax-punctuation">{</span><br/></div><div class="cm-line ">    <span class="sp-syntax-keyword">let</span> <span class="sp-syntax-plain">ignore</span> = <span class="sp-syntax-static">false</span><span class="sp-syntax-punctuation">;</span><br/></div><div class="cm-line ">    <span class="sp-syntax-definition">fetch</span><span class="sp-syntax-punctuation">(</span><span class="sp-syntax-string">`/api/cities?country=</span><span class="sp-syntax-punctuation">${</span><span class="sp-syntax-plain">country</span><span class="sp-syntax-punctuation">}</span><span class="sp-syntax-string">`</span><span class="sp-syntax-punctuation">)</span><br/></div><div class="cm-line ">      .<span class="sp-syntax-property">then</span><span class="sp-syntax-punctuation">(</span><span class="sp-syntax-plain">response</span> <span class="sp-syntax-punctuation">=&gt;</span> <span class="sp-syntax-plain">response</span>.<span class="sp-syntax-property">json</span><span class="sp-syntax-punctuation">(</span><span class="sp-syntax-punctuation">)</span><span class="sp-syntax-punctuation">)</span><br/></div><div class="cm-line ">      .<span class="sp-syntax-property">then</span><span class="sp-syntax-punctuation">(</span><span class="sp-syntax-plain">json</span> <span class="sp-syntax-punctuation">=&gt;</span> <span class="sp-syntax-punctuation">{</span><br/></div><div class="cm-line ">        <span class="sp-syntax-keyword">if</span> <span class="sp-syntax-punctuation">(</span>!<span class="sp-syntax-plain">ignore</span><span class="sp-syntax-punctuation">)</span> <span class="sp-syntax-punctuation">{</span><br/></div><div class="cm-line ">          <span class="sp-syntax-definition">setCities</span><span class="sp-syntax-punctuation">(</span><span class="sp-syntax-plain">json</span><span class="sp-syntax-punctuation">)</span><span class="sp-syntax-punctuation">;</span><br/></div><div class="cm-line ">        <span class="sp-syntax-punctuation">}</span><br/></div><div class="cm-line ">      <span class="sp-syntax-punctuation">}</span><span class="sp-syntax-punctuation">)</span><span class="sp-syntax-punctuation">;</span><br/></div><div class="cm-line bg-github-highlight dark:bg-opacity-10">    <span class="sp-syntax-comment">// 🔴 避免: 单个 Effect 同步两个独立逻辑处理</span><br/></div><div class="cm-line bg-github-highlight dark:bg-opacity-10">    <span class="sp-syntax-keyword">if</span> <span class="sp-syntax-punctuation">(</span><span class="sp-syntax-plain">city</span><span class="sp-syntax-punctuation">)</span> <span class="sp-syntax-punctuation">{</span><br/></div><div class="cm-line bg-github-highlight dark:bg-opacity-10">      <span class="sp-syntax-definition">fetch</span><span class="sp-syntax-punctuation">(</span><span class="sp-syntax-string">`/api/areas?city=</span><span class="sp-syntax-punctuation">${</span><span class="sp-syntax-plain">city</span><span class="sp-syntax-punctuation">}</span><span class="sp-syntax-string">`</span><span class="sp-syntax-punctuation">)</span><br/></div><div class="cm-line bg-github-highlight dark:bg-opacity-10">        .<span class="sp-syntax-property">then</span><span class="sp-syntax-punctuation">(</span><span class="sp-syntax-plain">response</span> <span class="sp-syntax-punctuation">=&gt;</span> <span class="sp-syntax-plain">response</span>.<span class="sp-syntax-property">json</span><span class="sp-syntax-punctuation">(</span><span class="sp-syntax-punctuation">)</span><span class="sp-syntax-punctuation">)</span><br/></div><div class="cm-line bg-github-highlight dark:bg-opacity-10">        .<span class="sp-syntax-property">then</span><span class="sp-syntax-punctuation">(</span><span class="sp-syntax-plain">json</span> <span class="sp-syntax-punctuation">=&gt;</span> <span class="sp-syntax-punctuation">{</span><br/></div><div class="cm-line bg-github-highlight dark:bg-opacity-10">          <span class="sp-syntax-keyword">if</span> <span class="sp-syntax-punctuation">(</span>!<span class="sp-syntax-plain">ignore</span><span class="sp-syntax-punctuation">)</span> <span class="sp-syntax-punctuation">{</span><br/></div><div class="cm-line bg-github-highlight dark:bg-opacity-10">            <span class="sp-syntax-definition">setAreas</span><span class="sp-syntax-punctuation">(</span><span class="sp-syntax-plain">json</span><span class="sp-syntax-punctuation">)</span><span class="sp-syntax-punctuation">;</span><br/></div><div class="cm-line bg-github-highlight dark:bg-opacity-10">          <span class="sp-syntax-punctuation">}</span><br/></div><div class="cm-line bg-github-highlight dark:bg-opacity-10">        <span class="sp-syntax-punctuation">}</span><span class="sp-syntax-punctuation">)</span><span class="sp-syntax-punctuation">;</span><br/></div><div class="cm-line bg-github-highlight dark:bg-opacity-10">    <span class="sp-syntax-punctuation">}</span><br/></div><div class="cm-line ">    <span class="sp-syntax-keyword">return</span> <span class="sp-syntax-punctuation">(</span><span class="sp-syntax-punctuation">)</span> <span class="sp-syntax-punctuation">=&gt;</span> <span class="sp-syntax-punctuation">{</span><br/></div><div class="cm-line ">      <span class="sp-syntax-plain">ignore</span> = <span class="sp-syntax-static">true</span><span class="sp-syntax-punctuation">;</span><br/></div><div class="cm-line ">    <span class="sp-syntax-punctuation">}</span><span class="sp-syntax-punctuation">;</span><br/></div><div class="cm-line bg-github-highlight dark:bg-opacity-10">  <span class="sp-syntax-punctuation">}</span><span class="sp-syntax-punctuation">,</span> <span class="sp-syntax-punctuation">[</span><span class="sp-syntax-plain">country</span><span class="sp-syntax-punctuation">,</span> <span class="sp-syntax-plain">city</span><span class="sp-syntax-punctuation">]</span><span class="sp-syntax-punctuation">)</span><span class="sp-syntax-punctuation">;</span> <span class="sp-syntax-comment">// ✅ 所有依赖已声明</span><br/></div><div class="cm-line "><br/></div><div class="cm-line ">  <span class="sp-syntax-comment">// ...</span></div></code></pre></div></div></div></div><!--/$-->
<p class="whitespace-pre-wrap my-4">然而，由于 Effect 现在使用 <code dir="ltr" class="inline text-code text-secondary dark:text-secondary-dark px-1 rounded-md no-underline bg-gray-30 bg-opacity-10 py-px">city</code> state 变量，你不得不把 <code dir="ltr" class="inline text-code text-secondary dark:text-secondary-dark px-1 rounded-md no-underline bg-gray-30 bg-opacity-10 py-px">city</code> 加入到依赖中。这又带来一个问题：当用户选择不同的城市时，Effect 将重新运行并调用 <code dir="ltr" class="inline text-code text-secondary dark:text-secondary-dark px-1 rounded-md no-underline bg-gray-30 bg-opacity-10 py-px">fetchCities(country)</code>。这将导致不必要地多次获取城市列表。</p>
<p class="whitespace-pre-wrap my-4"><strong class="font-bold">这段代码的问题在于，你在同步两个不同的、不相关的东西</strong>：</p>
<ol class="ms-6 my-3 list-decimal">
<li class="leading-relaxed mb-1">你想要根据 <code dir="ltr" class="inline text-code text-secondary dark:text-secondary-dark px-1 rounded-md no-underline bg-gray-30 bg-opacity-10 py-px">country</code> props 通过网络同步 <code dir="ltr" class="inline text-code text-secondary dark:text-secondary-dark px-1 rounded-md no-underline bg-gray-30 bg-opacity-10 py-px">city</code> state</li>
<li class="leading-relaxed mb-1">你想要根据 <code dir="ltr" class="inline text-code text-secondary dark:text-secondary-dark px-1 rounded-md no-underline bg-gray-30 bg-opacity-10 py-px">city</code> 状态通过网络同步 <code dir="ltr" class="inline text-code text-secondary dark:text-secondary-dark px-1 rounded-md no-underline bg-gray-30 bg-opacity-10 py-px">areas</code> state</li>
</ol>
<p class="whitespace-pre-wrap my-4">将逻辑分到 2 个 Effect 中，每个 Effect 仅响应其需要同步响应的 props：</p>
<!--$--><div dir="ltr" class="sandpack sandpack--codeblock rounded-2xl h-full w-full overflow-x-auto flex items-center bg-wash dark:bg-gray-95 shadow-lg my-8" style="contain:content"><div class="sp-wrapper"><div class="sp-stack"><div class="sp-code-editor"><pre class="sp-cm sp-pristine sp-javascript flex align-start"><code class="sp-pre-placeholder grow-[2]"><div class="cm-line "><span class="sp-syntax-keyword">function</span> <span class="sp-syntax-definition">ShippingForm</span><span class="sp-syntax-punctuation">(</span><span class="sp-syntax-punctuation">{</span> <span class="sp-syntax-property">country</span> <span class="sp-syntax-punctuation">}</span><span class="sp-syntax-punctuation">)</span> <span class="sp-syntax-punctuation">{</span><br/></div><div class="cm-line ">  <span class="sp-syntax-keyword">const</span> <span class="sp-syntax-punctuation">[</span><span class="sp-syntax-plain">cities</span><span class="sp-syntax-punctuation">,</span> <span class="sp-syntax-plain">setCities</span><span class="sp-syntax-punctuation">]</span> = <span class="sp-syntax-definition">useState</span><span class="sp-syntax-punctuation">(</span><span class="sp-syntax-keyword">null</span><span class="sp-syntax-punctuation">)</span><span class="sp-syntax-punctuation">;</span><br/></div><div class="cm-line ">  <span class="sp-syntax-definition">useEffect</span><span class="sp-syntax-punctuation">(</span><span class="sp-syntax-punctuation">(</span><span class="sp-syntax-punctuation">)</span> <span class="sp-syntax-punctuation">=&gt;</span> <span class="sp-syntax-punctuation">{</span><br/></div><div class="cm-line ">    <span class="sp-syntax-keyword">let</span> <span class="sp-syntax-plain">ignore</span> = <span class="sp-syntax-static">false</span><span class="sp-syntax-punctuation">;</span><br/></div><div class="cm-line ">    <span class="sp-syntax-definition">fetch</span><span class="sp-syntax-punctuation">(</span><span class="sp-syntax-string">`/api/cities?country=</span><span class="sp-syntax-punctuation">${</span><span class="sp-syntax-plain">country</span><span class="sp-syntax-punctuation">}</span><span class="sp-syntax-string">`</span><span class="sp-syntax-punctuation">)</span><br/></div><div class="cm-line ">      .<span class="sp-syntax-property">then</span><span class="sp-syntax-punctuation">(</span><span class="sp-syntax-plain">response</span> <span class="sp-syntax-punctuation">=&gt;</span> <span class="sp-syntax-plain">response</span>.<span class="sp-syntax-property">json</span><span class="sp-syntax-punctuation">(</span><span class="sp-syntax-punctuation">)</span><span class="sp-syntax-punctuation">)</span><br/></div><div class="cm-line ">      .<span class="sp-syntax-property">then</span><span class="sp-syntax-punctuation">(</span><span class="sp-syntax-plain">json</span> <span class="sp-syntax-punctuation">=&gt;</span> <span class="sp-syntax-punctuation">{</span><br/></div><div class="cm-line ">        <span class="sp-syntax-keyword">if</span> <span class="sp-syntax-punctuation">(</span>!<span class="sp-syntax-plain">ignore</span><span class="sp-syntax-punctuation">)</span> <span class="sp-syntax-punctuation">{</span><br/></div><div class="cm-line ">          <span class="sp-syntax-definition">setCities</span><span class="sp-syntax-punctuation">(</span><span class="sp-syntax-plain">json</span><span class="sp-syntax-punctuation">)</span><span class="sp-syntax-punctuation">;</span><br/></div><div class="cm-line ">        <span class="sp-syntax-punctuation">}</span><br/></div><div class="cm-line ">      <span class="sp-syntax-punctuation">}</span><span class="sp-syntax-punctuation">)</span><span class="sp-syntax-punctuation">;</span><br/></div><div class="cm-line ">    <span class="sp-syntax-keyword">return</span> <span class="sp-syntax-punctuation">(</span><span class="sp-syntax-punctuation">)</span> <span class="sp-syntax-punctuation">=&gt;</span> <span class="sp-syntax-punctuation">{</span><br/></div><div class="cm-line ">      <span class="sp-syntax-plain">ignore</span> = <span class="sp-syntax-static">true</span><span class="sp-syntax-punctuation">;</span><br/></div><div class="cm-line ">    <span class="sp-syntax-punctuation">}</span><span class="sp-syntax-punctuation">;</span><br/></div><div class="cm-line ">  <span class="sp-syntax-punctuation">}</span><span class="sp-syntax-punctuation">,</span> <span class="sp-syntax-punctuation">[</span><span class="sp-syntax-plain">country</span><span class="sp-syntax-punctuation">]</span><span class="sp-syntax-punctuation">)</span><span class="sp-syntax-punctuation">;</span> <span class="sp-syntax-comment">// ✅ 所有依赖已声明</span><br/></div><div class="cm-line "><br/></div><div class="cm-line ">  <span class="sp-syntax-keyword">const</span> <span class="sp-syntax-punctuation">[</span><span class="sp-syntax-plain">city</span><span class="sp-syntax-punctuation">,</span> <span class="sp-syntax-plain">setCity</span><span class="sp-syntax-punctuation">]</span> = <span class="sp-syntax-definition">useState</span><span class="sp-syntax-punctuation">(</span><span class="sp-syntax-keyword">null</span><span class="sp-syntax-punctuation">)</span><span class="sp-syntax-punctuation">;</span><br/></div><div class="cm-line ">  <span class="sp-syntax-keyword">const</span> <span class="sp-syntax-punctuation">[</span><span class="sp-syntax-plain">areas</span><span class="sp-syntax-punctuation">,</span> <span class="sp-syntax-plain">setAreas</span><span class="sp-syntax-punctuation">]</span> = <span class="sp-syntax-definition">useState</span><span class="sp-syntax-punctuation">(</span><span class="sp-syntax-keyword">null</span><span class="sp-syntax-punctuation">)</span><span class="sp-syntax-punctuation">;</span><br/></div><div class="cm-line bg-github-highlight dark:bg-opacity-10">  <span class="sp-syntax-definition">useEffect</span><span class="sp-syntax-punctuation">(</span><span class="sp-syntax-punctuation">(</span><span class="sp-syntax-punctuation">)</span> <span class="sp-syntax-punctuation">=&gt;</span> <span class="sp-syntax-punctuation">{</span><br/></div><div class="cm-line bg-github-highlight dark:bg-opacity-10">    <span class="sp-syntax-keyword">if</span> <span class="sp-syntax-punctuation">(</span><span class="sp-syntax-plain">city</span><span class="sp-syntax-punctuation">)</span> <span class="sp-syntax-punctuation">{</span><br/></div><div class="cm-line bg-github-highlight dark:bg-opacity-10">      <span class="sp-syntax-keyword">let</span> <span class="sp-syntax-plain">ignore</span> = <span class="sp-syntax-static">false</span><span class="sp-syntax-punctuation">;</span><br/></div><div class="cm-line bg-github-highlight dark:bg-opacity-10">      <span class="sp-syntax-definition">fetch</span><span class="sp-syntax-punctuation">(</span><span class="sp-syntax-string">`/api/areas?city=</span><span class="sp-syntax-punctuation">${</span><span class="sp-syntax-plain">city</span><span class="sp-syntax-punctuation">}</span><span class="sp-syntax-string">`</span><span class="sp-syntax-punctuation">)</span><br/></div><div class="cm-line bg-github-highlight dark:bg-opacity-10">        .<span class="sp-syntax-property">then</span><span class="sp-syntax-punctuation">(</span><span class="sp-syntax-plain">response</span> <span class="sp-syntax-punctuation">=&gt;</span> <span class="sp-syntax-plain">response</span>.<span class="sp-syntax-property">json</span><span class="sp-syntax-punctuation">(</span><span class="sp-syntax-punctuation">)</span><span class="sp-syntax-punctuation">)</span><br/></div><div class="cm-line bg-github-highlight dark:bg-opacity-10">        .<span class="sp-syntax-property">then</span><span class="sp-syntax-punctuation">(</span><span class="sp-syntax-plain">json</span> <span class="sp-syntax-punctuation">=&gt;</span> <span class="sp-syntax-punctuation">{</span><br/></div><div class="cm-line bg-github-highlight dark:bg-opacity-10">          <span class="sp-syntax-keyword">if</span> <span class="sp-syntax-punctuation">(</span>!<span class="sp-syntax-plain">ignore</span><span class="sp-syntax-punctuation">)</span> <span class="sp-syntax-punctuation">{</span><br/></div><div class="cm-line bg-github-highlight dark:bg-opacity-10">            <span class="sp-syntax-definition">setAreas</span><span class="sp-syntax-punctuation">(</span><span class="sp-syntax-plain">json</span><span class="sp-syntax-punctuation">)</span><span class="sp-syntax-punctuation">;</span><br/></div><div class="cm-line bg-github-highlight dark:bg-opacity-10">          <span class="sp-syntax-punctuation">}</span><br/></div><div class="cm-line bg-github-highlight dark:bg-opacity-10">        <span class="sp-syntax-punctuation">}</span><span class="sp-syntax-punctuation">)</span><span class="sp-syntax-punctuation">;</span><br/></div><div class="cm-line bg-github-highlight dark:bg-opacity-10">      <span class="sp-syntax-keyword">return</span> <span class="sp-syntax-punctuation">(</span><span class="sp-syntax-punctuation">)</span> <span class="sp-syntax-punctuation">=&gt;</span> <span class="sp-syntax-punctuation">{</span><br/></div><div class="cm-line bg-github-highlight dark:bg-opacity-10">        <span class="sp-syntax-plain">ignore</span> = <span class="sp-syntax-static">true</span><span class="sp-syntax-punctuation">;</span><br/></div><div class="cm-line bg-github-highlight dark:bg-opacity-10">      <span class="sp-syntax-punctuation">}</span><span class="sp-syntax-punctuation">;</span><br/></div><div class="cm-line bg-github-highlight dark:bg-opacity-10">    <span class="sp-syntax-punctuation">}</span><br/></div><div class="cm-line bg-github-highlight dark:bg-opacity-10">  <span class="sp-syntax-punctuation">}</span><span class="sp-syntax-punctuation">,</span> <span class="sp-syntax-punctuation">[</span><span class="sp-syntax-plain">city</span><span class="sp-syntax-punctuation">]</span><span class="sp-syntax-punctuation">)</span><span class="sp-syntax-punctuation">;</span> <span class="sp-syntax-comment">// ✅ 所有依赖已声明</span><br/></div><div class="cm-line "><br/></div><div class="cm-line ">  <span class="sp-syntax-comment">// ...</span></div></code></pre></div></div></div></div><!--/$-->
<p class="whitespace-pre-wrap my-4">现在，第一个 Effect 只在 <code dir="ltr" class="inline text-code text-secondary dark:text-secondary-dark px-1 rounded-md no-underline bg-gray-30 bg-opacity-10 py-px">country</code> 改变时重新运行，而第二个 Effect 在 <code dir="ltr" class="inline text-code text-secondary dark:text-secondary-dark px-1 rounded-md no-underline bg-gray-30 bg-opacity-10 py-px">city</code> 改变时重新运行。你已经按目的把它们分开了：两件不同的事情由两个独立的 Effect 来同步。两个独立的 Effect 有两个独立的依赖，所以它们不会在无意中相互触发。</p>
<p class="whitespace-pre-wrap my-4">最终完成的代码比最初的要长，但是拆分这些 Effect 是非常正确的。<a class="inline text-link dark:text-link-dark border-b border-link border-opacity-0 hover:border-opacity-100 duration-100 ease-in transition leading-normal" href="/learn/lifecycle-of-reactive-effects#each-effect-represents-a-separate-synchronization-process">每个 Effect 应该代表一个独立的同步过程</a>。在这个例子中，删除一个 Effect 并不会影响到另一个 Effect 的逻辑。这意味着他们 <strong class="font-bold">同步不同的事情</strong>，分开他们处理是一件好事。如果你担心重复代码的问题，你可以通过 <a class="inline text-link dark:text-link-dark border-b border-link border-opacity-0 hover:border-opacity-100 duration-100 ease-in transition leading-normal" href="/learn/reusing-logic-with-custom-hooks#when-to-use-custom-hooks">提取相同逻辑到自定义 Hook</a> 来提升代码质量</p>
<h3 id="are-you-reading-some-state-to-calculate-the-next-state" class="mdx-heading text-2xl font-display leading-9 text-primary dark:text-primary-dark font-bold my-6">是否在读取一些状态来计算下一个状态？ <a href="#are-you-reading-some-state-to-calculate-the-next-state" aria-label="Link for 是否在读取一些状态来计算下一个状态？ " title="Link for 是否在读取一些状态来计算下一个状态？ " class="mdx-header-anchor inline-block"><svg width="1em" height="1em" viewBox="0 0 13 13" xmlns="http://www.w3.org/2000/svg" class="text-gray-70 ms-2 h-5 w-5"><g fill="currentColor" fill-rule="evenodd"><path d="M7.778 7.975a2.5 2.5 0 0 0 .347-3.837L6.017 2.03a2.498 2.498 0 0 0-3.542-.007 2.5 2.5 0 0 0 .006 3.543l1.153 1.15c.07-.29.154-.563.25-.773.036-.077.084-.16.14-.25L3.18 4.85a1.496 1.496 0 0 1 .002-2.12 1.496 1.496 0 0 1 2.12 0l2.124 2.123a1.496 1.496 0 0 1-.333 2.37c.16.246.42.504.685.752z"></path><path d="M5.657 4.557a2.5 2.5 0 0 0-.347 3.837l2.108 2.108a2.498 2.498 0 0 0 3.542.007 2.5 2.5 0 0 0-.006-3.543L9.802 5.815c-.07.29-.154.565-.25.774-.036.076-.084.16-.14.25l.842.84c.585.587.59 1.532 0 2.122-.587.585-1.532.59-2.12 0L6.008 7.68a1.496 1.496 0 0 1 .332-2.372c-.16-.245-.42-.503-.685-.75z"></path></g></svg></a></h3>
<p class="whitespace-pre-wrap my-4">每次有新的消息到达时，这个 Effect 会用新创建的数组更新 <code dir="ltr" class="inline text-code text-secondary dark:text-secondary-dark px-1 rounded-md no-underline bg-gray-30 bg-opacity-10 py-px">messages</code> state：</p>
<!--$--><div dir="ltr" class="sandpack sandpack--codeblock rounded-2xl h-full w-full overflow-x-auto flex items-center bg-wash dark:bg-gray-95 shadow-lg my-8" style="contain:content"><div class="sp-wrapper"><div class="sp-stack"><div class="sp-code-editor"><pre class="sp-cm sp-pristine sp-javascript flex align-start"><code class="sp-pre-placeholder grow-[2]"><div class="cm-line "><span class="sp-syntax-keyword">function</span> <span class="sp-syntax-definition">ChatRoom</span><span class="sp-syntax-punctuation">(</span><span class="sp-syntax-punctuation">{</span> <span class="sp-syntax-property">roomId</span> <span class="sp-syntax-punctuation">}</span><span class="sp-syntax-punctuation">)</span> <span class="sp-syntax-punctuation">{</span><br/></div><div class="cm-line bg-github-highlight dark:bg-opacity-10">  <span class="sp-syntax-keyword">const</span> <span class="sp-syntax-punctuation">[</span><span class="sp-syntax-plain">messages</span><span class="sp-syntax-punctuation">,</span> <span class="sp-syntax-plain">setMessages</span><span class="sp-syntax-punctuation">]</span> = <span class="sp-syntax-definition">useState</span><span class="sp-syntax-punctuation">(</span><span class="sp-syntax-punctuation">[</span><span class="sp-syntax-punctuation">]</span><span class="sp-syntax-punctuation">)</span><span class="sp-syntax-punctuation">;</span><br/></div><div class="cm-line ">  <span class="sp-syntax-definition">useEffect</span><span class="sp-syntax-punctuation">(</span><span class="sp-syntax-punctuation">(</span><span class="sp-syntax-punctuation">)</span> <span class="sp-syntax-punctuation">=&gt;</span> <span class="sp-syntax-punctuation">{</span><br/></div><div class="cm-line ">    <span class="sp-syntax-keyword">const</span> <span class="sp-syntax-plain">connection</span> = <span class="sp-syntax-definition">createConnection</span><span class="sp-syntax-punctuation">(</span><span class="sp-syntax-punctuation">)</span><span class="sp-syntax-punctuation">;</span><br/></div><div class="cm-line ">    <span class="sp-syntax-plain">connection</span>.<span class="sp-syntax-property">connect</span><span class="sp-syntax-punctuation">(</span><span class="sp-syntax-punctuation">)</span><span class="sp-syntax-punctuation">;</span><br/></div><div class="cm-line bg-github-highlight dark:bg-opacity-10">    <span class="sp-syntax-plain">connection</span>.<span class="sp-syntax-property">on</span><span class="sp-syntax-punctuation">(</span><span class="sp-syntax-string">&#x27;message&#x27;</span><span class="sp-syntax-punctuation">,</span> <span class="sp-syntax-punctuation">(</span><span class="sp-syntax-plain">receivedMessage</span><span class="sp-syntax-punctuation">)</span> <span class="sp-syntax-punctuation">=&gt;</span> <span class="sp-syntax-punctuation">{</span><br/></div><div class="cm-line bg-github-highlight dark:bg-opacity-10">      <span class="sp-syntax-definition">setMessages</span><span class="sp-syntax-punctuation">(</span><span class="sp-syntax-punctuation">[</span><span class="sp-syntax-punctuation">...</span><span class="sp-syntax-plain">messages</span><span class="sp-syntax-punctuation">,</span> <span class="sp-syntax-plain">receivedMessage</span><span class="sp-syntax-punctuation">]</span><span class="sp-syntax-punctuation">)</span><span class="sp-syntax-punctuation">;</span><br/></div><div class="cm-line bg-github-highlight dark:bg-opacity-10">    <span class="sp-syntax-punctuation">}</span><span class="sp-syntax-punctuation">)</span><span class="sp-syntax-punctuation">;</span><br/></div><div class="cm-line ">    <span class="sp-syntax-comment">// ...</span></div></code></pre></div></div></div></div><!--/$-->
<p class="whitespace-pre-wrap my-4">它使用 <code dir="ltr" class="inline text-code text-secondary dark:text-secondary-dark px-1 rounded-md no-underline bg-gray-30 bg-opacity-10 py-px">messages</code> 变量来 <a class="inline text-link dark:text-link-dark border-b border-link border-opacity-0 hover:border-opacity-100 duration-100 ease-in transition leading-normal" href="/learn/updating-arrays-in-state">创建一个新的数组</a>：从所有现有的消息开始，并在最后添加新的消息。然而，由于 <code dir="ltr" class="inline text-code text-secondary dark:text-secondary-dark px-1 rounded-md no-underline bg-gray-30 bg-opacity-10 py-px">messages</code> 是一个由 Effect 读取的响应式值，它必须是一个依赖：</p>
<!--$--><div dir="ltr" class="sandpack sandpack--codeblock rounded-2xl h-full w-full overflow-x-auto flex items-center bg-wash dark:bg-gray-95 shadow-lg my-8" style="contain:content"><div class="sp-wrapper"><div class="sp-stack"><div class="sp-code-editor"><pre class="sp-cm sp-pristine sp-javascript flex align-start"><code class="sp-pre-placeholder grow-[2]"><div class="cm-line "><span class="sp-syntax-keyword">function</span> <span class="sp-syntax-definition">ChatRoom</span><span class="sp-syntax-punctuation">(</span><span class="sp-syntax-punctuation">{</span> <span class="sp-syntax-property">roomId</span> <span class="sp-syntax-punctuation">}</span><span class="sp-syntax-punctuation">)</span> <span class="sp-syntax-punctuation">{</span><br/></div><div class="cm-line ">  <span class="sp-syntax-keyword">const</span> <span class="sp-syntax-punctuation">[</span><span class="sp-syntax-plain">messages</span><span class="sp-syntax-punctuation">,</span> <span class="sp-syntax-plain">setMessages</span><span class="sp-syntax-punctuation">]</span> = <span class="sp-syntax-definition">useState</span><span class="sp-syntax-punctuation">(</span><span class="sp-syntax-punctuation">[</span><span class="sp-syntax-punctuation">]</span><span class="sp-syntax-punctuation">)</span><span class="sp-syntax-punctuation">;</span><br/></div><div class="cm-line ">  <span class="sp-syntax-definition">useEffect</span><span class="sp-syntax-punctuation">(</span><span class="sp-syntax-punctuation">(</span><span class="sp-syntax-punctuation">)</span> <span class="sp-syntax-punctuation">=&gt;</span> <span class="sp-syntax-punctuation">{</span><br/></div><div class="cm-line ">    <span class="sp-syntax-keyword">const</span> <span class="sp-syntax-plain">connection</span> = <span class="sp-syntax-definition">createConnection</span><span class="sp-syntax-punctuation">(</span><span class="sp-syntax-punctuation">)</span><span class="sp-syntax-punctuation">;</span><br/></div><div class="cm-line ">    <span class="sp-syntax-plain">connection</span>.<span class="sp-syntax-property">connect</span><span class="sp-syntax-punctuation">(</span><span class="sp-syntax-punctuation">)</span><span class="sp-syntax-punctuation">;</span><br/></div><div class="cm-line ">    <span class="sp-syntax-plain">connection</span>.<span class="sp-syntax-property">on</span><span class="sp-syntax-punctuation">(</span><span class="sp-syntax-string">&#x27;message&#x27;</span><span class="sp-syntax-punctuation">,</span> <span class="sp-syntax-punctuation">(</span><span class="sp-syntax-plain">receivedMessage</span><span class="sp-syntax-punctuation">)</span> <span class="sp-syntax-punctuation">=&gt;</span> <span class="sp-syntax-punctuation">{</span><br/></div><div class="cm-line bg-github-highlight dark:bg-opacity-10">      <span class="sp-syntax-definition">setMessages</span><span class="sp-syntax-punctuation">(</span><span class="sp-syntax-punctuation">[</span><span class="sp-syntax-punctuation">...</span><span class="sp-syntax-plain">messages</span><span class="sp-syntax-punctuation">,</span> <span class="sp-syntax-plain">receivedMessage</span><span class="sp-syntax-punctuation">]</span><span class="sp-syntax-punctuation">)</span><span class="sp-syntax-punctuation">;</span><br/></div><div class="cm-line ">    <span class="sp-syntax-punctuation">}</span><span class="sp-syntax-punctuation">)</span><span class="sp-syntax-punctuation">;</span><br/></div><div class="cm-line ">    <span class="sp-syntax-keyword">return</span> <span class="sp-syntax-punctuation">(</span><span class="sp-syntax-punctuation">)</span> <span class="sp-syntax-punctuation">=&gt;</span> <span class="sp-syntax-plain">connection</span>.<span class="sp-syntax-property">disconnect</span><span class="sp-syntax-punctuation">(</span><span class="sp-syntax-punctuation">)</span><span class="sp-syntax-punctuation">;</span><br/></div><div class="cm-line bg-github-highlight dark:bg-opacity-10">  <span class="sp-syntax-punctuation">}</span><span class="sp-syntax-punctuation">,</span> <span class="sp-syntax-punctuation">[</span><span class="sp-syntax-plain">roomId</span><span class="sp-syntax-punctuation">,</span> <span class="sp-syntax-plain">messages</span><span class="sp-syntax-punctuation">]</span><span class="sp-syntax-punctuation">)</span><span class="sp-syntax-punctuation">;</span> <span class="sp-syntax-comment">// ✅ 所有依赖已声明</span><br/></div><div class="cm-line ">  <span class="sp-syntax-comment">// ...</span></div></code></pre></div></div></div></div><!--/$-->
<p class="whitespace-pre-wrap my-4">而让 <code dir="ltr" class="inline text-code text-secondary dark:text-secondary-dark px-1 rounded-md no-underline bg-gray-30 bg-opacity-10 py-px">messages</code> 成为依赖会带来问题。</p>
<p class="whitespace-pre-wrap my-4">每当你收到一条消息，<code dir="ltr" class="inline text-code text-secondary dark:text-secondary-dark px-1 rounded-md no-underline bg-gray-30 bg-opacity-10 py-px">setMessages()</code> 就会使该组件重新渲染一个新的 <code dir="ltr" class="inline text-code text-secondary dark:text-secondary-dark px-1 rounded-md no-underline bg-gray-30 bg-opacity-10 py-px">messages</code> 数组，其中包括收到的消息。然而，由于该 Effect 现在依赖于 <code dir="ltr" class="inline text-code text-secondary dark:text-secondary-dark px-1 rounded-md no-underline bg-gray-30 bg-opacity-10 py-px">messages</code>，这 <strong class="font-bold">也将</strong> 重新同步该 Effect。所以每条新消息都会使聊天重新连接。用户不会喜欢这样！</p>
<p class="whitespace-pre-wrap my-4">为了解决这个问题，不要在 Effect 里面读取 <code dir="ltr" class="inline text-code text-secondary dark:text-secondary-dark px-1 rounded-md no-underline bg-gray-30 bg-opacity-10 py-px">messages</code>。相反，应该将一个 <a class="inline text-link dark:text-link-dark border-b border-link border-opacity-0 hover:border-opacity-100 duration-100 ease-in transition leading-normal" href="/reference/react/useState#updating-state-based-the-previous-state">state 更新函数</a> 传递给 <code dir="ltr" class="inline text-code text-secondary dark:text-secondary-dark px-1 rounded-md no-underline bg-gray-30 bg-opacity-10 py-px">setMessages</code>：</p>
<!--$--><div dir="ltr" class="sandpack sandpack--codeblock rounded-2xl h-full w-full overflow-x-auto flex items-center bg-wash dark:bg-gray-95 shadow-lg my-8" style="contain:content"><div class="sp-wrapper"><div class="sp-stack"><div class="sp-code-editor"><pre class="sp-cm sp-pristine sp-javascript flex align-start"><code class="sp-pre-placeholder grow-[2]"><div class="cm-line "><span class="sp-syntax-keyword">function</span> <span class="sp-syntax-definition">ChatRoom</span><span class="sp-syntax-punctuation">(</span><span class="sp-syntax-punctuation">{</span> <span class="sp-syntax-property">roomId</span> <span class="sp-syntax-punctuation">}</span><span class="sp-syntax-punctuation">)</span> <span class="sp-syntax-punctuation">{</span><br/></div><div class="cm-line ">  <span class="sp-syntax-keyword">const</span> <span class="sp-syntax-punctuation">[</span><span class="sp-syntax-plain">messages</span><span class="sp-syntax-punctuation">,</span> <span class="sp-syntax-plain">setMessages</span><span class="sp-syntax-punctuation">]</span> = <span class="sp-syntax-definition">useState</span><span class="sp-syntax-punctuation">(</span><span class="sp-syntax-punctuation">[</span><span class="sp-syntax-punctuation">]</span><span class="sp-syntax-punctuation">)</span><span class="sp-syntax-punctuation">;</span><br/></div><div class="cm-line ">  <span class="sp-syntax-definition">useEffect</span><span class="sp-syntax-punctuation">(</span><span class="sp-syntax-punctuation">(</span><span class="sp-syntax-punctuation">)</span> <span class="sp-syntax-punctuation">=&gt;</span> <span class="sp-syntax-punctuation">{</span><br/></div><div class="cm-line ">    <span class="sp-syntax-keyword">const</span> <span class="sp-syntax-plain">connection</span> = <span class="sp-syntax-definition">createConnection</span><span class="sp-syntax-punctuation">(</span><span class="sp-syntax-punctuation">)</span><span class="sp-syntax-punctuation">;</span><br/></div><div class="cm-line ">    <span class="sp-syntax-plain">connection</span>.<span class="sp-syntax-property">connect</span><span class="sp-syntax-punctuation">(</span><span class="sp-syntax-punctuation">)</span><span class="sp-syntax-punctuation">;</span><br/></div><div class="cm-line ">    <span class="sp-syntax-plain">connection</span>.<span class="sp-syntax-property">on</span><span class="sp-syntax-punctuation">(</span><span class="sp-syntax-string">&#x27;message&#x27;</span><span class="sp-syntax-punctuation">,</span> <span class="sp-syntax-punctuation">(</span><span class="sp-syntax-plain">receivedMessage</span><span class="sp-syntax-punctuation">)</span> <span class="sp-syntax-punctuation">=&gt;</span> <span class="sp-syntax-punctuation">{</span><br/></div><div class="cm-line bg-github-highlight dark:bg-opacity-10">      <span class="sp-syntax-definition">setMessages</span><span class="sp-syntax-punctuation">(</span><span class="sp-syntax-plain">msgs</span> <span class="sp-syntax-punctuation">=&gt;</span> <span class="sp-syntax-punctuation">[</span><span class="sp-syntax-punctuation">...</span><span class="sp-syntax-plain">msgs</span><span class="sp-syntax-punctuation">,</span> <span class="sp-syntax-plain">receivedMessage</span><span class="sp-syntax-punctuation">]</span><span class="sp-syntax-punctuation">)</span><span class="sp-syntax-punctuation">;</span><br/></div><div class="cm-line ">    <span class="sp-syntax-punctuation">}</span><span class="sp-syntax-punctuation">)</span><span class="sp-syntax-punctuation">;</span><br/></div><div class="cm-line ">    <span class="sp-syntax-keyword">return</span> <span class="sp-syntax-punctuation">(</span><span class="sp-syntax-punctuation">)</span> <span class="sp-syntax-punctuation">=&gt;</span> <span class="sp-syntax-plain">connection</span>.<span class="sp-syntax-property">disconnect</span><span class="sp-syntax-punctuation">(</span><span class="sp-syntax-punctuation">)</span><span class="sp-syntax-punctuation">;</span><br/></div><div class="cm-line bg-github-highlight dark:bg-opacity-10">  <span class="sp-syntax-punctuation">}</span><span class="sp-syntax-punctuation">,</span> <span class="sp-syntax-punctuation">[</span><span class="sp-syntax-plain">roomId</span><span class="sp-syntax-punctuation">]</span><span class="sp-syntax-punctuation">)</span><span class="sp-syntax-punctuation">;</span> <span class="sp-syntax-comment">// ✅ 所有依赖已声明</span><br/></div><div class="cm-line ">  <span class="sp-syntax-comment">// ...</span></div></code></pre></div></div></div></div><!--/$-->
<p class="whitespace-pre-wrap my-4"><strong class="font-bold">注意 Effect 现在根本不读取 <code dir="ltr" class="inline text-code text-secondary dark:text-secondary-dark px-1 rounded-md no-underline bg-gray-30 bg-opacity-10 py-px">messages</code> 变量</strong>。你只需要传递一个更新函数，比如 <code dir="ltr" class="inline text-code text-secondary dark:text-secondary-dark px-1 rounded-md no-underline bg-gray-30 bg-opacity-10 py-px">msgs =&gt; [...msgs, receivedMessage]</code>。React <a class="inline text-link dark:text-link-dark border-b border-link border-opacity-0 hover:border-opacity-100 duration-100 ease-in transition leading-normal" href="/learn/queueing-a-series-of-state-updates">将更新程序函数放入队列</a> 并将在下一次渲染期间向其提供 <code dir="ltr" class="inline text-code text-secondary dark:text-secondary-dark px-1 rounded-md no-underline bg-gray-30 bg-opacity-10 py-px">msgs</code> 参数。这就是 Effect 本身不再需要依赖 <code dir="ltr" class="inline text-code text-secondary dark:text-secondary-dark px-1 rounded-md no-underline bg-gray-30 bg-opacity-10 py-px">messages</code> 的原因。修复后，接收聊天消息将不再使聊天重新连接。</p>
<h3 id="do-you-want-to-read-a-value-without-reacting-to-its-changes" class="mdx-heading text-2xl font-display leading-9 text-primary dark:text-primary-dark font-bold my-6">你想读取一个值而不对其变化做出“反应”吗？ <a href="#do-you-want-to-read-a-value-without-reacting-to-its-changes" aria-label="Link for 你想读取一个值而不对其变化做出“反应”吗？ " title="Link for 你想读取一个值而不对其变化做出“反应”吗？ " class="mdx-header-anchor inline-block"><svg width="1em" height="1em" viewBox="0 0 13 13" xmlns="http://www.w3.org/2000/svg" class="text-gray-70 ms-2 h-5 w-5"><g fill="currentColor" fill-rule="evenodd"><path d="M7.778 7.975a2.5 2.5 0 0 0 .347-3.837L6.017 2.03a2.498 2.498 0 0 0-3.542-.007 2.5 2.5 0 0 0 .006 3.543l1.153 1.15c.07-.29.154-.563.25-.773.036-.077.084-.16.14-.25L3.18 4.85a1.496 1.496 0 0 1 .002-2.12 1.496 1.496 0 0 1 2.12 0l2.124 2.123a1.496 1.496 0 0 1-.333 2.37c.16.246.42.504.685.752z"></path><path d="M5.657 4.557a2.5 2.5 0 0 0-.347 3.837l2.108 2.108a2.498 2.498 0 0 0 3.542.007 2.5 2.5 0 0 0-.006-3.543L9.802 5.815c-.07.29-.154.565-.25.774-.036.076-.084.16-.14.25l.842.84c.585.587.59 1.532 0 2.122-.587.585-1.532.59-2.12 0L6.008 7.68a1.496 1.496 0 0 1 .332-2.372c-.16-.245-.42-.503-.685-.75z"></path></g></svg></a></h3>
<div class="expandable-callout pt-8 pb-4 px-5 sm:px-8 my-8 relative rounded-none shadow-inner-border -mx-5 sm:mx-auto sm:rounded-2xl bg-yellow-5 dark:bg-yellow-60 dark:bg-opacity-20"><h3 class="text-2xl font-display font-bold text-yellow-50 dark:text-yellow-40"><svg class="inline me-3 mb-1 text-lg text-yellow-50 dark:text-yellow-40" width="2em" height="2em" viewBox="0 0 72 72" fill="none" xmlns="http://www.w3.org/2000/svg"><g clip-path="url(#clip0_40_48064)"><path d="M24 27C24 25.3431 25.3431 24 27 24H45C46.6569 24 48 25.3431 48 27C48 28.6569 46.6569 30 45 30H27C25.3431 30 24 28.6569 24 27Z" fill="currentColor"></path><path d="M24 39C24 37.3431 25.3431 36 27 36H39C40.6569 36 42 37.3431 42 39C42 40.6569 40.6569 42 39 42H27C25.3431 42 24 40.6569 24 39Z" fill="currentColor"></path><path fill-rule="evenodd" clip-rule="evenodd" d="M12 18C12 13.0294 16.0294 9 21 9H51C55.9706 9 60 13.0294 60 18V54C60 58.9706 55.9706 63 51 63H21C16.0294 63 12 58.9706 12 54V18ZM21 15H51C52.6569 15 54 16.3431 54 18V54C54 55.6569 52.6569 57 51 57H21C19.3431 57 18 55.6569 18 54V18C18 16.3431 19.3431 15 21 15Z" fill="currentColor"></path></g><defs><clipPath id="clip0_40_48064"><rect width="72" height="72" fill="white"></rect></clipPath></defs></svg>正在建设中</h3><div class="relative"><div class="py-2"><p class="whitespace-pre-wrap my-4">本节描述了一个在稳定版本的 React 中 <strong class="font-bold">尚未发布的实验性</strong> API。</p></div></div></div>
<p class="whitespace-pre-wrap my-4">假设你希望在用户收到新消息时播放声音，<code dir="ltr" class="inline text-code text-secondary dark:text-secondary-dark px-1 rounded-md no-underline bg-gray-30 bg-opacity-10 py-px">isMuted</code> 为 <code dir="ltr" class="inline text-code text-secondary dark:text-secondary-dark px-1 rounded-md no-underline bg-gray-30 bg-opacity-10 py-px">true</code> 除外：</p>
<!--$--><div dir="ltr" class="sandpack sandpack--codeblock rounded-2xl h-full w-full overflow-x-auto flex items-center bg-wash dark:bg-gray-95 shadow-lg my-8" style="contain:content"><div class="sp-wrapper"><div class="sp-stack"><div class="sp-code-editor"><pre class="sp-cm sp-pristine sp-javascript flex align-start"><code class="sp-pre-placeholder grow-[2]"><div class="cm-line "><span class="sp-syntax-keyword">function</span> <span class="sp-syntax-definition">ChatRoom</span><span class="sp-syntax-punctuation">(</span><span class="sp-syntax-punctuation">{</span> <span class="sp-syntax-property">roomId</span> <span class="sp-syntax-punctuation">}</span><span class="sp-syntax-punctuation">)</span> <span class="sp-syntax-punctuation">{</span><br/></div><div class="cm-line ">  <span class="sp-syntax-keyword">const</span> <span class="sp-syntax-punctuation">[</span><span class="sp-syntax-plain">messages</span><span class="sp-syntax-punctuation">,</span> <span class="sp-syntax-plain">setMessages</span><span class="sp-syntax-punctuation">]</span> = <span class="sp-syntax-definition">useState</span><span class="sp-syntax-punctuation">(</span><span class="sp-syntax-punctuation">[</span><span class="sp-syntax-punctuation">]</span><span class="sp-syntax-punctuation">)</span><span class="sp-syntax-punctuation">;</span><br/></div><div class="cm-line bg-github-highlight dark:bg-opacity-10">  <span class="sp-syntax-keyword">const</span> <span class="sp-syntax-punctuation">[</span><span class="sp-syntax-plain">isMuted</span><span class="sp-syntax-punctuation">,</span> <span class="sp-syntax-plain">setIsMuted</span><span class="sp-syntax-punctuation">]</span> = <span class="sp-syntax-definition">useState</span><span class="sp-syntax-punctuation">(</span><span class="sp-syntax-static">false</span><span class="sp-syntax-punctuation">)</span><span class="sp-syntax-punctuation">;</span><br/></div><div class="cm-line "><br/></div><div class="cm-line ">  <span class="sp-syntax-definition">useEffect</span><span class="sp-syntax-punctuation">(</span><span class="sp-syntax-punctuation">(</span><span class="sp-syntax-punctuation">)</span> <span class="sp-syntax-punctuation">=&gt;</span> <span class="sp-syntax-punctuation">{</span><br/></div><div class="cm-line ">    <span class="sp-syntax-keyword">const</span> <span class="sp-syntax-plain">connection</span> = <span class="sp-syntax-definition">createConnection</span><span class="sp-syntax-punctuation">(</span><span class="sp-syntax-punctuation">)</span><span class="sp-syntax-punctuation">;</span><br/></div><div class="cm-line ">    <span class="sp-syntax-plain">connection</span>.<span class="sp-syntax-property">connect</span><span class="sp-syntax-punctuation">(</span><span class="sp-syntax-punctuation">)</span><span class="sp-syntax-punctuation">;</span><br/></div><div class="cm-line ">    <span class="sp-syntax-plain">connection</span>.<span class="sp-syntax-property">on</span><span class="sp-syntax-punctuation">(</span><span class="sp-syntax-string">&#x27;message&#x27;</span><span class="sp-syntax-punctuation">,</span> <span class="sp-syntax-punctuation">(</span><span class="sp-syntax-plain">receivedMessage</span><span class="sp-syntax-punctuation">)</span> <span class="sp-syntax-punctuation">=&gt;</span> <span class="sp-syntax-punctuation">{</span><br/></div><div class="cm-line ">      <span class="sp-syntax-definition">setMessages</span><span class="sp-syntax-punctuation">(</span><span class="sp-syntax-plain">msgs</span> <span class="sp-syntax-punctuation">=&gt;</span> <span class="sp-syntax-punctuation">[</span><span class="sp-syntax-punctuation">...</span><span class="sp-syntax-plain">msgs</span><span class="sp-syntax-punctuation">,</span> <span class="sp-syntax-plain">receivedMessage</span><span class="sp-syntax-punctuation">]</span><span class="sp-syntax-punctuation">)</span><span class="sp-syntax-punctuation">;</span><br/></div><div class="cm-line bg-github-highlight dark:bg-opacity-10">      <span class="sp-syntax-keyword">if</span> <span class="sp-syntax-punctuation">(</span>!<span class="sp-syntax-plain">isMuted</span><span class="sp-syntax-punctuation">)</span> <span class="sp-syntax-punctuation">{</span><br/></div><div class="cm-line bg-github-highlight dark:bg-opacity-10">        <span class="sp-syntax-definition">playSound</span><span class="sp-syntax-punctuation">(</span><span class="sp-syntax-punctuation">)</span><span class="sp-syntax-punctuation">;</span><br/></div><div class="cm-line bg-github-highlight dark:bg-opacity-10">      <span class="sp-syntax-punctuation">}</span><br/></div><div class="cm-line ">    <span class="sp-syntax-punctuation">}</span><span class="sp-syntax-punctuation">)</span><span class="sp-syntax-punctuation">;</span><br/></div><div class="cm-line ">    <span class="sp-syntax-comment">// ...</span></div></code></pre></div></div></div></div><!--/$-->
<p class="whitespace-pre-wrap my-4">由于 Effect 现在在其代码中使用了 <code dir="ltr" class="inline text-code text-secondary dark:text-secondary-dark px-1 rounded-md no-underline bg-gray-30 bg-opacity-10 py-px">isMuted</code> ，因此你必须将其添加到依赖中：</p>
<!--$--><div dir="ltr" class="sandpack sandpack--codeblock rounded-2xl h-full w-full overflow-x-auto flex items-center bg-wash dark:bg-gray-95 shadow-lg my-8" style="contain:content"><div class="sp-wrapper"><div class="sp-stack"><div class="sp-code-editor"><pre class="sp-cm sp-pristine sp-javascript flex align-start"><code class="sp-pre-placeholder grow-[2]"><div class="cm-line "><span class="sp-syntax-keyword">function</span> <span class="sp-syntax-definition">ChatRoom</span><span class="sp-syntax-punctuation">(</span><span class="sp-syntax-punctuation">{</span> <span class="sp-syntax-property">roomId</span> <span class="sp-syntax-punctuation">}</span><span class="sp-syntax-punctuation">)</span> <span class="sp-syntax-punctuation">{</span><br/></div><div class="cm-line ">  <span class="sp-syntax-keyword">const</span> <span class="sp-syntax-punctuation">[</span><span class="sp-syntax-plain">messages</span><span class="sp-syntax-punctuation">,</span> <span class="sp-syntax-plain">setMessages</span><span class="sp-syntax-punctuation">]</span> = <span class="sp-syntax-definition">useState</span><span class="sp-syntax-punctuation">(</span><span class="sp-syntax-punctuation">[</span><span class="sp-syntax-punctuation">]</span><span class="sp-syntax-punctuation">)</span><span class="sp-syntax-punctuation">;</span><br/></div><div class="cm-line ">  <span class="sp-syntax-keyword">const</span> <span class="sp-syntax-punctuation">[</span><span class="sp-syntax-plain">isMuted</span><span class="sp-syntax-punctuation">,</span> <span class="sp-syntax-plain">setIsMuted</span><span class="sp-syntax-punctuation">]</span> = <span class="sp-syntax-definition">useState</span><span class="sp-syntax-punctuation">(</span><span class="sp-syntax-static">false</span><span class="sp-syntax-punctuation">)</span><span class="sp-syntax-punctuation">;</span><br/></div><div class="cm-line "><br/></div><div class="cm-line ">  <span class="sp-syntax-definition">useEffect</span><span class="sp-syntax-punctuation">(</span><span class="sp-syntax-punctuation">(</span><span class="sp-syntax-punctuation">)</span> <span class="sp-syntax-punctuation">=&gt;</span> <span class="sp-syntax-punctuation">{</span><br/></div><div class="cm-line ">    <span class="sp-syntax-keyword">const</span> <span class="sp-syntax-plain">connection</span> = <span class="sp-syntax-definition">createConnection</span><span class="sp-syntax-punctuation">(</span><span class="sp-syntax-punctuation">)</span><span class="sp-syntax-punctuation">;</span><br/></div><div class="cm-line ">    <span class="sp-syntax-plain">connection</span>.<span class="sp-syntax-property">connect</span><span class="sp-syntax-punctuation">(</span><span class="sp-syntax-punctuation">)</span><span class="sp-syntax-punctuation">;</span><br/></div><div class="cm-line ">    <span class="sp-syntax-plain">connection</span>.<span class="sp-syntax-property">on</span><span class="sp-syntax-punctuation">(</span><span class="sp-syntax-string">&#x27;message&#x27;</span><span class="sp-syntax-punctuation">,</span> <span class="sp-syntax-punctuation">(</span><span class="sp-syntax-plain">receivedMessage</span><span class="sp-syntax-punctuation">)</span> <span class="sp-syntax-punctuation">=&gt;</span> <span class="sp-syntax-punctuation">{</span><br/></div><div class="cm-line ">      <span class="sp-syntax-definition">setMessages</span><span class="sp-syntax-punctuation">(</span><span class="sp-syntax-plain">msgs</span> <span class="sp-syntax-punctuation">=&gt;</span> <span class="sp-syntax-punctuation">[</span><span class="sp-syntax-punctuation">...</span><span class="sp-syntax-plain">msgs</span><span class="sp-syntax-punctuation">,</span> <span class="sp-syntax-plain">receivedMessage</span><span class="sp-syntax-punctuation">]</span><span class="sp-syntax-punctuation">)</span><span class="sp-syntax-punctuation">;</span><br/></div><div class="cm-line bg-github-highlight dark:bg-opacity-10">      <span class="sp-syntax-keyword">if</span> <span class="sp-syntax-punctuation">(</span>!<span class="sp-syntax-plain">isMuted</span><span class="sp-syntax-punctuation">)</span> <span class="sp-syntax-punctuation">{</span><br/></div><div class="cm-line ">        <span class="sp-syntax-definition">playSound</span><span class="sp-syntax-punctuation">(</span><span class="sp-syntax-punctuation">)</span><span class="sp-syntax-punctuation">;</span><br/></div><div class="cm-line ">      <span class="sp-syntax-punctuation">}</span><br/></div><div class="cm-line ">    <span class="sp-syntax-punctuation">}</span><span class="sp-syntax-punctuation">)</span><span class="sp-syntax-punctuation">;</span><br/></div><div class="cm-line ">    <span class="sp-syntax-keyword">return</span> <span class="sp-syntax-punctuation">(</span><span class="sp-syntax-punctuation">)</span> <span class="sp-syntax-punctuation">=&gt;</span> <span class="sp-syntax-plain">connection</span>.<span class="sp-syntax-property">disconnect</span><span class="sp-syntax-punctuation">(</span><span class="sp-syntax-punctuation">)</span><span class="sp-syntax-punctuation">;</span><br/></div><div class="cm-line bg-github-highlight dark:bg-opacity-10">  <span class="sp-syntax-punctuation">}</span><span class="sp-syntax-punctuation">,</span> <span class="sp-syntax-punctuation">[</span><span class="sp-syntax-plain">roomId</span><span class="sp-syntax-punctuation">,</span> <span class="sp-syntax-plain">isMuted</span><span class="sp-syntax-punctuation">]</span><span class="sp-syntax-punctuation">)</span><span class="sp-syntax-punctuation">;</span> <span class="sp-syntax-comment">// ✅ 所有依赖已声明</span><br/></div><div class="cm-line ">  <span class="sp-syntax-comment">// ...</span></div></code></pre></div></div></div></div><!--/$-->
<p class="whitespace-pre-wrap my-4">问题是每次 <code dir="ltr" class="inline text-code text-secondary dark:text-secondary-dark px-1 rounded-md no-underline bg-gray-30 bg-opacity-10 py-px">isMuted</code> 改变时（例如，当用户按下“静音”开关时），Effect 将重新同步，并重新连接到聊天。这不是理想的用户体验！（在此示例中，即使禁用 linter 也不起作用——如果你这样做，<code dir="ltr" class="inline text-code text-secondary dark:text-secondary-dark px-1 rounded-md no-underline bg-gray-30 bg-opacity-10 py-px">isMuted</code> 将“保持”其旧值。）</p>
<p class="whitespace-pre-wrap my-4">要解决这个问题，需要将不应该响应式的逻辑从 Effect 中抽取出来。你不希望此 Effect 对 <code dir="ltr" class="inline text-code text-secondary dark:text-secondary-dark px-1 rounded-md no-underline bg-gray-30 bg-opacity-10 py-px">isMuted</code> 中的更改做出“反应”。<a class="inline text-link dark:text-link-dark border-b border-link border-opacity-0 hover:border-opacity-100 duration-100 ease-in transition leading-normal" href="/learn/separating-events-from-effects#declaring-an-effect-event">将这段非响应式逻辑移至 Effect Event 中</a>：</p>
<!--$--><div dir="ltr" class="sandpack sandpack--codeblock rounded-2xl h-full w-full overflow-x-auto flex items-center bg-wash dark:bg-gray-95 shadow-lg my-8" style="contain:content"><div class="sp-wrapper"><div class="sp-stack"><div class="sp-code-editor"><pre class="sp-cm sp-pristine sp-javascript flex align-start"><code class="sp-pre-placeholder grow-[2]"><div class="cm-line bg-github-highlight dark:bg-opacity-10"><span class="sp-syntax-keyword">import</span> <span class="sp-syntax-punctuation">{</span> <span class="sp-syntax-plain">useState</span><span class="sp-syntax-punctuation">,</span> <span class="sp-syntax-plain">useEffect</span><span class="sp-syntax-punctuation">,</span> <span class="sp-syntax-plain">useEffectEvent</span> <span class="sp-syntax-punctuation">}</span> <span class="sp-syntax-keyword">from</span> <span class="sp-syntax-string">&#x27;react&#x27;</span><span class="sp-syntax-punctuation">;</span><br/></div><div class="cm-line "><br/></div><div class="cm-line "><span class="sp-syntax-keyword">function</span> <span class="sp-syntax-definition">ChatRoom</span><span class="sp-syntax-punctuation">(</span><span class="sp-syntax-punctuation">{</span> <span class="sp-syntax-property">roomId</span> <span class="sp-syntax-punctuation">}</span><span class="sp-syntax-punctuation">)</span> <span class="sp-syntax-punctuation">{</span><br/></div><div class="cm-line ">  <span class="sp-syntax-keyword">const</span> <span class="sp-syntax-punctuation">[</span><span class="sp-syntax-plain">messages</span><span class="sp-syntax-punctuation">,</span> <span class="sp-syntax-plain">setMessages</span><span class="sp-syntax-punctuation">]</span> = <span class="sp-syntax-definition">useState</span><span class="sp-syntax-punctuation">(</span><span class="sp-syntax-punctuation">[</span><span class="sp-syntax-punctuation">]</span><span class="sp-syntax-punctuation">)</span><span class="sp-syntax-punctuation">;</span><br/></div><div class="cm-line ">  <span class="sp-syntax-keyword">const</span> <span class="sp-syntax-punctuation">[</span><span class="sp-syntax-plain">isMuted</span><span class="sp-syntax-punctuation">,</span> <span class="sp-syntax-plain">setIsMuted</span><span class="sp-syntax-punctuation">]</span> = <span class="sp-syntax-definition">useState</span><span class="sp-syntax-punctuation">(</span><span class="sp-syntax-static">false</span><span class="sp-syntax-punctuation">)</span><span class="sp-syntax-punctuation">;</span><br/></div><div class="cm-line "><br/></div><div class="cm-line bg-github-highlight dark:bg-opacity-10">  <span class="sp-syntax-keyword">const</span> <span class="sp-syntax-plain">onMessage</span> = <span class="sp-syntax-definition">useEffectEvent</span><span class="sp-syntax-punctuation">(</span><span class="sp-syntax-plain">receivedMessage</span> <span class="sp-syntax-punctuation">=&gt;</span> <span class="sp-syntax-punctuation">{</span><br/></div><div class="cm-line bg-github-highlight dark:bg-opacity-10">    <span class="sp-syntax-definition">setMessages</span><span class="sp-syntax-punctuation">(</span><span class="sp-syntax-plain">msgs</span> <span class="sp-syntax-punctuation">=&gt;</span> <span class="sp-syntax-punctuation">[</span><span class="sp-syntax-punctuation">...</span><span class="sp-syntax-plain">msgs</span><span class="sp-syntax-punctuation">,</span> <span class="sp-syntax-plain">receivedMessage</span><span class="sp-syntax-punctuation">]</span><span class="sp-syntax-punctuation">)</span><span class="sp-syntax-punctuation">;</span><br/></div><div class="cm-line bg-github-highlight dark:bg-opacity-10">    <span class="sp-syntax-keyword">if</span> <span class="sp-syntax-punctuation">(</span>!<span class="sp-syntax-plain">isMuted</span><span class="sp-syntax-punctuation">)</span> <span class="sp-syntax-punctuation">{</span><br/></div><div class="cm-line bg-github-highlight dark:bg-opacity-10">      <span class="sp-syntax-definition">playSound</span><span class="sp-syntax-punctuation">(</span><span class="sp-syntax-punctuation">)</span><span class="sp-syntax-punctuation">;</span><br/></div><div class="cm-line bg-github-highlight dark:bg-opacity-10">    <span class="sp-syntax-punctuation">}</span><br/></div><div class="cm-line bg-github-highlight dark:bg-opacity-10">  <span class="sp-syntax-punctuation">}</span><span class="sp-syntax-punctuation">)</span><span class="sp-syntax-punctuation">;</span><br/></div><div class="cm-line "><br/></div><div class="cm-line ">  <span class="sp-syntax-definition">useEffect</span><span class="sp-syntax-punctuation">(</span><span class="sp-syntax-punctuation">(</span><span class="sp-syntax-punctuation">)</span> <span class="sp-syntax-punctuation">=&gt;</span> <span class="sp-syntax-punctuation">{</span><br/></div><div class="cm-line ">    <span class="sp-syntax-keyword">const</span> <span class="sp-syntax-plain">connection</span> = <span class="sp-syntax-definition">createConnection</span><span class="sp-syntax-punctuation">(</span><span class="sp-syntax-punctuation">)</span><span class="sp-syntax-punctuation">;</span><br/></div><div class="cm-line ">    <span class="sp-syntax-plain">connection</span>.<span class="sp-syntax-property">connect</span><span class="sp-syntax-punctuation">(</span><span class="sp-syntax-punctuation">)</span><span class="sp-syntax-punctuation">;</span><br/></div><div class="cm-line ">    <span class="sp-syntax-plain">connection</span>.<span class="sp-syntax-property">on</span><span class="sp-syntax-punctuation">(</span><span class="sp-syntax-string">&#x27;message&#x27;</span><span class="sp-syntax-punctuation">,</span> <span class="sp-syntax-punctuation">(</span><span class="sp-syntax-plain">receivedMessage</span><span class="sp-syntax-punctuation">)</span> <span class="sp-syntax-punctuation">=&gt;</span> <span class="sp-syntax-punctuation">{</span><br/></div><div class="cm-line bg-github-highlight dark:bg-opacity-10">      <span class="sp-syntax-definition">onMessage</span><span class="sp-syntax-punctuation">(</span><span class="sp-syntax-plain">receivedMessage</span><span class="sp-syntax-punctuation">)</span><span class="sp-syntax-punctuation">;</span><br/></div><div class="cm-line ">    <span class="sp-syntax-punctuation">}</span><span class="sp-syntax-punctuation">)</span><span class="sp-syntax-punctuation">;</span><br/></div><div class="cm-line ">    <span class="sp-syntax-keyword">return</span> <span class="sp-syntax-punctuation">(</span><span class="sp-syntax-punctuation">)</span> <span class="sp-syntax-punctuation">=&gt;</span> <span class="sp-syntax-plain">connection</span>.<span class="sp-syntax-property">disconnect</span><span class="sp-syntax-punctuation">(</span><span class="sp-syntax-punctuation">)</span><span class="sp-syntax-punctuation">;</span><br/></div><div class="cm-line bg-github-highlight dark:bg-opacity-10">  <span class="sp-syntax-punctuation">}</span><span class="sp-syntax-punctuation">,</span> <span class="sp-syntax-punctuation">[</span><span class="sp-syntax-plain">roomId</span><span class="sp-syntax-punctuation">]</span><span class="sp-syntax-punctuation">)</span><span class="sp-syntax-punctuation">;</span> <span class="sp-syntax-comment">// ✅ 所有依赖已声明</span><br/></div><div class="cm-line ">  <span class="sp-syntax-comment">// ...</span></div></code></pre></div></div></div></div><!--/$-->
<p class="whitespace-pre-wrap my-4">Effect Events 让你可以将 Effect 分成响应式部分（应该“反应”响应式值，如 <code dir="ltr" class="inline text-code text-secondary dark:text-secondary-dark px-1 rounded-md no-underline bg-gray-30 bg-opacity-10 py-px">roomId</code> 及其变化）和非响应式部分（只读取它们的最新值，如 <code dir="ltr" class="inline text-code text-secondary dark:text-secondary-dark px-1 rounded-md no-underline bg-gray-30 bg-opacity-10 py-px">onMessage</code> 读取 <code dir="ltr" class="inline text-code text-secondary dark:text-secondary-dark px-1 rounded-md no-underline bg-gray-30 bg-opacity-10 py-px">isMuted</code>）。<strong class="font-bold">现在你在 Effect Event 中读取了 <code dir="ltr" class="inline text-code text-secondary dark:text-secondary-dark px-1 rounded-md no-underline bg-gray-30 bg-opacity-10 py-px">isMuted</code>，它不需要添加到 Effect 依赖中</strong>。因此，当你打开或者关闭“静音”设置时，聊天不会重新连接。至此，解决原始问题！</p>
<h4 id="wrapping-an-event-handler-from-the-props" class="mdx-heading text-xl font-display font-bold leading-9 my-4">包装来自 props 的事件处理程序 <a href="#wrapping-an-event-handler-from-the-props" aria-label="Link for 包装来自 props 的事件处理程序 " title="Link for 包装来自 props 的事件处理程序 " class="mdx-header-anchor inline-block"><svg width="1em" height="1em" viewBox="0 0 13 13" xmlns="http://www.w3.org/2000/svg" class="text-gray-70 ms-2 h-5 w-5"><g fill="currentColor" fill-rule="evenodd"><path d="M7.778 7.975a2.5 2.5 0 0 0 .347-3.837L6.017 2.03a2.498 2.498 0 0 0-3.542-.007 2.5 2.5 0 0 0 .006 3.543l1.153 1.15c.07-.29.154-.563.25-.773.036-.077.084-.16.14-.25L3.18 4.85a1.496 1.496 0 0 1 .002-2.12 1.496 1.496 0 0 1 2.12 0l2.124 2.123a1.496 1.496 0 0 1-.333 2.37c.16.246.42.504.685.752z"></path><path d="M5.657 4.557a2.5 2.5 0 0 0-.347 3.837l2.108 2.108a2.498 2.498 0 0 0 3.542.007 2.5 2.5 0 0 0-.006-3.543L9.802 5.815c-.07.29-.154.565-.25.774-.036.076-.084.16-.14.25l.842.84c.585.587.59 1.532 0 2.122-.587.585-1.532.59-2.12 0L6.008 7.68a1.496 1.496 0 0 1 .332-2.372c-.16-.245-.42-.503-.685-.75z"></path></g></svg></a></h4>
<p class="whitespace-pre-wrap my-4">当组件接收事件处理函数作为 props 时，你可能会遇到类似的问题：</p>
<!--$--><div dir="ltr" class="sandpack sandpack--codeblock rounded-2xl h-full w-full overflow-x-auto flex items-center bg-wash dark:bg-gray-95 shadow-lg my-8" style="contain:content"><div class="sp-wrapper"><div class="sp-stack"><div class="sp-code-editor"><pre class="sp-cm sp-pristine sp-javascript flex align-start"><code class="sp-pre-placeholder grow-[2]"><div class="cm-line bg-github-highlight dark:bg-opacity-10"><span class="sp-syntax-keyword">function</span> <span class="sp-syntax-definition">ChatRoom</span><span class="sp-syntax-punctuation">(</span><span class="sp-syntax-punctuation">{</span> <span class="sp-syntax-property">roomId</span><span class="sp-syntax-punctuation">,</span> <span class="sp-syntax-property">onReceiveMessage</span> <span class="sp-syntax-punctuation">}</span><span class="sp-syntax-punctuation">)</span> <span class="sp-syntax-punctuation">{</span><br/></div><div class="cm-line ">  <span class="sp-syntax-keyword">const</span> <span class="sp-syntax-punctuation">[</span><span class="sp-syntax-plain">messages</span><span class="sp-syntax-punctuation">,</span> <span class="sp-syntax-plain">setMessages</span><span class="sp-syntax-punctuation">]</span> = <span class="sp-syntax-definition">useState</span><span class="sp-syntax-punctuation">(</span><span class="sp-syntax-punctuation">[</span><span class="sp-syntax-punctuation">]</span><span class="sp-syntax-punctuation">)</span><span class="sp-syntax-punctuation">;</span><br/></div><div class="cm-line "><br/></div><div class="cm-line ">  <span class="sp-syntax-definition">useEffect</span><span class="sp-syntax-punctuation">(</span><span class="sp-syntax-punctuation">(</span><span class="sp-syntax-punctuation">)</span> <span class="sp-syntax-punctuation">=&gt;</span> <span class="sp-syntax-punctuation">{</span><br/></div><div class="cm-line ">    <span class="sp-syntax-keyword">const</span> <span class="sp-syntax-plain">connection</span> = <span class="sp-syntax-definition">createConnection</span><span class="sp-syntax-punctuation">(</span><span class="sp-syntax-punctuation">)</span><span class="sp-syntax-punctuation">;</span><br/></div><div class="cm-line ">    <span class="sp-syntax-plain">connection</span>.<span class="sp-syntax-property">connect</span><span class="sp-syntax-punctuation">(</span><span class="sp-syntax-punctuation">)</span><span class="sp-syntax-punctuation">;</span><br/></div><div class="cm-line ">    <span class="sp-syntax-plain">connection</span>.<span class="sp-syntax-property">on</span><span class="sp-syntax-punctuation">(</span><span class="sp-syntax-string">&#x27;message&#x27;</span><span class="sp-syntax-punctuation">,</span> <span class="sp-syntax-punctuation">(</span><span class="sp-syntax-plain">receivedMessage</span><span class="sp-syntax-punctuation">)</span> <span class="sp-syntax-punctuation">=&gt;</span> <span class="sp-syntax-punctuation">{</span><br/></div><div class="cm-line bg-github-highlight dark:bg-opacity-10">      <span class="sp-syntax-definition">onReceiveMessage</span><span class="sp-syntax-punctuation">(</span><span class="sp-syntax-plain">receivedMessage</span><span class="sp-syntax-punctuation">)</span><span class="sp-syntax-punctuation">;</span><br/></div><div class="cm-line ">    <span class="sp-syntax-punctuation">}</span><span class="sp-syntax-punctuation">)</span><span class="sp-syntax-punctuation">;</span><br/></div><div class="cm-line ">    <span class="sp-syntax-keyword">return</span> <span class="sp-syntax-punctuation">(</span><span class="sp-syntax-punctuation">)</span> <span class="sp-syntax-punctuation">=&gt;</span> <span class="sp-syntax-plain">connection</span>.<span class="sp-syntax-property">disconnect</span><span class="sp-syntax-punctuation">(</span><span class="sp-syntax-punctuation">)</span><span class="sp-syntax-punctuation">;</span><br/></div><div class="cm-line bg-github-highlight dark:bg-opacity-10">  <span class="sp-syntax-punctuation">}</span><span class="sp-syntax-punctuation">,</span> <span class="sp-syntax-punctuation">[</span><span class="sp-syntax-plain">roomId</span><span class="sp-syntax-punctuation">,</span> <span class="sp-syntax-plain">onReceiveMessage</span><span class="sp-syntax-punctuation">]</span><span class="sp-syntax-punctuation">)</span><span class="sp-syntax-punctuation">;</span> <span class="sp-syntax-comment">// ✅ 所有依赖已声明</span><br/></div><div class="cm-line ">  <span class="sp-syntax-comment">// ...</span></div></code></pre></div></div></div></div><!--/$-->
<p class="whitespace-pre-wrap my-4">假设父组件在每次渲染时都传递了一个 <strong class="font-bold">不同的</strong> <code dir="ltr" class="inline text-code text-secondary dark:text-secondary-dark px-1 rounded-md no-underline bg-gray-30 bg-opacity-10 py-px">onReceiveMessage</code> 函数：</p>
<!--$--><div dir="ltr" class="sandpack sandpack--codeblock rounded-2xl h-full w-full overflow-x-auto flex items-center bg-wash dark:bg-gray-95 shadow-lg my-8" style="contain:content"><div class="sp-wrapper"><div class="sp-stack"><div class="sp-code-editor"><pre class="sp-cm sp-pristine sp-javascript flex align-start"><code class="sp-pre-placeholder grow-[2]"><div class="cm-line "><span class="sp-syntax-punctuation">&lt;</span><span class="sp-syntax-definition">ChatRoom</span><br/></div><div class="cm-line ">  <span class="sp-syntax-property">roomId</span>=<span class="sp-syntax-punctuation">{</span><span class="sp-syntax-plain">roomId</span><span class="sp-syntax-punctuation">}</span><br/></div><div class="cm-line bg-github-highlight dark:bg-opacity-10">  <span class="sp-syntax-property">onReceiveMessage</span>=<span class="sp-syntax-punctuation">{</span><span class="sp-syntax-plain">receivedMessage</span> <span class="sp-syntax-punctuation">=&gt;</span> <span class="sp-syntax-punctuation">{</span><br/></div><div class="cm-line bg-github-highlight dark:bg-opacity-10">    <span class="sp-syntax-comment">// ...</span><br/></div><div class="cm-line bg-github-highlight dark:bg-opacity-10">  <span class="sp-syntax-punctuation">}</span><span class="sp-syntax-punctuation">}</span><br/></div><div class="cm-line "><span class="sp-syntax-punctuation">/&gt;</span></div></code></pre></div></div></div></div><!--/$-->
<p class="whitespace-pre-wrap my-4">由于 <code dir="ltr" class="inline text-code text-secondary dark:text-secondary-dark px-1 rounded-md no-underline bg-gray-30 bg-opacity-10 py-px">onReceiveMessage</code> 是依赖，它会导致 Effect 在每次父级重新渲染后重新同步。这将导致聊天重新连接。要解决此问题，请用 Effect Event 包裹之后再调用：</p>
<!--$--><div dir="ltr" class="sandpack sandpack--codeblock rounded-2xl h-full w-full overflow-x-auto flex items-center bg-wash dark:bg-gray-95 shadow-lg my-8" style="contain:content"><div class="sp-wrapper"><div class="sp-stack"><div class="sp-code-editor"><pre class="sp-cm sp-pristine sp-javascript flex align-start"><code class="sp-pre-placeholder grow-[2]"><div class="cm-line "><span class="sp-syntax-keyword">function</span> <span class="sp-syntax-definition">ChatRoom</span><span class="sp-syntax-punctuation">(</span><span class="sp-syntax-punctuation">{</span> <span class="sp-syntax-property">roomId</span><span class="sp-syntax-punctuation">,</span> <span class="sp-syntax-property">onReceiveMessage</span> <span class="sp-syntax-punctuation">}</span><span class="sp-syntax-punctuation">)</span> <span class="sp-syntax-punctuation">{</span><br/></div><div class="cm-line ">  <span class="sp-syntax-keyword">const</span> <span class="sp-syntax-punctuation">[</span><span class="sp-syntax-plain">messages</span><span class="sp-syntax-punctuation">,</span> <span class="sp-syntax-plain">setMessages</span><span class="sp-syntax-punctuation">]</span> = <span class="sp-syntax-definition">useState</span><span class="sp-syntax-punctuation">(</span><span class="sp-syntax-punctuation">[</span><span class="sp-syntax-punctuation">]</span><span class="sp-syntax-punctuation">)</span><span class="sp-syntax-punctuation">;</span><br/></div><div class="cm-line "><br/></div><div class="cm-line bg-github-highlight dark:bg-opacity-10">  <span class="sp-syntax-keyword">const</span> <span class="sp-syntax-plain">onMessage</span> = <span class="sp-syntax-definition">useEffectEvent</span><span class="sp-syntax-punctuation">(</span><span class="sp-syntax-plain">receivedMessage</span> <span class="sp-syntax-punctuation">=&gt;</span> <span class="sp-syntax-punctuation">{</span><br/></div><div class="cm-line bg-github-highlight dark:bg-opacity-10">    <span class="sp-syntax-definition">onReceiveMessage</span><span class="sp-syntax-punctuation">(</span><span class="sp-syntax-plain">receivedMessage</span><span class="sp-syntax-punctuation">)</span><span class="sp-syntax-punctuation">;</span><br/></div><div class="cm-line bg-github-highlight dark:bg-opacity-10">  <span class="sp-syntax-punctuation">}</span><span class="sp-syntax-punctuation">)</span><span class="sp-syntax-punctuation">;</span><br/></div><div class="cm-line "><br/></div><div class="cm-line ">  <span class="sp-syntax-definition">useEffect</span><span class="sp-syntax-punctuation">(</span><span class="sp-syntax-punctuation">(</span><span class="sp-syntax-punctuation">)</span> <span class="sp-syntax-punctuation">=&gt;</span> <span class="sp-syntax-punctuation">{</span><br/></div><div class="cm-line ">    <span class="sp-syntax-keyword">const</span> <span class="sp-syntax-plain">connection</span> = <span class="sp-syntax-definition">createConnection</span><span class="sp-syntax-punctuation">(</span><span class="sp-syntax-punctuation">)</span><span class="sp-syntax-punctuation">;</span><br/></div><div class="cm-line ">    <span class="sp-syntax-plain">connection</span>.<span class="sp-syntax-property">connect</span><span class="sp-syntax-punctuation">(</span><span class="sp-syntax-punctuation">)</span><span class="sp-syntax-punctuation">;</span><br/></div><div class="cm-line ">    <span class="sp-syntax-plain">connection</span>.<span class="sp-syntax-property">on</span><span class="sp-syntax-punctuation">(</span><span class="sp-syntax-string">&#x27;message&#x27;</span><span class="sp-syntax-punctuation">,</span> <span class="sp-syntax-punctuation">(</span><span class="sp-syntax-plain">receivedMessage</span><span class="sp-syntax-punctuation">)</span> <span class="sp-syntax-punctuation">=&gt;</span> <span class="sp-syntax-punctuation">{</span><br/></div><div class="cm-line bg-github-highlight dark:bg-opacity-10">      <span class="sp-syntax-definition">onMessage</span><span class="sp-syntax-punctuation">(</span><span class="sp-syntax-plain">receivedMessage</span><span class="sp-syntax-punctuation">)</span><span class="sp-syntax-punctuation">;</span><br/></div><div class="cm-line ">    <span class="sp-syntax-punctuation">}</span><span class="sp-syntax-punctuation">)</span><span class="sp-syntax-punctuation">;</span><br/></div><div class="cm-line ">    <span class="sp-syntax-keyword">return</span> <span class="sp-syntax-punctuation">(</span><span class="sp-syntax-punctuation">)</span> <span class="sp-syntax-punctuation">=&gt;</span> <span class="sp-syntax-plain">connection</span>.<span class="sp-syntax-property">disconnect</span><span class="sp-syntax-punctuation">(</span><span class="sp-syntax-punctuation">)</span><span class="sp-syntax-punctuation">;</span><br/></div><div class="cm-line bg-github-highlight dark:bg-opacity-10">  <span class="sp-syntax-punctuation">}</span><span class="sp-syntax-punctuation">,</span> <span class="sp-syntax-punctuation">[</span><span class="sp-syntax-plain">roomId</span><span class="sp-syntax-punctuation">]</span><span class="sp-syntax-punctuation">)</span><span class="sp-syntax-punctuation">;</span> <span class="sp-syntax-comment">// ✅ 所有依赖已声明</span><br/></div><div class="cm-line ">  <span class="sp-syntax-comment">// ...</span></div></code></pre></div></div></div></div><!--/$-->
<p class="whitespace-pre-wrap my-4">Effect Events 不是响应式的，因此你不需要将它们指定为依赖。因此，即使父组件传递的函数在每次重新渲染时都不同，聊天也将不再重新连接。</p>
<h4 id="separating-reactive-and-non-reactive-code" class="mdx-heading text-xl font-display font-bold leading-9 my-4">分离响应式和非响应式代码 <a href="#separating-reactive-and-non-reactive-code" aria-label="Link for 分离响应式和非响应式代码 " title="Link for 分离响应式和非响应式代码 " class="mdx-header-anchor inline-block"><svg width="1em" height="1em" viewBox="0 0 13 13" xmlns="http://www.w3.org/2000/svg" class="text-gray-70 ms-2 h-5 w-5"><g fill="currentColor" fill-rule="evenodd"><path d="M7.778 7.975a2.5 2.5 0 0 0 .347-3.837L6.017 2.03a2.498 2.498 0 0 0-3.542-.007 2.5 2.5 0 0 0 .006 3.543l1.153 1.15c.07-.29.154-.563.25-.773.036-.077.084-.16.14-.25L3.18 4.85a1.496 1.496 0 0 1 .002-2.12 1.496 1.496 0 0 1 2.12 0l2.124 2.123a1.496 1.496 0 0 1-.333 2.37c.16.246.42.504.685.752z"></path><path d="M5.657 4.557a2.5 2.5 0 0 0-.347 3.837l2.108 2.108a2.498 2.498 0 0 0 3.542.007 2.5 2.5 0 0 0-.006-3.543L9.802 5.815c-.07.29-.154.565-.25.774-.036.076-.084.16-.14.25l.842.84c.585.587.59 1.532 0 2.122-.587.585-1.532.59-2.12 0L6.008 7.68a1.496 1.496 0 0 1 .332-2.372c-.16-.245-.42-.503-.685-.75z"></path></g></svg></a></h4>
<p class="whitespace-pre-wrap my-4">在此示例中，你希望在每次 <code dir="ltr" class="inline text-code text-secondary dark:text-secondary-dark px-1 rounded-md no-underline bg-gray-30 bg-opacity-10 py-px">roomId</code> 更改时记录一次。你希望在每个日志中包含当前的 <code dir="ltr" class="inline text-code text-secondary dark:text-secondary-dark px-1 rounded-md no-underline bg-gray-30 bg-opacity-10 py-px">notificationCount</code>，但你 <strong class="font-bold">不</strong> 希望通过更改 <code dir="ltr" class="inline text-code text-secondary dark:text-secondary-dark px-1 rounded-md no-underline bg-gray-30 bg-opacity-10 py-px">notificationCount</code> 来触发日志事件。</p>
<p class="whitespace-pre-wrap my-4">解决方案还是将非响应式代码拆分，将其放到 Effect Event 内：</p>
<!--$--><div dir="ltr" class="sandpack sandpack--codeblock rounded-2xl h-full w-full overflow-x-auto flex items-center bg-wash dark:bg-gray-95 shadow-lg my-8" style="contain:content"><div class="sp-wrapper"><div class="sp-stack"><div class="sp-code-editor"><pre class="sp-cm sp-pristine sp-javascript flex align-start"><code class="sp-pre-placeholder grow-[2]"><div class="cm-line "><span class="sp-syntax-keyword">function</span> <span class="sp-syntax-definition">Chat</span><span class="sp-syntax-punctuation">(</span><span class="sp-syntax-punctuation">{</span> <span class="sp-syntax-property">roomId</span><span class="sp-syntax-punctuation">,</span> <span class="sp-syntax-property">notificationCount</span> <span class="sp-syntax-punctuation">}</span><span class="sp-syntax-punctuation">)</span> <span class="sp-syntax-punctuation">{</span><br/></div><div class="cm-line bg-github-highlight dark:bg-opacity-10">  <span class="sp-syntax-keyword">const</span> <span class="sp-syntax-plain">onVisit</span> = <span class="sp-syntax-definition">useEffectEvent</span><span class="sp-syntax-punctuation">(</span><span class="sp-syntax-plain">visitedRoomId</span> <span class="sp-syntax-punctuation">=&gt;</span> <span class="sp-syntax-punctuation">{</span><br/></div><div class="cm-line bg-github-highlight dark:bg-opacity-10">    <span class="sp-syntax-definition">logVisit</span><span class="sp-syntax-punctuation">(</span><span class="sp-syntax-plain">visitedRoomId</span><span class="sp-syntax-punctuation">,</span> <span class="sp-syntax-plain">notificationCount</span><span class="sp-syntax-punctuation">)</span><span class="sp-syntax-punctuation">;</span><br/></div><div class="cm-line bg-github-highlight dark:bg-opacity-10">  <span class="sp-syntax-punctuation">}</span><span class="sp-syntax-punctuation">)</span><span class="sp-syntax-punctuation">;</span><br/></div><div class="cm-line "><br/></div><div class="cm-line ">  <span class="sp-syntax-definition">useEffect</span><span class="sp-syntax-punctuation">(</span><span class="sp-syntax-punctuation">(</span><span class="sp-syntax-punctuation">)</span> <span class="sp-syntax-punctuation">=&gt;</span> <span class="sp-syntax-punctuation">{</span><br/></div><div class="cm-line bg-github-highlight dark:bg-opacity-10">    <span class="sp-syntax-definition">onVisit</span><span class="sp-syntax-punctuation">(</span><span class="sp-syntax-plain">roomId</span><span class="sp-syntax-punctuation">)</span><span class="sp-syntax-punctuation">;</span><br/></div><div class="cm-line ">  <span class="sp-syntax-punctuation">}</span><span class="sp-syntax-punctuation">,</span> <span class="sp-syntax-punctuation">[</span><span class="sp-syntax-plain">roomId</span><span class="sp-syntax-punctuation">]</span><span class="sp-syntax-punctuation">)</span><span class="sp-syntax-punctuation">;</span> <span class="sp-syntax-comment">// ✅ 所有依赖已声明</span><br/></div><div class="cm-line ">  <span class="sp-syntax-comment">// ...</span><br/></div><div class="cm-line "><span class="sp-syntax-punctuation">}</span></div></code></pre></div></div></div></div><!--/$-->
<p class="whitespace-pre-wrap my-4">你希望逻辑对 <code dir="ltr" class="inline text-code text-secondary dark:text-secondary-dark px-1 rounded-md no-underline bg-gray-30 bg-opacity-10 py-px">roomId</code> 做出响应，因此你在 Effect 中读取 <code dir="ltr" class="inline text-code text-secondary dark:text-secondary-dark px-1 rounded-md no-underline bg-gray-30 bg-opacity-10 py-px">roomId</code>。但是，你不希望更改 <code dir="ltr" class="inline text-code text-secondary dark:text-secondary-dark px-1 rounded-md no-underline bg-gray-30 bg-opacity-10 py-px">notificationCount</code> 来记录额外的日志输出，因此你可以在 Effect Event 中读取 <code dir="ltr" class="inline text-code text-secondary dark:text-secondary-dark px-1 rounded-md no-underline bg-gray-30 bg-opacity-10 py-px">notificationCount</code>。<a class="inline text-link dark:text-link-dark border-b border-link border-opacity-0 hover:border-opacity-100 duration-100 ease-in transition leading-normal" href="/learn/separating-events-from-effects#reading-latest-props-and-state-with-effect-events">了解使用 Effect Events 在 Effect 中读取最新 props 和 state 的更多信息</a>。</p>
<h3 id="does-some-reactive-value-change-unintentionally" class="mdx-heading text-2xl font-display leading-9 text-primary dark:text-primary-dark font-bold my-6">一些响应式值是否无意中改变了？ <a href="#does-some-reactive-value-change-unintentionally" aria-label="Link for 一些响应式值是否无意中改变了？ " title="Link for 一些响应式值是否无意中改变了？ " class="mdx-header-anchor inline-block"><svg width="1em" height="1em" viewBox="0 0 13 13" xmlns="http://www.w3.org/2000/svg" class="text-gray-70 ms-2 h-5 w-5"><g fill="currentColor" fill-rule="evenodd"><path d="M7.778 7.975a2.5 2.5 0 0 0 .347-3.837L6.017 2.03a2.498 2.498 0 0 0-3.542-.007 2.5 2.5 0 0 0 .006 3.543l1.153 1.15c.07-.29.154-.563.25-.773.036-.077.084-.16.14-.25L3.18 4.85a1.496 1.496 0 0 1 .002-2.12 1.496 1.496 0 0 1 2.12 0l2.124 2.123a1.496 1.496 0 0 1-.333 2.37c.16.246.42.504.685.752z"></path><path d="M5.657 4.557a2.5 2.5 0 0 0-.347 3.837l2.108 2.108a2.498 2.498 0 0 0 3.542.007 2.5 2.5 0 0 0-.006-3.543L9.802 5.815c-.07.29-.154.565-.25.774-.036.076-.084.16-.14.25l.842.84c.585.587.59 1.532 0 2.122-.587.585-1.532.59-2.12 0L6.008 7.68a1.496 1.496 0 0 1 .332-2.372c-.16-.245-.42-.503-.685-.75z"></path></g></svg></a></h3>
<p class="whitespace-pre-wrap my-4">有时，你 <strong class="font-bold">确实</strong> 希望 Effect 对某个值“做出反应”，但该值的变化比你希望的更频繁——并且可能不会从用户的角度反映任何实际变化。例如，假设你在组件中创建了 <code dir="ltr" class="inline text-code text-secondary dark:text-secondary-dark px-1 rounded-md no-underline bg-gray-30 bg-opacity-10 py-px">options</code> 对象，然后从 Effect 内部读取该对象：</p>
<!--$--><div dir="ltr" class="sandpack sandpack--codeblock rounded-2xl h-full w-full overflow-x-auto flex items-center bg-wash dark:bg-gray-95 shadow-lg my-8" style="contain:content"><div class="sp-wrapper"><div class="sp-stack"><div class="sp-code-editor"><pre class="sp-cm sp-pristine sp-javascript flex align-start"><code class="sp-pre-placeholder grow-[2]"><div class="cm-line "><span class="sp-syntax-keyword">function</span> <span class="sp-syntax-definition">ChatRoom</span><span class="sp-syntax-punctuation">(</span><span class="sp-syntax-punctuation">{</span> <span class="sp-syntax-property">roomId</span> <span class="sp-syntax-punctuation">}</span><span class="sp-syntax-punctuation">)</span> <span class="sp-syntax-punctuation">{</span><br/></div><div class="cm-line ">  <span class="sp-syntax-comment">// ...</span><br/></div><div class="cm-line bg-github-highlight dark:bg-opacity-10">  <span class="sp-syntax-keyword">const</span> <span class="sp-syntax-plain">options</span> = <span class="sp-syntax-punctuation">{</span><br/></div><div class="cm-line bg-github-highlight dark:bg-opacity-10">    <span class="sp-syntax-property">serverUrl</span><span class="sp-syntax-punctuation">:</span> <span class="sp-syntax-plain">serverUrl</span><span class="sp-syntax-punctuation">,</span><br/></div><div class="cm-line bg-github-highlight dark:bg-opacity-10">    <span class="sp-syntax-property">roomId</span><span class="sp-syntax-punctuation">:</span> <span class="sp-syntax-plain">roomId</span><br/></div><div class="cm-line bg-github-highlight dark:bg-opacity-10">  <span class="sp-syntax-punctuation">}</span><span class="sp-syntax-punctuation">;</span><br/></div><div class="cm-line "><br/></div><div class="cm-line ">  <span class="sp-syntax-definition">useEffect</span><span class="sp-syntax-punctuation">(</span><span class="sp-syntax-punctuation">(</span><span class="sp-syntax-punctuation">)</span> <span class="sp-syntax-punctuation">=&gt;</span> <span class="sp-syntax-punctuation">{</span><br/></div><div class="cm-line bg-github-highlight dark:bg-opacity-10">    <span class="sp-syntax-keyword">const</span> <span class="sp-syntax-plain">connection</span> = <span class="sp-syntax-definition">createConnection</span><span class="sp-syntax-punctuation">(</span><span class="sp-syntax-plain">options</span><span class="sp-syntax-punctuation">)</span><span class="sp-syntax-punctuation">;</span><br/></div><div class="cm-line ">    <span class="sp-syntax-plain">connection</span>.<span class="sp-syntax-property">connect</span><span class="sp-syntax-punctuation">(</span><span class="sp-syntax-punctuation">)</span><span class="sp-syntax-punctuation">;</span><br/></div><div class="cm-line ">    <span class="sp-syntax-comment">// ...</span></div></code></pre></div></div></div></div><!--/$-->
<p class="whitespace-pre-wrap my-4">该对象在组件中声明，因此它是 <a class="inline text-link dark:text-link-dark border-b border-link border-opacity-0 hover:border-opacity-100 duration-100 ease-in transition leading-normal" href="/learn/lifecycle-of-reactive-effects#effects-react-to-reactive-values">响应式值</a>。当你在 Effect 中读取这样的响应式值时，你将其声明为依赖。这可确保 Effect 对其更改做出“反应”：</p>
<!--$--><div dir="ltr" class="sandpack sandpack--codeblock rounded-2xl h-full w-full overflow-x-auto flex items-center bg-wash dark:bg-gray-95 shadow-lg my-8" style="contain:content"><div class="sp-wrapper"><div class="sp-stack"><div class="sp-code-editor"><pre class="sp-cm sp-pristine sp-javascript flex align-start"><code class="sp-pre-placeholder grow-[2]"><div class="cm-line ">  <span class="sp-syntax-comment">// ...</span><br/></div><div class="cm-line ">  <span class="sp-syntax-definition">useEffect</span><span class="sp-syntax-punctuation">(</span><span class="sp-syntax-punctuation">(</span><span class="sp-syntax-punctuation">)</span> <span class="sp-syntax-punctuation">=&gt;</span> <span class="sp-syntax-punctuation">{</span><br/></div><div class="cm-line bg-github-highlight dark:bg-opacity-10">    <span class="sp-syntax-keyword">const</span> <span class="sp-syntax-plain">connection</span> = <span class="sp-syntax-definition">createConnection</span><span class="sp-syntax-punctuation">(</span><span class="sp-syntax-plain">options</span><span class="sp-syntax-punctuation">)</span><span class="sp-syntax-punctuation">;</span><br/></div><div class="cm-line ">    <span class="sp-syntax-plain">connection</span>.<span class="sp-syntax-property">connect</span><span class="sp-syntax-punctuation">(</span><span class="sp-syntax-punctuation">)</span><span class="sp-syntax-punctuation">;</span><br/></div><div class="cm-line ">    <span class="sp-syntax-keyword">return</span> <span class="sp-syntax-punctuation">(</span><span class="sp-syntax-punctuation">)</span> <span class="sp-syntax-punctuation">=&gt;</span> <span class="sp-syntax-plain">connection</span>.<span class="sp-syntax-property">disconnect</span><span class="sp-syntax-punctuation">(</span><span class="sp-syntax-punctuation">)</span><span class="sp-syntax-punctuation">;</span><br/></div><div class="cm-line bg-github-highlight dark:bg-opacity-10">  <span class="sp-syntax-punctuation">}</span><span class="sp-syntax-punctuation">,</span> <span class="sp-syntax-punctuation">[</span><span class="sp-syntax-plain">options</span><span class="sp-syntax-punctuation">]</span><span class="sp-syntax-punctuation">)</span><span class="sp-syntax-punctuation">;</span> <span class="sp-syntax-comment">// ✅ 所有依赖已声明</span><br/></div><div class="cm-line ">  <span class="sp-syntax-comment">// ...</span></div></code></pre></div></div></div></div><!--/$-->
<p class="whitespace-pre-wrap my-4">将其声明为依赖很重要！例如，这可以确保如果 <code dir="ltr" class="inline text-code text-secondary dark:text-secondary-dark px-1 rounded-md no-underline bg-gray-30 bg-opacity-10 py-px">roomId</code> 发生变化，Effect 将使用新的 <code dir="ltr" class="inline text-code text-secondary dark:text-secondary-dark px-1 rounded-md no-underline bg-gray-30 bg-opacity-10 py-px">options</code> 重新连接到聊天。但是，上面的代码也有问题。要查看它，请尝试在下面的沙盒中输入内容，然后观察控制台中发生的情况：</p>
</div><!--$--><div class="sandpack sandpack--playground w-full my-8" dir="ltr"><div class="sp-wrapper"><div class="shadow-lg dark:shadow-lg-dark rounded-lg" style="contain:content"><div class="bg-wash dark:bg-card-dark flex justify-between items-center relative z-10 border-b border-border dark:border-border-dark rounded-t-lg text-lg"><div class="flex-1 grow min-w-0 px-4 lg:px-6"><div><div class="relative overflow-hidden"><div class="w-[fit-content] invisible"><div class=" sp-tabs" translate="no"><div aria-label="Select active file" class=" sp-tabs-scrollable-container" role="tablist"><button aria-selected="true" class="  sp-tab-button" data-active="true" role="tab" title="/src/App.js" type="button">App.js</button><button aria-selected="false" class="  sp-tab-button" data-active="false" role="tab" title="/src/chat.js" type="button">chat.js</button></div></div></div><button class="absolute top-0 start-[2px]" id="headlessui-listbox-button-:R9iocq6:" aria-haspopup="true" aria-expanded="false" data-headlessui-state=""><span class="h-full py-2 px-1 mt-px -mb-px flex border-b text-link dark:text-link-dark border-link dark:border-link-dark items-center text-md leading-tight truncate" style="max-width:160px">App.js<span class="ms-2"><svg class="rotate-0" xmlns="http://www.w3.org/2000/svg" width="20" height="20" viewBox="0 0 20 20"><g fill="none" fill-rule="evenodd" transform="translate(-446 -398)"><path fill="currentColor" fill-rule="nonzero" d="M95.8838835,240.366117 C95.3957281,239.877961 94.6042719,239.877961 94.1161165,240.366117 C93.6279612,240.854272 93.6279612,241.645728 94.1161165,242.133883 L98.6161165,246.633883 C99.1042719,247.122039 99.8957281,247.122039 100.383883,246.633883 L104.883883,242.133883 C105.372039,241.645728 105.372039,240.854272 104.883883,240.366117 C104.395728,239.877961 103.604272,239.877961 103.116117,240.366117 L99.5,243.982233 L95.8838835,240.366117 Z" transform="translate(356.5 164.5)"></path><polygon points="446 418 466 418 466 398 446 398"></polygon></g></svg></span></span></button></div></div></div><div class="px-3 flex items-center justify-end text-start" translate="yes"><button class="text-sm text-primary dark:text-primary-dark inline-flex items-center hover:text-link duration-100 ease-in transition mx-1" title="Reset Sandbox" type="button"><svg width="1em" height="1em" viewBox="0 0 24 24" fill="none" xmlns="http://www.w3.org/2000/svg" class="inline mx-1 relative"><path d="M13.8982 5.20844C12.4626 4.88688 10.9686 4.93769 9.55821 5.35604L11.8524 3.06184C11.8989 3.0154 11.9357 2.96028 11.9608 2.89961C11.986 2.83894 11.9989 2.77391 11.9989 2.70824C11.9989 2.64256 11.986 2.57754 11.9608 2.51686C11.9357 2.45619 11.8989 2.40107 11.8524 2.35464L11.1456 1.64784C11.0992 1.60139 11.0441 1.56455 10.9834 1.53942C10.9227 1.51428 10.8577 1.50134 10.792 1.50134C10.7263 1.50134 10.6613 1.51428 10.6006 1.53942C10.54 1.56455 10.4848 1.60139 10.4384 1.64784L6.14571 5.94054C6.00654 6.07969 5.89615 6.2449 5.82083 6.42673C5.74551 6.60855 5.70675 6.80343 5.70675 7.00024C5.70675 7.19704 5.74551 7.39192 5.82083 7.57374C5.89615 7.75557 6.00654 7.92078 6.14571 8.05994L10.4387 12.3529C10.5325 12.4465 10.6595 12.4991 10.792 12.4991C10.9245 12.4991 11.0516 12.4465 11.1453 12.3529L11.8527 11.6455C11.9463 11.5518 11.9989 11.4247 11.9989 11.2922C11.9989 11.1598 11.9463 11.0327 11.8527 10.9389L8.77481 7.86104C9.99795 7.16236 11.415 6.8801 12.8125 7.05678C14.21 7.23347 15.5122 7.85953 16.523 8.84064C17.5338 9.82176 18.1983 11.1048 18.4165 12.4964C18.6347 13.888 18.3947 15.3129 17.7328 16.5562C17.0708 17.7996 16.0227 18.7942 14.7463 19.3902C13.47 19.9861 12.0345 20.1511 10.6563 19.8603C9.27798 19.5695 8.03152 18.8387 7.10469 17.778C6.17786 16.7172 5.62086 15.384 5.51761 13.9791C5.51156 13.8512 5.45689 13.7303 5.36477 13.6413C5.27265 13.5522 5.15001 13.5017 5.02191 13.5H4.02081C3.95297 13.4996 3.88574 13.5129 3.8232 13.5392C3.76065 13.5655 3.70408 13.6042 3.6569 13.6529C3.60972 13.7017 3.57291 13.7595 3.54869 13.8228C3.52448 13.8862 3.51336 13.9538 3.51601 14.0216C3.61349 15.5965 4.1473 17.1132 5.0577 18.4019C5.9681 19.6906 7.21917 20.7006 8.6709 21.3188C10.1226 21.937 11.7178 22.139 13.2778 21.9022C14.8378 21.6654 16.3011 20.9992 17.504 19.978C18.7069 18.9569 19.6019 17.6212 20.0889 16.1203C20.5759 14.6195 20.6356 13.0128 20.2614 11.4799C19.8872 9.94705 19.0938 8.54858 17.97 7.44098C16.8462 6.33339 15.4363 5.56037 13.8982 5.20844V5.20844Z" fill="currentColor"></path></svg> 重置</button><a href="https://codesandbox.io/api/v1/sandboxes/define?undefined&amp;environment=create-react-app" rel="noreferrer noopener" target="_blank" title="Open in CodeSandbox" class="text-sm text-primary dark:text-primary-dark inline-flex items-center hover:text-link duration-100 ease-in transition mx-1 ms-2 md:ms-1"><svg width="1em" height="1em" viewBox="0 0 24 24" fill="none" xmlns="http://www.w3.org/2000/svg" class="inline mx-1 relative top-[1px]"><path d="M20.5001 2H15.5001C15.3675 2 15.2403 2.05268 15.1465 2.14645C15.0528 2.24021 15.0001 2.36739 15.0001 2.5V3.5C15.0001 3.63261 15.0528 3.75979 15.1465 3.85355C15.2403 3.94732 15.3675 4 15.5001 4H18.5901L7.6501 14.94C7.60323 14.9865 7.56604 15.0418 7.54065 15.1027C7.51527 15.1636 7.5022 15.229 7.5022 15.295C7.5022 15.361 7.51527 15.4264 7.54065 15.4873C7.56604 15.5482 7.60323 15.6035 7.6501 15.65L8.3501 16.35C8.39658 16.3969 8.45188 16.4341 8.51281 16.4594C8.57374 16.4848 8.63909 16.4979 8.7051 16.4979C8.7711 16.4979 8.83646 16.4848 8.89738 16.4594C8.95831 16.4341 9.01362 16.3969 9.0601 16.35L20.0001 5.41V8.5C20.0001 8.63261 20.0528 8.75979 20.1465 8.85355C20.2403 8.94732 20.3675 9 20.5001 9H21.5001C21.6327 9 21.7599 8.94732 21.8537 8.85355C21.9474 8.75979 22.0001 8.63261 22.0001 8.5V3.5C22.0001 3.10218 21.8421 2.72064 21.5608 2.43934C21.2795 2.15804 20.8979 2 20.5001 2V2Z" fill="currentColor"></path><path d="M21.5 13H20.5C20.3674 13 20.2402 13.0527 20.1464 13.1464C20.0527 13.2402 20 13.3674 20 13.5V20H4V4H10.5C10.6326 4 10.7598 3.94732 10.8536 3.85355C10.9473 3.75979 11 3.63261 11 3.5V2.5C11 2.36739 10.9473 2.24021 10.8536 2.14645C10.7598 2.05268 10.6326 2 10.5 2H3.5C3.10218 2 2.72064 2.15804 2.43934 2.43934C2.15804 2.72064 2 3.10218 2 3.5V20.5C2 20.8978 2.15804 21.2794 2.43934 21.5607C2.72064 21.842 3.10218 22 3.5 22H20.5C20.8978 22 21.2794 21.842 21.5607 21.5607C21.842 21.2794 22 20.8978 22 20.5V13.5C22 13.3674 21.9473 13.2402 21.8536 13.1464C21.7598 13.0527 21.6326 13 21.5 13Z" fill="currentColor"></path></svg><span class="hidden md:block">Fork</span></a></div></div><div class=" sp-layout"><div class=" sp-editor sp-stack"><div class=" sp-code-editor"><div aria-autocomplete="list" aria-label="Code Editor for App.js" aria-multiline="true" class="sp-pristine sp-javascript   sp-cm" role="textbox" tabindex="0" translate="no"><pre class=" sp-pre-placeholder" style="margin-left:var(--sp-space-11)"><span class="sp-syntax-keyword">import</span> <span class="sp-syntax-punctuation">{</span> <span class="sp-syntax-plain">useState</span><span class="sp-syntax-punctuation">,</span> <span class="sp-syntax-plain">useEffect</span> <span class="sp-syntax-punctuation">}</span> <span class="sp-syntax-keyword">from</span> <span class="sp-syntax-string">&#x27;react&#x27;</span><span class="sp-syntax-punctuation">;</span>
<span class="sp-syntax-keyword">import</span> <span class="sp-syntax-punctuation">{</span> <span class="sp-syntax-plain">createConnection</span> <span class="sp-syntax-punctuation">}</span> <span class="sp-syntax-keyword">from</span> <span class="sp-syntax-string">&#x27;./chat.js&#x27;</span><span class="sp-syntax-punctuation">;</span>

<span class="sp-syntax-keyword">const</span> <span class="sp-syntax-plain">serverUrl</span> = <span class="sp-syntax-string">&#x27;https://localhost:1234&#x27;</span><span class="sp-syntax-punctuation">;</span>

<span class="sp-syntax-keyword">function</span> <span class="sp-syntax-definition">ChatRoom</span><span class="sp-syntax-punctuation">(</span><span class="sp-syntax-punctuation">{</span> <span class="sp-syntax-property">roomId</span> <span class="sp-syntax-punctuation">}</span><span class="sp-syntax-punctuation">)</span> <span class="sp-syntax-punctuation">{</span>
  <span class="sp-syntax-keyword">const</span> <span class="sp-syntax-punctuation">[</span><span class="sp-syntax-plain">message</span><span class="sp-syntax-punctuation">,</span> <span class="sp-syntax-plain">setMessage</span><span class="sp-syntax-punctuation">]</span> = <span class="sp-syntax-definition">useState</span><span class="sp-syntax-punctuation">(</span><span class="sp-syntax-string">&#x27;&#x27;</span><span class="sp-syntax-punctuation">)</span><span class="sp-syntax-punctuation">;</span>

  <span class="sp-syntax-comment">// 暂时禁用 linter 以演示问题</span>
  <span class="sp-syntax-comment">// eslint-disable-next-line react-hooks/exhaustive-deps</span>
  <span class="sp-syntax-keyword">const</span> <span class="sp-syntax-plain">options</span> = <span class="sp-syntax-punctuation">{</span>
    <span class="sp-syntax-property">serverUrl</span><span class="sp-syntax-punctuation">:</span> <span class="sp-syntax-plain">serverUrl</span><span class="sp-syntax-punctuation">,</span>
    <span class="sp-syntax-property">roomId</span><span class="sp-syntax-punctuation">:</span> <span class="sp-syntax-plain">roomId</span>
  <span class="sp-syntax-punctuation">}</span><span class="sp-syntax-punctuation">;</span>

  <span class="sp-syntax-definition">useEffect</span><span class="sp-syntax-punctuation">(</span><span class="sp-syntax-punctuation">(</span><span class="sp-syntax-punctuation">)</span> <span class="sp-syntax-punctuation">=&gt;</span> <span class="sp-syntax-punctuation">{</span>
    <span class="sp-syntax-keyword">const</span> <span class="sp-syntax-plain">connection</span> = <span class="sp-syntax-definition">createConnection</span><span class="sp-syntax-punctuation">(</span><span class="sp-syntax-plain">options</span><span class="sp-syntax-punctuation">)</span><span class="sp-syntax-punctuation">;</span>
    <span class="sp-syntax-plain">connection</span>.<span class="sp-syntax-property">connect</span><span class="sp-syntax-punctuation">(</span><span class="sp-syntax-punctuation">)</span><span class="sp-syntax-punctuation">;</span>
    <span class="sp-syntax-keyword">return</span> <span class="sp-syntax-punctuation">(</span><span class="sp-syntax-punctuation">)</span> <span class="sp-syntax-punctuation">=&gt;</span> <span class="sp-syntax-plain">connection</span>.<span class="sp-syntax-property">disconnect</span><span class="sp-syntax-punctuation">(</span><span class="sp-syntax-punctuation">)</span><span class="sp-syntax-punctuation">;</span>
  <span class="sp-syntax-punctuation">}</span><span class="sp-syntax-punctuation">,</span> <span class="sp-syntax-punctuation">[</span><span class="sp-syntax-plain">options</span><span class="sp-syntax-punctuation">]</span><span class="sp-syntax-punctuation">)</span><span class="sp-syntax-punctuation">;</span>

  <span class="sp-syntax-keyword">return</span> <span class="sp-syntax-punctuation">(</span>
    <span class="sp-syntax-punctuation">&lt;</span><span class="sp-syntax-punctuation">&gt;</span>
      <span class="sp-syntax-punctuation">&lt;</span><span class="sp-syntax-tag">h1</span><span class="sp-syntax-punctuation">&gt;</span>欢迎来到 <span class="sp-syntax-punctuation">{</span><span class="sp-syntax-plain">roomId</span><span class="sp-syntax-punctuation">}</span> 房间！<span class="sp-syntax-punctuation">&lt;/</span><span class="sp-syntax-tag">h1</span><span class="sp-syntax-punctuation">&gt;</span>
      <span class="sp-syntax-punctuation">&lt;</span><span class="sp-syntax-tag">input</span> <span class="sp-syntax-property">value</span>=<span class="sp-syntax-punctuation">{</span><span class="sp-syntax-plain">message</span><span class="sp-syntax-punctuation">}</span> <span class="sp-syntax-property">onChange</span>=<span class="sp-syntax-punctuation">{</span><span class="sp-syntax-plain">e</span> <span class="sp-syntax-punctuation">=&gt;</span> <span class="sp-syntax-definition">setMessage</span><span class="sp-syntax-punctuation">(</span><span class="sp-syntax-plain">e</span>.<span class="sp-syntax-property">target</span>.<span class="sp-syntax-property">value</span><span class="sp-syntax-punctuation">)</span><span class="sp-syntax-punctuation">}</span> <span class="sp-syntax-punctuation">/&gt;</span>
    <span class="sp-syntax-punctuation">&lt;/</span><span class="sp-syntax-punctuation">&gt;</span>
  <span class="sp-syntax-punctuation">)</span><span class="sp-syntax-punctuation">;</span>
<span class="sp-syntax-punctuation">}</span>

<span class="sp-syntax-keyword">export</span> <span class="sp-syntax-keyword">default</span> <span class="sp-syntax-keyword">function</span> <span class="sp-syntax-definition">App</span><span class="sp-syntax-punctuation">(</span><span class="sp-syntax-punctuation">)</span> <span class="sp-syntax-punctuation">{</span>
  <span class="sp-syntax-keyword">const</span> <span class="sp-syntax-punctuation">[</span><span class="sp-syntax-plain">roomId</span><span class="sp-syntax-punctuation">,</span> <span class="sp-syntax-plain">setRoomId</span><span class="sp-syntax-punctuation">]</span> = <span class="sp-syntax-definition">useState</span><span class="sp-syntax-punctuation">(</span><span class="sp-syntax-string">&#x27;所有&#x27;</span><span class="sp-syntax-punctuation">)</span><span class="sp-syntax-punctuation">;</span>
  <span class="sp-syntax-keyword">return</span> <span class="sp-syntax-punctuation">(</span>
    <span class="sp-syntax-punctuation">&lt;</span><span class="sp-syntax-punctuation">&gt;</span>
      <span class="sp-syntax-punctuation">&lt;</span><span class="sp-syntax-tag">label</span><span class="sp-syntax-punctuation">&gt;</span>
        选择聊天室：
        <span class="sp-syntax-punctuation">&lt;</span><span class="sp-syntax-tag">select</span>
          <span class="sp-syntax-property">value</span>=<span class="sp-syntax-punctuation">{</span><span class="sp-syntax-plain">roomId</span><span class="sp-syntax-punctuation">}</span>
          <span class="sp-syntax-property">onChange</span>=<span class="sp-syntax-punctuation">{</span><span class="sp-syntax-plain">e</span> <span class="sp-syntax-punctuation">=&gt;</span> <span class="sp-syntax-definition">setRoomId</span><span class="sp-syntax-punctuation">(</span><span class="sp-syntax-plain">e</span>.<span class="sp-syntax-property">target</span>.<span class="sp-syntax-property">value</span><span class="sp-syntax-punctuation">)</span><span class="sp-syntax-punctuation">}</span>
        <span class="sp-syntax-punctuation">&gt;</span>
          <span class="sp-syntax-punctuation">&lt;</span><span class="sp-syntax-tag">option</span> <span class="sp-syntax-property">value</span>=<span class="sp-syntax-string">&quot;所有&quot;</span><span class="sp-syntax-punctuation">&gt;</span>所有<span class="sp-syntax-punctuation">&lt;/</span><span class="sp-syntax-tag">option</span><span class="sp-syntax-punctuation">&gt;</span>
          <span class="sp-syntax-punctuation">&lt;</span><span class="sp-syntax-tag">option</span> <span class="sp-syntax-property">value</span>=<span class="sp-syntax-string">&quot;旅游&quot;</span><span class="sp-syntax-punctuation">&gt;</span>旅游<span class="sp-syntax-punctuation">&lt;/</span><span class="sp-syntax-tag">option</span><span class="sp-syntax-punctuation">&gt;</span>
          <span class="sp-syntax-punctuation">&lt;</span><span class="sp-syntax-tag">option</span> <span class="sp-syntax-property">value</span>=<span class="sp-syntax-string">&quot;音乐&quot;</span><span class="sp-syntax-punctuation">&gt;</span>音乐<span class="sp-syntax-punctuation">&lt;/</span><span class="sp-syntax-tag">option</span><span class="sp-syntax-punctuation">&gt;</span>
        <span class="sp-syntax-punctuation">&lt;/</span><span class="sp-syntax-tag">select</span><span class="sp-syntax-punctuation">&gt;</span>
      <span class="sp-syntax-punctuation">&lt;/</span><span class="sp-syntax-tag">label</span><span class="sp-syntax-punctuation">&gt;</span>
      <span class="sp-syntax-punctuation">&lt;</span><span class="sp-syntax-tag">hr</span> <span class="sp-syntax-punctuation">/&gt;</span>
      <span class="sp-syntax-punctuation">&lt;</span><span class="sp-syntax-definition">ChatRoom</span> <span class="sp-syntax-property">roomId</span>=<span class="sp-syntax-punctuation">{</span><span class="sp-syntax-plain">roomId</span><span class="sp-syntax-punctuation">}</span> <span class="sp-syntax-punctuation">/&gt;</span>
    <span class="sp-syntax-punctuation">&lt;/</span><span class="sp-syntax-punctuation">&gt;</span>
  <span class="sp-syntax-punctuation">)</span><span class="sp-syntax-punctuation">;</span>
<span class="sp-syntax-punctuation">}</span>

</pre></div></div></div><div class=" order-last xl:order-2 sp-stack"><div class="p-0 sm:p-2 md:p-4 lg:p-8 bg-card dark:bg-wash-dark h-full relative md:rounded-b-lg lg:rounded-b-none"><div style="position:relative"><iframe class="rounded-t-none bg-white md:shadow-md sm:rounded-lg w-full max-w-full transition-opacity absolute opacity-0 pointer-events-none duration-75" title="Sandbox Preview" style="height:15px;z-index:-1"></iframe></div></div></div><button translate="yes" class="sandpack-expand flex text-base justify-between dark:border-card-dark bg-wash dark:bg-card-dark items-center z-10 p-1 w-full order-2 xl:order-last border-b-1 relative top-0"><span class="flex p-2 focus:outline-none text-primary dark:text-primary-dark leading-[20px]"><svg class="rotate-0 inline me-1.5 text-xl" xmlns="http://www.w3.org/2000/svg" width="20" height="20" viewBox="0 0 20 20"><g fill="none" fill-rule="evenodd" transform="translate(-446 -398)"><path fill="currentColor" fill-rule="nonzero" d="M95.8838835,240.366117 C95.3957281,239.877961 94.6042719,239.877961 94.1161165,240.366117 C93.6279612,240.854272 93.6279612,241.645728 94.1161165,242.133883 L98.6161165,246.633883 C99.1042719,247.122039 99.8957281,247.122039 100.383883,246.633883 L104.883883,242.133883 C105.372039,241.645728 105.372039,240.854272 104.883883,240.366117 C104.395728,239.877961 103.604272,239.877961 103.116117,240.366117 L99.5,243.982233 L95.8838835,240.366117 Z" transform="translate(356.5 164.5)"></path><polygon points="446 418 466 418 466 398 446 398"></polygon></g></svg>显示更多</span></button></div></div></div></div><!--/$--><div class="max-w-4xl ms-0 2xl:mx-auto">
<p class="whitespace-pre-wrap my-4">在上面的沙箱中，输入仅更新 <code dir="ltr" class="inline text-code text-secondary dark:text-secondary-dark px-1 rounded-md no-underline bg-gray-30 bg-opacity-10 py-px">message</code> 状态变量。从用户的角度来看，这不应该影响聊天连接。但是，每次更新 <code dir="ltr" class="inline text-code text-secondary dark:text-secondary-dark px-1 rounded-md no-underline bg-gray-30 bg-opacity-10 py-px">message</code> 时，组件都会重新渲染。当组件重新渲染时，其中的代码会从头开始重新运行。</p>
<p class="whitespace-pre-wrap my-4">在每次重新渲染 <code dir="ltr" class="inline text-code text-secondary dark:text-secondary-dark px-1 rounded-md no-underline bg-gray-30 bg-opacity-10 py-px">ChatRoom</code> 组件时，都会从头开始创建一个新的 <code dir="ltr" class="inline text-code text-secondary dark:text-secondary-dark px-1 rounded-md no-underline bg-gray-30 bg-opacity-10 py-px">options</code> 对象。React 发现 <code dir="ltr" class="inline text-code text-secondary dark:text-secondary-dark px-1 rounded-md no-underline bg-gray-30 bg-opacity-10 py-px">options</code> 对象与上次渲染期间创建的 <code dir="ltr" class="inline text-code text-secondary dark:text-secondary-dark px-1 rounded-md no-underline bg-gray-30 bg-opacity-10 py-px">options</code> 对象是 <strong class="font-bold">不同的对象</strong>。这就是为什么它会重新同步 Effect（依赖于 <code dir="ltr" class="inline text-code text-secondary dark:text-secondary-dark px-1 rounded-md no-underline bg-gray-30 bg-opacity-10 py-px">options</code>），并且会在你输入时重新连接聊天。</p>
<p class="whitespace-pre-wrap my-4"><strong class="font-bold">此问题仅影响对象和函数。在 JavaScript 中，每个新创建的对象和函数都被认为与其他所有对象和函数不同。即使他们的值相同也没关系</strong>！</p>
<!--$--><div dir="ltr" class="sandpack sandpack--codeblock rounded-2xl h-full w-full overflow-x-auto flex items-center bg-wash dark:bg-gray-95 shadow-lg my-8" style="contain:content"><div class="sp-wrapper"><div class="sp-stack"><div class="sp-code-editor"><pre class="sp-cm sp-pristine sp-javascript flex align-start"><code class="sp-pre-placeholder grow-[2]"><div class="cm-line "><span class="sp-syntax-comment">// 第一次渲染</span><br/></div><div class="cm-line "><span class="sp-syntax-keyword">const</span> <span class="sp-syntax-plain">options1</span> = <span class="sp-syntax-punctuation">{</span> <span class="sp-syntax-property">serverUrl</span><span class="sp-syntax-punctuation">:</span> <span class="sp-syntax-string">&#x27;https://localhost:1234&#x27;</span><span class="sp-syntax-punctuation">,</span> <span class="sp-syntax-property">roomId</span><span class="sp-syntax-punctuation">:</span> <span class="sp-syntax-string">&#x27;音乐&#x27;</span> <span class="sp-syntax-punctuation">}</span><span class="sp-syntax-punctuation">;</span><br/></div><div class="cm-line "><br/></div><div class="cm-line "><span class="sp-syntax-comment">// 下一次渲染</span><br/></div><div class="cm-line "><span class="sp-syntax-keyword">const</span> <span class="sp-syntax-plain">options2</span> = <span class="sp-syntax-punctuation">{</span> <span class="sp-syntax-property">serverUrl</span><span class="sp-syntax-punctuation">:</span> <span class="sp-syntax-string">&#x27;https://localhost:1234&#x27;</span><span class="sp-syntax-punctuation">,</span> <span class="sp-syntax-property">roomId</span><span class="sp-syntax-punctuation">:</span> <span class="sp-syntax-string">&#x27;音乐&#x27;</span> <span class="sp-syntax-punctuation">}</span><span class="sp-syntax-punctuation">;</span><br/></div><div class="cm-line "><br/></div><div class="cm-line bg-github-highlight dark:bg-opacity-10"><span class="sp-syntax-comment">// 这是 2 个不同的对象</span><br/></div><div class="cm-line bg-github-highlight dark:bg-opacity-10"><span class="sp-syntax-plain">console</span>.<span class="sp-syntax-property">log</span><span class="sp-syntax-punctuation">(</span><span class="sp-syntax-plain">Object</span>.<span class="sp-syntax-property">is</span><span class="sp-syntax-punctuation">(</span><span class="sp-syntax-plain">options1</span><span class="sp-syntax-punctuation">,</span> <span class="sp-syntax-plain">options2</span><span class="sp-syntax-punctuation">)</span><span class="sp-syntax-punctuation">)</span><span class="sp-syntax-punctuation">;</span> <span class="sp-syntax-comment">// false</span></div></code></pre></div></div></div></div><!--/$-->
<p class="whitespace-pre-wrap my-4"><strong class="font-bold">对象和函数作为依赖，会使 Effect 比你需要的更频繁地重新同步</strong>。</p>
<p class="whitespace-pre-wrap my-4">这就是为什么你应该尽可能避免将对象和函数作为 Effect 的依赖。所以，尝试将它们移到组件外部、Effect 内部，或从中提取原始值。</p>
<h4 id="move-static-objects-and-functions-outside-your-component" class="mdx-heading text-xl font-display font-bold leading-9 my-4">将静态对象和函数移出组件 <a href="#move-static-objects-and-functions-outside-your-component" aria-label="Link for 将静态对象和函数移出组件 " title="Link for 将静态对象和函数移出组件 " class="mdx-header-anchor inline-block"><svg width="1em" height="1em" viewBox="0 0 13 13" xmlns="http://www.w3.org/2000/svg" class="text-gray-70 ms-2 h-5 w-5"><g fill="currentColor" fill-rule="evenodd"><path d="M7.778 7.975a2.5 2.5 0 0 0 .347-3.837L6.017 2.03a2.498 2.498 0 0 0-3.542-.007 2.5 2.5 0 0 0 .006 3.543l1.153 1.15c.07-.29.154-.563.25-.773.036-.077.084-.16.14-.25L3.18 4.85a1.496 1.496 0 0 1 .002-2.12 1.496 1.496 0 0 1 2.12 0l2.124 2.123a1.496 1.496 0 0 1-.333 2.37c.16.246.42.504.685.752z"></path><path d="M5.657 4.557a2.5 2.5 0 0 0-.347 3.837l2.108 2.108a2.498 2.498 0 0 0 3.542.007 2.5 2.5 0 0 0-.006-3.543L9.802 5.815c-.07.29-.154.565-.25.774-.036.076-.084.16-.14.25l.842.84c.585.587.59 1.532 0 2.122-.587.585-1.532.59-2.12 0L6.008 7.68a1.496 1.496 0 0 1 .332-2.372c-.16-.245-.42-.503-.685-.75z"></path></g></svg></a></h4>
<p class="whitespace-pre-wrap my-4">如果该对象不依赖于任何 props 和 state，你可以将该对象移到组件之外：</p>
<!--$--><div dir="ltr" class="sandpack sandpack--codeblock rounded-2xl h-full w-full overflow-x-auto flex items-center bg-wash dark:bg-gray-95 shadow-lg my-8" style="contain:content"><div class="sp-wrapper"><div class="sp-stack"><div class="sp-code-editor"><pre class="sp-cm sp-pristine sp-javascript flex align-start"><code class="sp-pre-placeholder grow-[2]"><div class="cm-line bg-github-highlight dark:bg-opacity-10"><span class="sp-syntax-keyword">const</span> <span class="sp-syntax-plain">options</span> = <span class="sp-syntax-punctuation">{</span><br/></div><div class="cm-line bg-github-highlight dark:bg-opacity-10">  <span class="sp-syntax-property">serverUrl</span><span class="sp-syntax-punctuation">:</span> <span class="sp-syntax-string">&#x27;https://localhost:1234&#x27;</span><span class="sp-syntax-punctuation">,</span><br/></div><div class="cm-line bg-github-highlight dark:bg-opacity-10">  <span class="sp-syntax-property">roomId</span><span class="sp-syntax-punctuation">:</span> <span class="sp-syntax-string">&#x27;音乐&#x27;</span><br/></div><div class="cm-line bg-github-highlight dark:bg-opacity-10"><span class="sp-syntax-punctuation">}</span><span class="sp-syntax-punctuation">;</span><br/></div><div class="cm-line "><br/></div><div class="cm-line "><span class="sp-syntax-keyword">function</span> <span class="sp-syntax-definition">ChatRoom</span><span class="sp-syntax-punctuation">(</span><span class="sp-syntax-punctuation">)</span> <span class="sp-syntax-punctuation">{</span><br/></div><div class="cm-line ">  <span class="sp-syntax-keyword">const</span> <span class="sp-syntax-punctuation">[</span><span class="sp-syntax-plain">message</span><span class="sp-syntax-punctuation">,</span> <span class="sp-syntax-plain">setMessage</span><span class="sp-syntax-punctuation">]</span> = <span class="sp-syntax-definition">useState</span><span class="sp-syntax-punctuation">(</span><span class="sp-syntax-string">&#x27;&#x27;</span><span class="sp-syntax-punctuation">)</span><span class="sp-syntax-punctuation">;</span><br/></div><div class="cm-line "><br/></div><div class="cm-line ">  <span class="sp-syntax-definition">useEffect</span><span class="sp-syntax-punctuation">(</span><span class="sp-syntax-punctuation">(</span><span class="sp-syntax-punctuation">)</span> <span class="sp-syntax-punctuation">=&gt;</span> <span class="sp-syntax-punctuation">{</span><br/></div><div class="cm-line ">    <span class="sp-syntax-keyword">const</span> <span class="sp-syntax-plain">connection</span> = <span class="sp-syntax-definition">createConnection</span><span class="sp-syntax-punctuation">(</span><span class="sp-syntax-plain">options</span><span class="sp-syntax-punctuation">)</span><span class="sp-syntax-punctuation">;</span><br/></div><div class="cm-line ">    <span class="sp-syntax-plain">connection</span>.<span class="sp-syntax-property">connect</span><span class="sp-syntax-punctuation">(</span><span class="sp-syntax-punctuation">)</span><span class="sp-syntax-punctuation">;</span><br/></div><div class="cm-line ">    <span class="sp-syntax-keyword">return</span> <span class="sp-syntax-punctuation">(</span><span class="sp-syntax-punctuation">)</span> <span class="sp-syntax-punctuation">=&gt;</span> <span class="sp-syntax-plain">connection</span>.<span class="sp-syntax-property">disconnect</span><span class="sp-syntax-punctuation">(</span><span class="sp-syntax-punctuation">)</span><span class="sp-syntax-punctuation">;</span><br/></div><div class="cm-line bg-github-highlight dark:bg-opacity-10">  <span class="sp-syntax-punctuation">}</span><span class="sp-syntax-punctuation">,</span> <span class="sp-syntax-punctuation">[</span><span class="sp-syntax-punctuation">]</span><span class="sp-syntax-punctuation">)</span><span class="sp-syntax-punctuation">;</span> <span class="sp-syntax-comment">// ✅ 所有依赖已声明</span><br/></div><div class="cm-line ">  <span class="sp-syntax-comment">// ...</span></div></code></pre></div></div></div></div><!--/$-->
<p class="whitespace-pre-wrap my-4">这样，你向 linter <strong class="font-bold">证明</strong> 它不是响应式的。它不会因为重新渲染而改变，所以它不是依赖。现在重新渲染 <code dir="ltr" class="inline text-code text-secondary dark:text-secondary-dark px-1 rounded-md no-underline bg-gray-30 bg-opacity-10 py-px">ChatRoom</code> 不会导致 Effect 重新同步。</p>
<p class="whitespace-pre-wrap my-4">这也适用于函数场景：</p>
<!--$--><div dir="ltr" class="sandpack sandpack--codeblock rounded-2xl h-full w-full overflow-x-auto flex items-center bg-wash dark:bg-gray-95 shadow-lg my-8" style="contain:content"><div class="sp-wrapper"><div class="sp-stack"><div class="sp-code-editor"><pre class="sp-cm sp-pristine sp-javascript flex align-start"><code class="sp-pre-placeholder grow-[2]"><div class="cm-line bg-github-highlight dark:bg-opacity-10"><span class="sp-syntax-keyword">function</span> <span class="sp-syntax-definition">createOptions</span><span class="sp-syntax-punctuation">(</span><span class="sp-syntax-punctuation">)</span> <span class="sp-syntax-punctuation">{</span><br/></div><div class="cm-line bg-github-highlight dark:bg-opacity-10">  <span class="sp-syntax-keyword">return</span> <span class="sp-syntax-punctuation">{</span><br/></div><div class="cm-line bg-github-highlight dark:bg-opacity-10">    <span class="sp-syntax-property">serverUrl</span><span class="sp-syntax-punctuation">:</span> <span class="sp-syntax-string">&#x27;https://localhost:1234&#x27;</span><span class="sp-syntax-punctuation">,</span><br/></div><div class="cm-line bg-github-highlight dark:bg-opacity-10">    <span class="sp-syntax-property">roomId</span><span class="sp-syntax-punctuation">:</span> <span class="sp-syntax-string">&#x27;音乐&#x27;</span><br/></div><div class="cm-line bg-github-highlight dark:bg-opacity-10">  <span class="sp-syntax-punctuation">}</span><span class="sp-syntax-punctuation">;</span><br/></div><div class="cm-line bg-github-highlight dark:bg-opacity-10"><span class="sp-syntax-punctuation">}</span><br/></div><div class="cm-line "><br/></div><div class="cm-line "><span class="sp-syntax-keyword">function</span> <span class="sp-syntax-definition">ChatRoom</span><span class="sp-syntax-punctuation">(</span><span class="sp-syntax-punctuation">)</span> <span class="sp-syntax-punctuation">{</span><br/></div><div class="cm-line ">  <span class="sp-syntax-keyword">const</span> <span class="sp-syntax-punctuation">[</span><span class="sp-syntax-plain">message</span><span class="sp-syntax-punctuation">,</span> <span class="sp-syntax-plain">setMessage</span><span class="sp-syntax-punctuation">]</span> = <span class="sp-syntax-definition">useState</span><span class="sp-syntax-punctuation">(</span><span class="sp-syntax-string">&#x27;&#x27;</span><span class="sp-syntax-punctuation">)</span><span class="sp-syntax-punctuation">;</span><br/></div><div class="cm-line "><br/></div><div class="cm-line ">  <span class="sp-syntax-definition">useEffect</span><span class="sp-syntax-punctuation">(</span><span class="sp-syntax-punctuation">(</span><span class="sp-syntax-punctuation">)</span> <span class="sp-syntax-punctuation">=&gt;</span> <span class="sp-syntax-punctuation">{</span><br/></div><div class="cm-line bg-github-highlight dark:bg-opacity-10">    <span class="sp-syntax-keyword">const</span> <span class="sp-syntax-plain">options</span> = <span class="sp-syntax-definition">createOptions</span><span class="sp-syntax-punctuation">(</span><span class="sp-syntax-punctuation">)</span><span class="sp-syntax-punctuation">;</span><br/></div><div class="cm-line ">    <span class="sp-syntax-keyword">const</span> <span class="sp-syntax-plain">connection</span> = <span class="sp-syntax-definition">createConnection</span><span class="sp-syntax-punctuation">(</span><span class="sp-syntax-plain">options</span><span class="sp-syntax-punctuation">)</span><span class="sp-syntax-punctuation">;</span><br/></div><div class="cm-line ">    <span class="sp-syntax-plain">connection</span>.<span class="sp-syntax-property">connect</span><span class="sp-syntax-punctuation">(</span><span class="sp-syntax-punctuation">)</span><span class="sp-syntax-punctuation">;</span><br/></div><div class="cm-line ">    <span class="sp-syntax-keyword">return</span> <span class="sp-syntax-punctuation">(</span><span class="sp-syntax-punctuation">)</span> <span class="sp-syntax-punctuation">=&gt;</span> <span class="sp-syntax-plain">connection</span>.<span class="sp-syntax-property">disconnect</span><span class="sp-syntax-punctuation">(</span><span class="sp-syntax-punctuation">)</span><span class="sp-syntax-punctuation">;</span><br/></div><div class="cm-line ">  <span class="sp-syntax-punctuation">}</span><span class="sp-syntax-punctuation">,</span> <span class="sp-syntax-punctuation">[</span><span class="sp-syntax-punctuation">]</span><span class="sp-syntax-punctuation">)</span><span class="sp-syntax-punctuation">;</span> <span class="sp-syntax-comment">// ✅ 所有依赖已声明</span><br/></div><div class="cm-line ">  <span class="sp-syntax-comment">// ...</span></div></code></pre></div></div></div></div><!--/$-->
<p class="whitespace-pre-wrap my-4">由于 <code dir="ltr" class="inline text-code text-secondary dark:text-secondary-dark px-1 rounded-md no-underline bg-gray-30 bg-opacity-10 py-px">createOptions</code> 是在组件外部声明的，因此它不是响应式值。这就是为什么它不需要在 Effect 的依赖中指定，以及为什么它永远不会导致 Effect 重新同步。</p>
<h4 id="move-dynamic-objects-and-functions-inside-your-effect" class="mdx-heading text-xl font-display font-bold leading-9 my-4">将动态对象和函数移动到 Effect 中 <a href="#move-dynamic-objects-and-functions-inside-your-effect" aria-label="Link for 将动态对象和函数移动到 Effect 中 " title="Link for 将动态对象和函数移动到 Effect 中 " class="mdx-header-anchor inline-block"><svg width="1em" height="1em" viewBox="0 0 13 13" xmlns="http://www.w3.org/2000/svg" class="text-gray-70 ms-2 h-5 w-5"><g fill="currentColor" fill-rule="evenodd"><path d="M7.778 7.975a2.5 2.5 0 0 0 .347-3.837L6.017 2.03a2.498 2.498 0 0 0-3.542-.007 2.5 2.5 0 0 0 .006 3.543l1.153 1.15c.07-.29.154-.563.25-.773.036-.077.084-.16.14-.25L3.18 4.85a1.496 1.496 0 0 1 .002-2.12 1.496 1.496 0 0 1 2.12 0l2.124 2.123a1.496 1.496 0 0 1-.333 2.37c.16.246.42.504.685.752z"></path><path d="M5.657 4.557a2.5 2.5 0 0 0-.347 3.837l2.108 2.108a2.498 2.498 0 0 0 3.542.007 2.5 2.5 0 0 0-.006-3.543L9.802 5.815c-.07.29-.154.565-.25.774-.036.076-.084.16-.14.25l.842.84c.585.587.59 1.532 0 2.122-.587.585-1.532.59-2.12 0L6.008 7.68a1.496 1.496 0 0 1 .332-2.372c-.16-.245-.42-.503-.685-.75z"></path></g></svg></a></h4>
<p class="whitespace-pre-wrap my-4">如果对象依赖于一些可能因重新渲染而改变的响应式值，例如 <code dir="ltr" class="inline text-code text-secondary dark:text-secondary-dark px-1 rounded-md no-underline bg-gray-30 bg-opacity-10 py-px">roomId</code> props，那么你不能将它放置于组件 <strong class="font-bold">外部</strong>。你可以在 Effect <strong class="font-bold">内部</strong> 创建它：</p>
<!--$--><div dir="ltr" class="sandpack sandpack--codeblock rounded-2xl h-full w-full overflow-x-auto flex items-center bg-wash dark:bg-gray-95 shadow-lg my-8" style="contain:content"><div class="sp-wrapper"><div class="sp-stack"><div class="sp-code-editor"><pre class="sp-cm sp-pristine sp-javascript flex align-start"><code class="sp-pre-placeholder grow-[2]"><div class="cm-line "><span class="sp-syntax-keyword">const</span> <span class="sp-syntax-plain">serverUrl</span> = <span class="sp-syntax-string">&#x27;https://localhost:1234&#x27;</span><span class="sp-syntax-punctuation">;</span><br/></div><div class="cm-line "><br/></div><div class="cm-line "><span class="sp-syntax-keyword">function</span> <span class="sp-syntax-definition">ChatRoom</span><span class="sp-syntax-punctuation">(</span><span class="sp-syntax-punctuation">{</span> <span class="sp-syntax-property">roomId</span> <span class="sp-syntax-punctuation">}</span><span class="sp-syntax-punctuation">)</span> <span class="sp-syntax-punctuation">{</span><br/></div><div class="cm-line ">  <span class="sp-syntax-keyword">const</span> <span class="sp-syntax-punctuation">[</span><span class="sp-syntax-plain">message</span><span class="sp-syntax-punctuation">,</span> <span class="sp-syntax-plain">setMessage</span><span class="sp-syntax-punctuation">]</span> = <span class="sp-syntax-definition">useState</span><span class="sp-syntax-punctuation">(</span><span class="sp-syntax-string">&#x27;&#x27;</span><span class="sp-syntax-punctuation">)</span><span class="sp-syntax-punctuation">;</span><br/></div><div class="cm-line "><br/></div><div class="cm-line ">  <span class="sp-syntax-definition">useEffect</span><span class="sp-syntax-punctuation">(</span><span class="sp-syntax-punctuation">(</span><span class="sp-syntax-punctuation">)</span> <span class="sp-syntax-punctuation">=&gt;</span> <span class="sp-syntax-punctuation">{</span><br/></div><div class="cm-line bg-github-highlight dark:bg-opacity-10">    <span class="sp-syntax-keyword">const</span> <span class="sp-syntax-plain">options</span> = <span class="sp-syntax-punctuation">{</span><br/></div><div class="cm-line bg-github-highlight dark:bg-opacity-10">      <span class="sp-syntax-property">serverUrl</span><span class="sp-syntax-punctuation">:</span> <span class="sp-syntax-plain">serverUrl</span><span class="sp-syntax-punctuation">,</span><br/></div><div class="cm-line bg-github-highlight dark:bg-opacity-10">      <span class="sp-syntax-property">roomId</span><span class="sp-syntax-punctuation">:</span> <span class="sp-syntax-plain">roomId</span><br/></div><div class="cm-line bg-github-highlight dark:bg-opacity-10">    <span class="sp-syntax-punctuation">}</span><span class="sp-syntax-punctuation">;</span><br/></div><div class="cm-line bg-github-highlight dark:bg-opacity-10">    <span class="sp-syntax-keyword">const</span> <span class="sp-syntax-plain">connection</span> = <span class="sp-syntax-definition">createConnection</span><span class="sp-syntax-punctuation">(</span><span class="sp-syntax-plain">options</span><span class="sp-syntax-punctuation">)</span><span class="sp-syntax-punctuation">;</span><br/></div><div class="cm-line ">    <span class="sp-syntax-plain">connection</span>.<span class="sp-syntax-property">connect</span><span class="sp-syntax-punctuation">(</span><span class="sp-syntax-punctuation">)</span><span class="sp-syntax-punctuation">;</span><br/></div><div class="cm-line ">    <span class="sp-syntax-keyword">return</span> <span class="sp-syntax-punctuation">(</span><span class="sp-syntax-punctuation">)</span> <span class="sp-syntax-punctuation">=&gt;</span> <span class="sp-syntax-plain">connection</span>.<span class="sp-syntax-property">disconnect</span><span class="sp-syntax-punctuation">(</span><span class="sp-syntax-punctuation">)</span><span class="sp-syntax-punctuation">;</span><br/></div><div class="cm-line bg-github-highlight dark:bg-opacity-10">  <span class="sp-syntax-punctuation">}</span><span class="sp-syntax-punctuation">,</span> <span class="sp-syntax-punctuation">[</span><span class="sp-syntax-plain">roomId</span><span class="sp-syntax-punctuation">]</span><span class="sp-syntax-punctuation">)</span><span class="sp-syntax-punctuation">;</span> <span class="sp-syntax-comment">// ✅ 所有依赖已声明</span><br/></div><div class="cm-line ">  <span class="sp-syntax-comment">// ...</span></div></code></pre></div></div></div></div><!--/$-->
<p class="whitespace-pre-wrap my-4">现在 <code dir="ltr" class="inline text-code text-secondary dark:text-secondary-dark px-1 rounded-md no-underline bg-gray-30 bg-opacity-10 py-px">options</code> 已在 Effect 中声明，它不再是 Effect 的依赖。相反，Effect 使用的唯一响应式值是 <code dir="ltr" class="inline text-code text-secondary dark:text-secondary-dark px-1 rounded-md no-underline bg-gray-30 bg-opacity-10 py-px">roomId</code>。由于 <code dir="ltr" class="inline text-code text-secondary dark:text-secondary-dark px-1 rounded-md no-underline bg-gray-30 bg-opacity-10 py-px">roomId</code> 不是对象或函数，你可以确定它不会 <strong class="font-bold">无意间</strong> 变不同。在 JavaScript 中，数字和字符串根据它们的内容进行比较：</p>
<!--$--><div dir="ltr" class="sandpack sandpack--codeblock rounded-2xl h-full w-full overflow-x-auto flex items-center bg-wash dark:bg-gray-95 shadow-lg my-8" style="contain:content"><div class="sp-wrapper"><div class="sp-stack"><div class="sp-code-editor"><pre class="sp-cm sp-pristine sp-javascript flex align-start"><code class="sp-pre-placeholder grow-[2]"><div class="cm-line "><span class="sp-syntax-comment">// 第一次渲染</span><br/></div><div class="cm-line "><span class="sp-syntax-keyword">const</span> <span class="sp-syntax-plain">roomId1</span> = <span class="sp-syntax-string">&#x27;音乐&#x27;</span><span class="sp-syntax-punctuation">;</span><br/></div><div class="cm-line "><br/></div><div class="cm-line "><span class="sp-syntax-comment">// 下一次渲染</span><br/></div><div class="cm-line "><span class="sp-syntax-keyword">const</span> <span class="sp-syntax-plain">roomId2</span> = <span class="sp-syntax-string">&#x27;音乐&#x27;</span><span class="sp-syntax-punctuation">;</span><br/></div><div class="cm-line "><br/></div><div class="cm-line bg-github-highlight dark:bg-opacity-10"><span class="sp-syntax-comment">// 这 2 个字符串是相同的</span><br/></div><div class="cm-line bg-github-highlight dark:bg-opacity-10"><span class="sp-syntax-plain">console</span>.<span class="sp-syntax-property">log</span><span class="sp-syntax-punctuation">(</span><span class="sp-syntax-plain">Object</span>.<span class="sp-syntax-property">is</span><span class="sp-syntax-punctuation">(</span><span class="sp-syntax-plain">roomId1</span><span class="sp-syntax-punctuation">,</span> <span class="sp-syntax-plain">roomId2</span><span class="sp-syntax-punctuation">)</span><span class="sp-syntax-punctuation">)</span><span class="sp-syntax-punctuation">;</span> <span class="sp-syntax-comment">// true</span></div></code></pre></div></div></div></div><!--/$-->
<p class="whitespace-pre-wrap my-4">得益于此修复，当你编辑输入时，聊天将不再重新连接：</p>
</div><!--$--><div class="sandpack sandpack--playground w-full my-8" dir="ltr"><div class="sp-wrapper"><div class="shadow-lg dark:shadow-lg-dark rounded-lg" style="contain:content"><div class="bg-wash dark:bg-card-dark flex justify-between items-center relative z-10 border-b border-border dark:border-border-dark rounded-t-lg text-lg"><div class="flex-1 grow min-w-0 px-4 lg:px-6"><div><div class="relative overflow-hidden"><div class="w-[fit-content] invisible"><div class=" sp-tabs" translate="no"><div aria-label="Select active file" class=" sp-tabs-scrollable-container" role="tablist"><button aria-selected="true" class="  sp-tab-button" data-active="true" role="tab" title="/src/App.js" type="button">App.js</button><button aria-selected="false" class="  sp-tab-button" data-active="false" role="tab" title="/src/chat.js" type="button">chat.js</button></div></div></div><button class="absolute top-0 start-[2px]" id="headlessui-listbox-button-:R9iqcq6:" aria-haspopup="true" aria-expanded="false" data-headlessui-state=""><span class="h-full py-2 px-1 mt-px -mb-px flex border-b text-link dark:text-link-dark border-link dark:border-link-dark items-center text-md leading-tight truncate" style="max-width:160px">App.js<span class="ms-2"><svg class="rotate-0" xmlns="http://www.w3.org/2000/svg" width="20" height="20" viewBox="0 0 20 20"><g fill="none" fill-rule="evenodd" transform="translate(-446 -398)"><path fill="currentColor" fill-rule="nonzero" d="M95.8838835,240.366117 C95.3957281,239.877961 94.6042719,239.877961 94.1161165,240.366117 C93.6279612,240.854272 93.6279612,241.645728 94.1161165,242.133883 L98.6161165,246.633883 C99.1042719,247.122039 99.8957281,247.122039 100.383883,246.633883 L104.883883,242.133883 C105.372039,241.645728 105.372039,240.854272 104.883883,240.366117 C104.395728,239.877961 103.604272,239.877961 103.116117,240.366117 L99.5,243.982233 L95.8838835,240.366117 Z" transform="translate(356.5 164.5)"></path><polygon points="446 418 466 418 466 398 446 398"></polygon></g></svg></span></span></button></div></div></div><div class="px-3 flex items-center justify-end text-start" translate="yes"><button class="text-sm text-primary dark:text-primary-dark inline-flex items-center hover:text-link duration-100 ease-in transition mx-1" title="Reset Sandbox" type="button"><svg width="1em" height="1em" viewBox="0 0 24 24" fill="none" xmlns="http://www.w3.org/2000/svg" class="inline mx-1 relative"><path d="M13.8982 5.20844C12.4626 4.88688 10.9686 4.93769 9.55821 5.35604L11.8524 3.06184C11.8989 3.0154 11.9357 2.96028 11.9608 2.89961C11.986 2.83894 11.9989 2.77391 11.9989 2.70824C11.9989 2.64256 11.986 2.57754 11.9608 2.51686C11.9357 2.45619 11.8989 2.40107 11.8524 2.35464L11.1456 1.64784C11.0992 1.60139 11.0441 1.56455 10.9834 1.53942C10.9227 1.51428 10.8577 1.50134 10.792 1.50134C10.7263 1.50134 10.6613 1.51428 10.6006 1.53942C10.54 1.56455 10.4848 1.60139 10.4384 1.64784L6.14571 5.94054C6.00654 6.07969 5.89615 6.2449 5.82083 6.42673C5.74551 6.60855 5.70675 6.80343 5.70675 7.00024C5.70675 7.19704 5.74551 7.39192 5.82083 7.57374C5.89615 7.75557 6.00654 7.92078 6.14571 8.05994L10.4387 12.3529C10.5325 12.4465 10.6595 12.4991 10.792 12.4991C10.9245 12.4991 11.0516 12.4465 11.1453 12.3529L11.8527 11.6455C11.9463 11.5518 11.9989 11.4247 11.9989 11.2922C11.9989 11.1598 11.9463 11.0327 11.8527 10.9389L8.77481 7.86104C9.99795 7.16236 11.415 6.8801 12.8125 7.05678C14.21 7.23347 15.5122 7.85953 16.523 8.84064C17.5338 9.82176 18.1983 11.1048 18.4165 12.4964C18.6347 13.888 18.3947 15.3129 17.7328 16.5562C17.0708 17.7996 16.0227 18.7942 14.7463 19.3902C13.47 19.9861 12.0345 20.1511 10.6563 19.8603C9.27798 19.5695 8.03152 18.8387 7.10469 17.778C6.17786 16.7172 5.62086 15.384 5.51761 13.9791C5.51156 13.8512 5.45689 13.7303 5.36477 13.6413C5.27265 13.5522 5.15001 13.5017 5.02191 13.5H4.02081C3.95297 13.4996 3.88574 13.5129 3.8232 13.5392C3.76065 13.5655 3.70408 13.6042 3.6569 13.6529C3.60972 13.7017 3.57291 13.7595 3.54869 13.8228C3.52448 13.8862 3.51336 13.9538 3.51601 14.0216C3.61349 15.5965 4.1473 17.1132 5.0577 18.4019C5.9681 19.6906 7.21917 20.7006 8.6709 21.3188C10.1226 21.937 11.7178 22.139 13.2778 21.9022C14.8378 21.6654 16.3011 20.9992 17.504 19.978C18.7069 18.9569 19.6019 17.6212 20.0889 16.1203C20.5759 14.6195 20.6356 13.0128 20.2614 11.4799C19.8872 9.94705 19.0938 8.54858 17.97 7.44098C16.8462 6.33339 15.4363 5.56037 13.8982 5.20844V5.20844Z" fill="currentColor"></path></svg> 重置</button><a href="https://codesandbox.io/api/v1/sandboxes/define?undefined&amp;environment=create-react-app" rel="noreferrer noopener" target="_blank" title="Open in CodeSandbox" class="text-sm text-primary dark:text-primary-dark inline-flex items-center hover:text-link duration-100 ease-in transition mx-1 ms-2 md:ms-1"><svg width="1em" height="1em" viewBox="0 0 24 24" fill="none" xmlns="http://www.w3.org/2000/svg" class="inline mx-1 relative top-[1px]"><path d="M20.5001 2H15.5001C15.3675 2 15.2403 2.05268 15.1465 2.14645C15.0528 2.24021 15.0001 2.36739 15.0001 2.5V3.5C15.0001 3.63261 15.0528 3.75979 15.1465 3.85355C15.2403 3.94732 15.3675 4 15.5001 4H18.5901L7.6501 14.94C7.60323 14.9865 7.56604 15.0418 7.54065 15.1027C7.51527 15.1636 7.5022 15.229 7.5022 15.295C7.5022 15.361 7.51527 15.4264 7.54065 15.4873C7.56604 15.5482 7.60323 15.6035 7.6501 15.65L8.3501 16.35C8.39658 16.3969 8.45188 16.4341 8.51281 16.4594C8.57374 16.4848 8.63909 16.4979 8.7051 16.4979C8.7711 16.4979 8.83646 16.4848 8.89738 16.4594C8.95831 16.4341 9.01362 16.3969 9.0601 16.35L20.0001 5.41V8.5C20.0001 8.63261 20.0528 8.75979 20.1465 8.85355C20.2403 8.94732 20.3675 9 20.5001 9H21.5001C21.6327 9 21.7599 8.94732 21.8537 8.85355C21.9474 8.75979 22.0001 8.63261 22.0001 8.5V3.5C22.0001 3.10218 21.8421 2.72064 21.5608 2.43934C21.2795 2.15804 20.8979 2 20.5001 2V2Z" fill="currentColor"></path><path d="M21.5 13H20.5C20.3674 13 20.2402 13.0527 20.1464 13.1464C20.0527 13.2402 20 13.3674 20 13.5V20H4V4H10.5C10.6326 4 10.7598 3.94732 10.8536 3.85355C10.9473 3.75979 11 3.63261 11 3.5V2.5C11 2.36739 10.9473 2.24021 10.8536 2.14645C10.7598 2.05268 10.6326 2 10.5 2H3.5C3.10218 2 2.72064 2.15804 2.43934 2.43934C2.15804 2.72064 2 3.10218 2 3.5V20.5C2 20.8978 2.15804 21.2794 2.43934 21.5607C2.72064 21.842 3.10218 22 3.5 22H20.5C20.8978 22 21.2794 21.842 21.5607 21.5607C21.842 21.2794 22 20.8978 22 20.5V13.5C22 13.3674 21.9473 13.2402 21.8536 13.1464C21.7598 13.0527 21.6326 13 21.5 13Z" fill="currentColor"></path></svg><span class="hidden md:block">Fork</span></a></div></div><div class=" sp-layout"><div class=" sp-editor sp-stack"><div class=" sp-code-editor"><div aria-autocomplete="list" aria-label="Code Editor for App.js" aria-multiline="true" class="sp-pristine sp-javascript   sp-cm" role="textbox" tabindex="0" translate="no"><pre class=" sp-pre-placeholder" style="margin-left:var(--sp-space-11)"><span class="sp-syntax-keyword">import</span> <span class="sp-syntax-punctuation">{</span> <span class="sp-syntax-plain">useState</span><span class="sp-syntax-punctuation">,</span> <span class="sp-syntax-plain">useEffect</span> <span class="sp-syntax-punctuation">}</span> <span class="sp-syntax-keyword">from</span> <span class="sp-syntax-string">&#x27;react&#x27;</span><span class="sp-syntax-punctuation">;</span>
<span class="sp-syntax-keyword">import</span> <span class="sp-syntax-punctuation">{</span> <span class="sp-syntax-plain">createConnection</span> <span class="sp-syntax-punctuation">}</span> <span class="sp-syntax-keyword">from</span> <span class="sp-syntax-string">&#x27;./chat.js&#x27;</span><span class="sp-syntax-punctuation">;</span>

<span class="sp-syntax-keyword">const</span> <span class="sp-syntax-plain">serverUrl</span> = <span class="sp-syntax-string">&#x27;https://localhost:1234&#x27;</span><span class="sp-syntax-punctuation">;</span>

<span class="sp-syntax-keyword">function</span> <span class="sp-syntax-definition">ChatRoom</span><span class="sp-syntax-punctuation">(</span><span class="sp-syntax-punctuation">{</span> <span class="sp-syntax-property">roomId</span> <span class="sp-syntax-punctuation">}</span><span class="sp-syntax-punctuation">)</span> <span class="sp-syntax-punctuation">{</span>
  <span class="sp-syntax-keyword">const</span> <span class="sp-syntax-punctuation">[</span><span class="sp-syntax-plain">message</span><span class="sp-syntax-punctuation">,</span> <span class="sp-syntax-plain">setMessage</span><span class="sp-syntax-punctuation">]</span> = <span class="sp-syntax-definition">useState</span><span class="sp-syntax-punctuation">(</span><span class="sp-syntax-string">&#x27;&#x27;</span><span class="sp-syntax-punctuation">)</span><span class="sp-syntax-punctuation">;</span>

  <span class="sp-syntax-definition">useEffect</span><span class="sp-syntax-punctuation">(</span><span class="sp-syntax-punctuation">(</span><span class="sp-syntax-punctuation">)</span> <span class="sp-syntax-punctuation">=&gt;</span> <span class="sp-syntax-punctuation">{</span>
    <span class="sp-syntax-keyword">const</span> <span class="sp-syntax-plain">options</span> = <span class="sp-syntax-punctuation">{</span>
      <span class="sp-syntax-property">serverUrl</span><span class="sp-syntax-punctuation">:</span> <span class="sp-syntax-plain">serverUrl</span><span class="sp-syntax-punctuation">,</span>
      <span class="sp-syntax-property">roomId</span><span class="sp-syntax-punctuation">:</span> <span class="sp-syntax-plain">roomId</span>
    <span class="sp-syntax-punctuation">}</span><span class="sp-syntax-punctuation">;</span>
    <span class="sp-syntax-keyword">const</span> <span class="sp-syntax-plain">connection</span> = <span class="sp-syntax-definition">createConnection</span><span class="sp-syntax-punctuation">(</span><span class="sp-syntax-plain">options</span><span class="sp-syntax-punctuation">)</span><span class="sp-syntax-punctuation">;</span>
    <span class="sp-syntax-plain">connection</span>.<span class="sp-syntax-property">connect</span><span class="sp-syntax-punctuation">(</span><span class="sp-syntax-punctuation">)</span><span class="sp-syntax-punctuation">;</span>
    <span class="sp-syntax-keyword">return</span> <span class="sp-syntax-punctuation">(</span><span class="sp-syntax-punctuation">)</span> <span class="sp-syntax-punctuation">=&gt;</span> <span class="sp-syntax-plain">connection</span>.<span class="sp-syntax-property">disconnect</span><span class="sp-syntax-punctuation">(</span><span class="sp-syntax-punctuation">)</span><span class="sp-syntax-punctuation">;</span>
  <span class="sp-syntax-punctuation">}</span><span class="sp-syntax-punctuation">,</span> <span class="sp-syntax-punctuation">[</span><span class="sp-syntax-plain">roomId</span><span class="sp-syntax-punctuation">]</span><span class="sp-syntax-punctuation">)</span><span class="sp-syntax-punctuation">;</span>

  <span class="sp-syntax-keyword">return</span> <span class="sp-syntax-punctuation">(</span>
    <span class="sp-syntax-punctuation">&lt;</span><span class="sp-syntax-punctuation">&gt;</span>
      <span class="sp-syntax-punctuation">&lt;</span><span class="sp-syntax-tag">h1</span><span class="sp-syntax-punctuation">&gt;</span>欢迎来到 <span class="sp-syntax-punctuation">{</span><span class="sp-syntax-plain">roomId</span><span class="sp-syntax-punctuation">}</span> 房间!<span class="sp-syntax-punctuation">&lt;/</span><span class="sp-syntax-tag">h1</span><span class="sp-syntax-punctuation">&gt;</span>
      <span class="sp-syntax-punctuation">&lt;</span><span class="sp-syntax-tag">input</span> <span class="sp-syntax-property">value</span>=<span class="sp-syntax-punctuation">{</span><span class="sp-syntax-plain">message</span><span class="sp-syntax-punctuation">}</span> <span class="sp-syntax-property">onChange</span>=<span class="sp-syntax-punctuation">{</span><span class="sp-syntax-plain">e</span> <span class="sp-syntax-punctuation">=&gt;</span> <span class="sp-syntax-definition">setMessage</span><span class="sp-syntax-punctuation">(</span><span class="sp-syntax-plain">e</span>.<span class="sp-syntax-property">target</span>.<span class="sp-syntax-property">value</span><span class="sp-syntax-punctuation">)</span><span class="sp-syntax-punctuation">}</span> <span class="sp-syntax-punctuation">/&gt;</span>
    <span class="sp-syntax-punctuation">&lt;/</span><span class="sp-syntax-punctuation">&gt;</span>
  <span class="sp-syntax-punctuation">)</span><span class="sp-syntax-punctuation">;</span>
<span class="sp-syntax-punctuation">}</span>

<span class="sp-syntax-keyword">export</span> <span class="sp-syntax-keyword">default</span> <span class="sp-syntax-keyword">function</span> <span class="sp-syntax-definition">App</span><span class="sp-syntax-punctuation">(</span><span class="sp-syntax-punctuation">)</span> <span class="sp-syntax-punctuation">{</span>
  <span class="sp-syntax-keyword">const</span> <span class="sp-syntax-punctuation">[</span><span class="sp-syntax-plain">roomId</span><span class="sp-syntax-punctuation">,</span> <span class="sp-syntax-plain">setRoomId</span><span class="sp-syntax-punctuation">]</span> = <span class="sp-syntax-definition">useState</span><span class="sp-syntax-punctuation">(</span><span class="sp-syntax-string">&#x27;所有&#x27;</span><span class="sp-syntax-punctuation">)</span><span class="sp-syntax-punctuation">;</span>
  <span class="sp-syntax-keyword">return</span> <span class="sp-syntax-punctuation">(</span>
    <span class="sp-syntax-punctuation">&lt;</span><span class="sp-syntax-punctuation">&gt;</span>
      <span class="sp-syntax-punctuation">&lt;</span><span class="sp-syntax-tag">label</span><span class="sp-syntax-punctuation">&gt;</span>
        选择聊天室:<span class="sp-syntax-punctuation">{</span><span class="sp-syntax-string">&#x27; &#x27;</span><span class="sp-syntax-punctuation">}</span>
        <span class="sp-syntax-punctuation">&lt;</span><span class="sp-syntax-tag">select</span>
          <span class="sp-syntax-property">value</span>=<span class="sp-syntax-punctuation">{</span><span class="sp-syntax-plain">roomId</span><span class="sp-syntax-punctuation">}</span>
          <span class="sp-syntax-property">onChange</span>=<span class="sp-syntax-punctuation">{</span><span class="sp-syntax-plain">e</span> <span class="sp-syntax-punctuation">=&gt;</span> <span class="sp-syntax-definition">setRoomId</span><span class="sp-syntax-punctuation">(</span><span class="sp-syntax-plain">e</span>.<span class="sp-syntax-property">target</span>.<span class="sp-syntax-property">value</span><span class="sp-syntax-punctuation">)</span><span class="sp-syntax-punctuation">}</span>
        <span class="sp-syntax-punctuation">&gt;</span>
          <span class="sp-syntax-punctuation">&lt;</span><span class="sp-syntax-tag">option</span> <span class="sp-syntax-property">value</span>=<span class="sp-syntax-string">&quot;所有&quot;</span><span class="sp-syntax-punctuation">&gt;</span>所有<span class="sp-syntax-punctuation">&lt;/</span><span class="sp-syntax-tag">option</span><span class="sp-syntax-punctuation">&gt;</span>
          <span class="sp-syntax-punctuation">&lt;</span><span class="sp-syntax-tag">option</span> <span class="sp-syntax-property">value</span>=<span class="sp-syntax-string">&quot;旅游&quot;</span><span class="sp-syntax-punctuation">&gt;</span>旅游<span class="sp-syntax-punctuation">&lt;/</span><span class="sp-syntax-tag">option</span><span class="sp-syntax-punctuation">&gt;</span>
          <span class="sp-syntax-punctuation">&lt;</span><span class="sp-syntax-tag">option</span> <span class="sp-syntax-property">value</span>=<span class="sp-syntax-string">&quot;音乐&quot;</span><span class="sp-syntax-punctuation">&gt;</span>音乐<span class="sp-syntax-punctuation">&lt;/</span><span class="sp-syntax-tag">option</span><span class="sp-syntax-punctuation">&gt;</span>
        <span class="sp-syntax-punctuation">&lt;/</span><span class="sp-syntax-tag">select</span><span class="sp-syntax-punctuation">&gt;</span>
      <span class="sp-syntax-punctuation">&lt;/</span><span class="sp-syntax-tag">label</span><span class="sp-syntax-punctuation">&gt;</span>
      <span class="sp-syntax-punctuation">&lt;</span><span class="sp-syntax-tag">hr</span> <span class="sp-syntax-punctuation">/&gt;</span>
      <span class="sp-syntax-punctuation">&lt;</span><span class="sp-syntax-definition">ChatRoom</span> <span class="sp-syntax-property">roomId</span>=<span class="sp-syntax-punctuation">{</span><span class="sp-syntax-plain">roomId</span><span class="sp-syntax-punctuation">}</span> <span class="sp-syntax-punctuation">/&gt;</span>
    <span class="sp-syntax-punctuation">&lt;/</span><span class="sp-syntax-punctuation">&gt;</span>
  <span class="sp-syntax-punctuation">)</span><span class="sp-syntax-punctuation">;</span>
<span class="sp-syntax-punctuation">}</span>

</pre></div></div></div><div class=" order-last xl:order-2 sp-stack"><div class="p-0 sm:p-2 md:p-4 lg:p-8 bg-card dark:bg-wash-dark h-full relative md:rounded-b-lg lg:rounded-b-none"><div style="position:relative"><iframe class="rounded-t-none bg-white md:shadow-md sm:rounded-lg w-full max-w-full transition-opacity absolute opacity-0 pointer-events-none duration-75" title="Sandbox Preview" style="height:15px;z-index:-1"></iframe></div></div></div><button translate="yes" class="sandpack-expand flex text-base justify-between dark:border-card-dark bg-wash dark:bg-card-dark items-center z-10 p-1 w-full order-2 xl:order-last border-b-1 relative top-0"><span class="flex p-2 focus:outline-none text-primary dark:text-primary-dark leading-[20px]"><svg class="rotate-0 inline me-1.5 text-xl" xmlns="http://www.w3.org/2000/svg" width="20" height="20" viewBox="0 0 20 20"><g fill="none" fill-rule="evenodd" transform="translate(-446 -398)"><path fill="currentColor" fill-rule="nonzero" d="M95.8838835,240.366117 C95.3957281,239.877961 94.6042719,239.877961 94.1161165,240.366117 C93.6279612,240.854272 93.6279612,241.645728 94.1161165,242.133883 L98.6161165,246.633883 C99.1042719,247.122039 99.8957281,247.122039 100.383883,246.633883 L104.883883,242.133883 C105.372039,241.645728 105.372039,240.854272 104.883883,240.366117 C104.395728,239.877961 103.604272,239.877961 103.116117,240.366117 L99.5,243.982233 L95.8838835,240.366117 Z" transform="translate(356.5 164.5)"></path><polygon points="446 418 466 418 466 398 446 398"></polygon></g></svg>显示更多</span></button></div></div></div></div><!--/$--><div class="max-w-4xl ms-0 2xl:mx-auto">
<p class="whitespace-pre-wrap my-4">然而，当你更改 <code dir="ltr" class="inline text-code text-secondary dark:text-secondary-dark px-1 rounded-md no-underline bg-gray-30 bg-opacity-10 py-px">roomId</code> 下拉列表时，它 <strong class="font-bold">确实</strong> 重新连接，正如你所期望的那样。</p>
<p class="whitespace-pre-wrap my-4">这也适用于函数的场景：</p>
<!--$--><div dir="ltr" class="sandpack sandpack--codeblock rounded-2xl h-full w-full overflow-x-auto flex items-center bg-wash dark:bg-gray-95 shadow-lg my-8" style="contain:content"><div class="sp-wrapper"><div class="sp-stack"><div class="sp-code-editor"><pre class="sp-cm sp-pristine sp-javascript flex align-start"><code class="sp-pre-placeholder grow-[2]"><div class="cm-line "><span class="sp-syntax-keyword">const</span> <span class="sp-syntax-plain">serverUrl</span> = <span class="sp-syntax-string">&#x27;https://localhost:1234&#x27;</span><span class="sp-syntax-punctuation">;</span><br/></div><div class="cm-line "><br/></div><div class="cm-line "><span class="sp-syntax-keyword">function</span> <span class="sp-syntax-definition">ChatRoom</span><span class="sp-syntax-punctuation">(</span><span class="sp-syntax-punctuation">{</span> <span class="sp-syntax-property">roomId</span> <span class="sp-syntax-punctuation">}</span><span class="sp-syntax-punctuation">)</span> <span class="sp-syntax-punctuation">{</span><br/></div><div class="cm-line ">  <span class="sp-syntax-keyword">const</span> <span class="sp-syntax-punctuation">[</span><span class="sp-syntax-plain">message</span><span class="sp-syntax-punctuation">,</span> <span class="sp-syntax-plain">setMessage</span><span class="sp-syntax-punctuation">]</span> = <span class="sp-syntax-definition">useState</span><span class="sp-syntax-punctuation">(</span><span class="sp-syntax-string">&#x27;&#x27;</span><span class="sp-syntax-punctuation">)</span><span class="sp-syntax-punctuation">;</span><br/></div><div class="cm-line "><br/></div><div class="cm-line ">  <span class="sp-syntax-definition">useEffect</span><span class="sp-syntax-punctuation">(</span><span class="sp-syntax-punctuation">(</span><span class="sp-syntax-punctuation">)</span> <span class="sp-syntax-punctuation">=&gt;</span> <span class="sp-syntax-punctuation">{</span><br/></div><div class="cm-line bg-github-highlight dark:bg-opacity-10">    <span class="sp-syntax-keyword">function</span> <span class="sp-syntax-definition">createOptions</span><span class="sp-syntax-punctuation">(</span><span class="sp-syntax-punctuation">)</span> <span class="sp-syntax-punctuation">{</span><br/></div><div class="cm-line bg-github-highlight dark:bg-opacity-10">      <span class="sp-syntax-keyword">return</span> <span class="sp-syntax-punctuation">{</span><br/></div><div class="cm-line bg-github-highlight dark:bg-opacity-10">        <span class="sp-syntax-property">serverUrl</span><span class="sp-syntax-punctuation">:</span> <span class="sp-syntax-plain">serverUrl</span><span class="sp-syntax-punctuation">,</span><br/></div><div class="cm-line bg-github-highlight dark:bg-opacity-10">        <span class="sp-syntax-property">roomId</span><span class="sp-syntax-punctuation">:</span> <span class="sp-syntax-plain">roomId</span><br/></div><div class="cm-line bg-github-highlight dark:bg-opacity-10">      <span class="sp-syntax-punctuation">}</span><span class="sp-syntax-punctuation">;</span><br/></div><div class="cm-line bg-github-highlight dark:bg-opacity-10">    <span class="sp-syntax-punctuation">}</span><br/></div><div class="cm-line "><br/></div><div class="cm-line bg-github-highlight dark:bg-opacity-10">    <span class="sp-syntax-keyword">const</span> <span class="sp-syntax-plain">options</span> = <span class="sp-syntax-definition">createOptions</span><span class="sp-syntax-punctuation">(</span><span class="sp-syntax-punctuation">)</span><span class="sp-syntax-punctuation">;</span><br/></div><div class="cm-line ">    <span class="sp-syntax-keyword">const</span> <span class="sp-syntax-plain">connection</span> = <span class="sp-syntax-definition">createConnection</span><span class="sp-syntax-punctuation">(</span><span class="sp-syntax-plain">options</span><span class="sp-syntax-punctuation">)</span><span class="sp-syntax-punctuation">;</span><br/></div><div class="cm-line ">    <span class="sp-syntax-plain">connection</span>.<span class="sp-syntax-property">connect</span><span class="sp-syntax-punctuation">(</span><span class="sp-syntax-punctuation">)</span><span class="sp-syntax-punctuation">;</span><br/></div><div class="cm-line ">    <span class="sp-syntax-keyword">return</span> <span class="sp-syntax-punctuation">(</span><span class="sp-syntax-punctuation">)</span> <span class="sp-syntax-punctuation">=&gt;</span> <span class="sp-syntax-plain">connection</span>.<span class="sp-syntax-property">disconnect</span><span class="sp-syntax-punctuation">(</span><span class="sp-syntax-punctuation">)</span><span class="sp-syntax-punctuation">;</span><br/></div><div class="cm-line ">  <span class="sp-syntax-punctuation">}</span><span class="sp-syntax-punctuation">,</span> <span class="sp-syntax-punctuation">[</span><span class="sp-syntax-plain">roomId</span><span class="sp-syntax-punctuation">]</span><span class="sp-syntax-punctuation">)</span><span class="sp-syntax-punctuation">;</span> <span class="sp-syntax-comment">// ✅ 所有依赖已声明</span><br/></div><div class="cm-line ">  <span class="sp-syntax-comment">// ...</span></div></code></pre></div></div></div></div><!--/$-->
<p class="whitespace-pre-wrap my-4">你可以编写自己的函数来组织 Effect 中的逻辑。只要将这些函数声明在 Effect <strong class="font-bold">内部</strong>，它们就不是响应式值，因此它们也不是 Effect 的依赖。</p>
<h4 id="read-primitive-values-from-objects" class="mdx-heading text-xl font-display font-bold leading-9 my-4">从对象中读取原始值 <a href="#read-primitive-values-from-objects" aria-label="Link for 从对象中读取原始值 " title="Link for 从对象中读取原始值 " class="mdx-header-anchor inline-block"><svg width="1em" height="1em" viewBox="0 0 13 13" xmlns="http://www.w3.org/2000/svg" class="text-gray-70 ms-2 h-5 w-5"><g fill="currentColor" fill-rule="evenodd"><path d="M7.778 7.975a2.5 2.5 0 0 0 .347-3.837L6.017 2.03a2.498 2.498 0 0 0-3.542-.007 2.5 2.5 0 0 0 .006 3.543l1.153 1.15c.07-.29.154-.563.25-.773.036-.077.084-.16.14-.25L3.18 4.85a1.496 1.496 0 0 1 .002-2.12 1.496 1.496 0 0 1 2.12 0l2.124 2.123a1.496 1.496 0 0 1-.333 2.37c.16.246.42.504.685.752z"></path><path d="M5.657 4.557a2.5 2.5 0 0 0-.347 3.837l2.108 2.108a2.498 2.498 0 0 0 3.542.007 2.5 2.5 0 0 0-.006-3.543L9.802 5.815c-.07.29-.154.565-.25.774-.036.076-.084.16-.14.25l.842.84c.585.587.59 1.532 0 2.122-.587.585-1.532.59-2.12 0L6.008 7.68a1.496 1.496 0 0 1 .332-2.372c-.16-.245-.42-.503-.685-.75z"></path></g></svg></a></h4>
<p class="whitespace-pre-wrap my-4">有时，你可能会通过 props 接收到类型为对象的值：</p>
<!--$--><div dir="ltr" class="sandpack sandpack--codeblock rounded-2xl h-full w-full overflow-x-auto flex items-center bg-wash dark:bg-gray-95 shadow-lg my-8" style="contain:content"><div class="sp-wrapper"><div class="sp-stack"><div class="sp-code-editor"><pre class="sp-cm sp-pristine sp-javascript flex align-start"><code class="sp-pre-placeholder grow-[2]"><div class="cm-line bg-github-highlight dark:bg-opacity-10"><span class="sp-syntax-keyword">function</span> <span class="sp-syntax-definition">ChatRoom</span><span class="sp-syntax-punctuation">(</span><span class="sp-syntax-punctuation">{</span> <span class="sp-syntax-property">options</span> <span class="sp-syntax-punctuation">}</span><span class="sp-syntax-punctuation">)</span> <span class="sp-syntax-punctuation">{</span><br/></div><div class="cm-line ">  <span class="sp-syntax-keyword">const</span> <span class="sp-syntax-punctuation">[</span><span class="sp-syntax-plain">message</span><span class="sp-syntax-punctuation">,</span> <span class="sp-syntax-plain">setMessage</span><span class="sp-syntax-punctuation">]</span> = <span class="sp-syntax-definition">useState</span><span class="sp-syntax-punctuation">(</span><span class="sp-syntax-string">&#x27;&#x27;</span><span class="sp-syntax-punctuation">)</span><span class="sp-syntax-punctuation">;</span><br/></div><div class="cm-line "><br/></div><div class="cm-line ">  <span class="sp-syntax-definition">useEffect</span><span class="sp-syntax-punctuation">(</span><span class="sp-syntax-punctuation">(</span><span class="sp-syntax-punctuation">)</span> <span class="sp-syntax-punctuation">=&gt;</span> <span class="sp-syntax-punctuation">{</span><br/></div><div class="cm-line bg-github-highlight dark:bg-opacity-10">    <span class="sp-syntax-keyword">const</span> <span class="sp-syntax-plain">connection</span> = <span class="sp-syntax-definition">createConnection</span><span class="sp-syntax-punctuation">(</span><span class="sp-syntax-plain">options</span><span class="sp-syntax-punctuation">)</span><span class="sp-syntax-punctuation">;</span><br/></div><div class="cm-line ">    <span class="sp-syntax-plain">connection</span>.<span class="sp-syntax-property">connect</span><span class="sp-syntax-punctuation">(</span><span class="sp-syntax-punctuation">)</span><span class="sp-syntax-punctuation">;</span><br/></div><div class="cm-line ">    <span class="sp-syntax-keyword">return</span> <span class="sp-syntax-punctuation">(</span><span class="sp-syntax-punctuation">)</span> <span class="sp-syntax-punctuation">=&gt;</span> <span class="sp-syntax-plain">connection</span>.<span class="sp-syntax-property">disconnect</span><span class="sp-syntax-punctuation">(</span><span class="sp-syntax-punctuation">)</span><span class="sp-syntax-punctuation">;</span><br/></div><div class="cm-line bg-github-highlight dark:bg-opacity-10">  <span class="sp-syntax-punctuation">}</span><span class="sp-syntax-punctuation">,</span> <span class="sp-syntax-punctuation">[</span><span class="sp-syntax-plain">options</span><span class="sp-syntax-punctuation">]</span><span class="sp-syntax-punctuation">)</span><span class="sp-syntax-punctuation">;</span> <span class="sp-syntax-comment">// ✅ 所有依赖已声明</span><br/></div><div class="cm-line ">  <span class="sp-syntax-comment">// ...</span></div></code></pre></div></div></div></div><!--/$-->
<p class="whitespace-pre-wrap my-4">这里的风险是父组件会在渲染过程中创建对象：</p>
<!--$--><div dir="ltr" class="sandpack sandpack--codeblock rounded-2xl h-full w-full overflow-x-auto flex items-center bg-wash dark:bg-gray-95 shadow-lg my-8" style="contain:content"><div class="sp-wrapper"><div class="sp-stack"><div class="sp-code-editor"><pre class="sp-cm sp-pristine sp-javascript flex align-start"><code class="sp-pre-placeholder grow-[2]"><div class="cm-line "><span class="sp-syntax-punctuation">&lt;</span><span class="sp-syntax-definition">ChatRoom</span><br/></div><div class="cm-line ">  <span class="sp-syntax-property">roomId</span>=<span class="sp-syntax-punctuation">{</span><span class="sp-syntax-plain">roomId</span><span class="sp-syntax-punctuation">}</span><br/></div><div class="cm-line bg-github-highlight dark:bg-opacity-10">  <span class="sp-syntax-property">options</span>=<span class="sp-syntax-punctuation">{</span><span class="sp-syntax-punctuation">{</span><br/></div><div class="cm-line bg-github-highlight dark:bg-opacity-10">    <span class="sp-syntax-property">serverUrl</span><span class="sp-syntax-punctuation">:</span> <span class="sp-syntax-plain">serverUrl</span><span class="sp-syntax-punctuation">,</span><br/></div><div class="cm-line bg-github-highlight dark:bg-opacity-10">    <span class="sp-syntax-property">roomId</span><span class="sp-syntax-punctuation">:</span> <span class="sp-syntax-plain">roomId</span><br/></div><div class="cm-line bg-github-highlight dark:bg-opacity-10">  <span class="sp-syntax-punctuation">}</span><span class="sp-syntax-punctuation">}</span><br/></div><div class="cm-line "><span class="sp-syntax-punctuation">/&gt;</span></div></code></pre></div></div></div></div><!--/$-->
<p class="whitespace-pre-wrap my-4">这将导致 Effect 在每次父组件重新渲染时重新连接。要解决此问题，请从 Effect <strong class="font-bold">外部</strong> 读取对象信息，并避免依赖对象和函数类型：</p>
<!--$--><div dir="ltr" class="sandpack sandpack--codeblock rounded-2xl h-full w-full overflow-x-auto flex items-center bg-wash dark:bg-gray-95 shadow-lg my-8" style="contain:content"><div class="sp-wrapper"><div class="sp-stack"><div class="sp-code-editor"><pre class="sp-cm sp-pristine sp-javascript flex align-start"><code class="sp-pre-placeholder grow-[2]"><div class="cm-line "><span class="sp-syntax-keyword">function</span> <span class="sp-syntax-definition">ChatRoom</span><span class="sp-syntax-punctuation">(</span><span class="sp-syntax-punctuation">{</span> <span class="sp-syntax-property">options</span> <span class="sp-syntax-punctuation">}</span><span class="sp-syntax-punctuation">)</span> <span class="sp-syntax-punctuation">{</span><br/></div><div class="cm-line ">  <span class="sp-syntax-keyword">const</span> <span class="sp-syntax-punctuation">[</span><span class="sp-syntax-plain">message</span><span class="sp-syntax-punctuation">,</span> <span class="sp-syntax-plain">setMessage</span><span class="sp-syntax-punctuation">]</span> = <span class="sp-syntax-definition">useState</span><span class="sp-syntax-punctuation">(</span><span class="sp-syntax-string">&#x27;&#x27;</span><span class="sp-syntax-punctuation">)</span><span class="sp-syntax-punctuation">;</span><br/></div><div class="cm-line "><br/></div><div class="cm-line bg-github-highlight dark:bg-opacity-10">  <span class="sp-syntax-keyword">const</span> <span class="sp-syntax-punctuation">{</span> <span class="sp-syntax-property">roomId</span><span class="sp-syntax-punctuation">,</span> <span class="sp-syntax-property">serverUrl</span> <span class="sp-syntax-punctuation">}</span> = <span class="sp-syntax-plain">options</span><span class="sp-syntax-punctuation">;</span><br/></div><div class="cm-line ">  <span class="sp-syntax-definition">useEffect</span><span class="sp-syntax-punctuation">(</span><span class="sp-syntax-punctuation">(</span><span class="sp-syntax-punctuation">)</span> <span class="sp-syntax-punctuation">=&gt;</span> <span class="sp-syntax-punctuation">{</span><br/></div><div class="cm-line ">    <span class="sp-syntax-keyword">const</span> <span class="sp-syntax-plain">connection</span> = <span class="sp-syntax-definition">createConnection</span><span class="sp-syntax-punctuation">(</span><span class="sp-syntax-punctuation">{</span><br/></div><div class="cm-line bg-github-highlight dark:bg-opacity-10">      <span class="sp-syntax-property">roomId</span><span class="sp-syntax-punctuation">:</span> <span class="sp-syntax-plain">roomId</span><span class="sp-syntax-punctuation">,</span><br/></div><div class="cm-line bg-github-highlight dark:bg-opacity-10">      <span class="sp-syntax-property">serverUrl</span><span class="sp-syntax-punctuation">:</span> <span class="sp-syntax-plain">serverUrl</span><br/></div><div class="cm-line ">    <span class="sp-syntax-punctuation">}</span><span class="sp-syntax-punctuation">)</span><span class="sp-syntax-punctuation">;</span><br/></div><div class="cm-line ">    <span class="sp-syntax-plain">connection</span>.<span class="sp-syntax-property">connect</span><span class="sp-syntax-punctuation">(</span><span class="sp-syntax-punctuation">)</span><span class="sp-syntax-punctuation">;</span><br/></div><div class="cm-line ">    <span class="sp-syntax-keyword">return</span> <span class="sp-syntax-punctuation">(</span><span class="sp-syntax-punctuation">)</span> <span class="sp-syntax-punctuation">=&gt;</span> <span class="sp-syntax-plain">connection</span>.<span class="sp-syntax-property">disconnect</span><span class="sp-syntax-punctuation">(</span><span class="sp-syntax-punctuation">)</span><span class="sp-syntax-punctuation">;</span><br/></div><div class="cm-line bg-github-highlight dark:bg-opacity-10">  <span class="sp-syntax-punctuation">}</span><span class="sp-syntax-punctuation">,</span> <span class="sp-syntax-punctuation">[</span><span class="sp-syntax-plain">roomId</span><span class="sp-syntax-punctuation">,</span> <span class="sp-syntax-plain">serverUrl</span><span class="sp-syntax-punctuation">]</span><span class="sp-syntax-punctuation">)</span><span class="sp-syntax-punctuation">;</span> <span class="sp-syntax-comment">// ✅ 所有依赖已声明</span><br/></div><div class="cm-line ">  <span class="sp-syntax-comment">// ...</span></div></code></pre></div></div></div></div><!--/$-->
<p class="whitespace-pre-wrap my-4">逻辑有点重复（你从 Effect 外部的对象读取一些值，然后在 Effect 内部创建具有相同值的对象）。但这使得 Effect <strong class="font-bold">实际</strong> 依赖的信息非常明确。如果对象被父组件无意中重新创建，聊天也不会重新连接。但是，如果 <code dir="ltr" class="inline text-code text-secondary dark:text-secondary-dark px-1 rounded-md no-underline bg-gray-30 bg-opacity-10 py-px">options.roomId</code> 或 <code dir="ltr" class="inline text-code text-secondary dark:text-secondary-dark px-1 rounded-md no-underline bg-gray-30 bg-opacity-10 py-px">options.serverUrl</code> 确实不同，聊天将重新连接。</p>
<h4 id="calculate-primitive-values-from-functions" class="mdx-heading text-xl font-display font-bold leading-9 my-4">从函数中计算原始值 <a href="#calculate-primitive-values-from-functions" aria-label="Link for 从函数中计算原始值 " title="Link for 从函数中计算原始值 " class="mdx-header-anchor inline-block"><svg width="1em" height="1em" viewBox="0 0 13 13" xmlns="http://www.w3.org/2000/svg" class="text-gray-70 ms-2 h-5 w-5"><g fill="currentColor" fill-rule="evenodd"><path d="M7.778 7.975a2.5 2.5 0 0 0 .347-3.837L6.017 2.03a2.498 2.498 0 0 0-3.542-.007 2.5 2.5 0 0 0 .006 3.543l1.153 1.15c.07-.29.154-.563.25-.773.036-.077.084-.16.14-.25L3.18 4.85a1.496 1.496 0 0 1 .002-2.12 1.496 1.496 0 0 1 2.12 0l2.124 2.123a1.496 1.496 0 0 1-.333 2.37c.16.246.42.504.685.752z"></path><path d="M5.657 4.557a2.5 2.5 0 0 0-.347 3.837l2.108 2.108a2.498 2.498 0 0 0 3.542.007 2.5 2.5 0 0 0-.006-3.543L9.802 5.815c-.07.29-.154.565-.25.774-.036.076-.084.16-.14.25l.842.84c.585.587.59 1.532 0 2.122-.587.585-1.532.59-2.12 0L6.008 7.68a1.496 1.496 0 0 1 .332-2.372c-.16-.245-.42-.503-.685-.75z"></path></g></svg></a></h4>
<p class="whitespace-pre-wrap my-4">同样的方法也适用于函数。例如，假设父组件传递了一个函数：</p>
<!--$--><div dir="ltr" class="sandpack sandpack--codeblock rounded-2xl h-full w-full overflow-x-auto flex items-center bg-wash dark:bg-gray-95 shadow-lg my-8" style="contain:content"><div class="sp-wrapper"><div class="sp-stack"><div class="sp-code-editor"><pre class="sp-cm sp-pristine sp-javascript flex align-start"><code class="sp-pre-placeholder grow-[2]"><div class="cm-line "><span class="sp-syntax-punctuation">&lt;</span><span class="sp-syntax-definition">ChatRoom</span><br/></div><div class="cm-line ">  <span class="sp-syntax-property">roomId</span>=<span class="sp-syntax-punctuation">{</span><span class="sp-syntax-plain">roomId</span><span class="sp-syntax-punctuation">}</span><br/></div><div class="cm-line bg-github-highlight dark:bg-opacity-10">  <span class="sp-syntax-property">getOptions</span>=<span class="sp-syntax-punctuation">{</span><span class="sp-syntax-punctuation">(</span><span class="sp-syntax-punctuation">)</span> <span class="sp-syntax-punctuation">=&gt;</span> <span class="sp-syntax-punctuation">{</span><br/></div><div class="cm-line bg-github-highlight dark:bg-opacity-10">    <span class="sp-syntax-keyword">return</span> <span class="sp-syntax-punctuation">{</span><br/></div><div class="cm-line bg-github-highlight dark:bg-opacity-10">      <span class="sp-syntax-property">serverUrl</span><span class="sp-syntax-punctuation">:</span> <span class="sp-syntax-plain">serverUrl</span><span class="sp-syntax-punctuation">,</span><br/></div><div class="cm-line bg-github-highlight dark:bg-opacity-10">      <span class="sp-syntax-property">roomId</span><span class="sp-syntax-punctuation">:</span> <span class="sp-syntax-plain">roomId</span><br/></div><div class="cm-line bg-github-highlight dark:bg-opacity-10">    <span class="sp-syntax-punctuation">}</span><span class="sp-syntax-punctuation">;</span><br/></div><div class="cm-line bg-github-highlight dark:bg-opacity-10">  <span class="sp-syntax-punctuation">}</span><span class="sp-syntax-punctuation">}</span><br/></div><div class="cm-line "><span class="sp-syntax-punctuation">/&gt;</span></div></code></pre></div></div></div></div><!--/$-->
<p class="whitespace-pre-wrap my-4">为避免使其成为依赖（并导致它在重新渲染时重新连接），请在 Effect 外部调用它。这为你提供了不是对象的 <code dir="ltr" class="inline text-code text-secondary dark:text-secondary-dark px-1 rounded-md no-underline bg-gray-30 bg-opacity-10 py-px">roomId</code> 和 <code dir="ltr" class="inline text-code text-secondary dark:text-secondary-dark px-1 rounded-md no-underline bg-gray-30 bg-opacity-10 py-px">serverUrl</code> 值，你可以从 Effect 中读取它们：</p>
<!--$--><div dir="ltr" class="sandpack sandpack--codeblock rounded-2xl h-full w-full overflow-x-auto flex items-center bg-wash dark:bg-gray-95 shadow-lg my-8" style="contain:content"><div class="sp-wrapper"><div class="sp-stack"><div class="sp-code-editor"><pre class="sp-cm sp-pristine sp-javascript flex align-start"><code class="sp-pre-placeholder grow-[2]"><div class="cm-line bg-github-highlight dark:bg-opacity-10"><span class="sp-syntax-keyword">function</span> <span class="sp-syntax-definition">ChatRoom</span><span class="sp-syntax-punctuation">(</span><span class="sp-syntax-punctuation">{</span> <span class="sp-syntax-property">getOptions</span> <span class="sp-syntax-punctuation">}</span><span class="sp-syntax-punctuation">)</span> <span class="sp-syntax-punctuation">{</span><br/></div><div class="cm-line ">  <span class="sp-syntax-keyword">const</span> <span class="sp-syntax-punctuation">[</span><span class="sp-syntax-plain">message</span><span class="sp-syntax-punctuation">,</span> <span class="sp-syntax-plain">setMessage</span><span class="sp-syntax-punctuation">]</span> = <span class="sp-syntax-definition">useState</span><span class="sp-syntax-punctuation">(</span><span class="sp-syntax-string">&#x27;&#x27;</span><span class="sp-syntax-punctuation">)</span><span class="sp-syntax-punctuation">;</span><br/></div><div class="cm-line "><br/></div><div class="cm-line bg-github-highlight dark:bg-opacity-10">  <span class="sp-syntax-keyword">const</span> <span class="sp-syntax-punctuation">{</span> <span class="sp-syntax-property">roomId</span><span class="sp-syntax-punctuation">,</span> <span class="sp-syntax-property">serverUrl</span> <span class="sp-syntax-punctuation">}</span> = <span class="sp-syntax-definition">getOptions</span><span class="sp-syntax-punctuation">(</span><span class="sp-syntax-punctuation">)</span><span class="sp-syntax-punctuation">;</span><br/></div><div class="cm-line ">  <span class="sp-syntax-definition">useEffect</span><span class="sp-syntax-punctuation">(</span><span class="sp-syntax-punctuation">(</span><span class="sp-syntax-punctuation">)</span> <span class="sp-syntax-punctuation">=&gt;</span> <span class="sp-syntax-punctuation">{</span><br/></div><div class="cm-line ">    <span class="sp-syntax-keyword">const</span> <span class="sp-syntax-plain">connection</span> = <span class="sp-syntax-definition">createConnection</span><span class="sp-syntax-punctuation">(</span><span class="sp-syntax-punctuation">{</span><br/></div><div class="cm-line ">      <span class="sp-syntax-property">roomId</span><span class="sp-syntax-punctuation">:</span> <span class="sp-syntax-plain">roomId</span><span class="sp-syntax-punctuation">,</span><br/></div><div class="cm-line ">      <span class="sp-syntax-property">serverUrl</span><span class="sp-syntax-punctuation">:</span> <span class="sp-syntax-plain">serverUrl</span><br/></div><div class="cm-line ">    <span class="sp-syntax-punctuation">}</span><span class="sp-syntax-punctuation">)</span><span class="sp-syntax-punctuation">;</span><br/></div><div class="cm-line ">    <span class="sp-syntax-plain">connection</span>.<span class="sp-syntax-property">connect</span><span class="sp-syntax-punctuation">(</span><span class="sp-syntax-punctuation">)</span><span class="sp-syntax-punctuation">;</span><br/></div><div class="cm-line ">    <span class="sp-syntax-keyword">return</span> <span class="sp-syntax-punctuation">(</span><span class="sp-syntax-punctuation">)</span> <span class="sp-syntax-punctuation">=&gt;</span> <span class="sp-syntax-plain">connection</span>.<span class="sp-syntax-property">disconnect</span><span class="sp-syntax-punctuation">(</span><span class="sp-syntax-punctuation">)</span><span class="sp-syntax-punctuation">;</span><br/></div><div class="cm-line ">  <span class="sp-syntax-punctuation">}</span><span class="sp-syntax-punctuation">,</span> <span class="sp-syntax-punctuation">[</span><span class="sp-syntax-plain">roomId</span><span class="sp-syntax-punctuation">,</span> <span class="sp-syntax-plain">serverUrl</span><span class="sp-syntax-punctuation">]</span><span class="sp-syntax-punctuation">)</span><span class="sp-syntax-punctuation">;</span> <span class="sp-syntax-comment">// ✅ 所有依赖已声明</span><br/></div><div class="cm-line ">  <span class="sp-syntax-comment">// ...</span></div></code></pre></div></div></div></div><!--/$-->
<p class="whitespace-pre-wrap my-4">这仅适用于 <a class="inline text-link dark:text-link-dark border-b border-link border-opacity-0 hover:border-opacity-100 duration-100 ease-in transition leading-normal" href="/learn/keeping-components-pure">纯</a> 函数，因为它们在渲染期间可以安全调用。如果函数是一个事件处理程序，但你不希望它的更改重新同步 Effect，<a class="inline text-link dark:text-link-dark border-b border-link border-opacity-0 hover:border-opacity-100 duration-100 ease-in transition leading-normal" href="#do-you-want-to-read-a-value-without-reacting-to-its-changes">将它包装到 Effect Event 中</a>。</p>
<section><h2 id="recap" class="mdx-heading text-3xl font-display leading-10 text-primary dark:text-primary-dark font-bold my-6">摘要<a href="#recap" aria-label="Link for 摘要" title="Link for 摘要" class="mdx-header-anchor inline-block"><svg width="1em" height="1em" viewBox="0 0 13 13" xmlns="http://www.w3.org/2000/svg" class="text-gray-70 ms-2 h-5 w-5"><g fill="currentColor" fill-rule="evenodd"><path d="M7.778 7.975a2.5 2.5 0 0 0 .347-3.837L6.017 2.03a2.498 2.498 0 0 0-3.542-.007 2.5 2.5 0 0 0 .006 3.543l1.153 1.15c.07-.29.154-.563.25-.773.036-.077.084-.16.14-.25L3.18 4.85a1.496 1.496 0 0 1 .002-2.12 1.496 1.496 0 0 1 2.12 0l2.124 2.123a1.496 1.496 0 0 1-.333 2.37c.16.246.42.504.685.752z"></path><path d="M5.657 4.557a2.5 2.5 0 0 0-.347 3.837l2.108 2.108a2.498 2.498 0 0 0 3.542.007 2.5 2.5 0 0 0-.006-3.543L9.802 5.815c-.07.29-.154.565-.25.774-.036.076-.084.16-.14.25l.842.84c.585.587.59 1.532 0 2.122-.587.585-1.532.59-2.12 0L6.008 7.68a1.496 1.496 0 0 1 .332-2.372c-.16-.245-.42-.503-.685-.75z"></path></g></svg></a></h2><ul class="ms-6 my-3 list-disc">
<li class="leading-relaxed mb-1">依赖应始终与代码匹配。</li>
<li class="leading-relaxed mb-1">当你对依赖不满意时，你需要编辑的是代码。</li>
<li class="leading-relaxed mb-1">抑制 linter 会导致非常混乱的错误，你应该始终避免它。</li>
<li class="leading-relaxed mb-1">要移除依赖，你需要向 linter “证明”它不是必需的。</li>
<li class="leading-relaxed mb-1">如果某些代码是为了响应特定交互，请将该代码移至事件处理的地方。</li>
<li class="leading-relaxed mb-1">如果 Effect 的不同部分因不同原因需要重新运行，请将其拆分为多个 Effect。</li>
<li class="leading-relaxed mb-1">如果你想根据以前的状态更新一些状态，传递一个更新函数。</li>
<li class="leading-relaxed mb-1">如果你想读取最新值而不“反应”它，请从 Effect 中提取出一个 Effect Event。</li>
<li class="leading-relaxed mb-1">在 JavaScript 中，如果对象和函数是在不同时间创建的，则它们被认为是不同的。</li>
<li class="leading-relaxed mb-1">尽量避免对象和函数依赖。将它们移到组件外或 Effect 内。</li>
</ul></section>
</div><div class="max-w-7xl mx-auto py-4 w-full"><div class="border-gray-10 bg-card dark:bg-card-dark shadow-inner rounded-none -mx-5 sm:mx-auto sm:rounded-2xl"><div class="py-2 px-5 sm:px-8 pb-0 md:pb-0"><h2 id="challenges" class="mdx-heading text-3xl font-display leading-10 text-primary dark:text-primary-dark font-bold my-6 mb-2 leading-10 relative text-3xl text-link">尝试一些挑战<a href="#challenges" aria-label="Link for 尝试一些挑战" title="Link for 尝试一些挑战" class="mdx-header-anchor inline-block"><svg width="1em" height="1em" viewBox="0 0 13 13" xmlns="http://www.w3.org/2000/svg" class="text-gray-70 ms-2 h-5 w-5"><g fill="currentColor" fill-rule="evenodd"><path d="M7.778 7.975a2.5 2.5 0 0 0 .347-3.837L6.017 2.03a2.498 2.498 0 0 0-3.542-.007 2.5 2.5 0 0 0 .006 3.543l1.153 1.15c.07-.29.154-.563.25-.773.036-.077.084-.16.14-.25L3.18 4.85a1.496 1.496 0 0 1 .002-2.12 1.496 1.496 0 0 1 2.12 0l2.124 2.123a1.496 1.496 0 0 1-.333 2.37c.16.246.42.504.685.752z"></path><path d="M5.657 4.557a2.5 2.5 0 0 0-.347 3.837l2.108 2.108a2.498 2.498 0 0 0 3.542.007 2.5 2.5 0 0 0-.006-3.543L9.802 5.815c-.07.29-.154.565-.25.774-.036.076-.084.16-.14.25l.842.84c.585.587.59 1.532 0 2.122-.587.585-1.532.59-2.12 0L6.008 7.68a1.496 1.496 0 0 1 .332-2.372c-.16-.245-.42-.503-.685-.75z"></path></g></svg></a></h2><div class="flex items-center justify-between"><div class="overflow-hidden"><div class="flex relative transition-transform content-box overflow-x-auto"><button class="py-2 me-4 text-base border-b-4 duration-100 ease-in transition whitespace-nowrap text-ellipsis text-link border-link hover:text-link dark:text-link-dark dark:border-link-dark dark:hover:text-link-dark">1<!-- -->. <!-- -->修复重置 interval </button><button class="py-2 me-4 text-base border-b-4 duration-100 ease-in transition whitespace-nowrap text-ellipsis">2<!-- -->. <!-- -->修复重新触发动画的问题 </button><button class="py-2 me-4 text-base border-b-4 duration-100 ease-in transition whitespace-nowrap text-ellipsis">3<!-- -->. <!-- -->修复聊天重新连接的问题 </button><button class="py-2 me-4 text-base border-b-4 duration-100 ease-in transition whitespace-nowrap text-ellipsis">4<!-- -->. <!-- -->再次修复聊天重新连接的问题 </button></div></div><div class="flex z-10 pb-2 ps-2"><button aria-label="Scroll left" class="bg-secondary-button dark:bg-secondary-button-dark h-8 px-2 rounded-l border-gray-20 border-r rtl:rotate-180 text-gray-30"><svg class="rotate-90 rtl:-rotate-90" xmlns="http://www.w3.org/2000/svg" width="20" height="20" viewBox="0 0 20 20"><g fill="none" fill-rule="evenodd" transform="translate(-446 -398)"><path fill="currentColor" fill-rule="nonzero" d="M95.8838835,240.366117 C95.3957281,239.877961 94.6042719,239.877961 94.1161165,240.366117 C93.6279612,240.854272 93.6279612,241.645728 94.1161165,242.133883 L98.6161165,246.633883 C99.1042719,247.122039 99.8957281,247.122039 100.383883,246.633883 L104.883883,242.133883 C105.372039,241.645728 105.372039,240.854272 104.883883,240.366117 C104.395728,239.877961 103.604272,239.877961 103.116117,240.366117 L99.5,243.982233 L95.8838835,240.366117 Z" transform="translate(356.5 164.5)"></path><polygon points="446 418 466 418 466 398 446 398"></polygon></g></svg></button><button aria-label="Scroll right" class="bg-secondary-button dark:bg-secondary-button-dark h-8 px-2 rounded-e rtl:rotate-180 text-primary dark:text-primary-dark"><svg class="-rotate-90 rtl:rotate-90" xmlns="http://www.w3.org/2000/svg" width="20" height="20" viewBox="0 0 20 20"><g fill="none" fill-rule="evenodd" transform="translate(-446 -398)"><path fill="currentColor" fill-rule="nonzero" d="M95.8838835,240.366117 C95.3957281,239.877961 94.6042719,239.877961 94.1161165,240.366117 C93.6279612,240.854272 93.6279612,241.645728 94.1161165,242.133883 L98.6161165,246.633883 C99.1042719,247.122039 99.8957281,247.122039 100.383883,246.633883 L104.883883,242.133883 C105.372039,241.645728 105.372039,240.854272 104.883883,240.366117 C104.395728,239.877961 103.604272,239.877961 103.116117,240.366117 L99.5,243.982233 L95.8838835,240.366117 Z" transform="translate(356.5 164.5)"></path><polygon points="446 418 466 418 466 398 446 398"></polygon></g></svg></button></div></div></div><div class="p-5 sm:py-8 sm:px-8"><div><h4 id="fix-a-resetting-interval" class="mdx-heading text-xl text-primary dark:text-primary-dark mb-2 mt-0 font-medium text-xl font-display font-bold leading-9 my-4"><div class="font-bold block md:inline">第 <!-- -->1<!-- --> 个<!-- -->挑战<!-- --> 共<!-- --> <!-- -->4<!-- --> 个挑战<span class="text-primary dark:text-primary-dark">: </span></div>修复重置 interval <a href="#fix-a-resetting-interval" aria-label="Link for this heading" title="Link for this heading" class="mdx-header-anchor inline-block"><svg width="1em" height="1em" viewBox="0 0 13 13" xmlns="http://www.w3.org/2000/svg" class="text-gray-70 ms-2 h-5 w-5"><g fill="currentColor" fill-rule="evenodd"><path d="M7.778 7.975a2.5 2.5 0 0 0 .347-3.837L6.017 2.03a2.498 2.498 0 0 0-3.542-.007 2.5 2.5 0 0 0 .006 3.543l1.153 1.15c.07-.29.154-.563.25-.773.036-.077.084-.16.14-.25L3.18 4.85a1.496 1.496 0 0 1 .002-2.12 1.496 1.496 0 0 1 2.12 0l2.124 2.123a1.496 1.496 0 0 1-.333 2.37c.16.246.42.504.685.752z"></path><path d="M5.657 4.557a2.5 2.5 0 0 0-.347 3.837l2.108 2.108a2.498 2.498 0 0 0 3.542.007 2.5 2.5 0 0 0-.006-3.543L9.802 5.815c-.07.29-.154.565-.25.774-.036.076-.084.16-.14.25l.842.84c.585.587.59 1.532 0 2.122-.587.585-1.532.59-2.12 0L6.008 7.68a1.496 1.496 0 0 1 .332-2.372c-.16-.245-.42-.503-.685-.75z"></path></g></svg></a></h4><p class="whitespace-pre-wrap my-4">这个 Effect 设置了一个每秒运行的 interval。你已经注意到一些奇怪的事情：似乎每次 interval 都会被销毁并重新创建。修复代码，使 interval 不会被不断重新创建。</p><!--$--><div class="sandpack sandpack--playground w-full my-8" dir="ltr"><div class="sp-wrapper"><div class="shadow-lg dark:shadow-lg-dark rounded-lg" style="contain:content"><div class="bg-wash dark:bg-card-dark flex justify-between items-center relative z-10 border-b border-border dark:border-border-dark rounded-t-lg text-lg"><div class="flex-1 grow min-w-0 px-4 lg:px-6"><div><div class="relative overflow-hidden"><div class="w-[fit-content] invisible"><div class=" sp-tabs" translate="no"><div aria-label="Select active file" class=" sp-tabs-scrollable-container" role="tablist"><button aria-selected="true" class="  sp-tab-button" data-active="true" role="tab" title="/src/App.js" type="button">App.js</button></div></div></div><button class="absolute top-0 start-[2px]" id="headlessui-listbox-button-:R4pd3ccq6:" aria-haspopup="true" aria-expanded="false" data-headlessui-state=""><span class="h-full py-2 px-1 mt-px -mb-px flex border-b text-link dark:text-link-dark border-link dark:border-link-dark items-center text-md leading-tight truncate" style="max-width:160px">App.js</span></button></div></div></div><div class="px-3 flex items-center justify-end text-start" translate="yes"><button class="text-sm text-primary dark:text-primary-dark inline-flex items-center hover:text-link duration-100 ease-in transition mx-1" title="Reset Sandbox" type="button"><svg width="1em" height="1em" viewBox="0 0 24 24" fill="none" xmlns="http://www.w3.org/2000/svg" class="inline mx-1 relative"><path d="M13.8982 5.20844C12.4626 4.88688 10.9686 4.93769 9.55821 5.35604L11.8524 3.06184C11.8989 3.0154 11.9357 2.96028 11.9608 2.89961C11.986 2.83894 11.9989 2.77391 11.9989 2.70824C11.9989 2.64256 11.986 2.57754 11.9608 2.51686C11.9357 2.45619 11.8989 2.40107 11.8524 2.35464L11.1456 1.64784C11.0992 1.60139 11.0441 1.56455 10.9834 1.53942C10.9227 1.51428 10.8577 1.50134 10.792 1.50134C10.7263 1.50134 10.6613 1.51428 10.6006 1.53942C10.54 1.56455 10.4848 1.60139 10.4384 1.64784L6.14571 5.94054C6.00654 6.07969 5.89615 6.2449 5.82083 6.42673C5.74551 6.60855 5.70675 6.80343 5.70675 7.00024C5.70675 7.19704 5.74551 7.39192 5.82083 7.57374C5.89615 7.75557 6.00654 7.92078 6.14571 8.05994L10.4387 12.3529C10.5325 12.4465 10.6595 12.4991 10.792 12.4991C10.9245 12.4991 11.0516 12.4465 11.1453 12.3529L11.8527 11.6455C11.9463 11.5518 11.9989 11.4247 11.9989 11.2922C11.9989 11.1598 11.9463 11.0327 11.8527 10.9389L8.77481 7.86104C9.99795 7.16236 11.415 6.8801 12.8125 7.05678C14.21 7.23347 15.5122 7.85953 16.523 8.84064C17.5338 9.82176 18.1983 11.1048 18.4165 12.4964C18.6347 13.888 18.3947 15.3129 17.7328 16.5562C17.0708 17.7996 16.0227 18.7942 14.7463 19.3902C13.47 19.9861 12.0345 20.1511 10.6563 19.8603C9.27798 19.5695 8.03152 18.8387 7.10469 17.778C6.17786 16.7172 5.62086 15.384 5.51761 13.9791C5.51156 13.8512 5.45689 13.7303 5.36477 13.6413C5.27265 13.5522 5.15001 13.5017 5.02191 13.5H4.02081C3.95297 13.4996 3.88574 13.5129 3.8232 13.5392C3.76065 13.5655 3.70408 13.6042 3.6569 13.6529C3.60972 13.7017 3.57291 13.7595 3.54869 13.8228C3.52448 13.8862 3.51336 13.9538 3.51601 14.0216C3.61349 15.5965 4.1473 17.1132 5.0577 18.4019C5.9681 19.6906 7.21917 20.7006 8.6709 21.3188C10.1226 21.937 11.7178 22.139 13.2778 21.9022C14.8378 21.6654 16.3011 20.9992 17.504 19.978C18.7069 18.9569 19.6019 17.6212 20.0889 16.1203C20.5759 14.6195 20.6356 13.0128 20.2614 11.4799C19.8872 9.94705 19.0938 8.54858 17.97 7.44098C16.8462 6.33339 15.4363 5.56037 13.8982 5.20844V5.20844Z" fill="currentColor"></path></svg> 重置</button><a href="https://codesandbox.io/api/v1/sandboxes/define?undefined&amp;environment=create-react-app" rel="noreferrer noopener" target="_blank" title="Open in CodeSandbox" class="text-sm text-primary dark:text-primary-dark inline-flex items-center hover:text-link duration-100 ease-in transition mx-1 ms-2 md:ms-1"><svg width="1em" height="1em" viewBox="0 0 24 24" fill="none" xmlns="http://www.w3.org/2000/svg" class="inline mx-1 relative top-[1px]"><path d="M20.5001 2H15.5001C15.3675 2 15.2403 2.05268 15.1465 2.14645C15.0528 2.24021 15.0001 2.36739 15.0001 2.5V3.5C15.0001 3.63261 15.0528 3.75979 15.1465 3.85355C15.2403 3.94732 15.3675 4 15.5001 4H18.5901L7.6501 14.94C7.60323 14.9865 7.56604 15.0418 7.54065 15.1027C7.51527 15.1636 7.5022 15.229 7.5022 15.295C7.5022 15.361 7.51527 15.4264 7.54065 15.4873C7.56604 15.5482 7.60323 15.6035 7.6501 15.65L8.3501 16.35C8.39658 16.3969 8.45188 16.4341 8.51281 16.4594C8.57374 16.4848 8.63909 16.4979 8.7051 16.4979C8.7711 16.4979 8.83646 16.4848 8.89738 16.4594C8.95831 16.4341 9.01362 16.3969 9.0601 16.35L20.0001 5.41V8.5C20.0001 8.63261 20.0528 8.75979 20.1465 8.85355C20.2403 8.94732 20.3675 9 20.5001 9H21.5001C21.6327 9 21.7599 8.94732 21.8537 8.85355C21.9474 8.75979 22.0001 8.63261 22.0001 8.5V3.5C22.0001 3.10218 21.8421 2.72064 21.5608 2.43934C21.2795 2.15804 20.8979 2 20.5001 2V2Z" fill="currentColor"></path><path d="M21.5 13H20.5C20.3674 13 20.2402 13.0527 20.1464 13.1464C20.0527 13.2402 20 13.3674 20 13.5V20H4V4H10.5C10.6326 4 10.7598 3.94732 10.8536 3.85355C10.9473 3.75979 11 3.63261 11 3.5V2.5C11 2.36739 10.9473 2.24021 10.8536 2.14645C10.7598 2.05268 10.6326 2 10.5 2H3.5C3.10218 2 2.72064 2.15804 2.43934 2.43934C2.15804 2.72064 2 3.10218 2 3.5V20.5C2 20.8978 2.15804 21.2794 2.43934 21.5607C2.72064 21.842 3.10218 22 3.5 22H20.5C20.8978 22 21.2794 21.842 21.5607 21.5607C21.842 21.2794 22 20.8978 22 20.5V13.5C22 13.3674 21.9473 13.2402 21.8536 13.1464C21.7598 13.0527 21.6326 13 21.5 13Z" fill="currentColor"></path></svg><span class="hidden md:block">Fork</span></a></div></div><div class=" sp-layout"><div class=" sp-editor sp-stack"><div class=" sp-code-editor"><div aria-autocomplete="list" aria-label="Code Editor for App.js" aria-multiline="true" class="sp-pristine sp-javascript   sp-cm" role="textbox" tabindex="0" translate="no"><pre class=" sp-pre-placeholder" style="margin-left:var(--sp-space-11)"><span class="sp-syntax-keyword">import</span> <span class="sp-syntax-punctuation">{</span> <span class="sp-syntax-plain">useState</span><span class="sp-syntax-punctuation">,</span> <span class="sp-syntax-plain">useEffect</span> <span class="sp-syntax-punctuation">}</span> <span class="sp-syntax-keyword">from</span> <span class="sp-syntax-string">&#x27;react&#x27;</span><span class="sp-syntax-punctuation">;</span>

<span class="sp-syntax-keyword">export</span> <span class="sp-syntax-keyword">default</span> <span class="sp-syntax-keyword">function</span> <span class="sp-syntax-definition">Timer</span><span class="sp-syntax-punctuation">(</span><span class="sp-syntax-punctuation">)</span> <span class="sp-syntax-punctuation">{</span>
  <span class="sp-syntax-keyword">const</span> <span class="sp-syntax-punctuation">[</span><span class="sp-syntax-plain">count</span><span class="sp-syntax-punctuation">,</span> <span class="sp-syntax-plain">setCount</span><span class="sp-syntax-punctuation">]</span> = <span class="sp-syntax-definition">useState</span><span class="sp-syntax-punctuation">(</span><span class="sp-syntax-static">0</span><span class="sp-syntax-punctuation">)</span><span class="sp-syntax-punctuation">;</span>

  <span class="sp-syntax-definition">useEffect</span><span class="sp-syntax-punctuation">(</span><span class="sp-syntax-punctuation">(</span><span class="sp-syntax-punctuation">)</span> <span class="sp-syntax-punctuation">=&gt;</span> <span class="sp-syntax-punctuation">{</span>
    <span class="sp-syntax-plain">console</span>.<span class="sp-syntax-property">log</span><span class="sp-syntax-punctuation">(</span><span class="sp-syntax-string">&#x27;✅ 创建定时器&#x27;</span><span class="sp-syntax-punctuation">)</span><span class="sp-syntax-punctuation">;</span>
    <span class="sp-syntax-keyword">const</span> <span class="sp-syntax-plain">id</span> = <span class="sp-syntax-definition">setInterval</span><span class="sp-syntax-punctuation">(</span><span class="sp-syntax-punctuation">(</span><span class="sp-syntax-punctuation">)</span> <span class="sp-syntax-punctuation">=&gt;</span> <span class="sp-syntax-punctuation">{</span>
      <span class="sp-syntax-plain">console</span>.<span class="sp-syntax-property">log</span><span class="sp-syntax-punctuation">(</span><span class="sp-syntax-string">&#x27;⏰ Interval&#x27;</span><span class="sp-syntax-punctuation">)</span><span class="sp-syntax-punctuation">;</span>
      <span class="sp-syntax-definition">setCount</span><span class="sp-syntax-punctuation">(</span><span class="sp-syntax-plain">count</span> + <span class="sp-syntax-static">1</span><span class="sp-syntax-punctuation">)</span><span class="sp-syntax-punctuation">;</span>
    <span class="sp-syntax-punctuation">}</span><span class="sp-syntax-punctuation">,</span> <span class="sp-syntax-static">1000</span><span class="sp-syntax-punctuation">)</span><span class="sp-syntax-punctuation">;</span>
    <span class="sp-syntax-keyword">return</span> <span class="sp-syntax-punctuation">(</span><span class="sp-syntax-punctuation">)</span> <span class="sp-syntax-punctuation">=&gt;</span> <span class="sp-syntax-punctuation">{</span>
      <span class="sp-syntax-plain">console</span>.<span class="sp-syntax-property">log</span><span class="sp-syntax-punctuation">(</span><span class="sp-syntax-string">&#x27;❌ 清除定时器&#x27;</span><span class="sp-syntax-punctuation">)</span><span class="sp-syntax-punctuation">;</span>
      <span class="sp-syntax-definition">clearInterval</span><span class="sp-syntax-punctuation">(</span><span class="sp-syntax-plain">id</span><span class="sp-syntax-punctuation">)</span><span class="sp-syntax-punctuation">;</span>
    <span class="sp-syntax-punctuation">}</span><span class="sp-syntax-punctuation">;</span>
  <span class="sp-syntax-punctuation">}</span><span class="sp-syntax-punctuation">,</span> <span class="sp-syntax-punctuation">[</span><span class="sp-syntax-plain">count</span><span class="sp-syntax-punctuation">]</span><span class="sp-syntax-punctuation">)</span><span class="sp-syntax-punctuation">;</span>

  <span class="sp-syntax-keyword">return</span> <span class="sp-syntax-punctuation">&lt;</span><span class="sp-syntax-tag">h1</span><span class="sp-syntax-punctuation">&gt;</span>计数器: <span class="sp-syntax-punctuation">{</span><span class="sp-syntax-plain">count</span><span class="sp-syntax-punctuation">}</span><span class="sp-syntax-punctuation">&lt;/</span><span class="sp-syntax-tag">h1</span><span class="sp-syntax-punctuation">&gt;</span>
<span class="sp-syntax-punctuation">}</span>

</pre></div></div></div><div class=" order-last xl:order-2 sp-stack"><div class="p-0 sm:p-2 md:p-4 lg:p-8 bg-card dark:bg-wash-dark h-full relative md:rounded-b-lg lg:rounded-b-none"><div style="position:relative"><iframe class="rounded-t-none bg-white md:shadow-md sm:rounded-lg w-full max-w-full transition-opacity absolute opacity-0 pointer-events-none duration-75" title="Sandbox Preview" style="height:15px;z-index:-1"></iframe></div></div></div><button translate="yes" class="sandpack-expand flex text-base justify-between dark:border-card-dark bg-wash dark:bg-card-dark items-center z-10 p-1 w-full order-2 xl:order-last border-b-1 relative top-0"><span class="flex p-2 focus:outline-none text-primary dark:text-primary-dark leading-[20px]"><svg class="rotate-0 inline me-1.5 text-xl" xmlns="http://www.w3.org/2000/svg" width="20" height="20" viewBox="0 0 20 20"><g fill="none" fill-rule="evenodd" transform="translate(-446 -398)"><path fill="currentColor" fill-rule="nonzero" d="M95.8838835,240.366117 C95.3957281,239.877961 94.6042719,239.877961 94.1161165,240.366117 C93.6279612,240.854272 93.6279612,241.645728 94.1161165,242.133883 L98.6161165,246.633883 C99.1042719,247.122039 99.8957281,247.122039 100.383883,246.633883 L104.883883,242.133883 C105.372039,241.645728 105.372039,240.854272 104.883883,240.366117 C104.395728,239.877961 103.604272,239.877961 103.116117,240.366117 L99.5,243.982233 L95.8838835,240.366117 Z" transform="translate(356.5 164.5)"></path><polygon points="446 418 466 418 466 398 446 398"></polygon></g></svg>显示更多</span></button></div></div></div></div><!--/$--></div><div class="flex justify-between items-center mt-4"><div><button class="me-2 text-base leading-tight font-bold rounded-full py-2 px-4 focus:outline focus:outline-offset-2 focus:outline-link dark:focus:outline-link-dark inline-flex items-center my-1 bg-transparent text-primary dark:text-primary-dark active:text-primary shadow-secondary-button-stroke dark:shadow-secondary-button-stroke-dark hover:bg-gray-40/5 active:bg-gray-40/10  hover:dark:bg-gray-60/5 active:dark:bg-gray-60/10"><svg class="inline -mt-0.5 me-1.5" width="12" height="14" viewBox="0 0 12 15" xmlns="http://www.w3.org/2000/svg"><path d="M4.53487 11H5.21954V7.66665H6.55287V11H7.23754C7.32554 10.1986 7.7342 9.53732 8.39754 8.81532C8.47287 8.73398 8.9522 8.23732 9.00887 8.16665C9.47973 7.5784 9.77486 6.86913 9.86028 6.1205C9.9457 5.37187 9.81794 4.61434 9.4917 3.93514C9.16547 3.25594 8.65402 2.6827 8.01628 2.28143C7.37853 1.88016 6.64041 1.66719 5.88692 1.66703C5.13344 1.66686 4.39523 1.87953 3.75731 2.28052C3.11939 2.68152 2.60771 3.25454 2.28118 3.9336C1.95465 4.61266 1.82656 5.37014 1.91167 6.1188C1.99677 6.86747 2.2916 7.57687 2.7622 8.16532C2.81954 8.23665 3.3002 8.73398 3.3742 8.81465C4.0382 9.53732 4.44687 10.1986 4.53487 11ZM4.55287 12.3333V13H7.21954V12.3333H4.55287ZM1.7222 8.99998C1.09433 8.21551 0.700836 7.26963 0.587047 6.2713C0.473258 5.27296 0.643804 4.26279 1.07904 3.35715C1.51428 2.4515 2.19649 1.68723 3.04711 1.15237C3.89772 0.617512 4.88213 0.333824 5.88692 0.333984C6.89172 0.334145 7.87604 0.61815 8.72648 1.15328C9.57692 1.68841 10.2589 2.4529 10.6938 3.35869C11.1288 4.26447 11.299 5.27469 11.1849 6.27299C11.0708 7.27129 10.677 8.21705 10.0489 9.00132C9.63554 9.51598 8.55287 10.3333 8.55287 11.3333V13C8.55287 13.3536 8.41239 13.6927 8.16235 13.9428C7.9123 14.1928 7.57316 14.3333 7.21954 14.3333H4.55287C4.19925 14.3333 3.86011 14.1928 3.61006 13.9428C3.36001 13.6927 3.21954 13.3536 3.21954 13V11.3333C3.21954 10.3333 2.1362 9.51598 1.7222 8.99998Z" fill="currentColor"></path></svg> <!-- -->展示提示</button><button class="me-2 text-base leading-tight font-bold rounded-full py-2 px-4 focus:outline focus:outline-offset-2 focus:outline-link dark:focus:outline-link-dark inline-flex items-center my-1 bg-transparent text-primary dark:text-primary-dark active:text-primary shadow-secondary-button-stroke dark:shadow-secondary-button-stroke-dark hover:bg-gray-40/5 active:bg-gray-40/10  hover:dark:bg-gray-60/5 active:dark:bg-gray-60/10"><svg class="inline me-1.5" width="0.75em" height="0.75em" viewBox="0 0 13 13" xmlns="http://www.w3.org/2000/svg"><path d="M2.21908 8.74479V12.7448H0.885742V0.078125H7.14041C7.26418 0.0781911 7.3855 0.112714 7.49076 0.177827C7.59602 0.242939 7.68108 0.336071 7.73641 0.446792L8.21908 1.41146H12.2191C12.3959 1.41146 12.5655 1.4817 12.6905 1.60672C12.8155 1.73174 12.8857 1.90131 12.8857 2.07812V9.41146C12.8857 9.58827 12.8155 9.75784 12.6905 9.88286C12.5655 10.0079 12.3959 10.0781 12.2191 10.0781H7.96441C7.84063 10.0781 7.71932 10.0435 7.61406 9.97842C7.50879 9.91331 7.42374 9.82018 7.36841 9.70946L6.88574 8.74479H2.21908ZM2.21908 1.41146V7.41146H7.70974L8.37641 8.74479H11.5524V2.74479H7.39508L6.72841 1.41146H2.21908Z" fill="currentColor"></path></svg> <!-- -->展示答案</button></div><button class="bg-link dark:bg-link-dark text-base leading-tight font-bold rounded-full py-2 px-4 focus:outline focus:outline-offset-2 focus:outline-link dark:focus:outline-link-dark inline-flex items-center my-1 bg-link border-link text-white hover:bg-link focus:bg-link active:bg-link">下一个<!-- -->挑战<svg width="1em" height="1em" viewBox="0 0 20 20" fill="none" xmlns="http://www.w3.org/2000/svg" class="block ms-1.5"><path d="M6.86612 13.6161C6.37796 14.1043 6.37796 14.8957 6.86612 15.3839C7.35427 15.872 8.14572 15.872 8.63388 15.3839L13.1339 10.8839C13.622 10.3957 13.622 9.60428 13.1339 9.11612L8.63388 4.61612C8.14572 4.12797 7.35427 4.12797 6.86612 4.61612C6.37796 5.10428 6.37796 5.89573 6.86612 6.38388L10.4822 10L6.86612 13.6161Z" fill="currentColor"></path></svg></button></div></div></div></div><div class="max-w-4xl ms-0 2xl:mx-auto">
<p class="whitespace-pre-wrap my-4"><strong class="font-bold">译注</strong>：
<a name="note1"></a> 在创建 <code dir="ltr" class="inline text-code text-secondary dark:text-secondary-dark px-1 rounded-md no-underline bg-gray-30 bg-opacity-10 py-px">onTick</code> 函数时，由于闭包的缘故，<code dir="ltr" class="inline text-code text-secondary dark:text-secondary-dark px-1 rounded-md no-underline bg-gray-30 bg-opacity-10 py-px">setCount(count + increment)</code> 捕获的是创建时 <code dir="ltr" class="inline text-code text-secondary dark:text-secondary-dark px-1 rounded-md no-underline bg-gray-30 bg-opacity-10 py-px">count</code> 和 <code dir="ltr" class="inline text-code text-secondary dark:text-secondary-dark px-1 rounded-md no-underline bg-gray-30 bg-opacity-10 py-px">increment</code> 值。由于这里的“说谎”，每次重新渲染时新创建的 <code dir="ltr" class="inline text-code text-secondary dark:text-secondary-dark px-1 rounded-md no-underline bg-gray-30 bg-opacity-10 py-px">onTick</code> 函数不能替换掉 Effect 里旧 <code dir="ltr" class="inline text-code text-secondary dark:text-secondary-dark px-1 rounded-md no-underline bg-gray-30 bg-opacity-10 py-px">onTick</code> 函数，于是最终的效果就是 <code dir="ltr" class="inline text-code text-secondary dark:text-secondary-dark px-1 rounded-md no-underline bg-gray-30 bg-opacity-10 py-px">setCount(0 + 1)</code> <br/></p></div></div><div class="grid grid-cols-1 gap-4 py-4 mx-auto max-w-7xl md:grid-cols-2 md:py-12"><a class="flex gap-x-4 md:gap-x-6 items-center w-full md:min-w-80 md:w-fit md:max-w-md px-4 md:px-5 py-6 border-2 border-transparent text-base leading-base text-link dark:text-link-dark rounded-lg group focus:text-link dark:focus:text-link-dark focus:bg-highlight focus:border-link dark:focus:bg-highlight-dark dark:focus:border-link-dark focus:border-opacity-100 focus:border-2 focus:ring-1 focus:ring-offset-4 focus:ring-blue-40 active:ring-0 active:ring-offset-0 hover:bg-gray-5 dark:hover:bg-gray-80" href="/learn/separating-events-from-effects"><svg xmlns="http://www.w3.org/2000/svg" width="20" height="20" viewBox="0 0 20 20" class="duration-100 ease-in transition rotate-90 rtl:-rotate-90 inline text-tertiary dark:text-tertiary-dark group-focus:text-link dark:group-focus:text-link-dark" style="min-width:20px;min-height:20px"><g fill="none" fill-rule="evenodd" transform="translate(-446 -398)"><path fill="currentColor" fill-rule="nonzero" d="M95.8838835,240.366117 C95.3957281,239.877961 94.6042719,239.877961 94.1161165,240.366117 C93.6279612,240.854272 93.6279612,241.645728 94.1161165,242.133883 L98.6161165,246.633883 C99.1042719,247.122039 99.8957281,247.122039 100.383883,246.633883 L104.883883,242.133883 C105.372039,241.645728 105.372039,240.854272 104.883883,240.366117 C104.395728,239.877961 103.604272,239.877961 103.116117,240.366117 L99.5,243.982233 L95.8838835,240.366117 Z" transform="translate(356.5 164.5)"></path><polygon points="446 418 466 418 466 398 446 398"></polygon></g></svg><div class="flex flex-col overflow-hidden"><span class="text-sm font-bold tracking-wide no-underline uppercase text-secondary dark:text-secondary-dark group-focus:text-link dark:group-focus:text-link-dark group-focus:text-opacity-100">上一页</span><span class="text-lg break-words group-hover:underline">将事件从 Effect 中分开</span></div></a><a class="flex gap-x-4 md:gap-x-6 items-center w-full md:min-w-80 md:w-fit md:max-w-md px-4 md:px-5 py-6 border-2 border-transparent text-base leading-base text-link dark:text-link-dark rounded-lg group focus:text-link dark:focus:text-link-dark focus:bg-highlight focus:border-link dark:focus:bg-highlight-dark dark:focus:border-link-dark focus:border-opacity-100 focus:border-2 focus:ring-1 focus:ring-offset-4 focus:ring-blue-40 active:ring-0 active:ring-offset-0 hover:bg-gray-5 dark:hover:bg-gray-80 flex-row-reverse justify-self-end text-end" href="/learn/reusing-logic-with-custom-hooks"><svg xmlns="http://www.w3.org/2000/svg" width="20" height="20" viewBox="0 0 20 20" class="duration-100 ease-in transition -rotate-90 rtl:rotate-90 inline text-tertiary dark:text-tertiary-dark group-focus:text-link dark:group-focus:text-link-dark" style="min-width:20px;min-height:20px"><g fill="none" fill-rule="evenodd" transform="translate(-446 -398)"><path fill="currentColor" fill-rule="nonzero" d="M95.8838835,240.366117 C95.3957281,239.877961 94.6042719,239.877961 94.1161165,240.366117 C93.6279612,240.854272 93.6279612,241.645728 94.1161165,242.133883 L98.6161165,246.633883 C99.1042719,247.122039 99.8957281,247.122039 100.383883,246.633883 L104.883883,242.133883 C105.372039,241.645728 105.372039,240.854272 104.883883,240.366117 C104.395728,239.877961 103.604272,239.877961 103.116117,240.366117 L99.5,243.982233 L95.8838835,240.366117 Z" transform="translate(356.5 164.5)"></path><polygon points="446 418 466 418 466 398 446 398"></polygon></g></svg><div class="flex flex-col overflow-hidden"><span class="text-sm font-bold tracking-wide no-underline uppercase text-secondary dark:text-secondary-dark group-focus:text-link dark:group-focus:text-link-dark group-focus:text-opacity-100">下一页</span><span class="text-lg break-words group-hover:underline">使用自定义 Hook 复用逻辑</span></div></a></div></div></div></article><div class="self-stretch w-full"><div class="w-full px-5 pt-10 mx-auto sm:px-12 md:px-12 md:pt-12 lg:pt-10"><hr class="mx-auto max-w-7xl border-border dark:border-border-dark"/></div><div class="py-12 px-5 sm:px-12 md:px-12 sm:py-12 md:py-16 lg:py-14"></div></div></main><!--/$--><div class="hidden -mt-16 lg:max-w-custom-xs 2xl:block"><nav role="navigation" class="pt-20 sticky top-0 end-0"><h2 class="mb-3 lg:mb-3 uppercase tracking-wide font-bold text-sm text-secondary dark:text-secondary-dark px-4 w-full">目录</h2><div class="h-full overflow-y-auto ps-4 max-h-[calc(100vh-7.5rem)]" style="overscroll-behavior:contain"><ul class="space-y-2 pb-16"><li class="text-sm px-2 rounded-s-xl bg-highlight dark:bg-highlight-dark"><a class="text-link dark:text-link-dark font-bold block hover:text-link dark:hover:text-link-dark leading-normal py-2" href="#">概览</a></li><li class="text-sm px-2 rounded-s-xl"><a class="text-secondary dark:text-secondary-dark block hover:text-link dark:hover:text-link-dark leading-normal py-2" href="#dependencies-should-match-the-code">依赖应该和代码保持一致 </a></li><li class="text-sm px-2 rounded-s-xl ps-4"><a class="text-secondary dark:text-secondary-dark block hover:text-link dark:hover:text-link-dark leading-normal py-2" href="#to-remove-a-dependency-prove-that-its-not-a-dependency">当要移除一个依赖时，请证明它不是一个依赖 </a></li><li class="text-sm px-2 rounded-s-xl ps-4"><a class="text-secondary dark:text-secondary-dark block hover:text-link dark:hover:text-link-dark leading-normal py-2" href="#to-change-the-dependencies-change-the-code">要改变依赖，请改变代码 </a></li><li class="text-sm px-2 rounded-s-xl"><a class="text-secondary dark:text-secondary-dark block hover:text-link dark:hover:text-link-dark leading-normal py-2" href="#removing-unnecessary-dependencies">移除非必需的依赖 </a></li><li class="text-sm px-2 rounded-s-xl ps-4"><a class="text-secondary dark:text-secondary-dark block hover:text-link dark:hover:text-link-dark leading-normal py-2" href="#should-this-code-move-to-an-event-handler">这段代码应该移到事件处理程序中吗？ </a></li><li class="text-sm px-2 rounded-s-xl ps-4"><a class="text-secondary dark:text-secondary-dark block hover:text-link dark:hover:text-link-dark leading-normal py-2" href="#is-your-effect-doing-several-unrelated-things">Effect 是否在做几件不相关的事情？ </a></li><li class="text-sm px-2 rounded-s-xl ps-4"><a class="text-secondary dark:text-secondary-dark block hover:text-link dark:hover:text-link-dark leading-normal py-2" href="#are-you-reading-some-state-to-calculate-the-next-state">是否在读取一些状态来计算下一个状态？ </a></li><li class="text-sm px-2 rounded-s-xl ps-4"><a class="text-secondary dark:text-secondary-dark block hover:text-link dark:hover:text-link-dark leading-normal py-2" href="#do-you-want-to-read-a-value-without-reacting-to-its-changes">你想读取一个值而不对其变化做出“反应”吗？ </a></li><li class="text-sm px-2 rounded-s-xl ps-4"><a class="text-secondary dark:text-secondary-dark block hover:text-link dark:hover:text-link-dark leading-normal py-2" href="#does-some-reactive-value-change-unintentionally">一些响应式值是否无意中改变了？ </a></li><li class="text-sm px-2 rounded-s-xl"><a class="text-secondary dark:text-secondary-dark block hover:text-link dark:hover:text-link-dark leading-normal py-2" href="#recap">Recap</a></li><li class="text-sm px-2 rounded-s-xl"><a class="text-secondary dark:text-secondary-dark block hover:text-link dark:hover:text-link-dark leading-normal py-2" href="#challenges">Challenges</a></li></ul></div></nav></div></div></div><script id="__NEXT_DATA__" type="application/json">{"props":{"pageProps":{"toc":"[{\"url\":\"#\",\"text\":\"概览\",\"depth\":2},{\"url\":\"#dependencies-should-match-the-code\",\"depth\":2,\"text\":\"依赖应该和代码保持一致 \"},{\"url\":\"#to-remove-a-dependency-prove-that-its-not-a-dependency\",\"depth\":3,\"text\":\"当要移除一个依赖时，请证明它不是一个依赖 \"},{\"url\":\"#to-change-the-dependencies-change-the-code\",\"depth\":3,\"text\":\"要改变依赖，请改变代码 \"},{\"url\":\"#removing-unnecessary-dependencies\",\"depth\":2,\"text\":\"移除非必需的依赖 \"},{\"url\":\"#should-this-code-move-to-an-event-handler\",\"depth\":3,\"text\":\"这段代码应该移到事件处理程序中吗？ \"},{\"url\":\"#is-your-effect-doing-several-unrelated-things\",\"depth\":3,\"text\":\"Effect 是否在做几件不相关的事情？ \"},{\"url\":\"#are-you-reading-some-state-to-calculate-the-next-state\",\"depth\":3,\"text\":\"是否在读取一些状态来计算下一个状态？ \"},{\"url\":\"#do-you-want-to-read-a-value-without-reacting-to-its-changes\",\"depth\":3,\"text\":\"你想读取一个值而不对其变化做出“反应”吗？ \"},{\"url\":\"#does-some-reactive-value-change-unintentionally\",\"depth\":3,\"text\":\"一些响应式值是否无意中改变了？ \"},{\"url\":\"#recap\",\"depth\":2,\"text\":\"Recap\"},{\"url\":\"#challenges\",\"depth\":2,\"text\":\"Challenges\"}]","content":"[[\"$r\",\"MaxWidth\",\"12\",{\"children\":[[\"$r\",\"Intro\",null,{\"children\":[\"$r\",\"p\",null,{\"children\":\"当编写 Effect 时，linter 会验证是否已经将 Effect 读取的每一个响应式值（如 props 和 state）包含在 Effect 的依赖中。这可以确保 Effect 与组件的 props 和 state 保持同步。不必要的依赖可能会导致 Effect 运行过于频繁，甚至产生无限循环。请按照本指南审查并移除 Effect 中不必要的依赖。\"}]}],\"\\n\",[\"$r\",\"YouWillLearn\",null,{\"children\":[\"$r\",\"ul\",null,{\"children\":[\"\\n\",[\"$r\",\"li\",null,{\"children\":\"修复无限的 Effect 依赖性循环\"}],\"\\n\",[\"$r\",\"li\",null,{\"children\":\"当你想移除依赖时，该怎么做\"}],\"\\n\",[\"$r\",\"li\",null,{\"children\":\"从 Effect 中读取值而不对它作出“反应”\"}],\"\\n\",[\"$r\",\"li\",null,{\"children\":\"为什么以及如何避免对象和函数的依赖？\"}],\"\\n\",[\"$r\",\"li\",null,{\"children\":\"为什么抑制依赖代码检查器的检查是危险的，以及应该如何做？\"}],\"\\n\"]}]}],\"\\n\",[\"$r\",\"h2\",null,{\"id\":\"dependencies-should-match-the-code\",\"children\":\"依赖应该和代码保持一致 \"}],\"\\n\",[\"$r\",\"p\",null,{\"children\":[\"当你编写 Effect 时，无论这个 Effect 要做什么，你首先要明确其 \",[\"$r\",\"a\",null,{\"href\":\"/learn/lifecycle-of-reactive-effects#the-lifecycle-of-an-effect\",\"children\":\"生命周期\"}],\"：\"]}],\"\\n\",[\"$r\",\"pre\",null,{\"children\":[\"$r\",\"code\",null,{\"className\":\"language-js\",\"meta\":\"{5-7}\",\"children\":\"const serverUrl = 'https://localhost:1234';\\r\\n\\r\\nfunction ChatRoom({ roomId }) {\\r\\n  useEffect(() =\u003e {\\r\\n    const connection = createConnection(serverUrl, roomId);\\r\\n    connection.connect();\\r\\n    return () =\u003e connection.disconnect();\\r\\n  \\t// ...\\r\\n}\\n\"}]}],\"\\n\",[\"$r\",\"p\",null,{\"children\":[\"如果你设置 Effect 的依赖是空数组（\",[\"$r\",\"code\",null,{\"children\":\"[]\"}],\"），那么 linter 将会建议合适的依赖：\"]}],\"\\n\"]}],[\"$r\",\"Sandpack\",null,{\"children\":[[\"$r\",\"pre\",null,{\"children\":[\"$r\",\"code\",null,{\"className\":\"language-js\",\"children\":\"import { useState, useEffect } from 'react';\\r\\nimport { createConnection } from './chat.js';\\r\\n\\r\\nconst serverUrl = 'https://localhost:1234';\\r\\n\\r\\nfunction ChatRoom({ roomId }) {\\r\\n  useEffect(() =\u003e {\\r\\n    const connection = createConnection(serverUrl, roomId);\\r\\n    connection.connect();\\r\\n    return () =\u003e connection.disconnect();\\r\\n  }, []); // \u003c-- 修复这里的依赖！\\r\\n  return \u003ch1\u003e欢迎来到 {roomId} 房间！\u003c/h1\u003e;\\r\\n}\\r\\n\\r\\nexport default function App() {\\r\\n  const [roomId, setRoomId] = useState('所有');\\r\\n  return (\\r\\n    \u003c\u003e\\r\\n      \u003clabel\u003e\\r\\n        选择聊天室：\\r\\n        \u003cselect\\r\\n          value={roomId}\\r\\n          onChange={e =\u003e setRoomId(e.target.value)}\\r\\n        \u003e\\r\\n          \u003coption value=\\\"所有\\\"\u003e所有\u003c/option\u003e\\r\\n          \u003coption value=\\\"旅游\\\"\u003e旅游\u003c/option\u003e\\r\\n          \u003coption value=\\\"音乐\\\"\u003e音乐\u003c/option\u003e\\r\\n        \u003c/select\u003e\\r\\n      \u003c/label\u003e\\r\\n      \u003chr /\u003e\\r\\n      \u003cChatRoom roomId={roomId} /\u003e\\r\\n    \u003c/\u003e\\r\\n  );\\r\\n}\\n\"}]}],[\"$r\",\"pre\",null,{\"children\":[\"$r\",\"code\",null,{\"className\":\"language-js\",\"meta\":\"src/chat.js\",\"children\":\"export function createConnection(serverUrl, roomId) {\\r\\n  // 真正的实现实际上会连接到服务器\\r\\n  return {\\r\\n    connect() {\\r\\n      console.log('✅ 连接到“' + roomId + '”房间，在 ' + serverUrl + '...');\\r\\n    },\\r\\n    disconnect() {\\r\\n      console.log('❌ 断开“' + roomId + '”房间，在 ' + serverUrl);\\r\\n    }\\r\\n  };\\r\\n}\\n\"}]}],[\"$r\",\"pre\",null,{\"children\":[\"$r\",\"code\",null,{\"className\":\"language-css\",\"children\":\"input { display: block; margin-bottom: 20px; }\\r\\nbutton { margin-left: 10px; }\\n\"}]}]]}],[\"$r\",\"MaxWidth\",\"20\",{\"children\":[\"\\n\",[\"$r\",\"p\",null,{\"children\":\"按照 linter 的建议，把它们填进去：\"}],\"\\n\",[\"$r\",\"pre\",null,{\"children\":[\"$r\",\"code\",null,{\"className\":\"language-js\",\"meta\":\"{6}\",\"children\":\"function ChatRoom({ roomId }) {\\r\\n  useEffect(() =\u003e {\\r\\n    const connection = createConnection(serverUrl, roomId);\\r\\n    connection.connect();\\r\\n    return () =\u003e connection.disconnect();\\r\\n  }, [roomId]); // ✅ 所有依赖已声明\\r\\n  // ...\\r\\n}\\n\"}]}],\"\\n\",[\"$r\",\"p\",null,{\"children\":[[\"$r\",\"a\",null,{\"href\":\"/learn/lifecycle-of-reactive-effects#effects-react-to-reactive-values\",\"children\":\"Effect “反应”响应式值\"}],\" 因为这里的 \",[\"$r\",\"code\",null,{\"children\":\"roomId\"}],\" 是一个响应式值（它可能随重新渲染而改变），所以 linter 会验证你是否将它指定为依赖。如果 \",[\"$r\",\"code\",null,{\"children\":\"roomId\"}],\" 变成不同的值，React 将重新运行 Effect。这可以确保聊天界面与所选房间保持一致，并把变化“反馈”给下拉菜单：\"]}],\"\\n\"]}],[\"$r\",\"Sandpack\",null,{\"children\":[[\"$r\",\"pre\",null,{\"children\":[\"$r\",\"code\",null,{\"className\":\"language-js\",\"children\":\"import { useState, useEffect } from 'react';\\r\\nimport { createConnection } from './chat.js';\\r\\n\\r\\nconst serverUrl = 'https://localhost:1234';\\r\\n\\r\\nfunction ChatRoom({ roomId }) {\\r\\n  useEffect(() =\u003e {\\r\\n    const connection = createConnection(serverUrl, roomId);\\r\\n    connection.connect();\\r\\n    return () =\u003e connection.disconnect();\\r\\n  }, [roomId]);\\r\\n  return \u003ch1\u003e欢迎来到 {roomId} 房间！\u003c/h1\u003e;\\r\\n}\\r\\n\\r\\nexport default function App() {\\r\\n  const [roomId, setRoomId] = useState('所有');\\r\\n  return (\\r\\n    \u003c\u003e\\r\\n      \u003clabel\u003e\\r\\n        选择聊天室：\\r\\n        \u003cselect\\r\\n          value={roomId}\\r\\n          onChange={e =\u003e setRoomId(e.target.value)}\\r\\n        \u003e\\r\\n          \u003coption value=\\\"所有\\\"\u003e所有\u003c/option\u003e\\r\\n          \u003coption value=\\\"旅游\\\"\u003e旅游\u003c/option\u003e\\r\\n          \u003coption value=\\\"音乐\\\"\u003e音乐\u003c/option\u003e\\r\\n        \u003c/select\u003e\\r\\n      \u003c/label\u003e\\r\\n      \u003chr /\u003e\\r\\n      \u003cChatRoom roomId={roomId} /\u003e\\r\\n    \u003c/\u003e\\r\\n  );\\r\\n}\\n\"}]}],[\"$r\",\"pre\",null,{\"children\":[\"$r\",\"code\",null,{\"className\":\"language-js\",\"meta\":\"src/chat.js\",\"children\":\"export function createConnection(serverUrl, roomId) {\\r\\n  // 真正的实现实际上会连接到服务器\\r\\n  return {\\r\\n    connect() {\\r\\n      console.log('✅ 连接到“' + roomId + '”房间，在 ' + serverUrl + '...');\\r\\n    },\\r\\n    disconnect() {\\r\\n      console.log('❌ 断开“' + roomId + '”房间，在 ' + serverUrl);\\r\\n    }\\r\\n  };\\r\\n}\\n\"}]}],[\"$r\",\"pre\",null,{\"children\":[\"$r\",\"code\",null,{\"className\":\"language-css\",\"children\":\"input { display: block; margin-bottom: 20px; }\\r\\nbutton { margin-left: 10px; }\\n\"}]}]]}],[\"$r\",\"MaxWidth\",\"40\",{\"children\":[\"\\n\",[\"$r\",\"h3\",null,{\"id\":\"to-remove-a-dependency-prove-that-its-not-a-dependency\",\"children\":\"当要移除一个依赖时，请证明它不是一个依赖 \"}],\"\\n\",[\"$r\",\"p\",null,{\"children\":[\"注意，你不能“选择” Effect 的依赖。每个被 Effect 所使用的\",[\"$r\",\"CodeStep\",null,{\"step\":2,\"children\":\"响应式值\"}],\"，必须在依赖中声明。依赖是由 Effect 的代码决定的：\"]}],\"\\n\",[\"$r\",\"pre\",null,{\"children\":[\"$r\",\"code\",null,{\"className\":\"language-js\",\"meta\":\"[[2, 3, \\\"roomId\\\"], [2, 5, \\\"roomId\\\"], [2, 8, \\\"roomId\\\"]]\",\"children\":\"const serverUrl = 'https://localhost:1234';\\r\\n\\r\\nfunction ChatRoom({ roomId }) { // 这是一个响应式值\\r\\n  useEffect(() =\u003e {\\r\\n    const connection = createConnection(serverUrl, roomId); // Effect 在这里读取响应式值\\r\\n    connection.connect();\\r\\n    return () =\u003e connection.disconnect();\\r\\n  }, [roomId]); // ✅ 所以你必须在依赖中声明 Effect 使用的响应式值\\r\\n  // ...\\r\\n}\\n\"}]}],\"\\n\",[\"$r\",\"p\",null,{\"children\":[[\"$r\",\"a\",null,{\"href\":\"/learn/lifecycle-of-reactive-effects#all-variables-declared-in-the-component-body-are-reactive\",\"children\":\"响应式值\"}],\" 包括 props 以及所有你直接在组件中声明的变量和函数。由于 \",[\"$r\",\"code\",null,{\"children\":\"roomId\"}],\" 是响应式值，你不能把它从依赖中移除。linter 不允许这样做：\"]}],\"\\n\",[\"$r\",\"pre\",null,{\"children\":[\"$r\",\"code\",null,{\"className\":\"language-js\",\"meta\":\"{8}\",\"children\":\"const serverUrl = 'https://localhost:1234';\\r\\n\\r\\nfunction ChatRoom({ roomId }) {\\r\\n  useEffect(() =\u003e {\\r\\n    const connection = createConnection(serverUrl, roomId);\\r\\n    connection.connect();\\r\\n    return () =\u003e connection.disconnect();\\r\\n  }, []); // 🔴 React Hook useEffect 缺失依赖: 'roomId'\\r\\n  // ...\\r\\n}\\n\"}]}],\"\\n\",[\"$r\",\"p\",null,{\"children\":[\"linter 是对的！ 由于 \",[\"$r\",\"code\",null,{\"children\":\"roomId\"}],\" 可能会随时间变化，这会在代码中引入错误。\"]}],\"\\n\",[\"$r\",\"p\",null,{\"children\":[[\"$r\",\"strong\",null,{\"children\":\"移除一个依赖，你需要向 linter 证明其不需要这个依赖\"}],\"。例如，你可以将 \",[\"$r\",\"code\",null,{\"children\":\"roomId\"}],\" 移出组件，以证明它不是响应的，也不会在重新渲染时改变：\"]}],\"\\n\",[\"$r\",\"pre\",null,{\"children\":[\"$r\",\"code\",null,{\"className\":\"language-js\",\"meta\":\"{2,9}\",\"children\":\"const serverUrl = 'https://localhost:1234';\\r\\nconst roomId = '音乐'; // 不再是响应式值\\r\\n\\r\\nfunction ChatRoom() {\\r\\n  useEffect(() =\u003e {\\r\\n    const connection = createConnection(serverUrl, roomId);\\r\\n    connection.connect();\\r\\n    return () =\u003e connection.disconnect();\\r\\n  }, []); // ✅ 所有依赖已声明\\r\\n  // ...\\r\\n}\\n\"}]}],\"\\n\",[\"$r\",\"p\",null,{\"children\":[\"现在 \",[\"$r\",\"code\",null,{\"children\":\"roomId\"}],\" 不是响应式值（并且不能在重新渲染时改变），那它不就不是依赖：\"]}],\"\\n\"]}],[\"$r\",\"Sandpack\",null,{\"children\":[[\"$r\",\"pre\",null,{\"children\":[\"$r\",\"code\",null,{\"className\":\"language-js\",\"children\":\"import { useState, useEffect } from 'react';\\r\\nimport { createConnection } from './chat.js';\\r\\n\\r\\nconst serverUrl = 'https://localhost:1234';\\r\\nconst roomId = '音乐';\\r\\n\\r\\nexport default function ChatRoom() {\\r\\n  useEffect(() =\u003e {\\r\\n    const connection = createConnection(serverUrl, roomId);\\r\\n    connection.connect();\\r\\n    return () =\u003e connection.disconnect();\\r\\n  }, []);\\r\\n  return \u003ch1\u003e欢迎来到 {roomId} 房间！\u003c/h1\u003e;\\r\\n}\\n\"}]}],[\"$r\",\"pre\",null,{\"children\":[\"$r\",\"code\",null,{\"className\":\"language-js\",\"meta\":\"src/chat.js\",\"children\":\"export function createConnection(serverUrl, roomId) {\\r\\n  // 真正的实现实际上会连接到服务器\\r\\n  return {\\r\\n    connect() {\\r\\n      console.log('✅ 连接到“' + roomId + '”房间，在 ' + serverUrl + '...');\\r\\n    },\\r\\n    disconnect() {\\r\\n      console.log('❌ 断开“' + roomId + '”房间，在 ' + serverUrl);\\r\\n    }\\r\\n  };\\r\\n}\\n\"}]}],[\"$r\",\"pre\",null,{\"children\":[\"$r\",\"code\",null,{\"className\":\"language-css\",\"children\":\"input { display: block; margin-bottom: 20px; }\\r\\nbutton { margin-left: 10px; }\\n\"}]}]]}],[\"$r\",\"MaxWidth\",\"192\",{\"children\":[\"\\n\",[\"$r\",\"p\",null,{\"children\":[\"这就是为什么你现在可以指定 \",[\"$r\",\"a\",null,{\"href\":\"/learn/lifecycle-of-reactive-effects#what-an-effect-with-empty-dependencies-means\",\"children\":[\"空（\",[\"$r\",\"code\",null,{\"children\":\"[]\"}],\"）依赖\"]}],\"。Effect \",[\"$r\",\"strong\",null,{\"children\":\"真的不\"}],\" 依赖任何响应式值了，也 \",[\"$r\",\"strong\",null,{\"children\":\"真的不\"}],\" 需要在组件的 props 或 state 改变时重新运行。\"]}],\"\\n\",[\"$r\",\"h3\",null,{\"id\":\"to-change-the-dependencies-change-the-code\",\"children\":\"要改变依赖，请改变代码 \"}],\"\\n\",[\"$r\",\"p\",null,{\"children\":\"你可能已经注意到工作流程中有一个模式：\"}],\"\\n\",[\"$r\",\"ol\",null,{\"children\":[\"\\n\",[\"$r\",\"li\",null,{\"children\":[\"首先，你 \",[\"$r\",\"strong\",null,{\"children\":\"改变 Effect 的代码\"}],\" 或响应式值的声明方式。\"]}],\"\\n\",[\"$r\",\"li\",null,{\"children\":[\"然后，你采纳 linter 的建议，调整依赖，以 \",[\"$r\",\"strong\",null,{\"children\":\"匹配你所改变的代码\"}],\"。\"]}],\"\\n\",[\"$r\",\"li\",null,{\"children\":[\"如果你对依赖不满意，你可以 \",[\"$r\",\"strong\",null,{\"children\":\"回到第一步\"}],\"（并再次修改代码）。\"]}],\"\\n\"]}],\"\\n\",[\"$r\",\"p\",null,{\"children\":[\"最后一部分很重要。\",[\"$r\",\"strong\",null,{\"children\":\"如果你想改变依赖，首先要改变所涉及到的代码\"}],\"。你可以把依赖看作是 \",[\"$r\",\"a\",null,{\"href\":\"/learn/lifecycle-of-reactive-effects#react-verifies-that-you-specified-every-reactive-value-as-a-dependency\",\"children\":\"Effect的代码所依赖的所有响应式值的列表\"}],\"。你不要 \",[\"$r\",\"strong\",null,{\"children\":\"选择\"}],\" 把什么放在这个列表上。该列表 \",[\"$r\",\"strong\",null,{\"children\":\"描述了\"}],\" 代码。要改变依赖，请改变代码。\"]}],\"\\n\",[\"$r\",\"p\",null,{\"children\":\"这可能感觉就像解方程一样。你有一个目标（例如，移除一个依赖），你需要“找到”与该目标相匹配的代码。不是每个人都觉得解方程很有趣，写 Effect 也是如此！幸运的是，下面有一些常见的解决方案你可以去尝试。\"}],\"\\n\",[\"$r\",\"Pitfall\",null,{\"children\":[[\"$r\",\"p\",null,{\"children\":\"如果你有一个已经存在的代码库，你可能会有一些像这样抑制 linter 的代码：\"}],[\"$r\",\"pre\",null,{\"children\":[\"$r\",\"code\",null,{\"className\":\"language-js\",\"meta\":\"{3-4}\",\"children\":\"useEffect(() =\u003e {\\r\\n  // ...\\r\\n  // 🔴 避免像这样抑制 linter 的警告或错误提示：\\r\\n  // eslint-ignore-next-line react-hooks/exhaustive-deps\\r\\n}, []);\\n\"}]}],[\"$r\",\"p\",null,{\"children\":[[\"$r\",\"strong\",null,{\"children\":\"当依赖与代码不匹配时，极有可能引入 bug\"}],\"。通过抑制 linter，你是在 Effect 所依赖的值上对 React “撒谎”。\"]}],[\"$r\",\"p\",null,{\"children\":\"你可以使用如下技术。\"}]]}],\"\\n\",[\"$r\",\"DeepDive\",null,{\"children\":[[\"$r\",\"h4\",null,{\"id\":\"why-is-suppressing-the-dependency-linter-so-dangerous\",\"children\":\"为什么抑制 linter 对依赖的检查如此危险？ \"}],[\"$r\",\"p\",null,{\"children\":\"抑制 linter 会导致非常不直观的 bug，这将很难发现和修复。这里有一个例子：\"}],[\"$r\",\"Sandpack\",null,{\"children\":[[\"$r\",\"pre\",null,{\"children\":[\"$r\",\"code\",null,{\"className\":\"language-js\",\"children\":\"import { useState, useEffect } from 'react';\\r\\n\\r\\nexport default function Timer() {\\r\\n  const [count, setCount] = useState(0);\\r\\n  const [increment, setIncrement] = useState(1);\\r\\n\\r\\n  function onTick() {\\r\\n\\tsetCount(count + increment);\\r\\n  }\\r\\n\\r\\n  useEffect(() =\u003e {\\r\\n    const id = setInterval(onTick, 1000);\\r\\n    return () =\u003e clearInterval(id);\\r\\n    // eslint-disable-next-line react-hooks/exhaustive-deps\\r\\n  }, []);\\r\\n\\r\\n  return (\\r\\n    \u003c\u003e\\r\\n      \u003ch1\u003e\\r\\n        计数器：{count}\\r\\n        \u003cbutton onClick={() =\u003e setCount(0)}\u003e重制\u003c/button\u003e\\r\\n      \u003c/h1\u003e\\r\\n      \u003chr /\u003e\\r\\n      \u003cp\u003e\\r\\n        每秒递增：\\r\\n        \u003cbutton disabled={increment === 0} onClick={() =\u003e {\\r\\n          setIncrement(i =\u003e i - 1);\\r\\n        }}\u003e–\u003c/button\u003e\\r\\n        \u003cb\u003e{increment}\u003c/b\u003e\\r\\n        \u003cbutton onClick={() =\u003e {\\r\\n          setIncrement(i =\u003e i + 1);\\r\\n        }}\u003e+\u003c/button\u003e\\r\\n      \u003c/p\u003e\\r\\n    \u003c/\u003e\\r\\n  );\\r\\n}\\n\"}]}],[\"$r\",\"pre\",null,{\"children\":[\"$r\",\"code\",null,{\"className\":\"language-css\",\"children\":\"button { margin: 10px; }\\n\"}]}]]}],[\"$r\",\"p\",null,{\"children\":[\"比方说，你想“只在 mount 时”运行 Effect。你已经知道可以通过设置 \",[\"$r\",\"a\",null,{\"href\":\"/learn/lifecycle-of-reactive-effects#what-an-effect-with-empty-dependencies-means\",\"children\":[\"空（\",[\"$r\",\"code\",null,{\"children\":\"[]\"}],\"）依赖\"]}],\" 来达到这种效果，所以你决定忽略 linter 的检查，强行指定 \",[\"$r\",\"code\",null,{\"children\":\"[]\"}],\" 为依赖。\"]}],[\"$r\",\"p\",null,{\"children\":[\"上面的计数器例子，本应该每秒递增，递增量可以通过两个按钮来控制。然而，由于你对 React “撒谎”，说这个 Effect 不依赖于任何东西，React 便一直使用初次渲染时的 \",[\"$r\",\"code\",null,{\"children\":\"onTick\"}],\" 函数。\",[\"$r\",\"a\",null,{\"href\":\"/learn/state-as-a-snapshot#rendering-takes-a-snapshot-in-time\",\"children\":\"在后续渲染中\"}],\"， \",[\"$r\",\"code\",null,{\"children\":\"count\"}],\" 总是 \",[\"$r\",\"code\",null,{\"children\":\"0\"}],\" ，\",[\"$r\",\"code\",null,{\"children\":\"increment\"}],\" 总是 \",[\"$r\",\"code\",null,{\"children\":\"1\"}],\"。为什么？因为定时器每秒调用 \",[\"$r\",\"code\",null,{\"children\":\"onTick\"}],\" 函数，实际运行的是 \",[\"$r\",\"code\",null,{\"children\":\"setCount(0 + 1)\"}],[\"$r\",\"sup\",null,{\"children\":[\"$r\",\"a\",null,{\"href\":\"#note1\",\"children\":\"[1]\"}]}],\"，所以你总是看到 \",[\"$r\",\"code\",null,{\"children\":\"1\"}],\"。像这样的错误，当它们分散在多个组件中时，就更难解决了。\"]}],[\"$r\",\"p\",null,{\"children\":[\"这里有一个比忽略 linter 更好的解决方案! 那便是将 \",[\"$r\",\"code\",null,{\"children\":\"onTick\"}],\" 添加到依赖中。(为了确保 interval 只设置一次，\",[\"$r\",\"a\",null,{\"href\":\"/learn/separating-events-from-effects#reading-latest-props-and-state-with-effect-events\",\"children\":[\"使 \",[\"$r\",\"code\",null,{\"children\":\"onTick\"}],\" 成为 Effect Event\"]}],\"。)\"]}],[\"$r\",\"p\",null,{\"children\":[[\"$r\",\"strong\",null,{\"children\":\"我们建议将依赖性 lint 错误作为一个编译错误来处理。如果你不抑制它，你将永远不会遇到像上面这样的错误\"}],\"。本页面的剩下部分将介绍这个和其他情况的替代方案。\"]}]]}],\"\\n\",[\"$r\",\"h2\",null,{\"id\":\"removing-unnecessary-dependencies\",\"children\":\"移除非必需的依赖 \"}],\"\\n\",[\"$r\",\"p\",null,{\"children\":\"每当你调整 Effect 的依赖以适配代码时，请注意一下当前的依赖。当这些依赖发生变化时，让 Effect 重新运行是否有意义？有时，答案是“不”：\"}],\"\\n\",[\"$r\",\"ul\",null,{\"children\":[\"\\n\",[\"$r\",\"li\",null,{\"children\":[\"你可能想在不同的条件下重新执行 Effect 的 \",[\"$r\",\"strong\",null,{\"children\":\"不同部分\"}],\"。\"]}],\"\\n\",[\"$r\",\"li\",null,{\"children\":[\"你可能想只读取某个依赖的 \",[\"$r\",\"strong\",null,{\"children\":\"最新值\"}],\"，而不是对其变化做出“反应”。\"]}],\"\\n\",[\"$r\",\"li\",null,{\"children\":[\"依赖可能会因为它的类型是对象或函数而 \",[\"$r\",\"strong\",null,{\"children\":\"无意间\"}],\" 改变太频繁。\"]}],\"\\n\"]}],\"\\n\",[\"$r\",\"p\",null,{\"children\":\"为了找到正确的解决方案，你需要回答关于 Effect 的几个问题。让我们来看看这些问题。\"}],\"\\n\",[\"$r\",\"h3\",null,{\"id\":\"should-this-code-move-to-an-event-handler\",\"children\":\"这段代码应该移到事件处理程序中吗？ \"}],\"\\n\",[\"$r\",\"p\",null,{\"children\":\"你应该考虑的第一件事是，这段代码是否应该成为 Effect。\"}],\"\\n\",[\"$r\",\"p\",null,{\"children\":[\"想象一个表单，在提交时你将 \",[\"$r\",\"code\",null,{\"children\":\"submitted\"}],\" 状态变量设置为 \",[\"$r\",\"code\",null,{\"children\":\"true\"}],\"，并在 \",[\"$r\",\"code\",null,{\"children\":\"submitted\"}],\" 为 \",[\"$r\",\"code\",null,{\"children\":\"true\"}],\" 时，需要发送 POST 请求并显示通知。你把这个逻辑放在 Effect 内，并根据 \",[\"$r\",\"code\",null,{\"children\":\"submitted\"}],\" 为 \",[\"$r\",\"code\",null,{\"children\":\"true\"}],\" “反应”。\"]}],\"\\n\",[\"$r\",\"pre\",null,{\"children\":[\"$r\",\"code\",null,{\"className\":\"language-js\",\"meta\":\"{6-8}\",\"children\":\"function Form() {\\r\\n  const [submitted, setSubmitted] = useState(false);\\r\\n\\r\\n  useEffect(() =\u003e {\\r\\n    if (submitted) {\\r\\n      // 🔴 避免: Effect 中有特定事件的逻辑\\r\\n      post('/api/register');\\r\\n      showNotification('Successfully registered!');\\r\\n    }\\r\\n  }, [submitted]);\\r\\n\\r\\n  function handleSubmit() {\\r\\n    setSubmitted(true);\\r\\n  }\\r\\n\\r\\n  // ...\\r\\n}\\n\"}]}],\"\\n\",[\"$r\",\"p\",null,{\"children\":[\"后来，你想通过读取当前的主题值来调整通知信息的样式。因为 \",[\"$r\",\"code\",null,{\"children\":\"theme\"}],\" 是在组件中声明的，所以它是响应式值，你决定把它作为依赖加入：\"]}],\"\\n\",[\"$r\",\"pre\",null,{\"children\":[\"$r\",\"code\",null,{\"className\":\"language-js\",\"meta\":\"{3,9,11}\",\"children\":\"function Form() {\\r\\n  const [submitted, setSubmitted] = useState(false);\\r\\n  const theme = useContext(ThemeContext);\\r\\n\\r\\n  useEffect(() =\u003e {\\r\\n    if (submitted) {\\r\\n      // 🔴 避免: Effect 中有特定事件的逻辑\\r\\n      post('/api/register');\\r\\n      showNotification('Successfully registered!', theme);\\r\\n    }\\r\\n  }, [submitted, theme]); // ✅ 所有依赖已声明\\r\\n\\r\\n  function handleSubmit() {\\r\\n    setSubmitted(true);\\r\\n  }  \\r\\n\\r\\n  // ...\\r\\n}\\n\"}]}],\"\\n\",[\"$r\",\"p\",null,{\"children\":[\"如果这么做，你将引入一个错误。想象一下，你先提交表单，然后切换暗亮主题。当 \",[\"$r\",\"code\",null,{\"children\":\"theme\"}],\" 改变后，Effect 重新运行，这将导致显示两次相同的通知！\"]}],\"\\n\",[\"$r\",\"p\",null,{\"children\":[[\"$r\",\"strong\",null,{\"children\":\"首先，这里的问题是，代码不应该以 Effect 实现\"}],\"。你想发送这个 POST 请求，并在 \",[\"$r\",\"strong\",null,{\"children\":\"提交表单时显示通知\"}],\"，这是一个特定的交互。特定的交互请将该逻辑直接放到相应的事件处理程序中：\"]}],\"\\n\",[\"$r\",\"pre\",null,{\"children\":[\"$r\",\"code\",null,{\"className\":\"language-js\",\"meta\":\"{6-7}\",\"children\":\"function Form() {\\r\\n  const theme = useContext(ThemeContext);\\r\\n\\r\\n  function handleSubmit() {\\r\\n    // ✅ 好：从事件处理程序调用特定于事件的逻辑\\r\\n    post('/api/register');\\r\\n    showNotification('Successfully registered!', theme);\\r\\n  }  \\r\\n\\r\\n  // ...\\r\\n}\\n\"}]}],\"\\n\",[\"$r\",\"p\",null,{\"children\":[\"现在，代码在事件处理程序中，它不是响应式的 —— 所以它只在用户提交表单时运行。阅读更多关于 \",[\"$r\",\"a\",null,{\"href\":\"/learn/separating-events-from-effects#reactive-values-and-reactive-logic\",\"children\":\"在事件处理程序和 Effect 之间做出选择\"}],\" 和 \",[\"$r\",\"a\",null,{\"href\":\"/learn/you-might-not-need-an-effect\",\"children\":\"如何删除不必要的 Effect\"}],\"。\"]}],\"\\n\",[\"$r\",\"h3\",null,{\"id\":\"is-your-effect-doing-several-unrelated-things\",\"children\":\"Effect 是否在做几件不相关的事情？ \"}],\"\\n\",[\"$r\",\"p\",null,{\"children\":\"下一个应该问自己的问题是，Effect 是否在做几件不相关的事情。\"}],\"\\n\",[\"$r\",\"p\",null,{\"children\":\"如下例子，你正在实现运输表单，用户需要选择他们的城市和地区。你根据所选的“国家”从服务器上获取“城市”列表，然后在下拉菜单中显示：\"}],\"\\n\",[\"$r\",\"pre\",null,{\"children\":[\"$r\",\"code\",null,{\"className\":\"language-js\",\"children\":\"function ShippingForm({ country }) {\\r\\n  const [cities, setCities] = useState(null);\\r\\n  const [city, setCity] = useState(null);\\r\\n\\r\\n  useEffect(() =\u003e {\\r\\n    let ignore = false;\\r\\n    fetch(`/api/cities?country=${country}`)\\r\\n      .then(response =\u003e response.json())\\r\\n      .then(json =\u003e {\\r\\n        if (!ignore) {\\r\\n          setCities(json);\\r\\n        }\\r\\n      });\\r\\n    return () =\u003e {\\r\\n      ignore = true;\\r\\n    };\\r\\n  }, [country]); // ✅ 所有依赖已声明\\r\\n\\r\\n  // ...\\n\"}]}],\"\\n\",[\"$r\",\"p\",null,{\"children\":[\"这是一个 \",[\"$r\",\"a\",null,{\"href\":\"/learn/you-might-not-need-an-effect#fetching-data\",\"children\":\"在Effect中获取数据\"}],\" 的好例子：\",[\"$r\",\"code\",null,{\"children\":\"cities\"}],\" state 通过网络和 \",[\"$r\",\"code\",null,{\"children\":\"country\"}],\" props 进行“同步”。但你不能在事件处理程序中这样做，因为你需要在 \",[\"$r\",\"code\",null,{\"children\":\"ShippingForm\"}],\" 显示时和 \",[\"$r\",\"code\",null,{\"children\":\"country\"}],\" 发生变化时（不管是哪个交互导致的）立即获取。\"]}],\"\\n\",[\"$r\",\"p\",null,{\"children\":[\"现在我们假设你要为城市区域添加第二个选择框，它应该获取当前选择的 \",[\"$r\",\"code\",null,{\"children\":\"city\"}],\" 的 \",[\"$r\",\"code\",null,{\"children\":\"areas\"}],\"。你也许会在同一个 Effect 中添加第二个 \",[\"$r\",\"code\",null,{\"children\":\"fetch\"}],\" 调用来获取地区列表：\"]}],\"\\n\",[\"$r\",\"pre\",null,{\"children\":[\"$r\",\"code\",null,{\"className\":\"language-js\",\"meta\":\"{15-24,28}\",\"children\":\"function ShippingForm({ country }) {\\r\\n  const [cities, setCities] = useState(null);\\r\\n  const [city, setCity] = useState(null);\\r\\n  const [areas, setAreas] = useState(null);\\r\\n\\r\\n  useEffect(() =\u003e {\\r\\n    let ignore = false;\\r\\n    fetch(`/api/cities?country=${country}`)\\r\\n      .then(response =\u003e response.json())\\r\\n      .then(json =\u003e {\\r\\n        if (!ignore) {\\r\\n          setCities(json);\\r\\n        }\\r\\n      });\\r\\n    // 🔴 避免: 单个 Effect 同步两个独立逻辑处理\\r\\n    if (city) {\\r\\n      fetch(`/api/areas?city=${city}`)\\r\\n        .then(response =\u003e response.json())\\r\\n        .then(json =\u003e {\\r\\n          if (!ignore) {\\r\\n            setAreas(json);\\r\\n          }\\r\\n        });\\r\\n    }\\r\\n    return () =\u003e {\\r\\n      ignore = true;\\r\\n    };\\r\\n  }, [country, city]); // ✅ 所有依赖已声明\\r\\n\\r\\n  // ...\\n\"}]}],\"\\n\",[\"$r\",\"p\",null,{\"children\":[\"然而，由于 Effect 现在使用 \",[\"$r\",\"code\",null,{\"children\":\"city\"}],\" state 变量，你不得不把 \",[\"$r\",\"code\",null,{\"children\":\"city\"}],\" 加入到依赖中。这又带来一个问题：当用户选择不同的城市时，Effect 将重新运行并调用 \",[\"$r\",\"code\",null,{\"children\":\"fetchCities(country)\"}],\"。这将导致不必要地多次获取城市列表。\"]}],\"\\n\",[\"$r\",\"p\",null,{\"children\":[[\"$r\",\"strong\",null,{\"children\":\"这段代码的问题在于，你在同步两个不同的、不相关的东西\"}],\"：\"]}],\"\\n\",[\"$r\",\"ol\",null,{\"children\":[\"\\n\",[\"$r\",\"li\",null,{\"children\":[\"你想要根据 \",[\"$r\",\"code\",null,{\"children\":\"country\"}],\" props 通过网络同步 \",[\"$r\",\"code\",null,{\"children\":\"city\"}],\" state\"]}],\"\\n\",[\"$r\",\"li\",null,{\"children\":[\"你想要根据 \",[\"$r\",\"code\",null,{\"children\":\"city\"}],\" 状态通过网络同步 \",[\"$r\",\"code\",null,{\"children\":\"areas\"}],\" state\"]}],\"\\n\"]}],\"\\n\",[\"$r\",\"p\",null,{\"children\":\"将逻辑分到 2 个 Effect 中，每个 Effect 仅响应其需要同步响应的 props：\"}],\"\\n\",[\"$r\",\"pre\",null,{\"children\":[\"$r\",\"code\",null,{\"className\":\"language-js\",\"meta\":\"{19-33}\",\"children\":\"function ShippingForm({ country }) {\\r\\n  const [cities, setCities] = useState(null);\\r\\n  useEffect(() =\u003e {\\r\\n    let ignore = false;\\r\\n    fetch(`/api/cities?country=${country}`)\\r\\n      .then(response =\u003e response.json())\\r\\n      .then(json =\u003e {\\r\\n        if (!ignore) {\\r\\n          setCities(json);\\r\\n        }\\r\\n      });\\r\\n    return () =\u003e {\\r\\n      ignore = true;\\r\\n    };\\r\\n  }, [country]); // ✅ 所有依赖已声明\\r\\n\\r\\n  const [city, setCity] = useState(null);\\r\\n  const [areas, setAreas] = useState(null);\\r\\n  useEffect(() =\u003e {\\r\\n    if (city) {\\r\\n      let ignore = false;\\r\\n      fetch(`/api/areas?city=${city}`)\\r\\n        .then(response =\u003e response.json())\\r\\n        .then(json =\u003e {\\r\\n          if (!ignore) {\\r\\n            setAreas(json);\\r\\n          }\\r\\n        });\\r\\n      return () =\u003e {\\r\\n        ignore = true;\\r\\n      };\\r\\n    }\\r\\n  }, [city]); // ✅ 所有依赖已声明\\r\\n\\r\\n  // ...\\n\"}]}],\"\\n\",[\"$r\",\"p\",null,{\"children\":[\"现在，第一个 Effect 只在 \",[\"$r\",\"code\",null,{\"children\":\"country\"}],\" 改变时重新运行，而第二个 Effect 在 \",[\"$r\",\"code\",null,{\"children\":\"city\"}],\" 改变时重新运行。你已经按目的把它们分开了：两件不同的事情由两个独立的 Effect 来同步。两个独立的 Effect 有两个独立的依赖，所以它们不会在无意中相互触发。\"]}],\"\\n\",[\"$r\",\"p\",null,{\"children\":[\"最终完成的代码比最初的要长，但是拆分这些 Effect 是非常正确的。\",[\"$r\",\"a\",null,{\"href\":\"/learn/lifecycle-of-reactive-effects#each-effect-represents-a-separate-synchronization-process\",\"children\":\"每个 Effect 应该代表一个独立的同步过程\"}],\"。在这个例子中，删除一个 Effect 并不会影响到另一个 Effect 的逻辑。这意味着他们 \",[\"$r\",\"strong\",null,{\"children\":\"同步不同的事情\"}],\"，分开他们处理是一件好事。如果你担心重复代码的问题，你可以通过 \",[\"$r\",\"a\",null,{\"href\":\"/learn/reusing-logic-with-custom-hooks#when-to-use-custom-hooks\",\"children\":\"提取相同逻辑到自定义 Hook\"}],\" 来提升代码质量\"]}],\"\\n\",[\"$r\",\"h3\",null,{\"id\":\"are-you-reading-some-state-to-calculate-the-next-state\",\"children\":\"是否在读取一些状态来计算下一个状态？ \"}],\"\\n\",[\"$r\",\"p\",null,{\"children\":[\"每次有新的消息到达时，这个 Effect 会用新创建的数组更新 \",[\"$r\",\"code\",null,{\"children\":\"messages\"}],\" state：\"]}],\"\\n\",[\"$r\",\"pre\",null,{\"children\":[\"$r\",\"code\",null,{\"className\":\"language-js\",\"meta\":\"{2,6-8}\",\"children\":\"function ChatRoom({ roomId }) {\\r\\n  const [messages, setMessages] = useState([]);\\r\\n  useEffect(() =\u003e {\\r\\n    const connection = createConnection();\\r\\n    connection.connect();\\r\\n    connection.on('message', (receivedMessage) =\u003e {\\r\\n      setMessages([...messages, receivedMessage]);\\r\\n    });\\r\\n    // ...\\n\"}]}],\"\\n\",[\"$r\",\"p\",null,{\"children\":[\"它使用 \",[\"$r\",\"code\",null,{\"children\":\"messages\"}],\" 变量来 \",[\"$r\",\"a\",null,{\"href\":\"/learn/updating-arrays-in-state\",\"children\":\"创建一个新的数组\"}],\"：从所有现有的消息开始，并在最后添加新的消息。然而，由于 \",[\"$r\",\"code\",null,{\"children\":\"messages\"}],\" 是一个由 Effect 读取的响应式值，它必须是一个依赖：\"]}],\"\\n\",[\"$r\",\"pre\",null,{\"children\":[\"$r\",\"code\",null,{\"className\":\"language-js\",\"meta\":\"{7,10}\",\"children\":\"function ChatRoom({ roomId }) {\\r\\n  const [messages, setMessages] = useState([]);\\r\\n  useEffect(() =\u003e {\\r\\n    const connection = createConnection();\\r\\n    connection.connect();\\r\\n    connection.on('message', (receivedMessage) =\u003e {\\r\\n      setMessages([...messages, receivedMessage]);\\r\\n    });\\r\\n    return () =\u003e connection.disconnect();\\r\\n  }, [roomId, messages]); // ✅ 所有依赖已声明\\r\\n  // ...\\n\"}]}],\"\\n\",[\"$r\",\"p\",null,{\"children\":[\"而让 \",[\"$r\",\"code\",null,{\"children\":\"messages\"}],\" 成为依赖会带来问题。\"]}],\"\\n\",[\"$r\",\"p\",null,{\"children\":[\"每当你收到一条消息，\",[\"$r\",\"code\",null,{\"children\":\"setMessages()\"}],\" 就会使该组件重新渲染一个新的 \",[\"$r\",\"code\",null,{\"children\":\"messages\"}],\" 数组，其中包括收到的消息。然而，由于该 Effect 现在依赖于 \",[\"$r\",\"code\",null,{\"children\":\"messages\"}],\"，这 \",[\"$r\",\"strong\",null,{\"children\":\"也将\"}],\" 重新同步该 Effect。所以每条新消息都会使聊天重新连接。用户不会喜欢这样！\"]}],\"\\n\",[\"$r\",\"p\",null,{\"children\":[\"为了解决这个问题，不要在 Effect 里面读取 \",[\"$r\",\"code\",null,{\"children\":\"messages\"}],\"。相反，应该将一个 \",[\"$r\",\"a\",null,{\"href\":\"/reference/react/useState#updating-state-based-the-previous-state\",\"children\":\"state 更新函数\"}],\" 传递给 \",[\"$r\",\"code\",null,{\"children\":\"setMessages\"}],\"：\"]}],\"\\n\",[\"$r\",\"pre\",null,{\"children\":[\"$r\",\"code\",null,{\"className\":\"language-js\",\"meta\":\"{7,10}\",\"children\":\"function ChatRoom({ roomId }) {\\r\\n  const [messages, setMessages] = useState([]);\\r\\n  useEffect(() =\u003e {\\r\\n    const connection = createConnection();\\r\\n    connection.connect();\\r\\n    connection.on('message', (receivedMessage) =\u003e {\\r\\n      setMessages(msgs =\u003e [...msgs, receivedMessage]);\\r\\n    });\\r\\n    return () =\u003e connection.disconnect();\\r\\n  }, [roomId]); // ✅ 所有依赖已声明\\r\\n  // ...\\n\"}]}],\"\\n\",[\"$r\",\"p\",null,{\"children\":[[\"$r\",\"strong\",null,{\"children\":[\"注意 Effect 现在根本不读取 \",[\"$r\",\"code\",null,{\"children\":\"messages\"}],\" 变量\"]}],\"。你只需要传递一个更新函数，比如 \",[\"$r\",\"code\",null,{\"children\":\"msgs =\u003e [...msgs, receivedMessage]\"}],\"。React \",[\"$r\",\"a\",null,{\"href\":\"/learn/queueing-a-series-of-state-updates\",\"children\":\"将更新程序函数放入队列\"}],\" 并将在下一次渲染期间向其提供 \",[\"$r\",\"code\",null,{\"children\":\"msgs\"}],\" 参数。这就是 Effect 本身不再需要依赖 \",[\"$r\",\"code\",null,{\"children\":\"messages\"}],\" 的原因。修复后，接收聊天消息将不再使聊天重新连接。\"]}],\"\\n\",[\"$r\",\"h3\",null,{\"id\":\"do-you-want-to-read-a-value-without-reacting-to-its-changes\",\"children\":\"你想读取一个值而不对其变化做出“反应”吗？ \"}],\"\\n\",[\"$r\",\"Wip\",null,{\"children\":[\"$r\",\"p\",null,{\"children\":[\"本节描述了一个在稳定版本的 React 中 \",[\"$r\",\"strong\",null,{\"children\":\"尚未发布的实验性\"}],\" API。\"]}]}],\"\\n\",[\"$r\",\"p\",null,{\"children\":[\"假设你希望在用户收到新消息时播放声音，\",[\"$r\",\"code\",null,{\"children\":\"isMuted\"}],\" 为 \",[\"$r\",\"code\",null,{\"children\":\"true\"}],\" 除外：\"]}],\"\\n\",[\"$r\",\"pre\",null,{\"children\":[\"$r\",\"code\",null,{\"className\":\"language-js\",\"meta\":\"{3,10-12}\",\"children\":\"function ChatRoom({ roomId }) {\\r\\n  const [messages, setMessages] = useState([]);\\r\\n  const [isMuted, setIsMuted] = useState(false);\\r\\n\\r\\n  useEffect(() =\u003e {\\r\\n    const connection = createConnection();\\r\\n    connection.connect();\\r\\n    connection.on('message', (receivedMessage) =\u003e {\\r\\n      setMessages(msgs =\u003e [...msgs, receivedMessage]);\\r\\n      if (!isMuted) {\\r\\n        playSound();\\r\\n      }\\r\\n    });\\r\\n    // ...\\n\"}]}],\"\\n\",[\"$r\",\"p\",null,{\"children\":[\"由于 Effect 现在在其代码中使用了 \",[\"$r\",\"code\",null,{\"children\":\"isMuted\"}],\" ，因此你必须将其添加到依赖中：\"]}],\"\\n\",[\"$r\",\"pre\",null,{\"children\":[\"$r\",\"code\",null,{\"className\":\"language-js\",\"meta\":\"{10,15}\",\"children\":\"function ChatRoom({ roomId }) {\\r\\n  const [messages, setMessages] = useState([]);\\r\\n  const [isMuted, setIsMuted] = useState(false);\\r\\n\\r\\n  useEffect(() =\u003e {\\r\\n    const connection = createConnection();\\r\\n    connection.connect();\\r\\n    connection.on('message', (receivedMessage) =\u003e {\\r\\n      setMessages(msgs =\u003e [...msgs, receivedMessage]);\\r\\n      if (!isMuted) {\\r\\n        playSound();\\r\\n      }\\r\\n    });\\r\\n    return () =\u003e connection.disconnect();\\r\\n  }, [roomId, isMuted]); // ✅ 所有依赖已声明\\r\\n  // ...\\n\"}]}],\"\\n\",[\"$r\",\"p\",null,{\"children\":[\"问题是每次 \",[\"$r\",\"code\",null,{\"children\":\"isMuted\"}],\" 改变时（例如，当用户按下“静音”开关时），Effect 将重新同步，并重新连接到聊天。这不是理想的用户体验！（在此示例中，即使禁用 linter 也不起作用——如果你这样做，\",[\"$r\",\"code\",null,{\"children\":\"isMuted\"}],\" 将“保持”其旧值。）\"]}],\"\\n\",[\"$r\",\"p\",null,{\"children\":[\"要解决这个问题，需要将不应该响应式的逻辑从 Effect 中抽取出来。你不希望此 Effect 对 \",[\"$r\",\"code\",null,{\"children\":\"isMuted\"}],\" 中的更改做出“反应”。\",[\"$r\",\"a\",null,{\"href\":\"/learn/separating-events-from-effects#declaring-an-effect-event\",\"children\":\"将这段非响应式逻辑移至 Effect Event 中\"}],\"：\"]}],\"\\n\",[\"$r\",\"pre\",null,{\"children\":[\"$r\",\"code\",null,{\"className\":\"language-js\",\"meta\":\"{1,7-12,18,21}\",\"children\":\"import { useState, useEffect, useEffectEvent } from 'react';\\r\\n\\r\\nfunction ChatRoom({ roomId }) {\\r\\n  const [messages, setMessages] = useState([]);\\r\\n  const [isMuted, setIsMuted] = useState(false);\\r\\n\\r\\n  const onMessage = useEffectEvent(receivedMessage =\u003e {\\r\\n    setMessages(msgs =\u003e [...msgs, receivedMessage]);\\r\\n    if (!isMuted) {\\r\\n      playSound();\\r\\n    }\\r\\n  });\\r\\n\\r\\n  useEffect(() =\u003e {\\r\\n    const connection = createConnection();\\r\\n    connection.connect();\\r\\n    connection.on('message', (receivedMessage) =\u003e {\\r\\n      onMessage(receivedMessage);\\r\\n    });\\r\\n    return () =\u003e connection.disconnect();\\r\\n  }, [roomId]); // ✅ 所有依赖已声明\\r\\n  // ...\\n\"}]}],\"\\n\",[\"$r\",\"p\",null,{\"children\":[\"Effect Events 让你可以将 Effect 分成响应式部分（应该“反应”响应式值，如 \",[\"$r\",\"code\",null,{\"children\":\"roomId\"}],\" 及其变化）和非响应式部分（只读取它们的最新值，如 \",[\"$r\",\"code\",null,{\"children\":\"onMessage\"}],\" 读取 \",[\"$r\",\"code\",null,{\"children\":\"isMuted\"}],\"）。\",[\"$r\",\"strong\",null,{\"children\":[\"现在你在 Effect Event 中读取了 \",[\"$r\",\"code\",null,{\"children\":\"isMuted\"}],\"，它不需要添加到 Effect 依赖中\"]}],\"。因此，当你打开或者关闭“静音”设置时，聊天不会重新连接。至此，解决原始问题！\"]}],\"\\n\",[\"$r\",\"h4\",null,{\"id\":\"wrapping-an-event-handler-from-the-props\",\"children\":\"包装来自 props 的事件处理程序 \"}],\"\\n\",[\"$r\",\"p\",null,{\"children\":\"当组件接收事件处理函数作为 props 时，你可能会遇到类似的问题：\"}],\"\\n\",[\"$r\",\"pre\",null,{\"children\":[\"$r\",\"code\",null,{\"className\":\"language-js\",\"meta\":\"{1,8,11}\",\"children\":\"function ChatRoom({ roomId, onReceiveMessage }) {\\r\\n  const [messages, setMessages] = useState([]);\\r\\n\\r\\n  useEffect(() =\u003e {\\r\\n    const connection = createConnection();\\r\\n    connection.connect();\\r\\n    connection.on('message', (receivedMessage) =\u003e {\\r\\n      onReceiveMessage(receivedMessage);\\r\\n    });\\r\\n    return () =\u003e connection.disconnect();\\r\\n  }, [roomId, onReceiveMessage]); // ✅ 所有依赖已声明\\r\\n  // ...\\n\"}]}],\"\\n\",[\"$r\",\"p\",null,{\"children\":[\"假设父组件在每次渲染时都传递了一个 \",[\"$r\",\"strong\",null,{\"children\":\"不同的\"}],\" \",[\"$r\",\"code\",null,{\"children\":\"onReceiveMessage\"}],\" 函数：\"]}],\"\\n\",[\"$r\",\"pre\",null,{\"children\":[\"$r\",\"code\",null,{\"className\":\"language-js\",\"meta\":\"{3-5}\",\"children\":\"\u003cChatRoom\\r\\n  roomId={roomId}\\r\\n  onReceiveMessage={receivedMessage =\u003e {\\r\\n    // ...\\r\\n  }}\\r\\n/\u003e\\n\"}]}],\"\\n\",[\"$r\",\"p\",null,{\"children\":[\"由于 \",[\"$r\",\"code\",null,{\"children\":\"onReceiveMessage\"}],\" 是依赖，它会导致 Effect 在每次父级重新渲染后重新同步。这将导致聊天重新连接。要解决此问题，请用 Effect Event 包裹之后再调用：\"]}],\"\\n\",[\"$r\",\"pre\",null,{\"children\":[\"$r\",\"code\",null,{\"className\":\"language-js\",\"meta\":\"{4-6,12,15}\",\"children\":\"function ChatRoom({ roomId, onReceiveMessage }) {\\r\\n  const [messages, setMessages] = useState([]);\\r\\n\\r\\n  const onMessage = useEffectEvent(receivedMessage =\u003e {\\r\\n    onReceiveMessage(receivedMessage);\\r\\n  });\\r\\n\\r\\n  useEffect(() =\u003e {\\r\\n    const connection = createConnection();\\r\\n    connection.connect();\\r\\n    connection.on('message', (receivedMessage) =\u003e {\\r\\n      onMessage(receivedMessage);\\r\\n    });\\r\\n    return () =\u003e connection.disconnect();\\r\\n  }, [roomId]); // ✅ 所有依赖已声明\\r\\n  // ...\\n\"}]}],\"\\n\",[\"$r\",\"p\",null,{\"children\":\"Effect Events 不是响应式的，因此你不需要将它们指定为依赖。因此，即使父组件传递的函数在每次重新渲染时都不同，聊天也将不再重新连接。\"}],\"\\n\",[\"$r\",\"h4\",null,{\"id\":\"separating-reactive-and-non-reactive-code\",\"children\":\"分离响应式和非响应式代码 \"}],\"\\n\",[\"$r\",\"p\",null,{\"children\":[\"在此示例中，你希望在每次 \",[\"$r\",\"code\",null,{\"children\":\"roomId\"}],\" 更改时记录一次。你希望在每个日志中包含当前的 \",[\"$r\",\"code\",null,{\"children\":\"notificationCount\"}],\"，但你 \",[\"$r\",\"strong\",null,{\"children\":\"不\"}],\" 希望通过更改 \",[\"$r\",\"code\",null,{\"children\":\"notificationCount\"}],\" 来触发日志事件。\"]}],\"\\n\",[\"$r\",\"p\",null,{\"children\":\"解决方案还是将非响应式代码拆分，将其放到 Effect Event 内：\"}],\"\\n\",[\"$r\",\"pre\",null,{\"children\":[\"$r\",\"code\",null,{\"className\":\"language-js\",\"meta\":\"{2-4,7}\",\"children\":\"function Chat({ roomId, notificationCount }) {\\r\\n  const onVisit = useEffectEvent(visitedRoomId =\u003e {\\r\\n    logVisit(visitedRoomId, notificationCount);\\r\\n  });\\r\\n\\r\\n  useEffect(() =\u003e {\\r\\n    onVisit(roomId);\\r\\n  }, [roomId]); // ✅ 所有依赖已声明\\r\\n  // ...\\r\\n}\\n\"}]}],\"\\n\",[\"$r\",\"p\",null,{\"children\":[\"你希望逻辑对 \",[\"$r\",\"code\",null,{\"children\":\"roomId\"}],\" 做出响应，因此你在 Effect 中读取 \",[\"$r\",\"code\",null,{\"children\":\"roomId\"}],\"。但是，你不希望更改 \",[\"$r\",\"code\",null,{\"children\":\"notificationCount\"}],\" 来记录额外的日志输出，因此你可以在 Effect Event 中读取 \",[\"$r\",\"code\",null,{\"children\":\"notificationCount\"}],\"。\",[\"$r\",\"a\",null,{\"href\":\"/learn/separating-events-from-effects#reading-latest-props-and-state-with-effect-events\",\"children\":\"了解使用 Effect Events 在 Effect 中读取最新 props 和 state 的更多信息\"}],\"。\"]}],\"\\n\",[\"$r\",\"h3\",null,{\"id\":\"does-some-reactive-value-change-unintentionally\",\"children\":\"一些响应式值是否无意中改变了？ \"}],\"\\n\",[\"$r\",\"p\",null,{\"children\":[\"有时，你 \",[\"$r\",\"strong\",null,{\"children\":\"确实\"}],\" 希望 Effect 对某个值“做出反应”，但该值的变化比你希望的更频繁——并且可能不会从用户的角度反映任何实际变化。例如，假设你在组件中创建了 \",[\"$r\",\"code\",null,{\"children\":\"options\"}],\" 对象，然后从 Effect 内部读取该对象：\"]}],\"\\n\",[\"$r\",\"pre\",null,{\"children\":[\"$r\",\"code\",null,{\"className\":\"language-js\",\"meta\":\"{3-6,9}\",\"children\":\"function ChatRoom({ roomId }) {\\r\\n  // ...\\r\\n  const options = {\\r\\n    serverUrl: serverUrl,\\r\\n    roomId: roomId\\r\\n  };\\r\\n\\r\\n  useEffect(() =\u003e {\\r\\n    const connection = createConnection(options);\\r\\n    connection.connect();\\r\\n    // ...\\n\"}]}],\"\\n\",[\"$r\",\"p\",null,{\"children\":[\"该对象在组件中声明，因此它是 \",[\"$r\",\"a\",null,{\"href\":\"/learn/lifecycle-of-reactive-effects#effects-react-to-reactive-values\",\"children\":\"响应式值\"}],\"。当你在 Effect 中读取这样的响应式值时，你将其声明为依赖。这可确保 Effect 对其更改做出“反应”：\"]}],\"\\n\",[\"$r\",\"pre\",null,{\"children\":[\"$r\",\"code\",null,{\"className\":\"language-js\",\"meta\":\"{3,6}\",\"children\":\"  // ...\\r\\n  useEffect(() =\u003e {\\r\\n    const connection = createConnection(options);\\r\\n    connection.connect();\\r\\n    return () =\u003e connection.disconnect();\\r\\n  }, [options]); // ✅ 所有依赖已声明\\r\\n  // ...\\n\"}]}],\"\\n\",[\"$r\",\"p\",null,{\"children\":[\"将其声明为依赖很重要！例如，这可以确保如果 \",[\"$r\",\"code\",null,{\"children\":\"roomId\"}],\" 发生变化，Effect 将使用新的 \",[\"$r\",\"code\",null,{\"children\":\"options\"}],\" 重新连接到聊天。但是，上面的代码也有问题。要查看它，请尝试在下面的沙盒中输入内容，然后观察控制台中发生的情况：\"]}],\"\\n\"]}],[\"$r\",\"Sandpack\",null,{\"children\":[[\"$r\",\"pre\",null,{\"children\":[\"$r\",\"code\",null,{\"className\":\"language-js\",\"children\":\"import { useState, useEffect } from 'react';\\r\\nimport { createConnection } from './chat.js';\\r\\n\\r\\nconst serverUrl = 'https://localhost:1234';\\r\\n\\r\\nfunction ChatRoom({ roomId }) {\\r\\n  const [message, setMessage] = useState('');\\r\\n\\r\\n  // 暂时禁用 linter 以演示问题\\r\\n  // eslint-disable-next-line react-hooks/exhaustive-deps\\r\\n  const options = {\\r\\n    serverUrl: serverUrl,\\r\\n    roomId: roomId\\r\\n  };\\r\\n\\r\\n  useEffect(() =\u003e {\\r\\n    const connection = createConnection(options);\\r\\n    connection.connect();\\r\\n    return () =\u003e connection.disconnect();\\r\\n  }, [options]);\\r\\n\\r\\n  return (\\r\\n    \u003c\u003e\\r\\n      \u003ch1\u003e欢迎来到 {roomId} 房间！\u003c/h1\u003e\\r\\n      \u003cinput value={message} onChange={e =\u003e setMessage(e.target.value)} /\u003e\\r\\n    \u003c/\u003e\\r\\n  );\\r\\n}\\r\\n\\r\\nexport default function App() {\\r\\n  const [roomId, setRoomId] = useState('所有');\\r\\n  return (\\r\\n    \u003c\u003e\\r\\n      \u003clabel\u003e\\r\\n        选择聊天室：\\r\\n        \u003cselect\\r\\n          value={roomId}\\r\\n          onChange={e =\u003e setRoomId(e.target.value)}\\r\\n        \u003e\\r\\n          \u003coption value=\\\"所有\\\"\u003e所有\u003c/option\u003e\\r\\n          \u003coption value=\\\"旅游\\\"\u003e旅游\u003c/option\u003e\\r\\n          \u003coption value=\\\"音乐\\\"\u003e音乐\u003c/option\u003e\\r\\n        \u003c/select\u003e\\r\\n      \u003c/label\u003e\\r\\n      \u003chr /\u003e\\r\\n      \u003cChatRoom roomId={roomId} /\u003e\\r\\n    \u003c/\u003e\\r\\n  );\\r\\n}\\n\"}]}],[\"$r\",\"pre\",null,{\"children\":[\"$r\",\"code\",null,{\"className\":\"language-js\",\"meta\":\"src/chat.js\",\"children\":\"export function createConnection({ serverUrl, roomId }) {\\r\\n  // 真正的实现实际上会连接到服务器\\r\\n  return {\\r\\n    connect() {\\r\\n      console.log('✅ 连接到“' + roomId + '”房间，在 ' + serverUrl + '...');\\r\\n    },\\r\\n    disconnect() {\\r\\n      console.log('❌ 断开“' + roomId + '”房间，在 ' + serverUrl);\\r\\n    }\\r\\n  };\\r\\n}\\n\"}]}],[\"$r\",\"pre\",null,{\"children\":[\"$r\",\"code\",null,{\"className\":\"language-css\",\"children\":\"input { display: block; margin-bottom: 20px; }\\r\\nbutton { margin-left: 10px; }\\n\"}]}]]}],[\"$r\",\"MaxWidth\",\"232\",{\"children\":[\"\\n\",[\"$r\",\"p\",null,{\"children\":[\"在上面的沙箱中，输入仅更新 \",[\"$r\",\"code\",null,{\"children\":\"message\"}],\" 状态变量。从用户的角度来看，这不应该影响聊天连接。但是，每次更新 \",[\"$r\",\"code\",null,{\"children\":\"message\"}],\" 时，组件都会重新渲染。当组件重新渲染时，其中的代码会从头开始重新运行。\"]}],\"\\n\",[\"$r\",\"p\",null,{\"children\":[\"在每次重新渲染 \",[\"$r\",\"code\",null,{\"children\":\"ChatRoom\"}],\" 组件时，都会从头开始创建一个新的 \",[\"$r\",\"code\",null,{\"children\":\"options\"}],\" 对象。React 发现 \",[\"$r\",\"code\",null,{\"children\":\"options\"}],\" 对象与上次渲染期间创建的 \",[\"$r\",\"code\",null,{\"children\":\"options\"}],\" 对象是 \",[\"$r\",\"strong\",null,{\"children\":\"不同的对象\"}],\"。这就是为什么它会重新同步 Effect（依赖于 \",[\"$r\",\"code\",null,{\"children\":\"options\"}],\"），并且会在你输入时重新连接聊天。\"]}],\"\\n\",[\"$r\",\"p\",null,{\"children\":[[\"$r\",\"strong\",null,{\"children\":\"此问题仅影响对象和函数。在 JavaScript 中，每个新创建的对象和函数都被认为与其他所有对象和函数不同。即使他们的值相同也没关系\"}],\"！\"]}],\"\\n\",[\"$r\",\"pre\",null,{\"children\":[\"$r\",\"code\",null,{\"className\":\"language-js\",\"meta\":\"{7-8}\",\"children\":\"// 第一次渲染\\r\\nconst options1 = { serverUrl: 'https://localhost:1234', roomId: '音乐' };\\r\\n\\r\\n// 下一次渲染\\r\\nconst options2 = { serverUrl: 'https://localhost:1234', roomId: '音乐' };\\r\\n\\r\\n// 这是 2 个不同的对象\\r\\nconsole.log(Object.is(options1, options2)); // false\\n\"}]}],\"\\n\",[\"$r\",\"p\",null,{\"children\":[[\"$r\",\"strong\",null,{\"children\":\"对象和函数作为依赖，会使 Effect 比你需要的更频繁地重新同步\"}],\"。\"]}],\"\\n\",[\"$r\",\"p\",null,{\"children\":\"这就是为什么你应该尽可能避免将对象和函数作为 Effect 的依赖。所以，尝试将它们移到组件外部、Effect 内部，或从中提取原始值。\"}],\"\\n\",[\"$r\",\"h4\",null,{\"id\":\"move-static-objects-and-functions-outside-your-component\",\"children\":\"将静态对象和函数移出组件 \"}],\"\\n\",[\"$r\",\"p\",null,{\"children\":\"如果该对象不依赖于任何 props 和 state，你可以将该对象移到组件之外：\"}],\"\\n\",[\"$r\",\"pre\",null,{\"children\":[\"$r\",\"code\",null,{\"className\":\"language-js\",\"meta\":\"{1-4,13}\",\"children\":\"const options = {\\r\\n  serverUrl: 'https://localhost:1234',\\r\\n  roomId: '音乐'\\r\\n};\\r\\n\\r\\nfunction ChatRoom() {\\r\\n  const [message, setMessage] = useState('');\\r\\n\\r\\n  useEffect(() =\u003e {\\r\\n    const connection = createConnection(options);\\r\\n    connection.connect();\\r\\n    return () =\u003e connection.disconnect();\\r\\n  }, []); // ✅ 所有依赖已声明\\r\\n  // ...\\n\"}]}],\"\\n\",[\"$r\",\"p\",null,{\"children\":[\"这样，你向 linter \",[\"$r\",\"strong\",null,{\"children\":\"证明\"}],\" 它不是响应式的。它不会因为重新渲染而改变，所以它不是依赖。现在重新渲染 \",[\"$r\",\"code\",null,{\"children\":\"ChatRoom\"}],\" 不会导致 Effect 重新同步。\"]}],\"\\n\",[\"$r\",\"p\",null,{\"children\":\"这也适用于函数场景：\"}],\"\\n\",[\"$r\",\"pre\",null,{\"children\":[\"$r\",\"code\",null,{\"className\":\"language-js\",\"meta\":\"{1-6,12}\",\"children\":\"function createOptions() {\\r\\n  return {\\r\\n    serverUrl: 'https://localhost:1234',\\r\\n    roomId: '音乐'\\r\\n  };\\r\\n}\\r\\n\\r\\nfunction ChatRoom() {\\r\\n  const [message, setMessage] = useState('');\\r\\n\\r\\n  useEffect(() =\u003e {\\r\\n    const options = createOptions();\\r\\n    const connection = createConnection(options);\\r\\n    connection.connect();\\r\\n    return () =\u003e connection.disconnect();\\r\\n  }, []); // ✅ 所有依赖已声明\\r\\n  // ...\\n\"}]}],\"\\n\",[\"$r\",\"p\",null,{\"children\":[\"由于 \",[\"$r\",\"code\",null,{\"children\":\"createOptions\"}],\" 是在组件外部声明的，因此它不是响应式值。这就是为什么它不需要在 Effect 的依赖中指定，以及为什么它永远不会导致 Effect 重新同步。\"]}],\"\\n\",[\"$r\",\"h4\",null,{\"id\":\"move-dynamic-objects-and-functions-inside-your-effect\",\"children\":\"将动态对象和函数移动到 Effect 中 \"}],\"\\n\",[\"$r\",\"p\",null,{\"children\":[\"如果对象依赖于一些可能因重新渲染而改变的响应式值，例如 \",[\"$r\",\"code\",null,{\"children\":\"roomId\"}],\" props，那么你不能将它放置于组件 \",[\"$r\",\"strong\",null,{\"children\":\"外部\"}],\"。你可以在 Effect \",[\"$r\",\"strong\",null,{\"children\":\"内部\"}],\" 创建它：\"]}],\"\\n\",[\"$r\",\"pre\",null,{\"children\":[\"$r\",\"code\",null,{\"className\":\"language-js\",\"meta\":\"{7-10,11,14}\",\"children\":\"const serverUrl = 'https://localhost:1234';\\r\\n\\r\\nfunction ChatRoom({ roomId }) {\\r\\n  const [message, setMessage] = useState('');\\r\\n\\r\\n  useEffect(() =\u003e {\\r\\n    const options = {\\r\\n      serverUrl: serverUrl,\\r\\n      roomId: roomId\\r\\n    };\\r\\n    const connection = createConnection(options);\\r\\n    connection.connect();\\r\\n    return () =\u003e connection.disconnect();\\r\\n  }, [roomId]); // ✅ 所有依赖已声明\\r\\n  // ...\\n\"}]}],\"\\n\",[\"$r\",\"p\",null,{\"children\":[\"现在 \",[\"$r\",\"code\",null,{\"children\":\"options\"}],\" 已在 Effect 中声明，它不再是 Effect 的依赖。相反，Effect 使用的唯一响应式值是 \",[\"$r\",\"code\",null,{\"children\":\"roomId\"}],\"。由于 \",[\"$r\",\"code\",null,{\"children\":\"roomId\"}],\" 不是对象或函数，你可以确定它不会 \",[\"$r\",\"strong\",null,{\"children\":\"无意间\"}],\" 变不同。在 JavaScript 中，数字和字符串根据它们的内容进行比较：\"]}],\"\\n\",[\"$r\",\"pre\",null,{\"children\":[\"$r\",\"code\",null,{\"className\":\"language-js\",\"meta\":\"{7-8}\",\"children\":\"// 第一次渲染\\r\\nconst roomId1 = '音乐';\\r\\n\\r\\n// 下一次渲染\\r\\nconst roomId2 = '音乐';\\r\\n\\r\\n// 这 2 个字符串是相同的\\r\\nconsole.log(Object.is(roomId1, roomId2)); // true\\n\"}]}],\"\\n\",[\"$r\",\"p\",null,{\"children\":\"得益于此修复，当你编辑输入时，聊天将不再重新连接：\"}],\"\\n\"]}],[\"$r\",\"Sandpack\",null,{\"children\":[[\"$r\",\"pre\",null,{\"children\":[\"$r\",\"code\",null,{\"className\":\"language-js\",\"children\":\"import { useState, useEffect } from 'react';\\r\\nimport { createConnection } from './chat.js';\\r\\n\\r\\nconst serverUrl = 'https://localhost:1234';\\r\\n\\r\\nfunction ChatRoom({ roomId }) {\\r\\n  const [message, setMessage] = useState('');\\r\\n\\r\\n  useEffect(() =\u003e {\\r\\n    const options = {\\r\\n      serverUrl: serverUrl,\\r\\n      roomId: roomId\\r\\n    };\\r\\n    const connection = createConnection(options);\\r\\n    connection.connect();\\r\\n    return () =\u003e connection.disconnect();\\r\\n  }, [roomId]);\\r\\n\\r\\n  return (\\r\\n    \u003c\u003e\\r\\n      \u003ch1\u003e欢迎来到 {roomId} 房间!\u003c/h1\u003e\\r\\n      \u003cinput value={message} onChange={e =\u003e setMessage(e.target.value)} /\u003e\\r\\n    \u003c/\u003e\\r\\n  );\\r\\n}\\r\\n\\r\\nexport default function App() {\\r\\n  const [roomId, setRoomId] = useState('所有');\\r\\n  return (\\r\\n    \u003c\u003e\\r\\n      \u003clabel\u003e\\r\\n        选择聊天室:{' '}\\r\\n        \u003cselect\\r\\n          value={roomId}\\r\\n          onChange={e =\u003e setRoomId(e.target.value)}\\r\\n        \u003e\\r\\n          \u003coption value=\\\"所有\\\"\u003e所有\u003c/option\u003e\\r\\n          \u003coption value=\\\"旅游\\\"\u003e旅游\u003c/option\u003e\\r\\n          \u003coption value=\\\"音乐\\\"\u003e音乐\u003c/option\u003e\\r\\n        \u003c/select\u003e\\r\\n      \u003c/label\u003e\\r\\n      \u003chr /\u003e\\r\\n      \u003cChatRoom roomId={roomId} /\u003e\\r\\n    \u003c/\u003e\\r\\n  );\\r\\n}\\n\"}]}],[\"$r\",\"pre\",null,{\"children\":[\"$r\",\"code\",null,{\"className\":\"language-js\",\"meta\":\"src/chat.js\",\"children\":\"export function createConnection({ serverUrl, roomId }) {\\r\\n  // 真正的实现实际上会连接到服务器\\r\\n  return {\\r\\n    connect() {\\r\\n      console.log('✅ 连接到“' + roomId + '”房间，在 ' + serverUrl + '...');\\r\\n    },\\r\\n    disconnect() {\\r\\n      console.log('❌ 断开“' + roomId + '”房间，在 ' + serverUrl);\\r\\n    }\\r\\n  };\\r\\n}\\n\"}]}],[\"$r\",\"pre\",null,{\"children\":[\"$r\",\"code\",null,{\"className\":\"language-css\",\"children\":\"input { display: block; margin-bottom: 20px; }\\r\\nbutton { margin-left: 10px; }\\n\"}]}]]}],[\"$r\",\"MaxWidth\",\"272\",{\"children\":[\"\\n\",[\"$r\",\"p\",null,{\"children\":[\"然而，当你更改 \",[\"$r\",\"code\",null,{\"children\":\"roomId\"}],\" 下拉列表时，它 \",[\"$r\",\"strong\",null,{\"children\":\"确实\"}],\" 重新连接，正如你所期望的那样。\"]}],\"\\n\",[\"$r\",\"p\",null,{\"children\":\"这也适用于函数的场景：\"}],\"\\n\",[\"$r\",\"pre\",null,{\"children\":[\"$r\",\"code\",null,{\"className\":\"language-js\",\"meta\":\"{7-12,14}\",\"children\":\"const serverUrl = 'https://localhost:1234';\\r\\n\\r\\nfunction ChatRoom({ roomId }) {\\r\\n  const [message, setMessage] = useState('');\\r\\n\\r\\n  useEffect(() =\u003e {\\r\\n    function createOptions() {\\r\\n      return {\\r\\n        serverUrl: serverUrl,\\r\\n        roomId: roomId\\r\\n      };\\r\\n    }\\r\\n\\r\\n    const options = createOptions();\\r\\n    const connection = createConnection(options);\\r\\n    connection.connect();\\r\\n    return () =\u003e connection.disconnect();\\r\\n  }, [roomId]); // ✅ 所有依赖已声明\\r\\n  // ...\\n\"}]}],\"\\n\",[\"$r\",\"p\",null,{\"children\":[\"你可以编写自己的函数来组织 Effect 中的逻辑。只要将这些函数声明在 Effect \",[\"$r\",\"strong\",null,{\"children\":\"内部\"}],\"，它们就不是响应式值，因此它们也不是 Effect 的依赖。\"]}],\"\\n\",[\"$r\",\"h4\",null,{\"id\":\"read-primitive-values-from-objects\",\"children\":\"从对象中读取原始值 \"}],\"\\n\",[\"$r\",\"p\",null,{\"children\":\"有时，你可能会通过 props 接收到类型为对象的值：\"}],\"\\n\",[\"$r\",\"pre\",null,{\"children\":[\"$r\",\"code\",null,{\"className\":\"language-js\",\"meta\":\"{1,5,8}\",\"children\":\"function ChatRoom({ options }) {\\r\\n  const [message, setMessage] = useState('');\\r\\n\\r\\n  useEffect(() =\u003e {\\r\\n    const connection = createConnection(options);\\r\\n    connection.connect();\\r\\n    return () =\u003e connection.disconnect();\\r\\n  }, [options]); // ✅ 所有依赖已声明\\r\\n  // ...\\n\"}]}],\"\\n\",[\"$r\",\"p\",null,{\"children\":\"这里的风险是父组件会在渲染过程中创建对象：\"}],\"\\n\",[\"$r\",\"pre\",null,{\"children\":[\"$r\",\"code\",null,{\"className\":\"language-js\",\"meta\":\"{3-6}\",\"children\":\"\u003cChatRoom\\r\\n  roomId={roomId}\\r\\n  options={{\\r\\n    serverUrl: serverUrl,\\r\\n    roomId: roomId\\r\\n  }}\\r\\n/\u003e\\n\"}]}],\"\\n\",[\"$r\",\"p\",null,{\"children\":[\"这将导致 Effect 在每次父组件重新渲染时重新连接。要解决此问题，请从 Effect \",[\"$r\",\"strong\",null,{\"children\":\"外部\"}],\" 读取对象信息，并避免依赖对象和函数类型：\"]}],\"\\n\",[\"$r\",\"pre\",null,{\"children\":[\"$r\",\"code\",null,{\"className\":\"language-js\",\"meta\":\"{4,7-8,12}\",\"children\":\"function ChatRoom({ options }) {\\r\\n  const [message, setMessage] = useState('');\\r\\n\\r\\n  const { roomId, serverUrl } = options;\\r\\n  useEffect(() =\u003e {\\r\\n    const connection = createConnection({\\r\\n      roomId: roomId,\\r\\n      serverUrl: serverUrl\\r\\n    });\\r\\n    connection.connect();\\r\\n    return () =\u003e connection.disconnect();\\r\\n  }, [roomId, serverUrl]); // ✅ 所有依赖已声明\\r\\n  // ...\\n\"}]}],\"\\n\",[\"$r\",\"p\",null,{\"children\":[\"逻辑有点重复（你从 Effect 外部的对象读取一些值，然后在 Effect 内部创建具有相同值的对象）。但这使得 Effect \",[\"$r\",\"strong\",null,{\"children\":\"实际\"}],\" 依赖的信息非常明确。如果对象被父组件无意中重新创建，聊天也不会重新连接。但是，如果 \",[\"$r\",\"code\",null,{\"children\":\"options.roomId\"}],\" 或 \",[\"$r\",\"code\",null,{\"children\":\"options.serverUrl\"}],\" 确实不同，聊天将重新连接。\"]}],\"\\n\",[\"$r\",\"h4\",null,{\"id\":\"calculate-primitive-values-from-functions\",\"children\":\"从函数中计算原始值 \"}],\"\\n\",[\"$r\",\"p\",null,{\"children\":\"同样的方法也适用于函数。例如，假设父组件传递了一个函数：\"}],\"\\n\",[\"$r\",\"pre\",null,{\"children\":[\"$r\",\"code\",null,{\"className\":\"language-js\",\"meta\":\"{3-8}\",\"children\":\"\u003cChatRoom\\r\\n  roomId={roomId}\\r\\n  getOptions={() =\u003e {\\r\\n    return {\\r\\n      serverUrl: serverUrl,\\r\\n      roomId: roomId\\r\\n    };\\r\\n  }}\\r\\n/\u003e\\n\"}]}],\"\\n\",[\"$r\",\"p\",null,{\"children\":[\"为避免使其成为依赖（并导致它在重新渲染时重新连接），请在 Effect 外部调用它。这为你提供了不是对象的 \",[\"$r\",\"code\",null,{\"children\":\"roomId\"}],\" 和 \",[\"$r\",\"code\",null,{\"children\":\"serverUrl\"}],\" 值，你可以从 Effect 中读取它们：\"]}],\"\\n\",[\"$r\",\"pre\",null,{\"children\":[\"$r\",\"code\",null,{\"className\":\"language-js\",\"meta\":\"{1,4}\",\"children\":\"function ChatRoom({ getOptions }) {\\r\\n  const [message, setMessage] = useState('');\\r\\n\\r\\n  const { roomId, serverUrl } = getOptions();\\r\\n  useEffect(() =\u003e {\\r\\n    const connection = createConnection({\\r\\n      roomId: roomId,\\r\\n      serverUrl: serverUrl\\r\\n    });\\r\\n    connection.connect();\\r\\n    return () =\u003e connection.disconnect();\\r\\n  }, [roomId, serverUrl]); // ✅ 所有依赖已声明\\r\\n  // ...\\n\"}]}],\"\\n\",[\"$r\",\"p\",null,{\"children\":[\"这仅适用于 \",[\"$r\",\"a\",null,{\"href\":\"/learn/keeping-components-pure\",\"children\":\"纯\"}],\" 函数，因为它们在渲染期间可以安全调用。如果函数是一个事件处理程序，但你不希望它的更改重新同步 Effect，\",[\"$r\",\"a\",null,{\"href\":\"#do-you-want-to-read-a-value-without-reacting-to-its-changes\",\"children\":\"将它包装到 Effect Event 中\"}],\"。\"]}],\"\\n\",[\"$r\",\"Recap\",null,{\"children\":[\"$r\",\"ul\",null,{\"children\":[\"\\n\",[\"$r\",\"li\",null,{\"children\":\"依赖应始终与代码匹配。\"}],\"\\n\",[\"$r\",\"li\",null,{\"children\":\"当你对依赖不满意时，你需要编辑的是代码。\"}],\"\\n\",[\"$r\",\"li\",null,{\"children\":\"抑制 linter 会导致非常混乱的错误，你应该始终避免它。\"}],\"\\n\",[\"$r\",\"li\",null,{\"children\":\"要移除依赖，你需要向 linter “证明”它不是必需的。\"}],\"\\n\",[\"$r\",\"li\",null,{\"children\":\"如果某些代码是为了响应特定交互，请将该代码移至事件处理的地方。\"}],\"\\n\",[\"$r\",\"li\",null,{\"children\":\"如果 Effect 的不同部分因不同原因需要重新运行，请将其拆分为多个 Effect。\"}],\"\\n\",[\"$r\",\"li\",null,{\"children\":\"如果你想根据以前的状态更新一些状态，传递一个更新函数。\"}],\"\\n\",[\"$r\",\"li\",null,{\"children\":\"如果你想读取最新值而不“反应”它，请从 Effect 中提取出一个 Effect Event。\"}],\"\\n\",[\"$r\",\"li\",null,{\"children\":\"在 JavaScript 中，如果对象和函数是在不同时间创建的，则它们被认为是不同的。\"}],\"\\n\",[\"$r\",\"li\",null,{\"children\":\"尽量避免对象和函数依赖。将它们移到组件外或 Effect 内。\"}],\"\\n\"]}]}],\"\\n\"]}],[\"$r\",\"Challenges\",null,{\"children\":[[\"$r\",\"h4\",null,{\"id\":\"fix-a-resetting-interval\",\"children\":\"修复重置 interval \"}],[\"$r\",\"p\",null,{\"children\":\"这个 Effect 设置了一个每秒运行的 interval。你已经注意到一些奇怪的事情：似乎每次 interval 都会被销毁并重新创建。修复代码，使 interval 不会被不断重新创建。\"}],[\"$r\",\"Hint\",null,{\"children\":[\"$r\",\"p\",null,{\"children\":[\"看起来这个 Effect 的代码依赖于 \",[\"$r\",\"code\",null,{\"children\":\"count\"}],\"。有什么方法不需要这依赖吗？有，那就是根据其之前的值更新 \",[\"$r\",\"code\",null,{\"children\":\"count\"}],\" state，从而避免添加对该值的依赖。\"]}]}],[\"$r\",\"Sandpack\",null,{\"children\":[\"$r\",\"pre\",null,{\"children\":[\"$r\",\"code\",null,{\"className\":\"language-js\",\"children\":\"import { useState, useEffect } from 'react';\\r\\n\\r\\nexport default function Timer() {\\r\\n  const [count, setCount] = useState(0);\\r\\n\\r\\n  useEffect(() =\u003e {\\r\\n    console.log('✅ 创建定时器');\\r\\n    const id = setInterval(() =\u003e {\\r\\n      console.log('⏰ Interval');\\r\\n      setCount(count + 1);\\r\\n    }, 1000);\\r\\n    return () =\u003e {\\r\\n      console.log('❌ 清除定时器');\\r\\n      clearInterval(id);\\r\\n    };\\r\\n  }, [count]);\\r\\n\\r\\n  return \u003ch1\u003e计数器: {count}\u003c/h1\u003e\\r\\n}\\n\"}]}]}],[\"$r\",\"Solution\",null,{\"children\":[[\"$r\",\"p\",null,{\"children\":[\"你想要从 Effect 内部将 \",[\"$r\",\"code\",null,{\"children\":\"count\"}],\" 状态更新为 \",[\"$r\",\"code\",null,{\"children\":\"count + 1\"}],\"。但是，这会使 Effect 依赖于 \",[\"$r\",\"code\",null,{\"children\":\"count\"}],\"，它会随着每次滴答而变化，这就是为什么 interval 会在每次滴答时重新创建。\"]}],[\"$r\",\"p\",null,{\"children\":[\"要解决这个问题，请使用 \",[\"$r\",\"a\",null,{\"href\":\"/reference/react/useState#updating-state-based-on-the-previous-state\",\"children\":\"更新函数\"}],\" 并编写 \",[\"$r\",\"code\",null,{\"children\":\"setCount(c =\u003e c + 1)\"}],\" 而不是 \",[\"$r\",\"code\",null,{\"children\":\"setCount(count + 1)\"}],\":\"]}],[\"$r\",\"Sandpack\",null,{\"children\":[\"$r\",\"pre\",null,{\"children\":[\"$r\",\"code\",null,{\"className\":\"language-js\",\"children\":\"import { useState, useEffect } from 'react';\\r\\n\\r\\nexport default function Timer() {\\r\\n  const [count, setCount] = useState(0);\\r\\n\\r\\n  useEffect(() =\u003e {\\r\\n    console.log('✅ 创建定时器');\\r\\n    const id = setInterval(() =\u003e {\\r\\n      console.log('⏰ Interval');\\r\\n      setCount(c =\u003e c + 1);\\r\\n    }, 1000);\\r\\n    return () =\u003e {\\r\\n      console.log('❌ 清除定时器');\\r\\n      clearInterval(id);\\r\\n    };\\r\\n  }, []);\\r\\n\\r\\n  return \u003ch1\u003e计数器: {count}\u003c/h1\u003e\\r\\n}\\n\"}]}]}],[\"$r\",\"p\",null,{\"children\":[\"你不应在 Effect 中读取 \",[\"$r\",\"code\",null,{\"children\":\"count\"}],\"，而是将 \",[\"$r\",\"code\",null,{\"children\":\"c =\u003e c + 1\"}],\" 指令（“增加此数字！”）传递给 React。React 将在下一次渲染时执行它。由于你不再需要读取 Effect 中 \",[\"$r\",\"code\",null,{\"children\":\"count\"}],\" 的值，因此你可以将 Effect 的依赖保持为空（\",[\"$r\",\"code\",null,{\"children\":\"[]\"}],\"）。这可以防止 Effect 在每次执行时重新创建定时器 interval。\"]}]]}],[\"$r\",\"h4\",null,{\"id\":\"fix-a-retriggering-animation\",\"children\":\"修复重新触发动画的问题 \"}],[\"$r\",\"p\",null,{\"children\":[\"在此示例中，当你按下“显示”时，欢迎消息淡入。动画持续一秒钟。当你按下“移除”时，欢迎信息立即消失。淡入动画的逻辑在 \",[\"$r\",\"code\",null,{\"children\":\"animation.js\"}],\" 文件中以纯 JavaScript \",[\"$r\",\"a\",null,{\"href\":\"https://developer.mozilla.org/zh-CN/docs/Web/API/window/requestAnimationFrame\",\"target\":\"_blank\",\"rel\":\"nofollow noopener noreferrer\",\"children\":\"动画循环\"}],\" 实现。你不需要改变那个逻辑。你可以将其视为第三方库。Effect 的逻辑是为 DOM 节点创建一个 \",[\"$r\",\"code\",null,{\"children\":\"FadeInAnimation\"}],\" 实例，然后调用 \",[\"$r\",\"code\",null,{\"children\":\"start(duration)\"}],\" 或 \",[\"$r\",\"code\",null,{\"children\":\"stop()\"}],\" 来控制动画。\",[\"$r\",\"code\",null,{\"children\":\"duration\"}],\" 由滑块控制。调整滑块并查看动画如何变化。\"]}],[\"$r\",\"p\",null,{\"children\":[\"此代码已经能工作，但你需要更改一些内容。目前，当你移动控制 \",[\"$r\",\"code\",null,{\"children\":\"duration\"}],\" 状态变量的滑块时，它会重新触发动画。更改行为，使 Effect 不会对 \",[\"$r\",\"code\",null,{\"children\":\"duration\"}],\" 变量做出“反应”。当你按下“显示”时，Effect 应该使用滑块上的当前 \",[\"$r\",\"code\",null,{\"children\":\"duration\"}],\" 值。但是，移动滑块本身不应重新触发动画。\"]}],[\"$r\",\"Hint\",null,{\"children\":[\"$r\",\"p\",null,{\"children\":\"Effect 中是否有一行代码不应该是响应式的？如何将非响应式代码移出 Effect？\"}]}],[\"$r\",\"Sandpack\",null,{\"children\":[[\"$r\",\"pre\",null,{\"children\":[\"$r\",\"code\",null,{\"className\":\"language-json\",\"meta\":\"package.json hidden\",\"children\":\"{\\r\\n  \\\"dependencies\\\": {\\r\\n    \\\"react\\\": \\\"experimental\\\",\\r\\n    \\\"react-dom\\\": \\\"experimental\\\",\\r\\n    \\\"react-scripts\\\": \\\"latest\\\"\\r\\n  },\\r\\n  \\\"scripts\\\": {\\r\\n    \\\"start\\\": \\\"react-scripts start\\\",\\r\\n    \\\"build\\\": \\\"react-scripts build\\\",\\r\\n    \\\"test\\\": \\\"react-scripts test --env=jsdom\\\",\\r\\n    \\\"eject\\\": \\\"react-scripts eject\\\"\\r\\n  }\\r\\n}\\n\"}]}],[\"$r\",\"pre\",null,{\"children\":[\"$r\",\"code\",null,{\"className\":\"language-js\",\"children\":\"import { useState, useEffect, useRef } from 'react';\\r\\nimport { experimental_useEffectEvent as useEffectEvent } from 'react';\\r\\nimport { FadeInAnimation } from './animation.js';\\r\\n\\r\\nfunction Welcome({ duration }) {\\r\\n  const ref = useRef(null);\\r\\n\\r\\n  useEffect(() =\u003e {\\r\\n    const animation = new FadeInAnimation(ref.current);\\r\\n    animation.start(duration);\\r\\n    return () =\u003e {\\r\\n      animation.stop();\\r\\n    };\\r\\n  }, [duration]);\\r\\n\\r\\n  return (\\r\\n    \u003ch1\\r\\n      ref={ref}\\r\\n      style={{\\r\\n        opacity: 0,\\r\\n        color: 'white',\\r\\n        padding: 50,\\r\\n        textAlign: 'center',\\r\\n        fontSize: 50,\\r\\n        backgroundImage: 'radial-gradient(circle, rgba(63,94,251,1) 0%, rgba(252,70,107,1) 100%)'\\r\\n      }}\\r\\n    \u003e\\r\\n      欢迎\\r\\n    \u003c/h1\u003e\\r\\n  );\\r\\n}\\r\\n\\r\\nexport default function App() {\\r\\n  const [duration, setDuration] = useState(1000);\\r\\n  const [show, setShow] = useState(false);\\r\\n\\r\\n  return (\\r\\n    \u003c\u003e\\r\\n      \u003clabel\u003e\\r\\n        \u003cinput\\r\\n          type=\\\"range\\\"\\r\\n          min=\\\"100\\\"\\r\\n          max=\\\"3000\\\"\\r\\n          value={duration}\\r\\n          onChange={e =\u003e setDuration(Number(e.target.value))}\\r\\n        /\u003e\\r\\n        \u003cbr /\u003e\\r\\n        淡入 interval: {duration} ms\\r\\n      \u003c/label\u003e\\r\\n      \u003cbutton onClick={() =\u003e setShow(!show)}\u003e\\r\\n        {show ? '移除' : '显示'}\\r\\n      \u003c/button\u003e\\r\\n      \u003chr /\u003e\\r\\n      {show \u0026\u0026 \u003cWelcome duration={duration} /\u003e}\\r\\n    \u003c/\u003e\\r\\n  );\\r\\n}\\n\"}]}],[\"$r\",\"pre\",null,{\"children\":[\"$r\",\"code\",null,{\"className\":\"language-js\",\"meta\":\"src/animation.js\",\"children\":\"export class FadeInAnimation {\\r\\n  constructor(node) {\\r\\n    this.node = node;\\r\\n  }\\r\\n  start(duration) {\\r\\n    this.duration = duration;\\r\\n    if (this.duration === 0) {\\r\\n      // Jump to end immediately\\r\\n      this.onProgress(1);\\r\\n    } else {\\r\\n      this.onProgress(0);\\r\\n      // Start animating\\r\\n      this.startTime = performance.now();\\r\\n      this.frameId = requestAnimationFrame(() =\u003e this.onFrame());\\r\\n    }\\r\\n  }\\r\\n  onFrame() {\\r\\n    const timePassed = performance.now() - this.startTime;\\r\\n    const progress = Math.min(timePassed / this.duration, 1);\\r\\n    this.onProgress(progress);\\r\\n    if (progress \u003c 1) {\\r\\n      // We still have more frames to paint\\r\\n      this.frameId = requestAnimationFrame(() =\u003e this.onFrame());\\r\\n    }\\r\\n  }\\r\\n  onProgress(progress) {\\r\\n    this.node.style.opacity = progress;\\r\\n  }\\r\\n  stop() {\\r\\n    cancelAnimationFrame(this.frameId);\\r\\n    this.startTime = null;\\r\\n    this.frameId = null;\\r\\n    this.duration = 0;\\r\\n  }\\r\\n}\\n\"}]}],[\"$r\",\"pre\",null,{\"children\":[\"$r\",\"code\",null,{\"className\":\"language-css\",\"children\":\"label, button { display: block; margin-bottom: 20px; }\\r\\nhtml, body { min-height: 300px; }\\n\"}]}]]}],[\"$r\",\"Solution\",null,{\"children\":[[\"$r\",\"p\",null,{\"children\":[\"Effect 需要读取 \",[\"$r\",\"code\",null,{\"children\":\"duration\"}],\" 的最新值，但你不希望它对 \",[\"$r\",\"code\",null,{\"children\":\"duration\"}],\" 的变化做出“反应”。你使用 \",[\"$r\",\"code\",null,{\"children\":\"duration\"}],\" 来启动动画，但启动动画不是响应式的。将非响应式代码行提取到 Effect Event 中，并从 Effect 中调用该函数。\"]}],[\"$r\",\"Sandpack\",null,{\"children\":[[\"$r\",\"pre\",null,{\"children\":[\"$r\",\"code\",null,{\"className\":\"language-json\",\"meta\":\"package.json hidden\",\"children\":\"{\\r\\n  \\\"dependencies\\\": {\\r\\n    \\\"react\\\": \\\"experimental\\\",\\r\\n    \\\"react-dom\\\": \\\"experimental\\\",\\r\\n    \\\"react-scripts\\\": \\\"latest\\\"\\r\\n  },\\r\\n  \\\"scripts\\\": {\\r\\n    \\\"start\\\": \\\"react-scripts start\\\",\\r\\n    \\\"build\\\": \\\"react-scripts build\\\",\\r\\n    \\\"test\\\": \\\"react-scripts test --env=jsdom\\\",\\r\\n    \\\"eject\\\": \\\"react-scripts eject\\\"\\r\\n  }\\r\\n}\\n\"}]}],[\"$r\",\"pre\",null,{\"children\":[\"$r\",\"code\",null,{\"className\":\"language-js\",\"children\":\"import { useState, useEffect, useRef } from 'react';\\r\\nimport { FadeInAnimation } from './animation.js';\\r\\nimport { experimental_useEffectEvent as useEffectEvent } from 'react';\\r\\n\\r\\nfunction Welcome({ duration }) {\\r\\n  const ref = useRef(null);\\r\\n\\r\\n  const onAppear = useEffectEvent(animation =\u003e {\\r\\n    animation.start(duration);\\r\\n  });\\r\\n\\r\\n  useEffect(() =\u003e {\\r\\n    const animation = new FadeInAnimation(ref.current);\\r\\n    onAppear(animation);\\r\\n    return () =\u003e {\\r\\n      animation.stop();\\r\\n    };\\r\\n  }, []);\\r\\n\\r\\n  return (\\r\\n    \u003ch1\\r\\n      ref={ref}\\r\\n      style={{\\r\\n        opacity: 0,\\r\\n        color: 'white',\\r\\n        padding: 50,\\r\\n        textAlign: 'center',\\r\\n        fontSize: 50,\\r\\n        backgroundImage: 'radial-gradient(circle, rgba(63,94,251,1) 0%, rgba(252,70,107,1) 100%)'\\r\\n      }}\\r\\n    \u003e\\r\\n      欢迎\\r\\n    \u003c/h1\u003e\\r\\n  );\\r\\n}\\r\\n\\r\\nexport default function App() {\\r\\n  const [duration, setDuration] = useState(1000);\\r\\n  const [show, setShow] = useState(false);\\r\\n\\r\\n  return (\\r\\n    \u003c\u003e\\r\\n      \u003clabel\u003e\\r\\n        \u003cinput\\r\\n          type=\\\"range\\\"\\r\\n          min=\\\"100\\\"\\r\\n          max=\\\"3000\\\"\\r\\n          value={duration}\\r\\n          onChange={e =\u003e setDuration(Number(e.target.value))}\\r\\n        /\u003e\\r\\n        \u003cbr /\u003e\\r\\n        淡入 interval: {duration} ms\\r\\n      \u003c/label\u003e\\r\\n      \u003cbutton onClick={() =\u003e setShow(!show)}\u003e\\r\\n        {show ? '移除' : '显示'}\\r\\n      \u003c/button\u003e\\r\\n      \u003chr /\u003e\\r\\n      {show \u0026\u0026 \u003cWelcome duration={duration} /\u003e}\\r\\n    \u003c/\u003e\\r\\n  );\\r\\n}\\n\"}]}],[\"$r\",\"pre\",null,{\"children\":[\"$r\",\"code\",null,{\"className\":\"language-js\",\"meta\":\"src/animation.js\",\"children\":\"export class FadeInAnimation {\\r\\n  constructor(node) {\\r\\n    this.node = node;\\r\\n  }\\r\\n  start(duration) {\\r\\n    this.duration = duration;\\r\\n    this.onProgress(0);\\r\\n    this.startTime = performance.now();\\r\\n    this.frameId = requestAnimationFrame(() =\u003e this.onFrame());\\r\\n  }\\r\\n  onFrame() {\\r\\n    const timePassed = performance.now() - this.startTime;\\r\\n    const progress = Math.min(timePassed / this.duration, 1);\\r\\n    this.onProgress(progress);\\r\\n    if (progress \u003c 1) {\\r\\n      // We still have more frames to paint\\r\\n      this.frameId = requestAnimationFrame(() =\u003e this.onFrame());\\r\\n    }\\r\\n  }\\r\\n  onProgress(progress) {\\r\\n    this.node.style.opacity = progress;\\r\\n  }\\r\\n  stop() {\\r\\n    cancelAnimationFrame(this.frameId);\\r\\n    this.startTime = null;\\r\\n    this.frameId = null;\\r\\n    this.duration = 0;\\r\\n  }\\r\\n}\\n\"}]}],[\"$r\",\"pre\",null,{\"children\":[\"$r\",\"code\",null,{\"className\":\"language-css\",\"children\":\"label, button { display: block; margin-bottom: 20px; }\\r\\nhtml, body { min-height: 300px; }\\n\"}]}]]}],[\"$r\",\"p\",null,{\"children\":[\"像 \",[\"$r\",\"code\",null,{\"children\":\"onAppear\"}],\" 这样的 Effect Events 不是响应式的，因此你可以在不重新触发动画的情况下读取内部的 \",[\"$r\",\"code\",null,{\"children\":\"duration\"}],\"。\"]}]]}],[\"$r\",\"h4\",null,{\"id\":\"fix-a-reconnecting-chat\",\"children\":\"修复聊天重新连接的问题 \"}],[\"$r\",\"p\",null,{\"children\":\"在此示例中，每次你按“切换主题”时，聊天都会重新连接。为什么会这样？修复错误，只有当你编辑服务器 URL 或选择不同的聊天室时，聊天才会重新连接。\"}],[\"$r\",\"p\",null,{\"children\":[\"将 \",[\"$r\",\"code\",null,{\"children\":\"chat.js\"}],\" 视为外部第三方库：你可以查阅它以检查其 API，但不要对其进行编辑。\"]}],[\"$r\",\"Hint\",null,{\"children\":[\"$r\",\"p\",null,{\"children\":\"解决这个问题的方法不止一种，但最终你希望避免将对象作为依赖。\"}]}],[\"$r\",\"Sandpack\",null,{\"children\":[[\"$r\",\"pre\",null,{\"children\":[\"$r\",\"code\",null,{\"className\":\"language-js\",\"meta\":\"src/App.js\",\"children\":\"import { useState } from 'react';\\r\\nimport ChatRoom from './ChatRoom.js';\\r\\n\\r\\nexport default function App() {\\r\\n  const [isDark, setIsDark] = useState(false);\\r\\n  const [roomId, setRoomId] = useState('所有');\\r\\n  const [serverUrl, setServerUrl] = useState('https://localhost:1234');\\r\\n\\r\\n  const options = {\\r\\n    serverUrl: serverUrl,\\r\\n    roomId: roomId\\r\\n  };\\r\\n\\r\\n  return (\\r\\n    \u003cdiv className={isDark ? 'dark' : 'light'}\u003e\\r\\n      \u003cbutton onClick={() =\u003e setIsDark(!isDark)}\u003e\\r\\n        切换主题\\r\\n      \u003c/button\u003e\\r\\n      \u003clabel\u003e\\r\\n        服务器地址：\\r\\n        \u003cinput\\r\\n          value={serverUrl}\\r\\n          onChange={e =\u003e setServerUrl(e.target.value)}\\r\\n        /\u003e\\r\\n      \u003c/label\u003e\\r\\n      \u003clabel\u003e\\r\\n        选择聊天室：\\r\\n        \u003cselect\\r\\n          value={roomId}\\r\\n          onChange={e =\u003e setRoomId(e.target.value)}\\r\\n        \u003e\\r\\n          \u003coption value=\\\"所有\\\"\u003e所有\u003c/option\u003e\\r\\n          \u003coption value=\\\"旅游\\\"\u003e旅游\u003c/option\u003e\\r\\n          \u003coption value=\\\"音乐\\\"\u003e音乐\u003c/option\u003e\\r\\n        \u003c/select\u003e\\r\\n      \u003c/label\u003e\\r\\n      \u003chr /\u003e\\r\\n      \u003cChatRoom options={options} /\u003e\\r\\n    \u003c/div\u003e\\r\\n  );\\r\\n}\\n\"}]}],[\"$r\",\"pre\",null,{\"children\":[\"$r\",\"code\",null,{\"className\":\"language-js\",\"meta\":\"src/ChatRoom.js active\",\"children\":\"import { useEffect } from 'react';\\r\\nimport { createConnection } from './chat.js';\\r\\n\\r\\nexport default function ChatRoom({ options }) {\\r\\n  useEffect(() =\u003e {\\r\\n    const connection = createConnection(options);\\r\\n    connection.connect();\\r\\n    return () =\u003e connection.disconnect();\\r\\n  }, [options]);\\r\\n\\r\\n  return \u003ch1\u003e欢迎来到 {options.roomId} 房间！\u003c/h1\u003e;\\r\\n}\\n\"}]}],[\"$r\",\"pre\",null,{\"children\":[\"$r\",\"code\",null,{\"className\":\"language-js\",\"meta\":\"src/chat.js\",\"children\":\"export function createConnection({ serverUrl, roomId }) {\\r\\n  // 真正的实现实际上会连接到服务器\\r\\n  if (typeof serverUrl !== 'string') {\\r\\n    throw Error('期望 serverUrl 是字符串类型，收到：' + serverUrl);\\r\\n  }\\r\\n  if (typeof roomId !== 'string') {\\r\\n    throw Error('期望 roomId 是字符串类型，收到：' + roomId);\\r\\n  }\\r\\n  return {\\r\\n    connect() {\\r\\n      console.log('✅ 连接到“' + roomId + '”房间，在 ' + serverUrl + '...');\\r\\n    },\\r\\n    disconnect() {\\r\\n      console.log('❌ 断开“' + roomId + '”房间，在 ' + serverUrl);\\r\\n    }\\r\\n  };\\r\\n}\\n\"}]}],[\"$r\",\"pre\",null,{\"children\":[\"$r\",\"code\",null,{\"className\":\"language-css\",\"children\":\"label, button { display: block; margin-bottom: 5px; }\\r\\n.dark { background: #222; color: #eee; }\\n\"}]}]]}],[\"$r\",\"Solution\",null,{\"children\":[[\"$r\",\"p\",null,{\"children\":[\"Effect 因依赖于 \",[\"$r\",\"code\",null,{\"children\":\"options\"}],\" 对象，导致其重新运行。对象可能会在无意中被重新创建，你应该尽可能避免将它们作为 Effect 的依赖。\"]}],[\"$r\",\"p\",null,{\"children\":[\"侵入性最小的修复方法是在 Effect 外部读取 \",[\"$r\",\"code\",null,{\"children\":\"roomId\"}],\" 和 \",[\"$r\",\"code\",null,{\"children\":\"serverUrl\"}],\"，然后使 Effect 依赖于这些原始值（不能无意地更改）。在 Effect 内部，创建一个对象并将其传递给 \",[\"$r\",\"code\",null,{\"children\":\"createConnection\"}],\"：\"]}],[\"$r\",\"Sandpack\",null,{\"children\":[[\"$r\",\"pre\",null,{\"children\":[\"$r\",\"code\",null,{\"className\":\"language-js\",\"meta\":\"src/App.js\",\"children\":\"import { useState } from 'react';\\r\\nimport ChatRoom from './ChatRoom.js';\\r\\n\\r\\nexport default function App() {\\r\\n  const [isDark, setIsDark] = useState(false);\\r\\n  const [roomId, setRoomId] = useState('所有');\\r\\n  const [serverUrl, setServerUrl] = useState('https://localhost:1234');\\r\\n\\r\\n  const options = {\\r\\n    serverUrl: serverUrl,\\r\\n    roomId: roomId\\r\\n  };\\r\\n\\r\\n  return (\\r\\n    \u003cdiv className={isDark ? 'dark' : 'light'}\u003e\\r\\n      \u003cbutton onClick={() =\u003e setIsDark(!isDark)}\u003e\\r\\n        切换主题\\r\\n      \u003c/button\u003e\\r\\n      \u003clabel\u003e\\r\\n        服务器地址：\\r\\n        \u003cinput\\r\\n          value={serverUrl}\\r\\n          onChange={e =\u003e setServerUrl(e.target.value)}\\r\\n        /\u003e\\r\\n      \u003c/label\u003e\\r\\n      \u003clabel\u003e\\r\\n        选择聊天室：\\r\\n        \u003cselect\\r\\n          value={roomId}\\r\\n          onChange={e =\u003e setRoomId(e.target.value)}\\r\\n        \u003e\\r\\n          \u003coption value=\\\"所有\\\"\u003e所有\u003c/option\u003e\\r\\n          \u003coption value=\\\"旅游\\\"\u003e旅游\u003c/option\u003e\\r\\n          \u003coption value=\\\"音乐\\\"\u003e音乐\u003c/option\u003e\\r\\n        \u003c/select\u003e\\r\\n      \u003c/label\u003e\\r\\n      \u003chr /\u003e\\r\\n      \u003cChatRoom options={options} /\u003e\\r\\n    \u003c/div\u003e\\r\\n  );\\r\\n}\\n\"}]}],[\"$r\",\"pre\",null,{\"children\":[\"$r\",\"code\",null,{\"className\":\"language-js\",\"meta\":\"src/ChatRoom.js active\",\"children\":\"import { useEffect } from 'react';\\r\\nimport { createConnection } from './chat.js';\\r\\n\\r\\nexport default function ChatRoom({ options }) {\\r\\n  const { roomId, serverUrl } = options;\\r\\n  useEffect(() =\u003e {\\r\\n    const connection = createConnection({\\r\\n      roomId: roomId,\\r\\n      serverUrl: serverUrl\\r\\n    });\\r\\n    connection.connect();\\r\\n    return () =\u003e connection.disconnect();\\r\\n  }, [roomId, serverUrl]);\\r\\n\\r\\n  return \u003ch1\u003e欢迎来到 {options.roomId} 房间！\u003c/h1\u003e;\\r\\n}\\n\"}]}],[\"$r\",\"pre\",null,{\"children\":[\"$r\",\"code\",null,{\"className\":\"language-js\",\"meta\":\"src/chat.js\",\"children\":\"export function createConnection({ serverUrl, roomId }) {\\r\\n  // 真正的实现实际上会连接到服务器\\r\\n  if (typeof serverUrl !== 'string') {\\r\\n    throw Error('期望 serverUrl 是字符串类型，收到：' + serverUrl);\\r\\n  }\\r\\n  if (typeof roomId !== 'string') {\\r\\n    throw Error('期望 roomId 是字符串类型，收到：' + roomId);\\r\\n  }\\r\\n  return {\\r\\n    connect() {\\r\\n      console.log('✅ 连接到“' + roomId + '”房间，在 ' + serverUrl + '...');\\r\\n    },\\r\\n    disconnect() {\\r\\n      console.log('❌ 断开“' + roomId + '”房间，在 ' + serverUrl);\\r\\n    }\\r\\n  };\\r\\n}\\n\"}]}],[\"$r\",\"pre\",null,{\"children\":[\"$r\",\"code\",null,{\"className\":\"language-css\",\"children\":\"label, button { display: block; margin-bottom: 5px; }\\r\\n.dark { background: #222; color: #eee; }\\n\"}]}]]}],[\"$r\",\"p\",null,{\"children\":[\"用更具体的 \",[\"$r\",\"code\",null,{\"children\":\"roomId\"}],\" 和 \",[\"$r\",\"code\",null,{\"children\":\"serverUrl\"}],\" props 替换对象 \",[\"$r\",\"code\",null,{\"children\":\"options\"}],\" props 会更好：\"]}],[\"$r\",\"Sandpack\",null,{\"children\":[[\"$r\",\"pre\",null,{\"children\":[\"$r\",\"code\",null,{\"className\":\"language-js\",\"meta\":\"src/App.js\",\"children\":\"import { useState } from 'react';\\r\\nimport ChatRoom from './ChatRoom.js';\\r\\n\\r\\nexport default function App() {\\r\\n  const [isDark, setIsDark] = useState(false);\\r\\n  const [roomId, setRoomId] = useState('所有');\\r\\n  const [serverUrl, setServerUrl] = useState('https://localhost:1234');\\r\\n\\r\\n  return (\\r\\n    \u003cdiv className={isDark ? 'dark' : 'light'}\u003e\\r\\n      \u003cbutton onClick={() =\u003e setIsDark(!isDark)}\u003e\\r\\n        切换主题\\r\\n      \u003c/button\u003e\\r\\n      \u003clabel\u003e\\r\\n        服务器地址：\\r\\n        \u003cinput\\r\\n          value={serverUrl}\\r\\n          onChange={e =\u003e setServerUrl(e.target.value)}\\r\\n        /\u003e\\r\\n      \u003c/label\u003e\\r\\n      \u003clabel\u003e\\r\\n        选择聊天室：\\r\\n        \u003cselect\\r\\n          value={roomId}\\r\\n          onChange={e =\u003e setRoomId(e.target.value)}\\r\\n        \u003e\\r\\n          \u003coption value=\\\"所有\\\"\u003e所有\u003c/option\u003e\\r\\n          \u003coption value=\\\"旅游\\\"\u003e旅游\u003c/option\u003e\\r\\n          \u003coption value=\\\"音乐\\\"\u003e音乐\u003c/option\u003e\\r\\n        \u003c/select\u003e\\r\\n      \u003c/label\u003e\\r\\n      \u003chr /\u003e\\r\\n      \u003cChatRoom\\r\\n        roomId={roomId}\\r\\n        serverUrl={serverUrl}\\r\\n      /\u003e\\r\\n    \u003c/div\u003e\\r\\n  );\\r\\n}\\n\"}]}],[\"$r\",\"pre\",null,{\"children\":[\"$r\",\"code\",null,{\"className\":\"language-js\",\"meta\":\"src/ChatRoom.js active\",\"children\":\"import { useState, useEffect } from 'react';\\r\\nimport { createConnection } from './chat.js';\\r\\n\\r\\nexport default function ChatRoom({ roomId, serverUrl }) {\\r\\n  useEffect(() =\u003e {\\r\\n    const connection = createConnection({\\r\\n      roomId: roomId,\\r\\n      serverUrl: serverUrl\\r\\n    });\\r\\n    connection.connect();\\r\\n    return () =\u003e connection.disconnect();\\r\\n  }, [roomId, serverUrl]);\\r\\n\\r\\n  return \u003ch1\u003e欢迎来到 {roomId} 房间！\u003c/h1\u003e;\\r\\n}\\n\"}]}],[\"$r\",\"pre\",null,{\"children\":[\"$r\",\"code\",null,{\"className\":\"language-js\",\"meta\":\"src/chat.js\",\"children\":\"export function createConnection({ serverUrl, roomId }) {\\r\\n  // 真正的实现实际上会连接到服务器\\r\\n  if (typeof serverUrl !== 'string') {\\r\\n    throw Error('期望 serverUrl 是字符串类型，收到：' + serverUrl);\\r\\n  }\\r\\n  if (typeof roomId !== 'string') {\\r\\n    throw Error('期望 roomId 是字符串类型，收到：' + roomId);\\r\\n  }\\r\\n  return {\\r\\n    connect() {\\r\\n      console.log('✅ 连接到“' + roomId + '”房间，在 ' + serverUrl + '...');\\r\\n    },\\r\\n    disconnect() {\\r\\n      console.log('❌ 断开“' + roomId + '”房间，在 ' + serverUrl);\\r\\n    }\\r\\n  };\\r\\n}\\n\"}]}],[\"$r\",\"pre\",null,{\"children\":[\"$r\",\"code\",null,{\"className\":\"language-css\",\"children\":\"label, button { display: block; margin-bottom: 5px; }\\r\\n.dark { background: #222; color: #eee; }\\n\"}]}]]}],[\"$r\",\"p\",null,{\"children\":\"尽可能坚持使用原始 props，以便以后更容易优化组件。\"}]]}],[\"$r\",\"h4\",null,{\"id\":\"fix-a-reconnecting-chat-again\",\"children\":\"再次修复聊天重新连接的问题 \"}],[\"$r\",\"p\",null,{\"children\":\"此示例使用或不使用加密连接到聊天。切换复选框并注意加密打开和关闭时控制台中的不同消息。换个房间试试，然后，尝试切换主题。当你连接到聊天室时，每隔几秒钟就会收到一条新消息。验证它们的颜色是否与你选择的主题相匹配。\"}],[\"$r\",\"p\",null,{\"children\":\"在此示例中，每次你尝试更改主题时聊天都会重新连接。解决这个问题。修复后，更改主题不应重新连接聊天，但切换加密设置或更改房间应重新连接。\"}],[\"$r\",\"p\",null,{\"children\":[\"不要更改 \",[\"$r\",\"code\",null,{\"children\":\"chat.js\"}],\" 中的任何代码。除此之外，你可以更改任何代码，只要它引起相同的行为。例如，你可能会发现更改正在传递的 props 很有帮助。\"]}],[\"$r\",\"Hint\",null,{\"children\":[[\"$r\",\"p\",null,{\"children\":[\"你传递了两个函数：\",[\"$r\",\"code\",null,{\"children\":\"onMessage\"}],\" 和 \",[\"$r\",\"code\",null,{\"children\":\"createConnection\"}],\"。每次 \",[\"$r\",\"code\",null,{\"children\":\"App\"}],\" 重新渲染时，它们都是从头开始创建的。它们每次都被视为新值，这就是它们重新触发 Effect 的原因。\"]}],[\"$r\",\"p\",null,{\"children\":\"前者是事件处理程序。你知道在不对新的事件处理函数“做出反应”的情况下调用事件处理程序 Effect 的方法吗？这个问题你迟早要遇到！\"}],[\"$r\",\"p\",null,{\"children\":[\"后者仅用于将某些状态传递给导入的 API 方法。这个函数真的有必要吗？传递的基本信息是什么？你可能需要将一些导入从 \",[\"$r\",\"code\",null,{\"children\":\"App.js\"}],\" 移至 \",[\"$r\",\"code\",null,{\"children\":\"ChatRoom.js\"}],\"。\"]}]]}],[\"$r\",\"Sandpack\",null,{\"children\":[[\"$r\",\"pre\",null,{\"children\":[\"$r\",\"code\",null,{\"className\":\"language-json\",\"meta\":\"package.json hidden\",\"children\":\"{\\r\\n  \\\"dependencies\\\": {\\r\\n    \\\"react\\\": \\\"experimental\\\",\\r\\n    \\\"react-dom\\\": \\\"experimental\\\",\\r\\n    \\\"react-scripts\\\": \\\"latest\\\",\\r\\n    \\\"toastify-js\\\": \\\"1.12.0\\\"\\r\\n  },\\r\\n  \\\"scripts\\\": {\\r\\n    \\\"start\\\": \\\"react-scripts start\\\",\\r\\n    \\\"build\\\": \\\"react-scripts build\\\",\\r\\n    \\\"test\\\": \\\"react-scripts test --env=jsdom\\\",\\r\\n    \\\"eject\\\": \\\"react-scripts eject\\\"\\r\\n  }\\r\\n}\\n\"}]}],[\"$r\",\"pre\",null,{\"children\":[\"$r\",\"code\",null,{\"className\":\"language-js\",\"meta\":\"src/App.js\",\"children\":\"import { useState } from 'react';\\r\\nimport ChatRoom from './ChatRoom.js';\\r\\nimport {\\r\\n  createEncryptedConnection,\\r\\n  createUnencryptedConnection,\\r\\n} from './chat.js';\\r\\nimport { showNotification } from './notifications.js';\\r\\n\\r\\nexport default function App() {\\r\\n  const [isDark, setIsDark] = useState(false);\\r\\n  const [roomId, setRoomId] = useState('所有');\\r\\n  const [isEncrypted, setIsEncrypted] = useState(false);\\r\\n\\r\\n  return (\\r\\n    \u003c\u003e\\r\\n      \u003clabel\u003e\\r\\n        \u003cinput\\r\\n          type=\\\"checkbox\\\"\\r\\n          checked={isDark}\\r\\n          onChange={e =\u003e setIsDark(e.target.checked)}\\r\\n        /\u003e\\r\\n        使用暗黑主题\\r\\n      \u003c/label\u003e\\r\\n      \u003clabel\u003e\\r\\n        \u003cinput\\r\\n          type=\\\"checkbox\\\"\\r\\n          checked={isEncrypted}\\r\\n          onChange={e =\u003e setIsEncrypted(e.target.checked)}\\r\\n        /\u003e\\r\\n        开启加密功能\\r\\n      \u003c/label\u003e\\r\\n      \u003clabel\u003e\\r\\n        选择聊天室：\\r\\n        \u003cselect\\r\\n          value={roomId}\\r\\n          onChange={e =\u003e setRoomId(e.target.value)}\\r\\n        \u003e\\r\\n          \u003coption value=\\\"所有\\\"\u003e所有\u003c/option\u003e\\r\\n          \u003coption value=\\\"旅游\\\"\u003e旅游\u003c/option\u003e\\r\\n          \u003coption value=\\\"音乐\\\"\u003e音乐\u003c/option\u003e\\r\\n        \u003c/select\u003e\\r\\n      \u003c/label\u003e\\r\\n      \u003chr /\u003e\\r\\n      \u003cChatRoom\\r\\n        roomId={roomId}\\r\\n        onMessage={msg =\u003e {\\r\\n          showNotification('新消息：' + msg, isDark ? 'dark' : 'light');\\r\\n        }}\\r\\n        createConnection={() =\u003e {\\r\\n          const options = {\\r\\n            serverUrl: 'https://localhost:1234',\\r\\n            roomId: roomId\\r\\n          };\\r\\n          if (isEncrypted) {\\r\\n            return createEncryptedConnection(options);\\r\\n          } else {\\r\\n            return createUnencryptedConnection(options);\\r\\n          }\\r\\n        }}\\r\\n      /\u003e\\r\\n    \u003c/\u003e\\r\\n  );\\r\\n}\\n\"}]}],[\"$r\",\"pre\",null,{\"children\":[\"$r\",\"code\",null,{\"className\":\"language-js\",\"meta\":\"src/ChatRoom.js active\",\"children\":\"import { useState, useEffect } from 'react';\\r\\nimport { experimental_useEffectEvent as useEffectEvent } from 'react';\\r\\n\\r\\nexport default function ChatRoom({ roomId, createConnection, onMessage }) {\\r\\n  useEffect(() =\u003e {\\r\\n    const connection = createConnection();\\r\\n    connection.on('message', (msg) =\u003e onMessage(msg));\\r\\n    connection.connect();\\r\\n    return () =\u003e connection.disconnect();\\r\\n  }, [createConnection, onMessage]);\\r\\n\\r\\n  return \u003ch1\u003e欢迎来到 {roomId} 房间！\u003c/h1\u003e;\\r\\n}\\n\"}]}],[\"$r\",\"pre\",null,{\"children\":[\"$r\",\"code\",null,{\"className\":\"language-js\",\"meta\":\"src/chat.js\",\"children\":\"export function createEncryptedConnection({ serverUrl, roomId }) {\\r\\n  // 真正的实现实际上会连接到服务器\\r\\n  if (typeof serverUrl !== 'string') {\\r\\n    throw Error('期望 serverUrl 是字符串类型，收到：' + serverUrl);\\r\\n  }\\r\\n  if (typeof roomId !== 'string') {\\r\\n    throw Error('期望 roomId 是字符串类型，收到：' + roomId);\\r\\n  }\\r\\n  let intervalId;\\r\\n  let messageCallback;\\r\\n  return {\\r\\n    connect() {\\r\\n      console.log('✅ 🔐 连接到“' + roomId + '”房间...（已加密）');\\r\\n      clearInterval(intervalId);\\r\\n      intervalId = setInterval(() =\u003e {\\r\\n        if (messageCallback) {\\r\\n          if (Math.random() \u003e 0.5) {\\r\\n            messageCallback('hey')\\r\\n          } else {\\r\\n            messageCallback('lol');\\r\\n          }\\r\\n        }\\r\\n      }, 3000);\\r\\n    },\\r\\n    disconnect() {\\r\\n      clearInterval(intervalId);\\r\\n      messageCallback = null;\\r\\n      console.log('❌ 🔐 断开“' + roomId + '”房间（已加密）');\\r\\n    },\\r\\n    on(event, callback) {\\r\\n      if (messageCallback) {\\r\\n        throw Error('不能添加 handler 2次');\\r\\n      }\\r\\n      if (event !== 'message') {\\r\\n        throw Error('仅支持 \\\"message\\\" 事件');\\r\\n      }\\r\\n      messageCallback = callback;\\r\\n    },\\r\\n  };\\r\\n}\\r\\n\\r\\nexport function createUnencryptedConnection({ serverUrl, roomId }) {\\r\\n  // 真正的实现实际上会连接到服务器\\r\\n  if (typeof serverUrl !== 'string') {\\r\\n    throw Error('期望 serverUrl 是字符串类型，收到：' + serverUrl);\\r\\n  }\\r\\n  if (typeof roomId !== 'string') {\\r\\n    throw Error('期望 roomId 是字符串类型，收到：' + roomId);\\r\\n  }\\r\\n  let intervalId;\\r\\n  let messageCallback;\\r\\n  return {\\r\\n    connect() {\\r\\n      console.log('✅ 连接到“' + roomId + '”房间（未加密）...');\\r\\n      clearInterval(intervalId);\\r\\n      intervalId = setInterval(() =\u003e {\\r\\n        if (messageCallback) {\\r\\n          if (Math.random() \u003e 0.5) {\\r\\n            messageCallback('hey')\\r\\n          } else {\\r\\n            messageCallback('lol');\\r\\n          }\\r\\n        }\\r\\n      }, 3000);\\r\\n    },\\r\\n    disconnect() {\\r\\n      clearInterval(intervalId);\\r\\n      messageCallback = null;\\r\\n      console.log('❌ 断开“' + roomId + '”房间（未加密）');\\r\\n    },\\r\\n    on(event, callback) {\\r\\n      if (messageCallback) {\\r\\n        throw Error('不能添加 handler 2次');\\r\\n      }\\r\\n      if (event !== 'message') {\\r\\n        throw Error('仅支持 \\\"message\\\" 事件');\\r\\n      }\\r\\n      messageCallback = callback;\\r\\n    },\\r\\n  };\\r\\n}\\n\"}]}],[\"$r\",\"pre\",null,{\"children\":[\"$r\",\"code\",null,{\"className\":\"language-js\",\"meta\":\"src/notifications.js\",\"children\":\"import Toastify from 'toastify-js';\\r\\nimport 'toastify-js/src/toastify.css';\\r\\n\\r\\nexport function showNotification(message, theme) {\\r\\n  Toastify({\\r\\n    text: message,\\r\\n    duration: 2000,\\r\\n    gravity: 'top',\\r\\n    position: 'right',\\r\\n    style: {\\r\\n      background: theme === 'dark' ? 'black' : 'white',\\r\\n      color: theme === 'dark' ? 'white' : 'black',\\r\\n    },\\r\\n  }).showToast();\\r\\n}\\n\"}]}],[\"$r\",\"pre\",null,{\"children\":[\"$r\",\"code\",null,{\"className\":\"language-css\",\"children\":\"label, button { display: block; margin-bottom: 5px; }\\n\"}]}]]}],[\"$r\",\"Solution\",null,{\"children\":[[\"$r\",\"p\",null,{\"children\":\"解决这个问题的正确方法不止一种，下面要介绍的是一种可能的解决方案。\"}],[\"$r\",\"p\",null,{\"children\":[\"在原始示例中，切换主题会导致创建和传递不同的 \",[\"$r\",\"code\",null,{\"children\":\"onMessage\"}],\" 和 \",[\"$r\",\"code\",null,{\"children\":\"createConnection\"}],\" 函数。由于 Effect 依赖于这些功能，因此每次切换主题时聊天都会重新连接。\"]}],[\"$r\",\"p\",null,{\"children\":[\"要解决 \",[\"$r\",\"code\",null,{\"children\":\"onMessage\"}],\" 的问题，你需要将其包装到 Effect Event 中：\"]}],[\"$r\",\"pre\",null,{\"children\":[\"$r\",\"code\",null,{\"className\":\"language-js\",\"meta\":\"{1,2,6}\",\"children\":\"export default function ChatRoom({ roomId, createConnection, onMessage }) {\\r\\n  const onReceiveMessage = useEffectEvent(onMessage);\\r\\n\\r\\n  useEffect(() =\u003e {\\r\\n    const connection = createConnection();\\r\\n    connection.on('message', (msg) =\u003e onReceiveMessage(msg));\\r\\n    // ...\\n\"}]}],[\"$r\",\"p\",null,{\"children\":[\"与 \",[\"$r\",\"code\",null,{\"children\":\"onMessage\"}],\" props 不同，\",[\"$r\",\"code\",null,{\"children\":\"onReceiveMessage\"}],\" Effect Event 不是响应式的。这就是为什么它不需要成为 Effect 的依赖。因此，对 \",[\"$r\",\"code\",null,{\"children\":\"onMessage\"}],\" 的更改不会导致聊天重新连接。\"]}],[\"$r\",\"p\",null,{\"children\":[\"你不能对 \",[\"$r\",\"code\",null,{\"children\":\"createConnection\"}],\" 做同样的事情，因为它 \",[\"$r\",\"strong\",null,{\"children\":\"应该\"}],\" 是响应式的。如果用户在加密和未加密连接之间切换，或者如果用户切换当前房间，你 \",[\"$r\",\"strong\",null,{\"children\":\"希望\"}],\" 重新触发 Effect。但是，因为 \",[\"$r\",\"code\",null,{\"children\":\"createConnection\"}],\" 是函数，你无法检查它读取的信息是否 \",[\"$r\",\"strong\",null,{\"children\":\"实际\"}],\" 发生了变化。要解决此问题，请传递原始的 \",[\"$r\",\"code\",null,{\"children\":\"roomId\"}],\" 和 \",[\"$r\",\"code\",null,{\"children\":\"isEncrypted\"}],\" 值，而不是从 App 组件向下传递 \",[\"$r\",\"code\",null,{\"children\":\"createConnection\"}],\" ：\"]}],[\"$r\",\"pre\",null,{\"children\":[\"$r\",\"code\",null,{\"className\":\"language-js\",\"meta\":\"{2-3}\",\"children\":\"      \u003cChatRoom\\r\\n        roomId={roomId}\\r\\n        isEncrypted={isEncrypted}\\r\\n        onMessage={msg =\u003e {\\r\\n          showNotification('新消息：' + msg, isDark ? 'dark' : 'light');\\r\\n        }}\\r\\n      /\u003e\\n\"}]}],[\"$r\",\"p\",null,{\"children\":[\"现在你可以将 \",[\"$r\",\"code\",null,{\"children\":\"createConnection\"}],\" 函数移到 Effect 里面，而不是从 \",[\"$r\",\"code\",null,{\"children\":\"App\"}],\" 向下传递它：\"]}],[\"$r\",\"pre\",null,{\"children\":[\"$r\",\"code\",null,{\"className\":\"language-js\",\"meta\":\"{1-4,6,10-20}\",\"children\":\"import {\\r\\n  createEncryptedConnection,\\r\\n  createUnencryptedConnection,\\r\\n} from './chat.js';\\r\\n\\r\\nexport default function ChatRoom({ roomId, isEncrypted, onMessage }) {\\r\\n  const onReceiveMessage = useEffectEvent(onMessage);\\r\\n\\r\\n  useEffect(() =\u003e {\\r\\n    function createConnection() {\\r\\n      const options = {\\r\\n        serverUrl: 'https://localhost:1234',\\r\\n        roomId: roomId\\r\\n      };\\r\\n      if (isEncrypted) {\\r\\n        return createEncryptedConnection(options);\\r\\n      } else {\\r\\n        return createUnencryptedConnection(options);\\r\\n      }\\r\\n    }\\r\\n    // ...\\n\"}]}],[\"$r\",\"p\",null,{\"children\":\"在这两个更改之后，Effect 不再依赖于任何函数值：\"}],[\"$r\",\"pre\",null,{\"children\":[\"$r\",\"code\",null,{\"className\":\"language-js\",\"meta\":\"{1,8,10,21}\",\"children\":\"export default function ChatRoom({ roomId, isEncrypted, onMessage }) { // Reactive values\\r\\n  const onReceiveMessage = useEffectEvent(onMessage); // Not reactive\\r\\n\\r\\n  useEffect(() =\u003e {\\r\\n    function createConnection() {\\r\\n      const options = {\\r\\n        serverUrl: 'https://localhost:1234',\\r\\n        roomId: roomId // 读取响应式值\\r\\n      };\\r\\n      if (isEncrypted) { // 读取响应式值\\r\\n        return createEncryptedConnection(options);\\r\\n      } else {\\r\\n        return createUnencryptedConnection(options);\\r\\n      }\\r\\n    }\\r\\n\\r\\n    const connection = createConnection();\\r\\n    connection.on('message', (msg) =\u003e onReceiveMessage(msg));\\r\\n    connection.connect();\\r\\n    return () =\u003e connection.disconnect();\\r\\n  }, [roomId, isEncrypted]); // ✅ 所有依赖已声明\\n\"}]}],[\"$r\",\"p\",null,{\"children\":[\"因此，仅当有意义的内容（\",[\"$r\",\"code\",null,{\"children\":\"roomId\"}],\" 或 \",[\"$r\",\"code\",null,{\"children\":\"isEncrypted\"}],\"）发生变化时，聊天才会重新连接：\"]}],[\"$r\",\"Sandpack\",null,{\"children\":[[\"$r\",\"pre\",null,{\"children\":[\"$r\",\"code\",null,{\"className\":\"language-json\",\"meta\":\"package.json hidden\",\"children\":\"{\\r\\n  \\\"dependencies\\\": {\\r\\n    \\\"react\\\": \\\"experimental\\\",\\r\\n    \\\"react-dom\\\": \\\"experimental\\\",\\r\\n    \\\"react-scripts\\\": \\\"latest\\\",\\r\\n    \\\"toastify-js\\\": \\\"1.12.0\\\"\\r\\n  },\\r\\n  \\\"scripts\\\": {\\r\\n    \\\"start\\\": \\\"react-scripts start\\\",\\r\\n    \\\"build\\\": \\\"react-scripts build\\\",\\r\\n    \\\"test\\\": \\\"react-scripts test --env=jsdom\\\",\\r\\n    \\\"eject\\\": \\\"react-scripts eject\\\"\\r\\n  }\\r\\n}\\n\"}]}],[\"$r\",\"pre\",null,{\"children\":[\"$r\",\"code\",null,{\"className\":\"language-js\",\"meta\":\"src/App.js\",\"children\":\"import { useState } from 'react';\\r\\nimport ChatRoom from './ChatRoom.js';\\r\\n\\r\\nimport { showNotification } from './notifications.js';\\r\\n\\r\\nexport default function App() {\\r\\n  const [isDark, setIsDark] = useState(false);\\r\\n  const [roomId, setRoomId] = useState('所有');\\r\\n  const [isEncrypted, setIsEncrypted] = useState(false);\\r\\n\\r\\n  return (\\r\\n    \u003c\u003e\\r\\n      \u003clabel\u003e\\r\\n        \u003cinput\\r\\n          type=\\\"checkbox\\\"\\r\\n          checked={isDark}\\r\\n          onChange={e =\u003e setIsDark(e.target.checked)}\\r\\n        /\u003e\\r\\n        使用暗黑主题\\r\\n      \u003c/label\u003e\\r\\n      \u003clabel\u003e\\r\\n        \u003cinput\\r\\n          type=\\\"checkbox\\\"\\r\\n          checked={isEncrypted}\\r\\n          onChange={e =\u003e setIsEncrypted(e.target.checked)}\\r\\n        /\u003e\\r\\n        开启加密功能\\r\\n      \u003c/label\u003e\\r\\n      \u003clabel\u003e\\r\\n        选择聊天室：\\r\\n        \u003cselect\\r\\n          value={roomId}\\r\\n          onChange={e =\u003e setRoomId(e.target.value)}\\r\\n        \u003e\\r\\n          \u003coption value=\\\"所有\\\"\u003e所有\u003c/option\u003e\\r\\n          \u003coption value=\\\"旅游\\\"\u003e旅游\u003c/option\u003e\\r\\n          \u003coption value=\\\"音乐\\\"\u003e音乐\u003c/option\u003e\\r\\n        \u003c/select\u003e\\r\\n      \u003c/label\u003e\\r\\n      \u003chr /\u003e\\r\\n      \u003cChatRoom\\r\\n        roomId={roomId}\\r\\n        isEncrypted={isEncrypted}\\r\\n        onMessage={msg =\u003e {\\r\\n          showNotification('新消息：' + msg, isDark ? 'dark' : 'light');\\r\\n        }}\\r\\n      /\u003e\\r\\n    \u003c/\u003e\\r\\n  );\\r\\n}\\n\"}]}],[\"$r\",\"pre\",null,{\"children\":[\"$r\",\"code\",null,{\"className\":\"language-js\",\"meta\":\"src/ChatRoom.js active\",\"children\":\"import { useState, useEffect } from 'react';\\r\\nimport { experimental_useEffectEvent as useEffectEvent } from 'react';\\r\\nimport {\\r\\n  createEncryptedConnection,\\r\\n  createUnencryptedConnection,\\r\\n} from './chat.js';\\r\\n\\r\\nexport default function ChatRoom({ roomId, isEncrypted, onMessage }) {\\r\\n  const onReceiveMessage = useEffectEvent(onMessage);\\r\\n\\r\\n  useEffect(() =\u003e {\\r\\n    function createConnection() {\\r\\n      const options = {\\r\\n        serverUrl: 'https://localhost:1234',\\r\\n        roomId: roomId\\r\\n      };\\r\\n      if (isEncrypted) {\\r\\n        return createEncryptedConnection(options);\\r\\n      } else {\\r\\n        return createUnencryptedConnection(options);\\r\\n      }\\r\\n    }\\r\\n\\r\\n    const connection = createConnection();\\r\\n    connection.on('message', (msg) =\u003e onReceiveMessage(msg));\\r\\n    connection.connect();\\r\\n    return () =\u003e connection.disconnect();\\r\\n  }, [roomId, isEncrypted]);\\r\\n\\r\\n  return \u003ch1\u003e欢迎来到 {roomId} 房间！\u003c/h1\u003e;\\r\\n}\\n\"}]}],[\"$r\",\"pre\",null,{\"children\":[\"$r\",\"code\",null,{\"className\":\"language-js\",\"meta\":\"src/chat.js\",\"children\":\"export function createEncryptedConnection({ serverUrl, roomId }) {\\r\\n  // 真正的实现实际上会连接到服务器\\r\\n  if (typeof serverUrl !== 'string') {\\r\\n    throw Error('期望 serverUrl 是字符串类型，收到：' + serverUrl);\\r\\n  }\\r\\n  if (typeof roomId !== 'string') {\\r\\n    throw Error('期望 roomId 是字符串类型，收到：' + roomId);\\r\\n  }\\r\\n  let intervalId;\\r\\n  let messageCallback;\\r\\n  return {\\r\\n    connect() {\\r\\n      console.log('✅ 🔐 连接到“' + roomId + '”房间...（已加密）');\\r\\n      clearInterval(intervalId);\\r\\n      intervalId = setInterval(() =\u003e {\\r\\n        if (messageCallback) {\\r\\n          if (Math.random() \u003e 0.5) {\\r\\n            messageCallback('hey')\\r\\n          } else {\\r\\n            messageCallback('lol');\\r\\n          }\\r\\n        }\\r\\n      }, 3000);\\r\\n    },\\r\\n    disconnect() {\\r\\n      clearInterval(intervalId);\\r\\n      messageCallback = null;\\r\\n      console.log('❌ 🔐 断开“' + roomId + '”房间（已加密）');\\r\\n    },\\r\\n    on(event, callback) {\\r\\n      if (messageCallback) {\\r\\n        throw Error('不能添加 handler 2次');\\r\\n      }\\r\\n      if (event !== 'message') {\\r\\n        throw Error('仅支持 \\\"message\\\" 事件');\\r\\n      }\\r\\n      messageCallback = callback;\\r\\n    },\\r\\n  };\\r\\n}\\r\\n\\r\\nexport function createUnencryptedConnection({ serverUrl, roomId }) {\\r\\n  // 真正的实现实际上会连接到服务器\\r\\n  if (typeof serverUrl !== 'string') {\\r\\n    throw Error('期望 serverUrl 是字符串类型，收到：' + serverUrl);\\r\\n  }\\r\\n  if (typeof roomId !== 'string') {\\r\\n    throw Error('期望 roomId 是字符串类型，收到：' + roomId);\\r\\n  }\\r\\n  let intervalId;\\r\\n  let messageCallback;\\r\\n  return {\\r\\n    connect() {\\r\\n      console.log('✅ 连接到“' + roomId + '”房间（未加密）...');\\r\\n      clearInterval(intervalId);\\r\\n      intervalId = setInterval(() =\u003e {\\r\\n        if (messageCallback) {\\r\\n          if (Math.random() \u003e 0.5) {\\r\\n            messageCallback('hey')\\r\\n          } else {\\r\\n            messageCallback('lol');\\r\\n          }\\r\\n        }\\r\\n      }, 3000);\\r\\n    },\\r\\n    disconnect() {\\r\\n      clearInterval(intervalId);\\r\\n      messageCallback = null;\\r\\n      console.log('❌ 断开“' + roomId + '”房间（未加密）');\\r\\n    },\\r\\n    on(event, callback) {\\r\\n      if (messageCallback) {\\r\\n        throw Error('不能添加 handler 2次');\\r\\n      }\\r\\n      if (event !== 'message') {\\r\\n        throw Error('仅支持 \\\"message\\\" 事件');\\r\\n      }\\r\\n      messageCallback = callback;\\r\\n    },\\r\\n  };\\r\\n}\\n\"}]}],[\"$r\",\"pre\",null,{\"children\":[\"$r\",\"code\",null,{\"className\":\"language-js\",\"meta\":\"src/notifications.js\",\"children\":\"import Toastify from 'toastify-js';\\r\\nimport 'toastify-js/src/toastify.css';\\r\\n\\r\\nexport function showNotification(message, theme) {\\r\\n  Toastify({\\r\\n    text: message,\\r\\n    duration: 2000,\\r\\n    gravity: 'top',\\r\\n    position: 'right',\\r\\n    style: {\\r\\n      background: theme === 'dark' ? 'black' : 'white',\\r\\n      color: theme === 'dark' ? 'white' : 'black',\\r\\n    },\\r\\n  }).showToast();\\r\\n}\\n\"}]}],[\"$r\",\"pre\",null,{\"children\":[\"$r\",\"code\",null,{\"className\":\"language-css\",\"children\":\"label, button { display: block; margin-bottom: 5px; }\\n\"}]}]]}]]}]]}],[\"$r\",\"MaxWidth\",\"last\",{\"children\":[\"\\n\",[\"$r\",\"p\",null,{\"children\":[[\"$r\",\"strong\",null,{\"children\":\"译注\"}],\"：\\r\\n\",[\"$r\",\"a\",null,{\"name\":\"note1\"}],\" 在创建 \",[\"$r\",\"code\",null,{\"children\":\"onTick\"}],\" 函数时，由于闭包的缘故，\",[\"$r\",\"code\",null,{\"children\":\"setCount(count + increment)\"}],\" 捕获的是创建时 \",[\"$r\",\"code\",null,{\"children\":\"count\"}],\" 和 \",[\"$r\",\"code\",null,{\"children\":\"increment\"}],\" 值。由于这里的“说谎”，每次重新渲染时新创建的 \",[\"$r\",\"code\",null,{\"children\":\"onTick\"}],\" 函数不能替换掉 Effect 里旧 \",[\"$r\",\"code\",null,{\"children\":\"onTick\"}],\" 函数，于是最终的效果就是 \",[\"$r\",\"code\",null,{\"children\":\"setCount(0 + 1)\"}],\" \",[\"$r\",\"br\",null,{}]]}]]}]]","meta":{"title":"移除 Effect 依赖"},"languages":null},"__N_SSG":true},"page":"/[[...markdownPath]]","query":{"markdownPath":["learn","removing-effect-dependencies"]},"buildId":"o3sV9gi4zL8eH-vfCdLA_","isFallback":false,"gsp":true,"scriptLoader":[]}</script></body></html>