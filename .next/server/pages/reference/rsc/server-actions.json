{"pageProps":{"toc":"[{\"url\":\"#\",\"text\":\"概览\",\"depth\":2},{\"url\":\"#creating-a-server-action-from-a-server-component\",\"depth\":3,\"text\":\"Creating a Server Action from a Server Component \"},{\"url\":\"#importing-server-actions-from-client-components\",\"depth\":3,\"text\":\"Importing Server Actions from Client Components \"},{\"url\":\"#composing-server-actions-with-actions\",\"depth\":3,\"text\":\"Composing Server Actions with Actions \"},{\"url\":\"#form-actions-with-server-actions\",\"depth\":3,\"text\":\"Form Actions with Server Actions \"},{\"url\":\"#server-actions-with-use-action-state\",\"depth\":3,\"text\":[\"Server Actions with \",[\"$r\",\"code\",null,{\"children\":\"useActionState\"}],\" \"]},{\"url\":\"#progressive-enhancement-with-useactionstate\",\"depth\":3,\"text\":[\"Progressive enhancement with \",[\"$r\",\"code\",null,{\"children\":\"useActionState\"}],\" \"]}]","content":"[[\"$r\",\"MaxWidth\",\"last\",{\"children\":[[\"$r\",\"Intro\",null,{\"children\":[\"$r\",\"p\",null,{\"children\":\"Server Actions allow Client Components to call async functions executed on the server.\"}]}],\"\\n\",[\"$r\",\"InlineToc\",null,{}],\"\\n\",[\"$r\",\"Note\",null,{\"children\":[[\"$r\",\"h4\",null,{\"id\":\"how-do-i-build-support-for-server-actions\",\"children\":\"How do I build support for Server Actions? \"}],[\"$r\",\"p\",null,{\"children\":\"While Server Actions in React 19 are stable and will not break between major versions, the underlying APIs used to implement Server Actions in a React Server Components bundler or framework do not follow semver and may break between minors in React 19.x.\"}],[\"$r\",\"p\",null,{\"children\":\"To support Server Actions as a bundler or framework, we recommend pinning to a specific React version, or using the Canary release. We will continue working with bundlers and frameworks to stabilize the APIs used to implement Server Actions in the future.\"}]]}],\"\\n\",[\"$r\",\"p\",null,{\"children\":[\"When a Server Action is defined with the \",[\"$r\",\"code\",null,{\"children\":\"\\\"use server\\\"\"}],\" directive, your framework will automatically create a reference to the server function, and pass that reference to the Client Component. When that function is called on the client, React will send a request to the server to execute the function, and return the result.\"]}],\"\\n\",[\"$r\",\"p\",null,{\"children\":\"Server Actions can be created in Server Components and passed as props to Client Components, or they can be imported and used in Client Components.\"}],\"\\n\",[\"$r\",\"h3\",null,{\"id\":\"creating-a-server-action-from-a-server-component\",\"children\":\"Creating a Server Action from a Server Component \"}],\"\\n\",[\"$r\",\"p\",null,{\"children\":[\"Server Components can define Server Actions with the \",[\"$r\",\"code\",null,{\"children\":\"\\\"use server\\\"\"}],\" directive:\"]}],\"\\n\",[\"$r\",\"pre\",null,{\"children\":[\"$r\",\"code\",null,{\"className\":\"language-js\",\"meta\":\"[[2, 7, \\\"'use server'\\\"], [1, 5, \\\"createNoteAction\\\"], [1, 12, \\\"createNoteAction\\\"]]\",\"children\":\"// Server Component\\r\\nimport Button from './Button';\\r\\n\\r\\nfunction EmptyNote () {\\r\\n  async function createNoteAction() {\\r\\n    // Server Action\\r\\n    'use server';\\r\\n    \\r\\n    await db.notes.create();\\r\\n  }\\r\\n\\r\\n  return <Button onClick={createNoteAction}/>;\\r\\n}\\n\"}]}],\"\\n\",[\"$r\",\"p\",null,{\"children\":[\"When React renders the \",[\"$r\",\"code\",null,{\"children\":\"EmptyNote\"}],\" Server Component, it will create a reference to the \",[\"$r\",\"code\",null,{\"children\":\"createNoteAction\"}],\" function, and pass that reference to the \",[\"$r\",\"code\",null,{\"children\":\"Button\"}],\" Client Component. When the button is clicked, React will send a request to the server to execute the \",[\"$r\",\"code\",null,{\"children\":\"createNoteAction\"}],\" function with the reference provided:\"]}],\"\\n\",[\"$r\",\"pre\",null,{\"children\":[\"$r\",\"code\",null,{\"className\":\"language-js\",\"meta\":\"{5}\",\"children\":\"\\\"use client\\\";\\r\\n\\r\\nexport default function Button({onClick}) { \\r\\n  console.log(onClick); \\r\\n  // {$$typeof: Symbol.for(\\\"react.server.reference\\\"), $$id: 'createNoteAction'}\\r\\n  return <button onClick={() => onClick()}>Create Empty Note</button>\\r\\n}\\n\"}]}],\"\\n\",[\"$r\",\"p\",null,{\"children\":[\"For more, see the docs for \",[\"$r\",\"a\",null,{\"href\":\"/reference/rsc/use-server\",\"children\":[\"$r\",\"code\",null,{\"children\":\"\\\"use server\\\"\"}]}],\".\"]}],\"\\n\",[\"$r\",\"h3\",null,{\"id\":\"importing-server-actions-from-client-components\",\"children\":\"Importing Server Actions from Client Components \"}],\"\\n\",[\"$r\",\"p\",null,{\"children\":[\"Client Components can import Server Actions from files that use the \",[\"$r\",\"code\",null,{\"children\":\"\\\"use server\\\"\"}],\" directive:\"]}],\"\\n\",[\"$r\",\"pre\",null,{\"children\":[\"$r\",\"code\",null,{\"className\":\"language-js\",\"meta\":\"[[1, 3, \\\"createNoteAction\\\"]]\",\"children\":\"\\\"use server\\\";\\r\\n\\r\\nexport async function createNoteAction() {\\r\\n  await db.notes.create();\\r\\n}\\r\\n\\n\"}]}],\"\\n\",[\"$r\",\"p\",null,{\"children\":[\"When the bundler builds the \",[\"$r\",\"code\",null,{\"children\":\"EmptyNote\"}],\" Client Component, it will create a reference to the \",[\"$r\",\"code\",null,{\"children\":\"createNoteAction\"}],\" function in the bundle. When the \",[\"$r\",\"code\",null,{\"children\":\"button\"}],\" is clicked, React will send a request to the server to execute the \",[\"$r\",\"code\",null,{\"children\":\"createNoteAction\"}],\" function using the reference provided:\"]}],\"\\n\",[\"$r\",\"pre\",null,{\"children\":[\"$r\",\"code\",null,{\"className\":\"language-js\",\"meta\":\"[[1, 2, \\\"createNoteAction\\\"], [1, 5, \\\"createNoteAction\\\"], [1, 7, \\\"createNoteAction\\\"]]\",\"children\":\"\\\"use client\\\";\\r\\nimport {createNoteAction} from './actions';\\r\\n\\r\\nfunction EmptyNote() {\\r\\n  console.log(createNoteAction);\\r\\n  // {$$typeof: Symbol.for(\\\"react.server.reference\\\"), $$id: 'createNoteAction'}\\r\\n  return <button onClick={createNoteAction} />\\r\\n}\\n\"}]}],\"\\n\",[\"$r\",\"p\",null,{\"children\":[\"For more, see the docs for \",[\"$r\",\"a\",null,{\"href\":\"/reference/rsc/use-server\",\"children\":[\"$r\",\"code\",null,{\"children\":\"\\\"use server\\\"\"}]}],\".\"]}],\"\\n\",[\"$r\",\"h3\",null,{\"id\":\"composing-server-actions-with-actions\",\"children\":\"Composing Server Actions with Actions \"}],\"\\n\",[\"$r\",\"p\",null,{\"children\":\"Server Actions can be composed with Actions on the client:\"}],\"\\n\",[\"$r\",\"pre\",null,{\"children\":[\"$r\",\"code\",null,{\"className\":\"language-js\",\"meta\":\"[[1, 3, \\\"updateName\\\"]]\",\"children\":\"\\\"use server\\\";\\r\\n\\r\\nexport async function updateName(name) {\\r\\n  if (!name) {\\r\\n    return {error: 'Name is required'};\\r\\n  }\\r\\n  await db.users.updateName(name);\\r\\n}\\n\"}]}],\"\\n\",[\"$r\",\"pre\",null,{\"children\":[\"$r\",\"code\",null,{\"className\":\"language-js\",\"meta\":\"[[1, 3, \\\"updateName\\\"], [1, 13, \\\"updateName\\\"], [2, 11, \\\"submitAction\\\"],  [2, 23, \\\"submitAction\\\"]]\",\"children\":\"\\\"use client\\\";\\r\\n\\r\\nimport {updateName} from './actions';\\r\\n\\r\\nfunction UpdateName() {\\r\\n  const [name, setName] = useState('');\\r\\n  const [error, setError] = useState(null);\\r\\n\\r\\n  const [isPending, startTransition] = useTransition();\\r\\n\\r\\n  const submitAction = async () => {\\r\\n    startTransition(async () => {\\r\\n      const {error} = await updateName(name);\\r\\n      if (!error) {\\r\\n        setError(error);\\r\\n      } else {\\r\\n        setName('');\\r\\n      }\\r\\n    })\\r\\n  }\\r\\n  \\r\\n  return (\\r\\n    <form action={submitAction}>\\r\\n      <input type=\\\"text\\\" name=\\\"name\\\" disabled={isPending}/>\\r\\n      {state.error && <span>Failed: {state.error}</span>}\\r\\n    </form>\\r\\n  )\\r\\n}\\n\"}]}],\"\\n\",[\"$r\",\"p\",null,{\"children\":[\"This allows you to access the \",[\"$r\",\"code\",null,{\"children\":\"isPending\"}],\" state of the Server Action by wrapping it in an Action on the client.\"]}],\"\\n\",[\"$r\",\"p\",null,{\"children\":[\"For more, see the docs for \",[\"$r\",\"a\",null,{\"href\":\"/reference/rsc/use-server#calling-a-server-action-outside-of-form\",\"children\":[\"Calling a Server Action outside of \",[\"$r\",\"code\",null,{\"children\":\"<form>\"}]]}]]}],\"\\n\",[\"$r\",\"h3\",null,{\"id\":\"form-actions-with-server-actions\",\"children\":\"Form Actions with Server Actions \"}],\"\\n\",[\"$r\",\"p\",null,{\"children\":\"Server Actions work with the new Form features in React 19.\"}],\"\\n\",[\"$r\",\"p\",null,{\"children\":\"You can pass a Server Action to a Form to automatically submit the form to the server:\"}],\"\\n\",[\"$r\",\"pre\",null,{\"children\":[\"$r\",\"code\",null,{\"className\":\"language-js\",\"meta\":\"[[1, 3, \\\"updateName\\\"], [1, 7, \\\"updateName\\\"]]\",\"children\":\"\\\"use client\\\";\\r\\n\\r\\nimport {updateName} from './actions';\\r\\n\\r\\nfunction UpdateName() {\\r\\n  return (\\r\\n    <form action={updateName}>\\r\\n      <input type=\\\"text\\\" name=\\\"name\\\" />\\r\\n    </form>\\r\\n  )\\r\\n}\\n\"}]}],\"\\n\",[\"$r\",\"p\",null,{\"children\":[\"When the Form submission succeeds, React will automatically reset the form. You can add \",[\"$r\",\"code\",null,{\"children\":\"useActionState\"}],\" to access the pending state, last response, or to support progressive enhancement.\"]}],\"\\n\",[\"$r\",\"p\",null,{\"children\":[\"For more, see the docs for \",[\"$r\",\"a\",null,{\"href\":\"/reference/rsc/use-server#server-actions-in-forms\",\"children\":\"Server Actions in Forms\"}],\".\"]}],\"\\n\",[\"$r\",\"h3\",null,{\"id\":\"server-actions-with-use-action-state\",\"children\":[\"Server Actions with \",[\"$r\",\"code\",null,{\"children\":\"useActionState\"}],\" \"]}],\"\\n\",[\"$r\",\"p\",null,{\"children\":[\"You can compose Server Actions with \",[\"$r\",\"code\",null,{\"children\":\"useActionState\"}],\" for the common case where you just need access to the action pending state and last returned response:\"]}],\"\\n\",[\"$r\",\"pre\",null,{\"children\":[\"$r\",\"code\",null,{\"className\":\"language-js\",\"meta\":\"[[1, 3, \\\"updateName\\\"], [1, 6, \\\"updateName\\\"], [2, 6, \\\"submitAction\\\"], [2, 9, \\\"submitAction\\\"]]\",\"children\":\"\\\"use client\\\";\\r\\n\\r\\nimport {updateName} from './actions';\\r\\n\\r\\nfunction UpdateName() {\\r\\n  const [state, submitAction, isPending] = useActionState(updateName, {error: null});\\r\\n\\r\\n  return (\\r\\n    <form action={submitAction}>\\r\\n      <input type=\\\"text\\\" name=\\\"name\\\" disabled={isPending}/>\\r\\n      {state.error && <span>Failed: {state.error}</span>}\\r\\n    </form>\\r\\n  );\\r\\n}\\n\"}]}],\"\\n\",[\"$r\",\"p\",null,{\"children\":[\"When using \",[\"$r\",\"code\",null,{\"children\":\"useActionState\"}],\" with Server Actions, React will also automatically replay form submissions entered before hydration finishes. This means users can interact with your app even before the app has hydrated.\"]}],\"\\n\",[\"$r\",\"p\",null,{\"children\":[\"For more, see the docs for \",[\"$r\",\"a\",null,{\"href\":\"/reference/react/useActionState\",\"children\":[\"$r\",\"code\",null,{\"children\":\"useActionState\"}]}],\".\"]}],\"\\n\",[\"$r\",\"h3\",null,{\"id\":\"progressive-enhancement-with-useactionstate\",\"children\":[\"Progressive enhancement with \",[\"$r\",\"code\",null,{\"children\":\"useActionState\"}],\" \"]}],\"\\n\",[\"$r\",\"p\",null,{\"children\":[\"Server Actions also support progressive enhancement with the third argument of \",[\"$r\",\"code\",null,{\"children\":\"useActionState\"}],\".\"]}],\"\\n\",[\"$r\",\"pre\",null,{\"children\":[\"$r\",\"code\",null,{\"className\":\"language-js\",\"meta\":\"[[1, 3, \\\"updateName\\\"], [1, 6, \\\"updateName\\\"], [2, 6, \\\"/name/update\\\"], [3, 6, \\\"submitAction\\\"], [3, 9, \\\"submitAction\\\"]]\",\"children\":\"\\\"use client\\\";\\r\\n\\r\\nimport {updateName} from './actions';\\r\\n\\r\\nfunction UpdateName() {\\r\\n  const [, submitAction] = useActionState(updateName, null, `/name/update`);\\r\\n\\r\\n  return (\\r\\n    <form action={submitAction}>\\r\\n      ...\\r\\n    </form>\\r\\n  );\\r\\n}\\n\"}]}],\"\\n\",[\"$r\",\"p\",null,{\"children\":[\"When the \",[\"$r\",\"CodeStep\",null,{\"step\":2,\"children\":\"permalink\"}],\" is provided to \",[\"$r\",\"code\",null,{\"children\":\"useActionState\"}],\", React will redirect to the provided URL if the form is submitted before the JavaScript bundle loads.\"]}],\"\\n\",[\"$r\",\"p\",null,{\"children\":[\"For more, see the docs for \",[\"$r\",\"a\",null,{\"href\":\"/reference/react/useActionState\",\"children\":[\"$r\",\"code\",null,{\"children\":\"useActionState\"}]}],\".\"]}]]}]]","meta":{"title":"Server Actions","canary":true},"languages":null},"__N_SSG":true}